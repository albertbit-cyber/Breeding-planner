const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf-5IEmIIiP.js","assets/vendor-CCGeIgWZ.js","assets/pdfjs-DJpon-Fg.js"])))=>i.map(i=>d[i]);
import{r as h,j as t,c as rl,R as al}from"./vendor-react-szI2idXW.js";import{_ as xs}from"./jspdf-5IEmIIiP.js";import{b as Rn,j as ol}from"./vendor-CCGeIgWZ.js";import{p as _n}from"./pdfjs-DJpon-Fg.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const Ot=1e-6,Xt=()=>({0:0,1:0,2:0}),dn=e=>({0:e[0]??0,1:e[1]??0,2:e[2]??0}),Er=Object.freeze({0:1,1:0,2:0}),ll=e=>e.trim().toLowerCase().replace(/\s+/g," "),il=e=>{let s=e.trim();return s?(s=s.replace(/\(([^)]*)\)/g," $1 "),s=s.replace(/\b(?:possible|pos|probable|het|ph|carrier)\b/gi,""),s=s.replace(/\d+(?:\.\d+)?\s*%/g,""),s=s.replace(/\s+/g," ").trim(),s||(s=e.trim()),s.split(" ").filter(Boolean).map(a=>a.length<=2?a.toUpperCase():/^[A-Z]+$/.test(a)?a:a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ")||e.trim()):""},Ir=e=>Math.abs(e[2]-1)<Ot?3:Math.abs(e[1]-1)<Ot?2:e[1]>Ot?1:0,cl=(e,s)=>{const n=e[1]??0,o=s[1]??0,a=1-(1-n)*(1-o),r=Xt();return r[1]=a,r[0]=1-a,r},dl=(e,s,n,o)=>{const a=Ir(o);return e?(a>e.level?(e.distribution=dn(o),e.level=a):a===e.level&&a===1&&(e.distribution=cl(e.distribution,o),e.level=Ir(e.distribution)),(n==="recessive"||!e.type||e.type!==n&&n==="co-dom"&&e.type==="dominant")&&(e.type=n),e):{gene:s,type:n,distribution:dn(o),level:a}},ul=e=>{const s=e.trim();return/^super\s+/i.test(s)?{gene:s.replace(/^super\s+/i,"").trim(),alleleCount:2}:{gene:s,alleleCount:1}},ml=e=>{const s=e.match(/(\d+(?:\.\d+)?)\s*%/);if(s){const n=Number(s[1]);if(!Number.isNaN(n))return Math.max(0,Math.min(1,n/100))}},Lr=e=>{const s=new Map,n=(o,a,r)=>{const l=il(o),c=ll(l),d=s.get(c);s.set(c,dl(d,l,a,r))};return(e.morphs||[]).forEach(o=>{if(!(o!=null&&o.name))return;const a=o.name.trim();if(a)if(o.type==="recessive"){const r=Xt();r[2]=1,n(a,"recessive",r)}else if(o.type==="co-dom"){const r=ul(a),l=Xt();l[r.alleleCount]=1,n(r.gene,"co-dom",l)}else if(o.type==="dominant"||o.type==="polygenic"||o.type==="co-dom"){const r=Xt();r[1]=1,n(a,"dominant",r)}else{const r=Xt();r[1]=1,n(a,"dominant",r)}}),(e.hets||[]).forEach(o=>{if(!o)return;const a=Xt();a[1]=1,n(o,"recessive",a)}),(e.possibleHets||[]).forEach(o=>{if(!o)return;const a=ml(o)??.5,r=Xt();r[1]=a,r[0]=1-a,n(o,"recessive",r)}),s},Mr=e=>e<=0?0:e>=2?1:.5,hl=(e,s)=>{const n=Xt(),o=[[0,e[0]??0],[1,e[1]??0],[2,e[2]??0]],a=[[0,s[0]??0],[1,s[1]??0],[2,s[2]??0]];o.forEach(([l,c])=>{c<=Ot||a.forEach(([d,u])=>{if(u<=Ot)return;const m=c*u,p=Mr(l),g=Mr(d),f=p*g,y=p*(1-g),j=(1-p)*g,w=y+j,D=(1-p)*(1-g);n[2]+=m*f,n[1]+=m*w,n[0]+=m*D})});const r=n[0]+n[1]+n[2];return r>Ot&&(n[0]/=r,n[1]/=r,n[2]/=r),n},pl=(e,s,n)=>{const o=[],a=(r,l)=>{r>Ot&&o.push({labels:l,prob:r})};if(s==="recessive")a(n[2]??0,[e]),a(n[1]??0,[`het ${e}`]),a(n[0]??0,[]);else if(s==="co-dom")a(n[2]??0,[`Super ${e}`]),a(n[1]??0,[e]),a(n[0]??0,[]);else{const r=(n[1]??0)+(n[2]??0);a(r,[e]),a(n[0]??0,[])}return o.length?o:[{labels:[],prob:1}]},fl=(e,s)=>{const n=Lr(e),o=Lr(s),a=new Set([...n.keys(),...o.keys()]);return Array.from(a).map(r=>{const l=n.get(r),c=o.get(r),d=(l==null?void 0:l.gene)??(c==null?void 0:c.gene)??r,u=(l==null?void 0:l.type)??(c==null?void 0:c.type)??"recessive",m=l?l.distribution:dn(Er),p=c?c.distribution:dn(Er);return{gene:d,type:u,parentA:m,parentB:p}})},xl=e=>{let s=[{labels:[],prob:1}];e.forEach(r=>{const l=hl(r.parentA,r.parentB),c=pl(r.gene,r.type,l),d=[];c.forEach(u=>{s.forEach(m=>{const p=m.prob*u.prob;p<=Ot||d.push({labels:[...m.labels,...u.labels],prob:p})})}),s=d.length?d:s});const n=new Map;s.forEach(r=>{const l=r.labels.slice().sort((u,m)=>u.localeCompare(m)),c=l.join("|"),d=n.get(c);d?d.prob+=r.prob:n.set(c,{labels:l,prob:r.prob})});let o=0;n.forEach(r=>{o+=r.prob}),o>Ot&&Math.abs(o-1)>1e-6&&n.forEach(r=>{r.prob=r.prob/o});const a=Array.from(n.values()).filter(r=>r.prob>Ot).map(r=>({genotype:r.labels,prob:r.prob,flags:[]})).sort((r,l)=>l.prob-r.prob);return a.length?a:[{genotype:[],prob:1,flags:[]}]},gl=(e,s)=>{const n=fl(e,s);return n.length?xl(n):[{genotype:[],prob:1,flags:[]}]},On=(e,s)=>gl(e,s);var Tr={};const ks=60*60*1e3,_t=e=>!e||!Number.isFinite(e)||e<=0?0:e,bl=typeof window<"u"&&typeof window.document<"u",yl=()=>{const e=new Map,s=new Map,n=(o,a)=>{const r=_t(a);if(!r)return!1;const l=Date.now()-r*ks;return o.ts<l};return{getSearchCache(o,a){if(!o)return null;const r=e.get(o);return r?n(r,a)?(e.delete(o),null):r.value:null},setSearchCache(o,a,r){if(o&&(e.set(o,{value:a,ts:Date.now()}),_t(r))){const l=_t(r),c=Date.now()-l*ks;Array.from(e.entries()).forEach(([d,u])=>{u.ts<c&&e.delete(d)})}},getPageCache(o,a){if(!o)return null;const r=s.get(o);return r?n(r,a)?(s.delete(o),null):r.value:null},setPageCache(o,a,r){if(o&&(s.set(o,{value:a,ts:Date.now()}),_t(r))){const l=_t(r),c=Date.now()-l*ks;Array.from(s.entries()).forEach(([d,u])=>{u.ts<c&&s.delete(d)})}}}},Nl=()=>{const e=require("fs"),s=require("path"),n=(()=>{try{return require("better-sqlite3")}catch{return null}})(),o=Tr.CACHE_DB_PATH?s.resolve(process.cwd(),Tr.CACHE_DB_PATH):s.resolve(process.cwd(),"data","cache.sqlite");let a=null;const r=()=>{if(a)return a;if(!n)throw new Error("better-sqlite3 is required for caching. Install it by running 'npm install better-sqlite3'.");const c=o;e.mkdirSync(s.dirname(c),{recursive:!0});const d=new n(c);return d.pragma("journal_mode = WAL"),d.exec("CREATE TABLE IF NOT EXISTS search_hits (query TEXT PRIMARY KEY, json TEXT NOT NULL, ts INTEGER NOT NULL)"),d.exec("CREATE TABLE IF NOT EXISTS pages (url TEXT PRIMARY KEY, html TEXT NOT NULL, ts INTEGER NOT NULL)"),a=d,a},l=(c,d)=>{const u=_t(d);if(u)try{const m=Date.now()-u*ks;r().prepare(`DELETE FROM ${c} WHERE ts < ?`).run(m)}catch{}};return{getSearchCache(c,d){if(!c)return null;try{const m=r().prepare("SELECT json, ts FROM search_hits WHERE query = ?").get(c);if(!m)return null;if(_t(d)){const p=Date.now()-_t(d)*ks;if(m.ts<p)return null}return JSON.parse(m.json)}catch{return null}},setSearchCache(c,d,u){if(c)try{const m=Date.now();r().prepare("INSERT INTO search_hits (query, json, ts) VALUES (?, ?, ?) ON CONFLICT(query) DO UPDATE SET json = excluded.json, ts = excluded.ts").run(c,JSON.stringify(d),m),l("search_hits",u)}catch{}},getPageCache(c,d){if(!c)return null;try{const m=r().prepare("SELECT html, ts FROM pages WHERE url = ?").get(c);if(!m)return null;if(_t(d)){const p=Date.now()-_t(d)*ks;if(m.ts<p)return null}return m.html}catch{return null}},setPageCache(c,d,u){if(c)try{const m=Date.now();r().prepare("INSERT INTO pages (url, html, ts) VALUES (?, ?, ?) ON CONFLICT(url) DO UPDATE SET html = excluded.html, ts = excluded.ts").run(c,d,m),l("pages",u)}catch{}}}},pn=bl?yl():Nl(),wl=(e,s)=>pn.getSearchCache(e,s),vl=(e,s,n)=>pn.setSearchCache(e,s,n),jl=(e,s)=>pn.getPageCache(e,s),Cl=(e,s,n)=>pn.setPageCache(e,s,n);var Fr={NVM_INC:"/Users/albertbitton/.nvm/versions/node/v20.19.5/include/node",TERM_PROGRAM:"vscode",NODE:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",INIT_CWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_CD_FLAGS:"-q",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/",npm_config_global_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",VSCODE_PYTHON_AUTOACTIVATE_GUARD:"1",TERM_PROGRAM_VERSION:"1.106.0",ZDOTDIR:"/Users/albertbitton",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_DIR:"/Users/albertbitton/.nvm",USER:"albertbitton",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/Users/albertbitton/.nvm/versions/node/v20.19.5/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.gyh6QCvRwm/Listeners",VSCODE_PROFILE_INITIALIZED:"1",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin:/Users/albertbitton/Documents/GitHub/node_modules/.bin:/Users/albertbitton/Documents/node_modules/.bin:/Users/albertbitton/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_package_json:"/Users/albertbitton/Documents/GitHub/Breeding-planner/package.json",_:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin/cross-env",npm_config_userconfig:"/Users/albertbitton/.npmrc",npm_config_init_module:"/Users/albertbitton/.npm-init.js",USER_ZDOTDIR:"/Users/albertbitton",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run-script",PWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",npm_lifecycle_event:"deploy",EDITOR:"vi",npm_package_name:"breeding-planner",LANG:"en_US.UTF-8",npm_config_npm_version:"10.8.2",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"0.1.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/albertbitton",VSCODE_GIT_ASKPASS_MAIN:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",npm_config_cache:"/Users/albertbitton/.npm",LOGNAME:"albertbitton",npm_lifecycle_script:"cross-env PUBLIC_URL=https://albertbit-cyber.github.io/Breeding-planner/ vite build && gh-pages -d dist",VSCODE_GIT_IPC_HANDLE:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/vscode-git-c6232d8e0d.sock",NVM_BIN:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_config_user_agent:"npm/10.8.2 node/v20.19.5 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",GIT_PAGER:"cat",npm_node_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",npm_config_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",COLORTERM:"truecolor",PUBLIC_URL:"https://albertbit-cyber.github.io/Breeding-planner/",NODE_ENV:"production"};const Sl=8e3,kl=(e,s)=>{const n=Number(e);return Number.isFinite(n)&&n>0?n:s},Al=typeof process<"u"&&process&&Fr?Fr:{},Da=kl(Al.PAGE_CACHE_TTL_HOURS,24),Dl=/\$?\b\d{2,5}\b/g,El=[/\b\d{4}-\d{1,2}-\d{1,2}\b/g,/\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/g,/\b(?:jan|feb|mar|apr|may|jun|jul|aug|sep|sept|oct|nov|dec)[a-z]*\.?\s+\d{1,2},?\s+\d{4}\b/gi],Us=e=>!Number.isFinite(e)||e<0?0:e>1?1:e,Il=e=>{try{return new URL(e)}catch{return null}},Ll=async(e,s)=>{const n=new AbortController,o=setTimeout(()=>n.abort(),s);try{return await fetch(e,{signal:n.signal,headers:{"User-Agent":"BreedingPlanner/1.0 (Demand Extractor)",Accept:"text/html,application/xhtml+xml"}})}finally{clearTimeout(o)}};let Pt=null;const $r=new Function("specifier","return import(specifier);"),Ml=async()=>{if(Pt)return Pt;Pt={};try{const e=await $r("jsdom").catch(()=>null);if(Pt.JSDOM=e==null?void 0:e.JSDOM,Pt.JSDOM)try{const s=await $r("@mozilla/readability").catch(()=>null);Pt.Readability=s==null?void 0:s.Readability}catch{Pt.Readability=void 0}}catch{Pt.JSDOM=void 0,Pt.Readability=void 0}return Pt},Tl=e=>{const s=e.replace(/[^\d]/g,"");if(!s)return null;const n=Number(s);return!Number.isFinite(n)||n<25||n>5e4?null:n},Fl=e=>{const s=e.replace(/\s+/g," ").replace(/[,]/g,"").trim();if(!s)return null;if(s.match(/^\d{4}-\d{1,2}-\d{1,2}$/)){const[r,l,c]=s.split("-").map(d=>Number(d));return new Date(r,l-1,c)}const o=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);if(o){let r=Number(o[3]);const l=Number(o[1]),c=Number(o[2]);return r<100&&(r=r>=70?1900+r:2e3+r),new Date(r,l-1,c)}const a=Date.parse(s);return Number.isNaN(a)?null:new Date(a)},$l=(e,s)=>{if(!e.length)return .2;const n=24*60*60*1e3,o=e.reduce((r,l)=>{const d=Math.max(0,s.getTime()-l.getTime())/n;return Math.min(r,d)},Number.POSITIVE_INFINITY);if(!Number.isFinite(o))return .2;const a=Math.exp(-o/45);return Us(a)},Pl=(e,s)=>{if(!e)return[];const n=e.split(new RegExp("(?<=[.!?])\\s+")).map(a=>a.trim()).filter(Boolean);if(!n.length)return[];const o=[];return s&&new Set(Array.from(s)).forEach(r=>{const l=n.find(c=>c.includes(r));l&&o.push(l.substring(0,240))}),o.length||o.push(n[0].substring(0,240)),o.slice(0,3)},Pr=async(e,s,n)=>{var g,f;const{JSDOM:o,Readability:a}=await Ml();let r=e,l="";if(o&&a)try{const y=new o(s,{url:e});r=y.window.document.title||r;const w=new a(y.window.document).parse();w!=null&&w.textContent?(l=w.textContent,r=w.title||r):l=((g=y.window.document.body)==null?void 0:g.textContent)||""}catch{l=""}if(!l){const y=s.replace(/<script[^>]*>[\s\S]*?<\/script>/gi," ").replace(/<style[^>]*>[\s\S]*?<\/style>/gi," ").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),j=s.match(/<title[^>]*>([^<]*)<\/title>/i);r=((f=j==null?void 0:j[1])==null?void 0:f.trim())||r,l=y}const c=l.match(Dl),d=[];c&&c.forEach(y=>{const j=Tl(y);j&&d.push(j)});const u=[];El.forEach(y=>{const j=l.match(y);j&&j.forEach(w=>{const D=Fl(w);D&&u.push(D)})});const m=$l(u,n),p=Pl(l,c);return{url:e,title:r,text:l,prices:d,freshnessScore:m,signals:p}},Rl=e=>{const s=new Set,n=[];return e.forEach(o=>{const a=Il(o);if(!a)return;const r=a.host.toLowerCase();s.has(r)||(s.add(r),n.push(a.toString()))}),n},_l=e=>{try{const s=jl(e,Da);return typeof s=="string"?s:null}catch{return null}},Ol=(e,s)=>{try{Cl(e,s,Da)}catch{}},Rr=e=>e.length?e.reduce((s,n)=>s+n,0)/e.length:0,Ul=async(e,s={})=>{const n=Rl(e);if(!n.length)return{index:0,priceBand:null,signals:[],sources:[]};const o=s.timeoutMs??Sl,a=s.now??new Date,r=[],l=[],c=[],d=[],u=D=>{r.push({title:D.title||D.url,url:D.url}),l.push(...D.signals),c.push(...D.prices),d.push(D.freshnessScore)};await Promise.all(n.map(async D=>{try{let b=_l(D);if(b)try{const E=await Pr(D,b,a);u(E);return}catch(E){l.push(`Cached content parse failed for ${D}: ${(E==null?void 0:E.message)||"unknown error"}`),b=null}const I=await Ll(D,o);if(!I.ok){l.push(`Skipped ${D} (status ${I.status})`);return}b=await I.text();const P=await Pr(D,b,a);u(P),Ol(D,b)}catch(b){l.push(`Fetch failed for ${D}: ${(b==null?void 0:b.message)||"unknown error"}`)}}));const m=Array.from(new Set(l.map(D=>D.trim()).filter(Boolean))).slice(0,12);let p=null;if(c.length){const D=Math.min(...c),b=Math.max(...c);Number.isFinite(D)&&Number.isFinite(b)&&(p=[D,b])}const g=Us(m.length/6),f=p?Us(Rr(c)/5e3):0,y=d.length?Us(Rr(d)):.2,j=Us(.4*f+.35*g+.25*y);return{index:Math.round(j*100),priceBand:p,signals:m,sources:r}};var _r={NVM_INC:"/Users/albertbitton/.nvm/versions/node/v20.19.5/include/node",TERM_PROGRAM:"vscode",NODE:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",INIT_CWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_CD_FLAGS:"-q",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/",npm_config_global_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",VSCODE_PYTHON_AUTOACTIVATE_GUARD:"1",TERM_PROGRAM_VERSION:"1.106.0",ZDOTDIR:"/Users/albertbitton",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_DIR:"/Users/albertbitton/.nvm",USER:"albertbitton",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/Users/albertbitton/.nvm/versions/node/v20.19.5/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.gyh6QCvRwm/Listeners",VSCODE_PROFILE_INITIALIZED:"1",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin:/Users/albertbitton/Documents/GitHub/node_modules/.bin:/Users/albertbitton/Documents/node_modules/.bin:/Users/albertbitton/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_package_json:"/Users/albertbitton/Documents/GitHub/Breeding-planner/package.json",_:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin/cross-env",npm_config_userconfig:"/Users/albertbitton/.npmrc",npm_config_init_module:"/Users/albertbitton/.npm-init.js",USER_ZDOTDIR:"/Users/albertbitton",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run-script",PWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",npm_lifecycle_event:"deploy",EDITOR:"vi",npm_package_name:"breeding-planner",LANG:"en_US.UTF-8",npm_config_npm_version:"10.8.2",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"0.1.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/albertbitton",VSCODE_GIT_ASKPASS_MAIN:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",npm_config_cache:"/Users/albertbitton/.npm",LOGNAME:"albertbitton",npm_lifecycle_script:"cross-env PUBLIC_URL=https://albertbit-cyber.github.io/Breeding-planner/ vite build && gh-pages -d dist",VSCODE_GIT_IPC_HANDLE:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/vscode-git-c6232d8e0d.sock",NVM_BIN:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_config_user_agent:"npm/10.8.2 node/v20.19.5 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",GIT_PAGER:"cat",npm_node_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",npm_config_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",COLORTERM:"truecolor",PUBLIC_URL:"https://albertbit-cyber.github.io/Breeding-planner/",NODE_ENV:"production"};class As extends Error{constructor(s,n=!0){super(s),this.name="SearchError",this.retryable=n}}const Un=8,fn=(e,s)=>{if(e==null)return s;const n=Number(e);return Number.isFinite(n)&&n>0?n:s},Gl=(e,s=!1)=>{if(e==null)return s;const n=e.trim().toLowerCase();return["1","true","yes","y","on"].includes(n)?!0:["0","false","no","n","off"].includes(n)?!1:s},Ut=typeof process<"u"&&process&&_r?_r:{},er=typeof window<"u"&&typeof window.document<"u",Ea=fn(Ut.SEARCH_CACHE_TTL_HOURS,12),Ia=Gl(Ut.CACHE_ONLY,!1),Gn=fn(Ut.SEARCH_TIMEOUT_MS,8e3),An=Math.max(1,Math.floor(fn(Ut.SEARCH_RETRY_ATTEMPTS,2))),Bl=fn(Ut.SEARCH_RETRY_DELAY_MS,300),zl=e=>new Promise(s=>{setTimeout(s,e)}),Hl=async(e,s)=>{const n=new AbortController,o=setTimeout(()=>n.abort(),Gn);try{return await fetch(e,{...s,signal:n.signal})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new As(`Search request timed out after ${Gn}ms`,!0):a}finally{clearTimeout(o)}},La=async(e,s)=>{try{const n=await Hl(e,s);if(!n.ok){const o=await n.text().catch(()=>""),a=n.status>=500||n.status===429;throw new As(`Search request failed (${n.status}): ${o||n.statusText}`,a)}return await n.json()}catch(n){if(n instanceof As)throw n;const o=(n==null?void 0:n.message)||"Unknown search error";throw new As(o,!0)}},Ma=async e=>{let s=0,n;for(;s<An;){s+=1;try{return await e()}catch(a){if(a instanceof As){if(!a.retryable||s>=An)throw a;n=a}else{if(s>=An)throw a;n=a}}const o=Math.min(Gn,Bl*s);await zl(o)}throw n instanceof Error?n:new As("Search request failed",!0)},Ta=e=>{const s=new Set,n=[];return e.forEach(o=>{try{const a=new URL(o.url).hostname.replace(/^www\./i,"").toLowerCase();if(s.has(a))return;s.add(a),n.push(o)}catch{}}),n.slice(0,Un)},Fa=e=>!Number.isFinite(e)||e<=0?Un:Math.min(Math.floor(e),Un),Bn=new Map,Vl=e=>{try{const s=wl(e,Ea);if(Array.isArray(s))return s}catch{}return null},ql=(e,s)=>{try{vl(e,s,Ea)}catch{}},$a=e=>{const s=Bn.get(e);if(s)return s;const n=Vl(e);return n?(Bn.set(e,n),n):null},Pa=(e,s)=>{Bn.set(e,s),ql(e,s)},Ra=(e,s)=>`${e}:${s.trim().toLowerCase()}`,tr=e=>({async search(){return typeof console<"u"&&console.warn&&console.warn(`[search] ${e}`),[]}}),Yl=()=>{const e=Ut.BING_SEARCH_KEY||Ut.AZURE_BING_KEY;if(!e){if(er)return tr("Bing search unavailable: missing API key");throw new Error("Bing search provider selected but no BING_SEARCH_KEY (or AZURE_BING_KEY) is configured.")}return{async search(s,n){var m;const o=Fa(n),a=Ra("bing",s),r=$a(a);if(r)return r.slice(0,o);if(Ia)return[];const d=(((m=(await Ma(()=>La(`https://api.bing.microsoft.com/v7.0/search?q=${encodeURIComponent(s)}&count=${o*2}`,{headers:{"Ocp-Apim-Subscription-Key":e}}))).webPages)==null?void 0:m.value)||[]).map(p=>({title:p.name||"",url:p.url||""})).filter(p=>p.title&&p.url),u=Ta(d);return Pa(a,u),u.slice(0,o)}}},Wl=()=>{const e=Ut.SERPAPI_API_KEY||Ut.SERPAPI_KEY;if(!e){if(er)return tr("SerpAPI search unavailable: missing API key");throw new Error("SerpAPI search provider selected but no SERPAPI_API_KEY (or SERPAPI_KEY) is configured.")}return{async search(s,n){const o=Fa(n),a=Ra("serpapi",s),r=$a(a);if(r)return r.slice(0,o);if(Ia)return[];const l=new URLSearchParams({engine:"google",q:s,num:String(Math.max(10,o*2)),api_key:e}),u=((await Ma(()=>La(`https://serpapi.com/search.json?${l.toString()}`,{}))).organic_results||[]).map(p=>({title:p.title||"",url:p.link||""})).filter(p=>p.title&&p.url),m=Ta(u);return Pa(a,m),m.slice(0,o)}}},Ql=()=>{const e=(Ut.SEARCH_PROVIDER||"bing").trim().toLowerCase();switch(e){case"serpapi":return Wl();case"bing":return Yl();default:if(er)return tr(`Unknown search provider '${e}', falling back to no-op.`);throw new Error(`Unknown SEARCH_PROVIDER '${e}'. Supported providers: bing, serpapi.`)}},Kl=[{pattern:"Spider x Spider",flag:"Suspect super",penalty:.8},{pattern:"Champagne x Champagne",flag:"Suspect super",penalty:.8},{pattern:"Woma x Woma",flag:"Suspect super",penalty:.8},{pattern:"Cinnamon x Cinnamon",flag:"Deformity risk in supers",penalty:.3},{pattern:"BlackPastel x BlackPastel",flag:"Deformity risk in supers",penalty:.3}],Zs={risk_rules:Kl},Or=e=>e.trim().toLowerCase(),Xl=Array.isArray(Zs==null?void 0:Zs.risk_rules)?Zs.risk_rules.map(e=>({pattern:e.pattern,flag:e.flag,penalty:e.penalty??0})):[],Jl=e=>{const s=new Set;return e.forEach(n=>s.add(n)),Array.from(s)},Zl=(e,s)=>{if(!e)return!1;const n=Or(s.pattern);return Or(e).includes(n)},ei=(e,s)=>{let n=0;const o=[];Xl.forEach(r=>{Zl(e,r)&&(o.push(r.flag),n+=r.penalty)});const a=Math.min(1,Math.max(0,n));return{risks:Jl(o),penalty:a}},Ur=e=>e.trim().toLowerCase(),ds=(e,s)=>{const n=Ur(e),o=Ur(s);return o?n===o?!0:n.includes(o):!1},ti=(e,s)=>{const n=e.trim();if(!n)return[];const o=new Set;o.add(n);const a=n.toLowerCase(),r=a.startsWith("het ")||a.includes("het "),l=a.includes("possible het");if(!r&&!l){o.add(`Super ${n}`);const c=s.recessiveState;(c==="het"||c==="possibleHet")&&(o.add(`het ${n}`),o.add(`possible het ${n}`))}return Array.from(o)},Gr=(e,s,n)=>ti(s,n).some(a=>e.some(r=>ds(r,a))),Br=(e,s)=>{var o,a,r;const n=l=>l?ds(l,s)||ds(l,`het ${s}`):!1;return!!((o=e.morphs)!=null&&o.some(l=>ds(l.name,s))||(a=e.hets)!=null&&a.some(l=>ds(l,s))||(r=e.possibleHets)!=null&&r.some(l=>n(l)))},zr=(e,s)=>{var n;return((n=e.morphs)==null?void 0:n.some(o=>ds(o.name,s)))??!1},si=e=>{let s=e.trim();return s=s.replace(/^(?:het|possible het|pos het)\s+/i,""),s.trim()},ni=(e,s)=>{var o,a,r;const n=e||[];return!((o=s.avoid)!=null&&o.some(l=>n.some(c=>ds(c,l)))||(a=s.requireAll)!=null&&a.length&&!s.requireAll.every(c=>Gr(n,c,s))||(r=s.requireAny)!=null&&r.length&&!s.requireAny.some(c=>Gr(n,c,s)))},_a=(e,s)=>e.reduce((n,o)=>ni(o.genotype,s)?n+o.prob:n,0),ri=(e,s)=>s.reduce((n,o)=>{const a=_a(e,o);if(o.minProb&&a<o.minProb)return n;const r=o.weight??1;return n+a*r},0),ai=(e,s,n)=>{var o,a;return(o=n.avoid)!=null&&o.length&&n.avoid.some(l=>zr(e,l)||zr(s,l))?!1:n.recessiveState==="visual"&&((a=n.requireAll)!=null&&a.length)?n.requireAll.every(r=>{const l=si(r);return l?Br(e,l)&&Br(s,l):!0}):!0},sr=e=>Number.isNaN(e)||e<0?0:e>1?1:e,oi=e=>{const s=typeof(e==null?void 0:e.index)=="number"?e.index:0;return sr(s/10)},li=e=>{const s=e==null?void 0:e.priceBand;if(!s||s.length!==2)return 0;const[n,o]=s,a=[n,o].filter(c=>typeof c=="number");if(!a.length)return 0;const r=a.reduce((c,d)=>c+(d??0),0)/a.length,l=r/(r+5e3);return sr(l)},ii=e=>{if(!(e!=null&&e.length))return 0;const n=(new Set(e.map(o=>o.genotype.slice().sort().join("|"))).size-1)/3;return sr(n)},ci=({outcomes:e,demand:s,risks:n,w:o})=>{const a=o.wDemand*oi(s),r=o.wPrice*li(s),l=o.wNovelty*ii(e),c=o.wRisk*((n==null?void 0:n.penalty)??0),d=a+r+l-c;return Math.max(0,d)},di=({outcomes:e,demand:s,risks:n,goals:o,w:a})=>{const r=ci({outcomes:e,demand:s,risks:n,w:a}),l=o!=null&&o.length?ri(e,o):0,c=r+(a.wGoalFit??1)*l;return{score:Math.max(0,c),goalFit:l}},ui={type:"object",properties:{why_good:{type:"string"},watchouts:{type:"array",items:{type:"string"}},sources:{type:"array",items:{type:"string"}}},required:["why_good","watchouts","sources"]},en=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),mi=e=>{if(!Array.isArray(e))throw new Error("Expected an array of strings");return e.forEach(s=>{if(typeof s!="string")throw new Error("Expected all array items to be strings")}),e},hi=(e,s)=>{let n;try{n=JSON.parse(e)}catch{throw new Error("Response was not valid JSON")}if(!en(s))throw new Error("Schema must be an object");if(!en(n))throw new Error("Parsed JSON is not an object");Array.isArray(s.required)&&s.required.forEach(a=>{if(!(a in n))throw new Error(`Missing required property: ${a}`)});const o=en(s.properties)?s.properties:{};return Object.entries(o).forEach(([a,r])=>{const l=n[a];if(!en(r))return;const c=r.type;if(c==="string"&&typeof l!="string")throw new Error(`Expected property '${a}' to be a string`);c==="array"&&mi(l)}),n},pi=async e=>{throw new Error("No LLM provider configured for justification")},fi=async e=>{const s=await pi();return hi(s,ui)},zn={Recessive:["210 Hypo","Albino","Atomic","Axanthic","Axanthic (GCR)","Axanthic (Jolliff)","Axanthic (MJ)","Axanthic (TSK)","Axanthic (VPI)","Bengal","Black Axanthic","Black Lace","Candy","Caramel Albino","Clown","Cryptic","Desert Ghost","Enhancer","Genetic Stripe","Ghost (Vesper)","Hypo","Lavender Albino","Maple","Metal Flake","Migraine","Monarch","Monsoon","Moray","Orange Crush","Orange Ghost","Paint","Patternless","Piebald","Puzzle","Rainbow","Sahara","Sandstorm","Sunset","Tornado","Tri-stripe","Ultramel","Whitewash","Zebra"],"Incomplete Dominant":["Acid","Ajax","Alloy","Ambush","Arcane","Arroyo","Asphalt","Astro","Bald","Bambino","Bamboo","Banana","Bang","Black Head","Black Pastel","Blade","Bongo","Butter","Cafe","Calico","Carbon","Carnivore","Champagne","Chino","Chocolate","Cinder","Cinnamon","Circle","Citron","Coffee","Copper","Creed","Cypress","Dark Viking","Diesel","Disco","Dot","EMG","Enchi","Epic","Exo-lbb","Fire","Flame","FNR Vanilla","Furrow","Fusion","Gaia","Gallium","GeneX","GHI","Glossy","Gobi","Granite","Gravel","Grim","Het Red Axanthic","Hidden Gene Woma","Hieroglyphic","High Intensity OD","Honey","Huffman","Hydra","Jaguar","Java","Jedi","Jolliff Tiger","Jolt","Joppa","Jungle Woma","KRG","Lace","LC Black Magic","Lemonback","Lesser","Mahogany","Mario","Marvel","Mckenzie","Melt","Microscale","Mocha","Mojave","Mosaic","Motley","Mystic","Nanny","Nico","Nr Mandarin","Nyala","Odium","OFY","Orange Dream","Orbit","Panther","Pastel","Peach","Phantom","Phenomenon","Pixel","Quake","Rain","RAR","Raven","Razor","Reaper","Red Gene","Red Stripe","Rhino","Russo","Saar","Sable","Sandblast","Sapphire","Satin","Scaleless Head","Scrambler","Shadow","Sherg","Shrapnel","Shredder","Smuggler","Spark","Special","Specter","Spider","Splatter","Spotnose","Stranger","Striker","Sulfur","Surge","Taronja","The Darkling","Trick","Trident","Trojan","Twister","Vanilla","Vudoo","Web","Woma","Wookie","Wrecking Ball","X-treme Gene","X-tremist","Yellow Belly","Zuwadi"],Dominant:["Adder","AHI","Ashen","Black Belly","Confusion","Congo","Desert","Eramosa","Frost","Gold Blush","Harlequin","Het Daddy","Josie","Leopard","Mordor","Nova","Oriole","Pinstripe","Redhead","Shatter","Splash","Static","Sunrise","Vesper","Zip Belly"],Polygenic:["Brown Back","Fader","Genetic Black Back","Genetic Reduced"],Other:["Dinker","Hybrid","Normal","Paradox","RECO","Ringer","Ringer Mark"],Locality:["Volta"]},xi=["Recessive","Incomplete Dominant","Dominant","Other"],Bs={ultramelanistic:"Ultramel"},Hr=(()=>{const e=new Map;return Object.entries(zn).forEach(([s,n])=>{n.forEach(o=>{o&&e.set(String(o).trim().toLowerCase(),s)})}),e})();function zs(e){return e?String(e).trim().toLowerCase():""}function gi(e){if(!e)return null;const s=new Set,n=p=>{if(!p)return;const g=String(p).trim();if(!g)return;const f=g.toLowerCase();s.has(f)||s.add(f)},o=String(e).trim();if(!o)return null;n(o);const a=o.replace(/\(.*?\)/g,"").trim();a&&a!==o&&n(a);const r=a.replace(/^super[\s-]+/i,"").trim();r&&r!==a&&n(r);const l=a.match(/^super([A-Z].*)$/);l&&l[1]&&n(l[1]);const c=Bs[a.toLowerCase()];c&&n(c);const d=o.match(/^\s*axanthic\s*\(([^)]+)\)/i);if(d&&d[1]){const p=d[1].replace(/\s+/g," ").trim();if(p){const g=p.toLowerCase(),f=[{match:/tsk/,canonical:"TSK"},{match:/gcr/,canonical:"GCR"},{match:/jol(l|liff)/,canonical:"Jolliff"},{match:/mj/,canonical:"MJ"},{match:/vpi/,canonical:"VPI"}];let y=null;for(const{match:j,canonical:w}of f)if(j.test(g)){y=w;break}y||(y=p.replace(/\s*line$/i,"").trim()),y&&n(`Axanthic (${y})`),n("Axanthic")}}const u=r.replace(/^(?:\d{1,3}%\s+)?(?:pos(?:s?i?a?ble)?\s+)?het\s+/i,"").trim();u&&u!==r&&n(u);const m=u.replace(/^(?:\d{1,3}%\s*)/i,"").trim();m&&m!==u&&n(m);for(const p of s){const g=Bs[p];g&&n(g)}for(const p of s){const g=zs(p);if(Hr.has(g))return Hr.get(g)||null}return null}function bi(e){return!e||e==="Polygenic"||e==="Locality"||!xi.includes(e)?"Other":e}function gs(e){const s=gi(e);return bi(s)}function Oa(e){const s=gs(e);return s==="Recessive"?"recessive":s==="Incomplete Dominant"?"co-dom":s==="Dominant"?"dominant":"polygenic"}var Dn={};const yi=6,Ni=(()=>{if(typeof process<"u"&&process&&Dn&&Dn.SUGGESTION_CONCURRENCY){const e=Number(Dn.SUGGESTION_CONCURRENCY);if(Number.isFinite(e)&&e>0)return e}return 3})(),wi=e=>{const s=new Set;return e.filter(n=>!!(n&&n.trim())).forEach(n=>{const o=n.trim();s.has(o)||s.add(o)}),Array.from(s)},vi=(e,s,n)=>{const o=[],a=r=>{var l,c,d;(l=r.morphs)==null||l.forEach(u=>o.push(u.name)),(c=r.hets)==null||c.forEach(u=>o.push(`${u}`)),(d=r.possibleHets)==null||d.forEach(u=>o.push(u))};return a(e),a(s),n.slice(0,4).forEach(r=>{var l;(l=r.genotype)!=null&&l.length&&o.push(r.genotype.join(" "))}),wi(o).slice(0,6)},ji=e=>e.length?`ball python ${e.join(" ")}`.trim():"ball python morph",Vr=e=>{var n;const s=((n=e.morphs)==null?void 0:n.map(o=>o.name).join(" "))||"Normal";return`${e.sex==="M"?"Male":"Female"} ${s}`},qr=()=>({index:0,priceBand:null,signals:[],sources:[]}),Ci=(e,s,n)=>`Projected score ${e.toFixed(2)} with demand index ${s}. ${n}`.trim(),Hn=(e,s)=>s.map(n=>_a(e,n)),Si=(e,s)=>{if(!e.length||!s.length)return"No specific goal targets.";let n=0,o=s[0];s.forEach((r,l)=>{r>o&&(o=r,n=l)});const a=e[n];return`${(o*100).toFixed(1)}% chance to hit goal '${a.name}'.`},ki=async(e,s)=>{var n,o;try{const a=await fi(e),r=(n=a.watchouts)!=null&&n.length?` Watchouts: ${a.watchouts.join("; ")}.`:"",l=(o=a.sources)!=null&&o.length?` Sources: ${a.sources.join(", ")}.`:"";return`${a.why_good}${r}${l}`.trim()}catch{return s}},Hs=e=>e.toLowerCase().replace(/\s+/g," ").trim(),Vn=e=>e.replace(/^(?:het|possible het|pos het)\s+/i,"").replace(/^visual\s+/i,"").replace(/^super\s+/i,"").trim(),Ua=e=>Vn(e),Ai=e=>{const s=new Set;return e.forEach(n=>{(n.requireAll||[]).forEach(o=>{const a=Ua(o);a&&s.add(a)})}),Array.from(s)},Yr=e=>{var s;return((s=e.genotype)==null?void 0:s.map(n=>n.trim()).filter(Boolean))??[]},Di=e=>{const s=[],n=[],o=[],a=[];return e.forEach(r=>{const l=r.trim();if(!l)return;const c=Hs(l);if(c.startsWith("possible het")){const d=Vn(l);d&&(o.push(d),a.push(`possible het ${d}`));return}if(c.startsWith("het ")){const d=Vn(l);d&&(n.push(d),a.push(`het ${d}`));return}s.push({name:l,type:Oa(l)}),a.push(l)}),{morphs:s,hets:n,possibleHets:o,displayTokens:a}},Ei=(e,s)=>{const n=e.map(Hs);let o=0,a=0;return s.forEach(l=>{const c=Hs(l);if(n.some(m=>m.startsWith("het ")||m.startsWith("possible het ")?!1:m.includes(c))){o+=1;return}n.some(m=>m.startsWith("het ")?m.replace(/^het\s+/,"").includes(c):m.startsWith("possible het ")?m.replace(/^possible het\s+/,"").includes(c):!1)&&(a+=1)}),{score:o*2+a,visualMatches:o,hetMatches:a}},Ii=(e,s)=>{const n=Di(e),o={morphs:n.morphs,hets:n.hets,possibleHets:n.possibleHets},a={id:`${s}-holdback-f`,sex:"F",morphs:o.morphs,hets:o.hets,possibleHets:o.possibleHets},r={id:`${s}-holdback-m`,sex:"M",morphs:o.morphs,hets:o.hets,possibleHets:o.possibleHets};return{female:a,male:r,traits:n.displayTokens}},Li=(e,s,n,o,a)=>{var P,E;if(!o.length)return;const r=Ai(o);if(!r.length)return;const l=e.goalProb??0,c=[{generation:1,title:`Generation 1: ${s.id} × ${n.id}`,summary:l>0?`Direct chance to reach the goal is ${(l*100).toFixed(1)}%.`:`No direct visual expected; produce holdbacks carrying ${r.join(", ")}.`,maleId:s.id,femaleId:n.id,focusTraits:r,successProb:l}];if(!a||l>=.25)return{strategy:"direct",steps:c,cumulativeProb:Math.max(l,0)};const d=e.outcomes.slice(0,8).filter(k=>k.prob>.01);let u=null;if(d.forEach(k=>{const R=Yr(k),O=Ei(R,r);if(O.score<=0)return;const K={outcome:k,...O};if(!u){u=K;return}if(K.score>u.score){u=K;return}K.score===u.score&&k.prob>u.outcome.prob&&(u=K)}),!u)return{strategy:"direct",steps:c,cumulativeProb:Math.max(l,0)};const m=u,p=`${s.id}-${n.id}`,g=Ii(Yr(m.outcome),p),f=g.traits.filter(k=>{const R=Ua(k);return R?r.some(O=>Hs(R).includes(Hs(O))):!1});let y=null;if((P=a.allMales)==null||P.forEach(k=>{if(k.id===s.id)return;const R=On(k,g.female),O=Hn(R,o),K=O.length?Math.max(...O):0;K<=0||(!y||K>y.prob)&&(y={prob:K,partnerId:k.id,partnerSex:"M",holdbackSex:"F",outcomes:R})}),(E=a.allFemales)==null||E.forEach(k=>{if(k.id===n.id)return;const R=On(g.male,k),O=Hn(R,o),K=O.length?Math.max(...O):0;K<=0||(!y||K>y.prob)&&(y={prob:K,partnerId:k.id,partnerSex:"F",holdbackSex:"M",outcomes:R})}),!y)return{strategy:"direct",steps:c,cumulativeProb:Math.max(l,0),holdbackTraits:f,holdbackProb:m.outcome.prob};const j=y,w=f.length?f.join(", "):r.join(", "),D=g.male.id,b=g.female.id;c[0]={...c[0],summary:`Direct goal chance ${(l*100).toFixed(1)}%. Prioritise producing holdbacks carrying ${w}.`},c.push({generation:2,title:`Generation 2: Holdback × ${j.partnerId}`,summary:`Retain the ${j.holdbackSex==="F"?"female":"male"} holdback (${w}). Pair with ${j.partnerId} for ${(j.prob*100).toFixed(1)}% chance at the goal.`,maleId:j.holdbackSex==="F"?j.partnerId:D,femaleId:j.holdbackSex==="F"?b:j.partnerId,focusTraits:r,successProb:j.prob,prerequisiteProb:m.outcome.prob});const I=m.outcome.prob*j.prob;return{strategy:"multi",steps:c,cumulativeProb:I,holdbackTraits:f,holdbackProb:m.outcome.prob}},Mi=async(e,s,n,o,a)=>{const r=On(e,s),l=vi(e,s,r),c=ji(l);let d=qr(),u=[];try{u=await Ql().search(c,yi)}catch{}const m=u.map(E=>E.url);try{m.length&&(d=await Ul(m))}catch{d=qr()}const p=`${Vr(e)} x ${Vr(s)}`,g=ei(p),f=Hn(r,n),y=f.length?Math.max(...f):0,j=di({outcomes:r,demand:d,risks:g,goals:n,w:o}),w=Si(n,f);let D=Ci(j.score,d.index,w);D=await ki({a:e,b:s,outcomes:r,demand:d,risks:g.risks,goals:n},D);const b=d.sources.length?d.sources:u.map(E=>({title:E.title,url:E.url})),I={maleId:e.id,femaleId:s.id,outcomes:r,score:j.score,demand:d,risks:g.risks,sources:b,rationale:D,goalProb:y,goalFit:j.goalFit},P=Li(I,e,s,n,a);return P&&(I.plan=P),I},Ti=(e,s)=>{const n=[];for(let o=0;o<e.length;o+=s)n.push(e.slice(o,o+s));return n},Fi=(e,s,n)=>n.length?n.every(o=>ai(e,s,o)):!0,$i=async(e,s,n,o)=>{const a=[];if(e.forEach(d=>{s.forEach(u=>{Fi(d,u,n)&&a.push({male:d,female:u})})}),!a.length)return[];const r=Math.max(1,Ni),l=Ti(a,r),c=[];for(const d of l)(await Promise.all(d.map(async({male:m,female:p})=>{try{return await Mi(m,p,n,o,{allMales:e,allFemales:s})}catch{return null}}))).forEach(m=>{m&&c.push(m)});return c.sort((d,u)=>u.score-d.score)},Tt=e=>e==null?"":String(e).replace(/\s+/g," ").trim(),Pi=e=>{const s=Tt(e).toLowerCase();return s?s==="m"||s==="male"||/^1[\s.:/]*0$/.test(s)||s.startsWith("m")?"M":s==="f"||s==="female"||/^0[\s.:/]*1$/.test(s)||s.startsWith("f")?"F":null:null},Wr=e=>{if(e&&typeof e=="object"){if(Object.prototype.hasOwnProperty.call(e,"name")&&e.name!=null)return Tt(e.name);if(Object.prototype.hasOwnProperty.call(e,"label")&&e.label!=null)return Tt(e.label)}return Tt(e)},Ri=e=>e.split(/[\n\r,;|/+]+/).map(s=>Tt(s)).filter(Boolean),qn=e=>{if(Array.isArray(e))return e.map(n=>Wr(n)).filter(Boolean);const s=Wr(e);return s?Ri(s):[]},un=e=>{const s=Tt(e);return s?s.split(" ").map(n=>n&&(n.length<=2?n.toUpperCase():/^[A-Z0-9-]+$/.test(n)?n:n.charAt(0).toUpperCase()+n.slice(1).toLowerCase())).join(" "):""},_i=e=>{const s=qn(e),n=new Set,o=[];return s.forEach(a=>{const r=un(a),l=zs(r);!r||!l||n.has(l)||(n.add(l),o.push({name:r,type:Oa(r)}))}),o},Oi=e=>{if(!e)return null;let s=Tt(e);if(!s)return null;let n="";const o=s.match(/^(\d{1,3}%)(?:\s*)(.*)$/i);o&&(n=o[1].toUpperCase(),s=o[2].trim());let a="";const r=s.match(/^(pos(?:s?i?a?ble)?|probable|maybe|ph)(?:\s*)(.*)$/i);r&&(a=r[1].toLowerCase(),s=r[2].trim()),s=s.replace(/\bhet\b/gi," ").replace(/^het(?=[A-Za-z])/i,"").trim();const c={pos:"Possible",ph:"Possible",possible:"Possible",possiable:"Possible",posible:"Possible",probable:"Probable",maybe:"Maybe"}[a]||"",d=un(s);if(!d)return null;const u=[];return n&&u.push(n),c&&u.push(c),u.push("Het"),u.push(d),u.join(" ").replace(/\s+/g," ").trim()||null},Ui=(e,s)=>{const n=[],o=[],a=new Set,r=new Set,l=(c,d=!1)=>{const u=Oi(c);if(!u)return;const m=u.toLowerCase();d||/^\d{1,3}%/.test(u)||/^(?:possible|probable|maybe)\b/i.test(u)?r.has(m)||(r.add(m),o.push(u)):a.has(m)||(a.add(m),n.push(u))};return qn(e).forEach(c=>l(c,!1)),qn(s).forEach(c=>l(c,!0)),{certain:n,possible:o}},Qr=e=>{if(!e||!e.id)return null;const s=Pi(e.sex);if(!s)return null;const n=_i(e.morphs),{certain:o,possible:a}=Ui(e.hets,e.possibleHets);return{id:String(e.id),sex:s,morphs:n,hets:o,possibleHets:a.length?a:void 0}},Gi="breeders",tn=.6,Bi={wDemand:1,wPrice:.8,wNovelty:.4,wRisk:.6,wGoalFit:1.2},Yt=(e,s=0)=>`${(e*100).toFixed(s)}%`,zi=e=>{if(!e||e.length!==2)return null;const[s,n]=e;return s==null||n==null?null:`$${Number(s).toLocaleString()} – $${Number(n).toLocaleString()}`},Hi="bg-violet-200 border border-violet-300 text-violet-800",En={Het:Hi,Recessive:"bg-violet-300 border border-violet-400","Incomplete Dominant":"bg-rose-300 border border-rose-400",Dominant:"bg-sky-300 border border-sky-400",Other:"bg-emerald-300 border border-emerald-400"},Vi=e=>{if(!e)return!1;const s=String(e).toLowerCase();return!!(s.includes("het")||/(^|\s)(pos(?:s?i?a?ble)?|probable|maybe|ph)(\s|$)/i.test(s)||/\d{1,3}%/.test(s))},nr=e=>{if(!e)return!1;const s=String(e).replace(/\s+/g," ").trim();if(!s)return!1;const n=s.toLowerCase();return/^(?:\d{1,3}%\s*)?(?:(?:pos(?:s?i?a?ble)?|probable|maybe|ph)\s+)?het\b/.test(n)?!0:Vi(e)},qi=e=>{if(nr(e))return En.Het;const s=gs(e);return En[s]||En.Other},Yn=(e=[])=>{const s=new Set,n=[];return e.forEach(o=>{if(o==null)return;const a=String(o).trim();if(!a)return;const r=a.toLowerCase();s.has(r)||(s.add(r),n.push(a))}),n},Ga=e=>String(e||"").replace(/^(?:\d{1,3}%\s*)?(?:(?:pos(?:s?i?a?ble)?|probable|maybe|ph)\s+)?het\s+/i,"").replace(/^visual\s+/i,"").replace(/^super\s+/i,"").trim(),ss=e=>{const s=Ga(Tt(e));return s?zs(s):""},ms=(e=[],s)=>{const n=[],o=[];return e.forEach(a=>{const r=Tt(a);if(!r)return;const l=ss(r);s&&s.size>0&&(!l||!s.has(l))||(nr(r)?o.push(r):n.push(r))}),{visuals:Yn(n),hets:Yn(o)}},Ba=(e=[],s=3,n)=>{const o=[];return(e||[]).slice(0,s).forEach(a=>{((a==null?void 0:a.genotype)||[]).forEach(r=>{const l=Tt(r);l&&o.push(l)})}),ms(o,n)},Yi=(e=[])=>{const s=[];return e.forEach(n=>{var o,a;(o=n==null?void 0:n.requireAll)!=null&&o.length&&s.push(...n.requireAll),(a=n==null?void 0:n.requireAny)!=null&&a.length&&s.push(...n.requireAny)}),s},Kr=(e=[])=>{const s=Yi(e),n=new Set;return s.forEach(o=>{const a=ss(o);a&&n.add(a)}),{tokens:s,baseGeneKeys:n,groups:ms(s)}},Wi=(e,s)=>{var l,c;if(!s||s.size===0)return!0;const n=Ba((e==null?void 0:e.outcomes)||[],6,s);if(n.visuals.length||n.hets.length)return!0;const o=ms(((l=e==null?void 0:e.plan)==null?void 0:l.holdbackTraits)??[],s);if(o.visuals.length||o.hets.length)return!0;const a=(((c=e==null?void 0:e.plan)==null?void 0:c.steps)||[]).flatMap(d=>(d==null?void 0:d.focusTraits)||[]),r=ms(a,s);return!!(r.visuals.length||r.hets.length)},sn={visual:"Visual",het:"Het",possibleHet:"Possible het",none:"Normal"},za=e=>typeof e=="string"&&e.includes("-holdback-"),Qi=(e,s)=>!e||!s?"none":(e.morphs||[]).some(r=>ss(r==null?void 0:r.name)===s)?"visual":(e.hets||[]).some(r=>ss(r)===s)?"het":(e.possibleHets||[]).some(r=>ss(r)===s)?"possibleHet":"none",Ki=(e=[],s)=>{if(!e||!e.length||!s)return"none";let n="none";return e.forEach(o=>{const a=Tt(o);if(!(!a||ss(a)!==s)){if(/possible\s+het/i.test(a)||/probable\s+het/i.test(a)){n="possibleHet";return}if(nr(a)){n="het";return}n="visual"}}),n},Xr=(e,s,n)=>{var o,a;return s?e&&((o=n==null?void 0:n.advisorAnimals)!=null&&o.has(e))?Qi(n.advisorAnimals.get(e),s):za(e)?Ki(((a=n==null?void 0:n.plan)==null?void 0:a.holdbackTraits)??[],s):"none":"none"},Xi=(e,s)=>{const n=[e,s].sort().join("-");return n==="none-visual"?"100% het":n==="het-het"?"≈66% het":n==="het-none"?"≈50% het":null},Ji=(e=[],s)=>{const n=(e||[]).find(o=>ss(o)===s);return un(n?Ga(n):s)},Zi=(e,s,n)=>{var r;if(!((r=e==null?void 0:e.focusTraits)!=null&&r.length)||!(s!=null&&s.size))return[];const o=new Set;(e.focusTraits||[]).forEach(l=>{const c=ss(l);c&&s.has(c)&&o.add(c)});const a=[];return o.forEach(l=>{const c=Xr(e.maleId,l,n),d=Xr(e.femaleId,l,n),u=Xi(c,d);if(!u)return;const m=Ji(e.focusTraits,l),p=sn[c]||sn.none,g=sn[d]||sn.none;a.push(`${m}: ${p} × ${g} → ${u}`)}),a},Jr=({label:e,tokens:s})=>{const n=Yn(s).slice(0,12);return n.length?t.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-xs text-neutral-600",children:[t.jsxs("span",{className:"uppercase tracking-wide text-[10px] text-neutral-500 mr-1",children:[e,":"]}),n.map(o=>t.jsx("span",{className:`inline-flex items-center rounded-md font-medium ${qi(o)} text-xs px-2 py-0.5`,children:o},`${e}-${o}`))]}):null},In=()=>[],Zr=e=>{const s=new Map;return(e||[]).forEach(n=>{n!=null&&n.id&&s.set(n.id,n)}),s},ec=e=>Array.isArray(e)?e.map(s=>typeof s=="string"?s:String(s??"")).map(s=>s.trim()).filter(Boolean):typeof e=="string"?[e.trim()].filter(Boolean):[],ea=(e=[])=>e.filter(s=>ec(s==null?void 0:s.groups).some(n=>n.toLowerCase()===Gi)),tc=e=>`${e.maleId}::${e.femaleId}`,sc=({males:e=[],females:s=[],initialGoals:n=[],initialWeights:o=Bi})=>{const a=n[0],r=(a==null?void 0:a.name)??"",l=((a==null?void 0:a.requireAll)??[]).join(", "),c=[r,l].filter(Boolean).join(r&&l?": ":""),d=h.useMemo(()=>ea(e),[e]),u=h.useMemo(()=>ea(s),[s]),m=h.useMemo(()=>d.map(Qr).filter(Boolean),[d]),p=h.useMemo(()=>u.map(Qr).filter(Boolean),[u]),[g,f]=h.useState(n.length?n:In()),[y,j]=h.useState(c),[w]=h.useState(o),[D,b]=h.useState([]),[I,P]=h.useState(!1),[E,k]=h.useState(""),[R,O]=h.useState(n.length?n:[]),K=h.useMemo(()=>Zr(d),[d]),S=h.useMemo(()=>Zr(u),[u]),z=h.useMemo(()=>{const $=new Map;return m.forEach(_=>{_!=null&&_.id&&$.set(_.id,_)}),p.forEach(_=>{_!=null&&_.id&&$.set(_.id,_)}),$},[m,p]),B=h.useCallback($=>{if(!$)return"Unknown";const _=K.get($)||S.get($);if(_!=null&&_.name)return _.name;if(_!=null&&_.displayName)return _.displayName;if(_!=null&&_.display_name)return _.display_name;if(za($)){const[,ue]=$.split("-holdback-");return ue==="m"?"Holdback Male":ue==="f"?"Holdback Female":"Holdback"}return $},[K,S]),F=h.useMemo(()=>D.slice().sort(($,_)=>(_.score??0)-($.score??0)),[D]),de=h.useMemo(()=>F.filter($=>($.goalProb??0)>=tn),[F]),U=h.useMemo(()=>F.filter($=>($.goalProb??0)<tn),[F]),A=h.useMemo(()=>Kr(R),[R]),G=A.groups,le=A.baseGeneKeys,ee=h.useCallback($=>{f(_=>{if(!_.length){const Ce=In()[0]??{id:`goal-${Date.now().toString(36)}`,name:"Custom goal",requireAll:[],weight:1};return[$(Ce)]}const[ue,...me]=_;return[$(ue),...me]})},[]),pe=h.useCallback($=>$.split(/[,\n]/).map(_=>_.trim()).filter(Boolean),[]),Q=h.useCallback($=>{const _=($??"").trim();if(!_)return{name:"",traits:[]};if(_.includes(":")){const[ue,me=""]=_.split(/:/,2);return{name:ue.trim(),traits:pe(me)}}if(_.includes(" - ")){const[ue,me=""]=_.split(" - ",2);return{name:ue.trim(),traits:pe(me)}}return _.includes(",")?{name:"",traits:pe(_)}:{name:_,traits:[]}},[pe]),se=h.useCallback($=>{const{name:_,traits:ue}=Q($);ee(me=>({...me,name:_||(me==null?void 0:me.name)||"Custom goal",requireAll:ue}))},[Q,ee]),xe=$=>{const _=$.target.value;j(_),E&&k(""),se(_)},oe=()=>{j(""),f(In()),O([]),b([]),k(""),P(!1)},Ae=async()=>{if(!m.length||!p.length){k("Add animals to the Breeders group to see advisor recommendations.");return}const $=g.filter(_=>{var ue,me;return(((ue=_.requireAll)==null?void 0:ue.length)??0)>0||(((me=_.requireAny)==null?void 0:me.length)??0)>0});if(!$.length){k("Add goal traits before running the advisor.");return}O($),P(!0),k("");try{const _=Kr($),me=(await $i(m,p,$,w)).filter(Ce=>Wi(Ce,_.baseGeneKeys)).filter(Ce=>(Ce.goalProb??0)>0);b(me)}catch(_){k((_==null?void 0:_.message)||"Failed to generate suggestions")}finally{P(!1)}},Oe=$=>t.jsxs("div",{className:"font-semibold text-neutral-900",children:[B($.maleId)," × ",B($.femaleId)]}),Ge=()=>I?"Crunching punnett squares…":E||(D.length?!de.length&&U.length?`No pairs meet the high-confidence bar yet, but here are ${U.length} options to review.`:de.length?`${de.length} pairing${de.length===1?"":"s"} meet the ≥ ${Yt(tn)} goal confidence target.`:"No pairings crossed the confidence bar. Try adjusting your collections or goals.":"Run the advisor to discover promising pairings."),W=$=>{var me,Ce;const _=(me=$.outcomes)==null?void 0:me[0];return _?`${((Ce=_.genotype)==null?void 0:Ce.join(" "))||"Unknown morph"} (${Yt(_.prob,0)} appearance chance)`:"No projection available."},ce=($,_)=>{var Be,He,Qe,ve,pt;const ue=tc($),me=_==="high",Ce=$.goalProb??0,Ne=$.plan,Ee=(Ne==null?void 0:Ne.steps)??[],$e=Ba($.outcomes||[],6,le),Pe=ms((Ne==null?void 0:Ne.holdbackTraits)??[],le),ae=Ee.slice(1).reduce((fe,De)=>{var M;return(M=De==null?void 0:De.focusTraits)!=null&&M.length&&fe.push(...De.focusTraits),fe},[]),H=ms(ae,le),J=[];G.visuals.length&&J.push({label:"Goal Visuals",tokens:G.visuals}),G.hets.length&&J.push({label:"Goal Hets",tokens:G.hets}),$e.visuals.length&&J.push({label:"Projected Visuals",tokens:$e.visuals}),$e.hets.length&&J.push({label:"Projected Hets",tokens:$e.hets}),Pe.visuals.length&&J.push({label:"Holdback Visuals",tokens:Pe.visuals}),Pe.hets.length&&J.push({label:"Holdback Hets",tokens:Pe.hets}),H.visuals.length&&J.push({label:"Next-Gen Visuals",tokens:H.visuals}),H.hets.length&&J.push({label:"Next-Gen Hets",tokens:H.hets});const ge=((He=(Be=$.demand)==null?void 0:Be.signals)==null?void 0:He.slice(0,2))??[],Se=zi((Qe=$.demand)==null?void 0:Qe.priceBand);return t.jsx("div",{className:`rounded-xl border ${me?"border-emerald-200 bg-emerald-50":"border-neutral-200 bg-white"} p-4 shadow-sm`,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[Oe($),t.jsx("div",{className:"text-sm text-neutral-600",children:W($)}),J.length>0&&t.jsx("div",{className:"flex flex-col gap-1",children:J.map(({label:fe,tokens:De},M)=>t.jsx(Jr,{label:fe,tokens:De},`${ue}-${fe}-${M}`))}),t.jsxs("div",{className:"text-sm text-neutral-600",children:["Goal success chance: "," ",t.jsx("span",{className:`font-semibold ${me?"text-emerald-600":"text-amber-600"}`,children:Yt(Ce,0)}),!me&&t.jsx("span",{className:"ml-1 text-xs text-neutral-500",children:"(below confidence target)"})]}),!!ge.length&&t.jsxs("div",{className:"text-sm text-neutral-600",children:["Demand signals: ",ge.join(" • ")]}),Se&&t.jsx("div",{className:"text-sm text-neutral-600",children:Se}),$.rationale&&t.jsx("div",{className:"rounded-lg bg-neutral-50 p-3 text-sm text-neutral-700",children:$.rationale}),!!((ve=$.sources)!=null&&ve.length)&&t.jsxs("div",{className:"text-xs text-neutral-500",children:["Sources: ",$.sources.slice(0,3).map(fe=>fe.title||fe.url).join(", ")]}),Ne&&t.jsxs("div",{className:"rounded-lg border border-sky-200 bg-sky-50/70 p-3 text-sm text-sky-900",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xs font-semibold uppercase tracking-wide text-sky-700",children:["Multi-generation plan (",Ne.strategy==="multi"?"2-step":"direct",")"]}),t.jsxs("div",{className:"text-xs font-semibold text-emerald-700",children:["Combined ≈ ",Yt(Ne.cumulativeProb??0,1)]})]}),t.jsx("div",{className:"mt-3 space-y-3",children:Ee.map(fe=>{const De=B(fe.maleId),M=B(fe.femaleId),X=Zi(fe,le,{advisorAnimals:z,plan:Ne}),we=ms((fe==null?void 0:fe.focusTraits)||[],le),Ie=[];return we.visuals.length&&Ie.push({label:"Focus Visuals",tokens:we.visuals}),we.hets.length&&Ie.push({label:"Focus Hets",tokens:we.hets}),t.jsxs("div",{className:"rounded-lg border border-sky-200 bg-white p-3 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xs font-semibold uppercase tracking-wide text-sky-600",children:["Generation ",fe.generation]}),t.jsxs("div",{className:"flex items-center gap-3 text-[11px] font-medium text-sky-700",children:[fe.prerequisiteProb!=null&&t.jsxs("span",{children:["Prereq ≈ ",Yt(fe.prerequisiteProb,1)]}),fe.successProb!=null&&t.jsxs("span",{children:["Goal ≈ ",Yt(fe.successProb,1)]})]})]}),t.jsxs("div",{className:"mt-1 text-sm font-semibold text-sky-900",children:[De," × ",M]}),t.jsx("div",{className:"mt-1 text-xs text-sky-800",children:fe.summary}),Ie.length>0&&t.jsx("div",{className:"mt-2 flex flex-col gap-1",children:Ie.map(({label:ie,tokens:Ke},Re)=>t.jsx(Jr,{label:ie,tokens:Ke},`${ue}-step-${fe.generation}-${ie}-${Re}`))}),X.length>0&&t.jsx("div",{className:"mt-2 flex flex-col gap-1",children:X.map((ie,Ke)=>t.jsx("div",{className:"inline-flex items-center rounded-md bg-violet-100 px-2 py-1 text-[11px] font-medium text-violet-900",children:ie},`${ue}-het-${fe.generation}-${Ke}`))})]},`${ue}-plan-${fe.generation}`)})}),t.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 text-xs text-sky-700",children:[Ne.holdbackProb!=null&&t.jsxs("span",{children:["Holdback ≈ ",Yt(Ne.holdbackProb,1)]}),(pt=Ne.holdbackTraits)!=null&&pt.length?t.jsxs("span",{children:["Holdback genes: ",[...Pe.visuals,...Pe.hets].join(", ")||Ne.holdbackTraits.join(", ")]}):null]})]})]})},ue)};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"rounded-xl border border-neutral-200 bg-white p-5 shadow-sm",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Breeding Advisor"}),t.jsxs("p",{className:"text-sm text-neutral-600",children:["We only look at animals tagged in the ",t.jsx("strong",{children:"Breeders"})," group and surface pairings that have a very high chance of producing your selected morph goal."]})]}),t.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:t.jsxs("label",{className:"sm:col-span-2 flex flex-col gap-1 text-sm text-neutral-700",children:[t.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Goal (Name and Traits)"}),t.jsx("input",{value:y,onChange:xe,placeholder:"Visual Clown: Clown, het Desert Ghost",className:"rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-sky-400 focus:outline-none"}),t.jsx("span",{className:"text-xs text-neutral-500",children:'Format tip: "Goal Name: trait one, trait two". If you only list traits, we’ll build a generic goal.'})]})}),t.jsxs("div",{className:"flex flex-col gap-2 rounded-lg bg-sky-50 p-3 text-sm text-sky-900",children:[t.jsx("div",{className:"font-medium",children:"Status"}),t.jsx("div",{children:Ge()})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-neutral-500",children:[t.jsx("span",{children:`${d.length} breeder male${d.length===1?"":"s"}`}),t.jsx("span",{children:"•"}),t.jsx("span",{children:`${u.length} breeder female${u.length===1?"":"s"}`}),t.jsx("span",{children:"•"}),t.jsxs("span",{children:["Confidence bar ≥ ",Yt(tn)]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:Ae,disabled:I,className:"inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:cursor-not-allowed disabled:bg-emerald-800",children:I?"Generating...":"Run Advisor"}),t.jsx("button",{type:"button",onClick:oe,disabled:I,className:"inline-flex items-center justify-center rounded-lg border border-neutral-300 px-4 py-2 text-sm font-semibold text-neutral-700 hover:bg-neutral-100 disabled:cursor-not-allowed disabled:opacity-70",children:"Reset Advisor"})]})]})}),t.jsxs("div",{className:"space-y-4",children:[de.map($=>ce($,"high")),U.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-sm font-semibold text-neutral-700",children:"Additional pairings worth reviewing"}),U.map($=>ce($,"supporting"))]}),!D.length&&!I&&!E&&t.jsxs("div",{className:"rounded-xl border border-dashed border-neutral-300 p-6 text-center text-sm text-neutral-500",children:["Ready when you are—click ",t.jsx("strong",{children:"Run Advisor"})," to discover your strongest breeder pairings."]})]})]})},nc="https://accounts.google.com/gsi/client",rc="https://www.googleapis.com/auth/calendar.events",ac="https://www.googleapis.com/oauth2/v2/userinfo",oc="https://www.googleapis.com/calendar/v3/users/me/calendarList",Ln=new Map;function lc(e){if(Ln.has(e))return Ln.get(e);const s=new Promise((n,o)=>{if(typeof window>"u"){o(new Error("Google identity services require a browser environment."));return}const a=document.querySelector(`script[src="${e}"]`);if(a){if(a.dataset.loaded==="true"){n();return}a.addEventListener("load",()=>n()),a.addEventListener("error",()=>o(new Error("Failed to load Google Identity Services.")));return}const r=document.createElement("script");r.src=e,r.async=!0,r.defer=!0,r.onload=()=>{r.dataset.loaded="true",n()},r.onerror=()=>o(new Error("Failed to load Google Identity Services.")),document.head.appendChild(r)});return Ln.set(e,s),s}function ic(){const e="1008745918644-s1g0lveqdm7oof16psrp8t326s5qhfpp.apps.googleusercontent.com",s=!!e,n=h.useRef(null),[o,a]=h.useState(!1),[r,l]=h.useState(null),[c,d]=h.useState(null),[u,m]=h.useState([]),[p,g]=h.useState("primary"),[f,y]=h.useState(null),[j,w]=h.useState(!1),[D,b]=h.useState(!1);h.useEffect(()=>{if(!s)return;let k=!1;return lc(nc).then(()=>{var O;if(k)return;const R=window.google;if(!((O=R==null?void 0:R.accounts)!=null&&O.oauth2))throw new Error("Google Identity Services unavailable in this environment.");n.current=R.accounts.oauth2.initTokenClient({client_id:e,scope:rc,callback:()=>{}}),a(!0)}).catch(R=>{k||y(R instanceof Error?R:new Error(String(R)))}),()=>{k=!0}},[e,s]),h.useEffect(()=>{if(!r)return;let k=!1;const R={Authorization:`Bearer ${r}`};return(async()=>{var K,S,z;try{y(null);const B=await fetch(ac,{headers:R});if(!B.ok){const A=await B.json().catch(()=>({}));throw new Error(((K=A==null?void 0:A.error)==null?void 0:K.message)||"Unable to fetch Google profile.")}const F=await B.json();if(k)return;d({name:(F==null?void 0:F.name)||(F==null?void 0:F.email)||"Google user",email:(F==null?void 0:F.email)||""}),b(!0);const de=await fetch(oc,{headers:R});if(!de.ok){const A=await de.json().catch(()=>({}));throw new Error(((S=A==null?void 0:A.error)==null?void 0:S.message)||"Unable to fetch calendar list.")}const U=await de.json();if(k)return;m(Array.isArray(U.items)?U.items:[]),!p&&((z=U.items)!=null&&z.length)&&g(U.items[0].id)}catch(B){k||y(B instanceof Error?B:new Error(String(B)))}finally{k||b(!1)}})(),()=>{k=!0}},[r,p]);const I=h.useCallback(()=>{if(!n.current){y(new Error("Google services are still loading."));return}y(null),n.current.callback=k=>{if(k!=null&&k.error){y(new Error(k.error));return}k!=null&&k.access_token&&l(k.access_token)},n.current.requestAccessToken({prompt:r?"":"consent"})},[r]),P=h.useCallback(()=>{var k,R,O;if(r&&((O=(R=(k=window.google)==null?void 0:k.accounts)==null?void 0:R.oauth2)!=null&&O.revoke))try{window.google.accounts.oauth2.revoke(r)}catch{}l(null),d(null),m([]),g("primary")},[r]),E=h.useCallback(async k=>{var R;if(!r)throw new Error("Connect Google Calendar before syncing.");if(!p)throw new Error("Select a target calendar.");if(!Array.isArray(k)||!k.length)return{synced:0};w(!0),y(null);try{let O=0;const K=encodeURIComponent(p);for(const S of k){const z={summary:S.summary,description:S.description||void 0,start:{date:S.startDate},end:{date:S.endDate},iCalUID:S.uid,source:S.source||void 0,extendedProperties:S.extendedProperties||void 0},B=await fetch(`https://www.googleapis.com/calendar/v3/calendars/${K}/events/import`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(z)});if(!B.ok){const F=await B.json().catch(()=>({}));throw new Error(((R=F==null?void 0:F.error)==null?void 0:R.message)||`Failed to sync event: ${S.summary}`)}O+=1}return{synced:O}}catch(O){const K=O instanceof Error?O:new Error(String(O));throw y(K),K}finally{w(!1)}},[r,p]);return{isSupported:s,isReady:o,isSignedIn:!!r,user:c,calendars:u,selectedCalendarId:p,setSelectedCalendarId:g,isLoadingCalendars:D,isSyncing:j,lastError:f,signIn:I,signOut:P,syncEvents:E}}var cc={PUBLIC_URL:"https://albertbit-cyber.github.io/Breeding-planner/"};_n.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${_n.version}/pdf.worker.min.js`;const Zt=e=>e?String(e).charAt(0).toUpperCase()+String(e).slice(1):"";function Gs(){return{ovulation:{observed:!1,date:"",notes:""},preLayShed:{observed:!1,date:"",notes:"",intervalFromOvulation:null},clutch:{recorded:!1,date:"",eggsTotal:"",fertileEggs:"",slugs:"",notes:""},hatch:{scheduledDate:"",recorded:!1,date:"",hatchedCount:0,notes:""}}}const te=(...e)=>e.flat().filter(Boolean).join(" "),Ls=(e="id")=>`${e}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e6).toString(36)}`,rt=(e=new Date)=>{const s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${o}`},dc=()=>new Date().toISOString();function xt(e){if(!e)return"";const s=e instanceof Date?e:new Date(e);return Number.isNaN(s.getTime())?"":s.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})}function It(e){if(!e)return null;const s=String(e).trim();if(!s)return null;const n=s.match(/^(\d{4})/);if(!n)return null;const o=Number(n[1]);return Number.isFinite(o)?o:null}function uc(e="",s=""){const n=String(s||"").trim();if(!n)return e||"";const o=String(e||"");return o?o.split(`
`).map(r=>r.trim()).includes(n)?o:`${o}${o.endsWith(`
`)?"":`
`}${n}`:n}function rr(e){const s=xt(e);return s?`Lock observed ${s}`:"Lock observed"}const ta="breedingPlannerPendingAnimalView",Lt={snakes:"breedingPlannerSnakes",pairings:"breedingPlannerPairings",groups:"breedingPlannerGroups",breeder:"breedingPlannerBreederInfo",lastFeedDefaults:"breedingPlannerLastFeedDefaults",backupSettings:"breedingPlannerBackupSettings",backupSnapshot:"breedingPlannerBackupSnapshot",backupVault:"breedingPlannerBackupVault"},mc=`${cc.PUBLIC_URL}/app-icons/icon_512x512.png`,hc=["off","nightly","weekly","monthly"],pc=20,fc=[5,10,20,50,100,200,"unlimited"],xc="bpbackup",js=`.${xc}`,$s="application/x-breeding-planner-backup+json",Mn=(e,s)=>`${e}-${s}${js}`,is=[{key:"id",label:"Animal ID",section:"Identity",getter:e=>(e==null?void 0:e.id)||""},{key:"name",label:"Name",section:"Identity",getter:e=>(e==null?void 0:e.name)||""},{key:"sex",label:"Sex",section:"Identity",getter:e=>{const s=zt(e==null?void 0:e.sex);return s==="UNKNOWN"?"":s}},{key:"status",label:"Status",section:"Identity",getter:e=>(e==null?void 0:e.status)||""},{key:"year",label:"Hatch year",section:"Timeline",getter:e=>e?Number.isFinite(Number(e.year))?Number(e.year):It(e.birthDate)||"":""},{key:"birthDate",label:"Birth date",section:"Timeline",getter:e=>e!=null&&e.birthDate?je(e.birthDate):""},{key:"weight",label:"Current weight (g)",section:"Husbandry",getter:e=>{const s=e==null?void 0:e.weight;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"genetics",label:"Genetics summary",section:"Genetics",getter:e=>Rt(At(e==null?void 0:e.morphs,e==null?void 0:e.hets,e==null?void 0:e.possibleHets))},{key:"morphs",label:"Morphs",section:"Genetics",getter:e=>Rt(e==null?void 0:e.morphs)},{key:"hets",label:"Hets",section:"Genetics",getter:e=>Rt(e==null?void 0:e.hets)},{key:"tags",label:"Tags",section:"Attributes",getter:e=>Rt(e==null?void 0:e.tags)},{key:"groups",label:"Groups",section:"Attributes",getter:e=>Rt(e==null?void 0:e.groups)},{key:"sireId",label:"Sire ID",section:"Lineage",getter:e=>(e==null?void 0:e.sireId)||""},{key:"damId",label:"Dam ID",section:"Lineage",getter:e=>(e==null?void 0:e.damId)||""},{key:"projects",label:"Projects (pairings)",section:"Breeding",getter:(e,s={})=>{var o;if(!(e!=null&&e.id))return"";const n=((o=s.pairingsBySnakeId)==null?void 0:o.get(e.id))||[];return n.length?Rt(n.map(a=>a.label)):""}},{key:"lastFeedDate",label:"Last feed date",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"feeds");return s!=null&&s.date?je(s.date):""}},{key:"lastFeedDetails",label:"Last feed details",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"feeds");if(!s)return"";const n=[s.feed,s.size,s.method].map(o=>typeof o=="string"?o.trim():"").filter(Boolean);return typeof s.weightGrams=="number"&&s.weightGrams>0?n.push(`${s.weightGrams} g`):typeof s.grams=="number"&&s.grams>0&&n.push(`${s.grams} g`),Rt(n)}},{key:"lastWeightDate",label:"Last weigh date",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"weights");return s!=null&&s.date?je(s.date):""}},{key:"lastWeightGrams",label:"Last recorded weight (g)",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"weights");return s&&Number.isFinite(Number(s.grams))?Number(s.grams):""}},{key:"lastShedDate",label:"Last shed date",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"sheds");return s!=null&&s.date?je(s.date):""}},{key:"lastCleaningDate",label:"Last cleaning date",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"cleanings");return s!=null&&s.date?je(s.date):""}},{key:"lastMedDate",label:"Last medication date",section:"Husbandry",getter:e=>{const s=os(e==null?void 0:e.logs,"meds");return s!=null&&s.date?je(s.date):""}}],Ds=["id","name","sex","status","genetics","groups","weight","projects","lastFeedDate"],cs=[{key:"pairingId",label:"Pairing ID",section:"Identifiers",getter:e=>(e==null?void 0:e.id)||""},{key:"label",label:"Project label",section:"Identifiers",getter:(e,s={})=>s.displayLabel||(e==null?void 0:e.label)||""},{key:"cycleYear",label:"Season year",section:"Timeline",getter:(e,s={})=>s.cycleYear||""},{key:"femaleId",label:"Female ID",section:"Participants",getter:e=>(e==null?void 0:e.femaleId)||""},{key:"femaleName",label:"Female name",section:"Participants",getter:(e,s={})=>s.femaleName||(e==null?void 0:e.femaleId)||""},{key:"femaleGenetics",label:"Female genetics",section:"Participants",getter:(e,s={})=>s.femaleGenetics||""},{key:"maleId",label:"Male ID",section:"Participants",getter:e=>(e==null?void 0:e.maleId)||""},{key:"maleName",label:"Male name",section:"Participants",getter:(e,s={})=>s.maleName||(e==null?void 0:e.maleId)||""},{key:"maleGenetics",label:"Male genetics",section:"Participants",getter:(e,s={})=>s.maleGenetics||""},{key:"startDate",label:"Start date",section:"Timeline",getter:e=>e!=null&&e.startDate?je(e.startDate):""},{key:"ovulationDate",label:"Ovulation date",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.ovulationDate?je(s.derived.ovulationDate):""}},{key:"preLayDate",label:"Pre-lay shed",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.preLayDate?je(s.derived.preLayDate):""}},{key:"clutchDate",label:"Clutch date",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.clutchDate?je(s.derived.clutchDate):""}},{key:"eggsTotal",label:"Eggs laid",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.clutch)==null?void 0:n.eggsTotal;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"fertileEggs",label:"Fertile eggs",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.clutch)==null?void 0:n.fertileEggs;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"slugs",label:"Slugs",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.clutch)==null?void 0:n.slugs;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"hatchDate",label:"Hatch date",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.hatchDate?je(s.derived.hatchDate):""}},{key:"hatchScheduledDate",label:"Scheduled hatch",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.hatchScheduledDate?je(s.derived.hatchScheduledDate):""}},{key:"hatchedCount",label:"Hatched count",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.hatch)==null?void 0:n.hatchedCount;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"status",label:"Project status",section:"Summary",getter:(e,s={})=>qa(s.derived)},{key:"goals",label:"Goals",section:"Summary",getter:e=>Rt(e==null?void 0:e.goals)},{key:"hatchlingsCount",label:"Hatchlings produced",section:"Summary",getter:(e,s={})=>Array.isArray(s.hatchlings)?s.hatchlings.length:""}],Es=["label","cycleYear","femaleName","maleName","clutchDate","eggsTotal","hatchDate","hatchedCount","status"];function Cs(e,s,n){const o=new Set(n.map(r=>r.key)),a=Array.isArray(e)?e.filter(r=>o.has(r)):[];return a.length?a:[...s]}function sa(e=[],s=[],n=Ds){const o=Cs(n,Ds,is),a=new Map(is.map(m=>[m.key,m])),r=o.map(m=>a.get(m)).filter(Boolean),l=Ha(e),c=gc(s,l),d={snakes:e,pairings:s,snakeMap:l,pairingsBySnakeId:c},u=[];return(Array.isArray(e)?e:[]).forEach(m=>{if(!m)return;const p={};r.forEach(g=>{const f=typeof g.getter=="function"?g.getter(m,d):m[g.key];p[g.key]=ar(f)}),u.push(p)}),{columns:r.map(m=>({key:m.key,label:m.label})),rows:u}}function na(e=[],s=[],n=Es){const o=Cs(n,Es,cs),a=new Map(cs.map(u=>[u.key,u])),r=o.map(u=>a.get(u)).filter(Boolean),l=Ha(s),c=bc(s),d=[];return(Array.isArray(e)?e:[]).forEach(u=>{if(!u)return;const m=dt({...u}),p=bs(m),g=m!=null&&m.femaleId?l.get(m.femaleId):null,f=m!=null&&m.maleId?l.get(m.maleId):null,y=Va(m,g,f),j=gn({clutchDate:p.clutchDate,preLayDate:p.preLayDate,ovulationDate:p.ovulationDate,hatchDate:p.hatchDate,startDate:m.startDate||""}),w=c.get(m.id)||[],D={snakes:s,pairings:e,snakeMap:l,derived:p,displayLabel:y,femaleSnake:g,femaleName:(g==null?void 0:g.name)||m.femaleId||"",femaleGenetics:Rt(At(g==null?void 0:g.morphs,g==null?void 0:g.hets,g==null?void 0:g.possibleHets)),maleSnake:f,maleName:(f==null?void 0:f.name)||m.maleId||"",maleGenetics:Rt(At(f==null?void 0:f.morphs,f==null?void 0:f.hets,f==null?void 0:f.possibleHets)),cycleYear:j,hatchlings:w},b={};r.forEach(I=>{const P=typeof I.getter=="function"?I.getter(m,D):m[I.key];b[I.key]=ar(P)}),d.push(b)}),{columns:r.map(u=>({key:u.key,label:u.label})),rows:d}}function ar(e){if(e===null||typeof e>"u")return"";if(Array.isArray(e))return e.map(n=>{const o=ar(n);return o===null||typeof o>"u"?"":typeof o=="number"?String(o):o}).filter(Boolean).join(", ");if(e instanceof Date)return je(e)||e.toISOString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return e}function Rt(e){return Array.isArray(e)?e.map(s=>s===null||typeof s>"u"?"":String(s).trim()).filter(Boolean).join(", "):e===null||typeof e>"u"?"":String(e)}function os(e,s){if(!e||typeof e!="object")return null;const n=Array.isArray(e[s])?e[s]:[];return n.length?n[n.length-1]:null}function Ha(e=[]){const s=new Map;return(Array.isArray(e)?e:[]).forEach(n=>{n&&n.id&&s.set(n.id,n)}),s}function gc(e=[],s=new Map){const n=new Map;return(Array.isArray(e)?e:[]).forEach(o=>{if(!o)return;const a=dt({...o}),r=a.femaleId?s.get(a.femaleId):null,l=a.maleId?s.get(a.maleId):null,c=Va(a,r,l);a.femaleId&&(n.has(a.femaleId)||n.set(a.femaleId,[]),n.get(a.femaleId).push({id:a.id,label:c})),a.maleId&&(n.has(a.maleId)||n.set(a.maleId,[]),n.get(a.maleId).push({id:a.id,label:c}))}),n}function bc(e=[]){const s=new Map;return(Array.isArray(e)?e:[]).forEach(n=>{var a;if(!n)return;const o=n.pairingId||((a=n==null?void 0:n.metadata)==null?void 0:a.pairingId)||null;o&&(s.has(o)||s.set(o,[]),s.get(o).push(n))}),s}function Va(e,s,n){if(e!=null&&e.label&&e.label.trim())return e.label.trim();const o=(s==null?void 0:s.name)||(e==null?void 0:e.femaleId)||"Female",a=(n==null?void 0:n.name)||(e==null?void 0:e.maleId)||"Male";return`${o} × ${a}`}function qa(e){return e?e.hatchedRecorded?"Hatched":e.clutchRecorded?"Eggs laid":e.preLayObserved?"Pre-lay shed":e.ovulationObserved?"Ovulation observed":"Planned":"Planned"}function yc(e){var m,p,g,f;if(!e)return"";const s=dt({...e}),n=bs(s),o=qa(n),r=(Array.isArray(s.appointments)?s.appointments.slice():[]).map(y=>{const j=new Date(y.date||y.start||y.end||"");return Number.isNaN(j.getTime())?null:(j.setHours(0,0,0,0),{info:y,date:j})}).filter(Boolean).sort((y,j)=>y.date.getTime()-j.date.getTime()),l=new Date;l.setHours(0,0,0,0);const c=r.find(y=>y.date.getTime()>=l.getTime()),d=r.filter(y=>y.date.getTime()<l.getTime()).pop(),u=[];return(m=s==null?void 0:s.clutch)!=null&&m.recorded&&((p=s==null?void 0:s.clutch)!=null&&p.date)?u.push(`Clutch on ${je(s.clutch.date)}`):(g=s==null?void 0:s.ovulation)!=null&&g.observed&&((f=s==null?void 0:s.ovulation)!=null&&f.date)&&u.push(`Ovulation recorded ${je(s.ovulation.date)}`),c?u.push(`Next appointment ${je(c.date)}`):d&&u.push(`Last appointment ${je(d.date)}`),u.length?`${o} • ${u.join(" • ")}`:o}async function ra(e,s={}){const n=Array.isArray(e==null?void 0:e.columns)?e.columns:[],o=Array.isArray(e==null?void 0:e.rows)?e.rows:[],{title:a="",subtitle:r="",fileName:l="export.pdf",orientation:c="landscape"}=s,{jsPDF:d}=await xs(async()=>{const{jsPDF:R}=await import("./jspdf-5IEmIIiP.js").then(O=>O.j);return{jsPDF:R}},__vite__mapDeps([0,1,2])),u=new d({orientation:c,unit:"mm",format:"a4"}),m=12,p=u.internal.pageSize.getWidth(),g=u.internal.pageSize.getHeight(),f=8,y=2,j=4.5;let w=m;if(u.setFontSize(14),a&&(u.text(a,m,w),w+=7),r&&(u.setFontSize(10),u.text(r,m,w),w+=6),u.setFontSize(9),!n.length){u.text("No columns selected.",m,w+5),u.save(l);return}const D=p-m*2,b=22;let I=D/n.length,P=n.map(()=>I);if(I>b){P=n.map(()=>Math.max(b,I));const R=P.reduce((O,K)=>O+K,0);if(R>D){const O=D/R;P=P.map(K=>K*O)}}else P=n.map(()=>I);const E=()=>{let R=m;u.setFontSize(9),u.setFont(void 0,"bold"),n.forEach((O,K)=>{u.setFillColor(237,242,247),u.setDrawColor(210),u.rect(R,w,P[K],f,"FD"),u.setTextColor(51,65,85);const S=O.label||O.key||`Column ${K+1}`;u.text(S,R+2,w+f-2),R+=P[K]}),u.setFont(void 0,"normal"),u.setTextColor(17,24,39),w+=f};E(),o.forEach(R=>{const O=n.map((B,F)=>{const de=R[B.key],U=de===null||typeof de>"u"?"":de,A=String(typeof U=="number"?U:U||""),G=Math.max(10,P[F]-4);return u.splitTextToSize(A,G)}),K=O.reduce((B,F)=>Math.max(B,F.length||1),1),S=Math.max(f,K*j+y*2);w+S>g-m&&(u.addPage(void 0,c),w=m,E());let z=m;n.forEach((B,F)=>{const de=O[F];u.setDrawColor(230),u.rect(z,w,P[F],S),u.text(de,z+2,w+y+3),z+=P[F]}),w+=S});const k=new Date().toISOString();u.setFontSize(8),u.setTextColor(100),u.text(`Generated ${xt(k)||k}`,m,g-m+4),u.save(l)}async function aa(e,s={}){const n=Array.isArray(e==null?void 0:e.columns)?e.columns:[],o=Array.isArray(e==null?void 0:e.rows)?e.rows:[],{fileName:a="export.xlsx"}=s;if(typeof window>"u"||typeof document>"u")throw new Error("Spreadsheet export is only supported in a browser environment.");let r;try{r=await xs(()=>import("./xlsx-D_0l8YDs.js"),[])}catch{throw new Error("XLSX library is unavailable.")}if(!r||!r.utils)throw new Error("XLSX library is unavailable.");const l=n.map(y=>y.label||y.key),c=o.map(y=>{const j={};return n.forEach(w=>{const D=w.label||w.key,b=y[w.key];j[D]=b===null||typeof b>"u"?"":b}),j}),d=r.utils.json_to_sheet(c,{header:l}),u=r.utils.book_new();r.utils.book_append_sheet(u,d,s.sheetName||"Export");const m=r.write(u,{bookType:"xlsx",type:"array"}),p=new Blob([m],{type:"application/octet-stream"}),g=URL.createObjectURL(p),f=document.createElement("a");f.href=g,f.download=a,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.setTimeout(()=>URL.revokeObjectURL(g),500)}function oa(e=[]){const s=new Map;return e.forEach(n=>{const o=n.section||"Other";s.has(o)||s.set(o,[]),s.get(o).push(n)}),Array.from(s.entries()).map(([n,o])=>({section:n,fields:o}))}function ls(e){const s={frequency:"off",lastRun:null,maxVaultEntries:pc};if(!e||typeof e!="object")return s;const n=hc.includes(e.frequency)?e.frequency:s.frequency,o=typeof e.lastRun=="string"&&e.lastRun?e.lastRun:null;let a=s.maxVaultEntries;if(e.maxVaultEntries==="unlimited"||e.maxVaultEntries===null)a=null;else{const r=parseInt(e.maxVaultEntries,10);Number.isFinite(r)&&r>0&&(a=Math.min(r,200))}return{frequency:n,lastRun:o,maxVaultEntries:a}}function Nc(e){switch(e){case"nightly":return 24*60*60*1e3;case"weekly":return 7*24*60*60*1e3;case"monthly":return 30*24*60*60*1e3;default:return null}}function wc(e){if(!e||typeof e!="object")return null;const s=typeof e.savedAt=="string"&&e.savedAt?e.savedAt:null,n=e.payload&&typeof e.payload=="object"?e.payload:null;return!s||!n?null:{savedAt:s,payload:n}}const vc="[YR][PREFIX]-[SEQ]",xn=Object.freeze({template:"[YROB][GEN3][-][SEX]-[SEQ]",sequencePadding:1,uppercase:!1,customText:""});function or(){return{...xn}}function Ms(e){const s=or();if(!e||typeof e!="object")return s;const n={...s,...e};n.template=String(n.template||s.template);const o=parseInt(n.sequencePadding,10);return n.sequencePadding=Number.isFinite(o)&&o>0?Math.min(o,6):s.sequencePadding,n.uppercase=n.uppercase!==!1,n.customText=String(typeof n.customText=="string"?n.customText:n.customText??s.customText??""),n}function us(e){const s={name:"",businessName:"",email:"",phone:"",logoUrl:"",idGenerator:or()};if(!e||typeof e!="object")return s;const n={...s,...e},o=e==null?void 0:e.idGenerator;let a=Ms(n.idGenerator);return(!o||typeof o=="object"&&(!Object.prototype.hasOwnProperty.call(o,"template")||String(o.template||"").trim()===vc)&&!Object.prototype.hasOwnProperty.call(o,"customText")&&!Object.prototype.hasOwnProperty.call(o,"uppercase")&&!Object.prototype.hasOwnProperty.call(o,"sequencePadding"))&&(a={...a,template:xn.template}),n.idGenerator=Ms(a),n}const jc=[{token:"[YR]",description:"Last two digits of the year (e.g., 25)."},{token:"[YEAR]",description:"Full four-digit year (e.g., 2025)."},{token:"[YROB]",description:"Last two digits of the birth year."},{token:"[YEAROB]",description:"Full four-digit birth year."},{token:"[PREFIX]",description:"Legacy prefix derived from the name (or sire × dam pattern)."},{token:"[PREFIXU]",description:"Prefix in uppercase."},{token:"[PREFIXL]",description:"Prefix in lowercase."},{token:"[NAME]",description:"Letters from the name in Title Case."},{token:"[NAMEU]",description:"Letters from the name in uppercase."},{token:"[NAMEL]",description:"Letters from the name in lowercase."},{token:"[INITIALS]",description:"Initials from each word of the name."},{token:"[SLUG]",description:"Letters and numbers condensed to lowercase."},{token:"[SLUGU]",description:"Letters and numbers condensed to uppercase."},{token:"[PAREN]",description:"Code from a leading parentheses block (e.g., (DH))."},{token:"[HETS]",description:"Compact het markers (e.g., 50%Hclo)."},{token:"[SEX]",description:"Animal sex (F or M)."},{token:"[TEXT]",description:"Free text snippet from the wizard."},{token:"[GEN3]",description:"First three letters of each gene (e.g., Enchi Fire Clown → EncFirClo)."},{token:"[SEQ]",description:"Running sequence number with optional padding."},{token:"[-]",description:"Literal dash separator."}];function Ps(e,s){if(typeof window>"u")return s;try{const n=window.localStorage.getItem(e);return n?JSON.parse(n)??s:s}catch(n){return console.warn(`Failed to read ${e} from storage`,n),s}}function Rs(e,s){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(s))}catch(n){console.warn(`Failed to persist ${e} to storage`,n)}}function fs(e={}){return{feeds:[...e.feeds||[]],weights:[...e.weights||[]],sheds:[...e.sheds||[]],cleanings:[...e.cleanings||[]],meds:[...e.meds||[]]}}const Cc=60;function Ya(e){if(!e||typeof e!="object")return null;const s=typeof e.url=="string"&&e.url.trim()?e.url.trim():typeof e.dataUrl=="string"&&e.dataUrl.trim()?e.dataUrl.trim():null;if(!s)return null;const n=typeof e.id=="string"&&e.id.trim()?e.id.trim():Ls("photo"),o=typeof e.name=="string"?e.name.trim():"",a=typeof e.addedAt=="string"&&e.addedAt?e.addedAt:new Date().toISOString(),r=e.source==="camera"?"camera":"upload",l=typeof e.type=="string"?e.type:"",c=Number(e.size),d=Number.isFinite(c)&&c>=0?c:null,u=typeof e.note=="string"?e.note:"";return{id:n,url:s,name:o,addedAt:a,source:r,type:l,size:d,note:u}}function Mt(e){return Array.isArray(e)?e.map(Ya).filter(Boolean):[]}function Tn(e,s=Cc){return Array.isArray(e)?typeof s!="number"||s<=0||e.length<=s?e:e.slice(e.length-s):[]}function Sc(e){if(!e||typeof e!="object")return null;const s={...e};return s.morphs=Array.isArray(e.morphs)?e.morphs.map(n=>String(n||"").trim()).filter(Boolean):[],s.hets=Array.isArray(e.hets)?e.hets.map(n=>String(n||"").trim()).filter(Boolean):[],s.possibleHets=Array.isArray(e.possibleHets)?e.possibleHets.map(n=>String(n||"").trim()).filter(Boolean):typeof e.possibleHets=="string"?String(e.possibleHets).split(/[,\n]/).map(n=>String(n||"").trim()).filter(Boolean):[],s.tags=Array.isArray(e.tags)?e.tags.map(n=>String(n||"").trim()).filter(Boolean):[],s.groups=Array.isArray(e.groups)?e.groups.map(n=>String(n||"").trim()).filter(Boolean):es(e.groups),s.logs=fs(e.logs),s.photos=Mt(e.photos),s.metadata&&typeof s.metadata=="object"&&(s.metadata={...s.metadata}),s}function kc(e){return!e||typeof e!="object"?null:dt({...e})}function Wa(e){if(!e||typeof e!="object")return null;const s=e.payload&&typeof e.payload=="object"?e.payload:null;if(!s)return null;const n=e.source==="auto"?"auto":"manual",o=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:new Date().toISOString(),a=typeof e.updatedAt=="string"&&e.updatedAt?e.updatedAt:o,r=typeof e.name=="string"&&e.name.trim()?e.name.trim():`${n==="auto"?"Auto":"Manual"} backup ${xt(o)}`;return{id:typeof e.id=="string"&&e.id.trim()?e.id.trim():Ls("backup"),name:r,createdAt:o,updatedAt:a,source:n,payload:s}}function Ac(e){if(!Array.isArray(e))return[];const s=e.map(Wa).filter(Boolean);return s.sort((n,o)=>{const a=new Date(n.createdAt||0).getTime();return new Date(o.createdAt||0).getTime()-a}),s}const Qa=[{id:"25Ath-1",name:"Athena - DEMO",sex:"F",morphs:["Clown","Pastel"],hets:["Hypo"],possibleHets:[],weight:850,year:2025,birthDate:"2024-06-15",tags:["proven","female"],groups:["Breeders"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}},{id:"25Bor-1",name:"Boris - DEMO",sex:"M",morphs:["Pinstripe","Albino"],hets:[],possibleHets:[],weight:1020,year:2023,birthDate:"2023-08-02",tags:["male"],groups:["Breeders"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}},{id:"25Jun-1",name:"Juniper - DEMO",sex:"F",morphs:["GHI"],hets:[],possibleHets:[],weight:460,year:2024,birthDate:"2024-04-11",tags:["holdback"],groups:["Holdbacks"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}},{id:"25Neo-1",name:"Neo - DEMO",sex:"M",morphs:["Normal"],hets:[],possibleHets:[],weight:180,year:2025,birthDate:"2025-05-01",tags:["hatchling"],groups:["Hatchlings 2025"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}}],tt=Qa.find(e=>(e==null?void 0:e.name)==="Boris - DEMO"),_s={name:(tt==null?void 0:tt.name)||"Boris - DEMO",year:(tt==null?void 0:tt.year)||It(tt==null?void 0:tt.birthDate)||new Date().getFullYear(),birthYear:It(tt==null?void 0:tt.birthDate)||(tt==null?void 0:tt.year)||new Date().getFullYear(),sex:Nt(tt==null?void 0:tt.sex,"M"),genes:(()=>{const e=Array.isArray(tt==null?void 0:tt.morphs)?tt.morphs:[],s=Array.isArray(tt==null?void 0:tt.hets)?tt.hets:[],n=[...e,...s].map(o=>String(o||"").trim()).filter(Boolean);return n.length?n.join(", "):""})()},Dc=[],Ec=["Breeders","Holdbacks","Hatchlings 2024","Hatchlings 2025"],la=["Active","Holdback","Grow-out","Breeder","Quarantine","Sold","On loan","MorphMarket","On hold","Retired","Deceased"],ia="breedingPlannerScanMode";function ca(){return Qa.map(e=>{const s=Number(e==null?void 0:e.idSequence),n=Number.isFinite(s)&&s>0?s:gt(e==null?void 0:e.id)||null;return{...e,idSequence:n,morphs:[...e.morphs||[]],hets:[...e.hets||[]],possibleHets:Array.isArray(e.possibleHets)?[...e.possibleHets]:[],tags:[...e.tags||[]],groups:es(e.groups),logs:fs(e.logs),photos:Mt(e.photos)}})}function Ic(){return Dc.map(e=>dt({...e,goals:[...e.goals||[]],notes:e.notes||"",appointments:(e.appointments||[]).map(s=>({...s}))}))}function je(e){if(!e)return"";if(typeof e=="string"){const s=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(s)return`${s[3]}/${s[2]}/${s[1]}`;const n=new Date(e);if(!isNaN(n)){const o=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();return`${o}/${a}/${r}`}return e}if(e instanceof Date){const s=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();return`${s}/${n}/${o}`}try{const s=new Date(e);if(!isNaN(s)){const n=String(s.getDate()).padStart(2,"0"),o=String(s.getMonth()+1).padStart(2,"0"),a=s.getFullYear();return`${n}/${o}/${a}`}}catch{}return String(e)}function dt(e={}){const s=Gs(),n={...s.ovulation,...e.ovulation||{}},o={...s.preLayShed,...e.preLayShed||{}},a={...s.clutch,...e.clutch||{}},r={...s.hatch,...e.hatch||{}},l=g=>{if(g===""||g===null||typeof g>"u")return null;const f=Number(g);return!Number.isFinite(f)||f<0?null:f},c=!!a.recorded;let d=l(a.fertileEggs),u=l(a.slugs),m=l(a.eggsTotal);c?(d===null&&m!==null&&(d=Math.max(0,m-(u??0))),u===null&&(u=0),d===null&&(d=0),d=Math.max(0,d),u=Math.max(0,u),m=d+u,a.fertileEggs=d,a.slugs=u,a.eggsTotal=m):(a.fertileEggs="",a.slugs="",a.eggsTotal=""),r.hatchedCount=Number(r.hatchedCount||0),(!Number.isFinite(r.hatchedCount)||r.hatchedCount<0)&&(r.hatchedCount=0);const p=typeof a.fertileEggs=="number"&&Number.isFinite(a.fertileEggs)?Math.max(0,a.fertileEggs):typeof a.eggsTotal=="number"&&Number.isFinite(a.eggsTotal)?Math.max(0,a.eggsTotal):null;return typeof p=="number"&&Number.isFinite(p)?r.hatchedCount=Math.min(Math.max(0,r.hatchedCount),p):r.hatchedCount=Math.max(0,r.hatchedCount),{...e,ovulation:n,preLayShed:o,clutch:a,hatch:r}}function nn(e){if(!e)return{name:"",sex:"F",status:"Active",morphs:[],hets:[],tags:[],groups:[],logs:fs(),idSequence:null};const s=Number(e==null?void 0:e.idSequence),n=Number.isFinite(s)&&s>0?s:gt(e==null?void 0:e.id)||null;return{...e,status:typeof(e==null?void 0:e.status)=="string"&&e.status.trim()?e.status.trim():"Active",idSequence:n,sex:Nt(e.sex,"F"),morphs:e.morphs||[],hets:e.hets||[],tags:e.tags||[],groups:es(e.groups),logs:fs(e.logs),photos:Mt(e.photos)}}function Fn(){return{id:"",autoId:!0,idSequence:null,name:"",sex:"F",status:"Active",morphHetInput:"",morphs:[],hets:[],weight:"",year:"",birthDate:"",imageUrl:"",photos:[],groups:[],logs:fs()}}function Jt(e,s){return Array.isArray(e)&&e.find(n=>n&&n.id===s)||null}function zt(e){const s=String(e??"").trim().toLowerCase();return s?s==="m"||s==="male"?"M":s==="f"||s==="female"?"F":/^male\b/.test(s)?"M":/^female\b/.test(s)?"F":/^supermale\b/.test(s)?"M":/^superfemale\b/.test(s)?"F":/^1[\s.:/]*0$/.test(s)?"M":/^0[\s.:/]*1$/.test(s)?"F":/^m/.test(s)?"M":/^f/.test(s)?"F":"UNKNOWN":"UNKNOWN"}function Nt(e,s="F"){const n=zt(e);return n==="UNKNOWN"?s:n}function Os(e){return zt(e==null?void 0:e.sex)==="F"}function rn(e){return zt(e==null?void 0:e.sex)==="M"}function mn(e){if(e==null)return null;let s=String(e).replace(/\s+/g," ").trim();if(!s)return null;let n=s;const o=[],a=n.match(/^(\d{1,3}%)(?:\s+)(.*)$/i);a&&(o.push(a[1].trim()),n=a[2].trim());const r=n.match(/^(pos(?:s?i?a?ble)?|probable|maybe|ph)\b\s*(.*)$/i);if(r){const d=r[1].toLowerCase(),u={pos:"Possible",possiable:"Possible",posible:"Possible",possible:"Possible",probable:"Probable",maybe:"Maybe",ph:"Possible"};o.push(u[d]||Zt(d)),n=r[2].trim()}let l=n;/\bhet\b/i.test(l)&&(l=l.replace(/\bhet\b/gi,"").trim()),l&&(l=l.split(/\s+/).map(d=>{if(!d)return"";const u=d.toUpperCase();return d===u?d:d.charAt(0).toUpperCase()+d.slice(1)}).join(" ").trim());const c=[...o,"Het"];return l&&c.push(l),c.join(" ").replace(/\s+/g," ").trim()}function Wn(e=[]){const s=new Set,n=[];return e.forEach(o=>{const a=String(o).replace(/\s+/g," ").trim().toLowerCase();!a||s.has(a)||(s.add(a),n.push(o))}),n}function At(e=[],s=[],n=[]){const o=Array.isArray(e)?e:e?[e]:[],a=Array.isArray(s)?s:s?[s]:[],r=Array.isArray(n)?n:n?[n]:[],l=o.map(g=>String(g).trim()).filter(Boolean),c=a.map(mn).filter(Boolean),d=r.map(mn).filter(Boolean),u=Wn([...l,...c,...d]),m={Dominant:0,"Incomplete Dominant":1,Recessive:2,Other:3},p=u.map((g,f)=>{const y=gs(g)||"Other",j=typeof m[y]=="number"?m[y]:m.Other;return{token:g,index:f,weight:j}});return p.sort((g,f)=>g.weight!==f.weight?g.weight-f.weight:g.index-f.index),p.map(g=>g.token)}function Ka(e){if(!e)return!1;const s=String(e).toLowerCase();return!!(s.includes("het")||/(^|\s)(pos(?:s?i?a?ble)?|probable|maybe|ph)(\s|$)/i.test(s)||/\d{1,3}%/.test(s))}function Lc(e){if(!e)return!1;const s=String(e).replace(/\s+/g," ").trim();if(!s)return!1;const n=s.toLowerCase();return/^(?:\d{1,3}%\s*)?(?:(?:pos(?:s?i?a?ble)?|probable|maybe|ph)\s+)?het\b/.test(n)?!0:Ka(e)}function Mc(e){if(!e)return null;let s=String(e).replace(/\s+/g," ").trim();if(!s)return null;let n="";const o=s.match(/^(\d{1,3}%)(?:\s*)(.*)$/i);o&&(n=o[1].toUpperCase(),s=o[2].trim());let a="";const r=s.match(/^(pos(?:s?i?a?ble)?|probable|maybe|ph)(?:\s*)(.*)$/i);r&&(a=r[1].toLowerCase(),s=r[2].trim()),s=s.replace(/\bhet\b/gi," ").replace(/^het(?=[A-Za-z])/i,"").trim();const c={pos:"Possible",ph:"Possible",possible:"Possible",possiable:"Possible",posible:"Possible",probable:"Probable",maybe:"Maybe"}[a]||"",d=[];c&&d.push(c),s&&d.push(s);let u=d.join(" ").trim();return n&&(u=`${n} ${u}`.trim()),u||null}const Wt={map:null,compactMap:null,maxWords:1,maxCompactLength:0};function lr(e){return String(e||"").replace(/[()[\]]/g," ").replace(/[-_/]+/g," ").replace(/\s+/g," ").trim().toLowerCase()}function ir(){if(Wt.map||typeof zn>"u")return Wt;const e=new Map,s=(l,c)=>{const d=lr(l);d&&(e.has(d)||e.set(d,c))};Object.values(zn).forEach(l=>{(l||[]).forEach(c=>{if(!c)return;s(c,c);const d=c.replace(/\(.*?\)/g,"").trim();d&&d!==c&&s(d,c)})}),typeof Bs=="object"&&Bs&&Object.entries(Bs).forEach(([l,c])=>{l&&(c&&s(c,c),s(l,c||l))});const n=new Map;let o=1,a=0;const r=(l,c)=>{const d=l.replace(/\s+/g,"");d&&(n.has(d)||(n.set(d,{display:c,sourceKey:d}),d.length>a&&(a=Math.max(a,d.length))))};return e.forEach((l,c)=>{const d=c.split(" ").filter(Boolean);if(d.length>o&&(o=d.length),r(c,l),!String(l||"").toLowerCase().startsWith("super ")){const m=`super${c.replace(/\s+/g,"")}`,p=`Super ${l}`;r(m,p)}}),Wt.map=e,Wt.compactMap=n,Wt.maxWords=o,Wt.maxCompactLength=a,Wt}function da(e){if(!e)return null;const n=ir().map;if(!n)return null;const o=lr(e);return o&&n.get(o)||null}function Tc(e){const s=[];if(!Array.isArray(e)||!e.length)return s;const o=ir().maxWords||1;let a=0;for(;a<e.length;){const r=e[a];if(!r){a+=1;continue}if(r.toLowerCase()==="super"&&a+1<e.length){let u=null,m=0;for(let p=Math.min(o,e.length-(a+1));p>=1;p--){const f=e.slice(a+1,a+1+p).join(" "),y=da(f);if(y){u={display:`Super ${y}`,source:`Super ${f}`},m=p+1;break}}if(u){s.push(u),a+=m;continue}}let c=null,d=0;for(let u=Math.min(o,e.length-a);u>=1;u--){const p=e.slice(a,a+u).join(" "),g=da(p);if(g){c={display:g,source:p},d=u;break}}if(c){s.push(c),a+=d;continue}s.push({display:r,source:r}),a+=1}return s}function ua(e){if(!e)return[];const s=ir(),n=s.compactMap;if(!n||!n.size)return[];const a=lr(e).replace(/\s+/g,"");if(!a)return[];const r=s.maxCompactLength||a.length,l=new Map,c=p=>{if(p===a.length)return[[]];if(l.has(p))return l.get(p);const g=[],f=Math.min(r,a.length-p);for(let y=f;y>=1;y--){const j=a.slice(p,p+y),w=n.get(j);if(!w)continue;c(p+y).forEach(b=>{g.push([w,...b])})}return l.set(p,g),g},d=c(0).filter(p=>p.length);if(!d.length)return[];d.sort((p,g)=>p.length-g.length);const u=d[0].length;return(d.find(p=>p.length===u)||d[0]).map(p=>({display:p.display,source:p.sourceKey}))}function Fc(e){if(!e)return[];const s=String(e).replace(/[+]+/g," ");let n=s;const o=[],a=[];let r=0;const l=(P,E)=>a.some(k=>Math.max(k.start,P)<Math.min(k.end,E)),c=(P,E)=>{const k=String(P||"").replace(/\s+/g," ").trim();if(!k)return;const R=Number.isFinite(E)?E:Number.POSITIVE_INFINITY;o.push({token:k,start:R,order:r++})},d=(P,E)=>{!Number.isFinite(P)||!Number.isFinite(E)||a.push({start:P,end:E})},u=/(?:\d{1,3}%\s*)?(?:pos(?:s?i?a?ble)?|probable|maybe|ph)?\s*het\s*[A-Za-z][A-Za-z\s-]*/gi;let m;for(;(m=u.exec(n))!==null;){const P=m.index,E=P+m[0].length;l(P,E)||(c(m[0],P),d(P,E))}const p=/\d{1,3}%\s*[A-Za-z][A-Za-z\s-]*/gi;for(;(m=p.exec(n))!==null;){const P=m.index,E=P+m[0].length;l(P,E)||(c(m[0],P),d(P,E))}if(a.length){let P="",E=0;[...a].sort((R,O)=>R.start-O.start).forEach(R=>{P+=n.slice(E,R.start),P+=" ",E=R.end}),P+=n.slice(E),n=P}const g=s.toLowerCase();let f=0;const y=P=>{if(!P)return Number.POSITIVE_INFINITY;const E=String(P).toLowerCase();let k=g.indexOf(E,f);for(;k!==-1;){const R=k,O=R+E.length;if(!l(R,O))return d(R,O),f=O,R;k=g.indexOf(E,O)}for(k=g.indexOf(E);k!==-1;){const R=k,O=R+E.length;if(!l(R,O))return d(R,O),f=O,R;k=g.indexOf(E,O)}return Number.POSITIVE_INFINITY},j=n.split(/\s+/).filter(Boolean),w=Tc(j);w.length&&w.forEach(P=>{if(P.display===P.source){const R=ua(P.source)||[];if((R.length>1||R.length===1&&R[0].display!==P.display)&&R.length){R.forEach(K=>{if(!K||!K.display)return;const S=[K.source,K.display].filter(Boolean);let z=Number.POSITIVE_INFINITY;for(const B of S)if(z=y(B),Number.isFinite(z))break;c(K.display,z)});return}}const k=y(P.source);c(P.display,k)});const D=[...a].sort((P,E)=>P.start-E.start);let b=0;const I=[];if(D.forEach(P=>{if(P.start>b){const E=s.slice(b,P.start);E&&/[A-Za-z]/.test(E)&&I.push(E)}b=Math.max(b,P.end)}),b<s.length){const P=s.slice(b);P&&/[A-Za-z]/.test(P)&&I.push(P)}return I.length&&I.forEach(P=>{(ua(P)||[]).forEach(k=>{if(!k||!k.display)return;const R=[k.source,k.display].filter(Boolean);let O=Number.POSITIVE_INFINITY;for(const K of R)if(O=y(K),Number.isFinite(O))break;c(k.display,O)})}),o.sort((P,E)=>P.start===E.start?P.order-E.order:P.start-E.start),o.map(P=>P.token)}function Ss(e){const s=String(e||"").trim();if(!s)return{morphs:[],hets:[]};const o=s.split(/[\n\r,;|/+]+/).map(l=>l.trim()).filter(Boolean).flatMap(Fc),a=[],r=[];return o.forEach(l=>{if(Ka(l)){const c=Mc(l);c&&r.push(c)}else a.push(l)}),{morphs:a,hets:r}}function $c(e=[],s=[]){const n=(Array.isArray(e)?e:[]).map(a=>String(a).trim()).filter(Boolean),o=(Array.isArray(s)?s:[]).map(mn).filter(Boolean);return[...n,...o].join(", ")}function Xa(e,s=3){const n=[],o=new Date(e||new Date);for(let a=0;a<s;a++){const r=new Date(o.getFullYear(),o.getMonth()+a,o.getDate());n.push({id:Ls("ap"),date:rt(r),notes:"",lockObserved:!1,lockLoggedAt:null})}return n}function Ja(e){return new Promise((s,n)=>{const o=new FileReader;o.onload=()=>s(o.result),o.onerror=n,o.readAsDataURL(e)})}function Pc(e,s,n=1024){if(!e||!s)return{width:0,height:0};const o=Math.max(e,s);if(!n||o<=n)return{width:e,height:s};const a=n/o;return{width:Math.round(e*a),height:Math.round(s*a)}}function Rc(e){return new Promise((s,n)=>{const o=new Image;o.onload=()=>s(o),o.onerror=n,o.src=e})}async function _c(e,{maxDimension:s=1024}={}){if(!e)return null;const n=URL.createObjectURL(e);try{const o=await Rc(n),a=o.naturalWidth||o.width,r=o.naturalHeight||o.height;if(!a||!r)throw new Error("Invalid image dimensions");const{width:l,height:c}=Pc(a,r,s),d=document.createElement("canvas");d.width=l,d.height=c;const u=d.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("Canvas context not available");u.drawImage(o,0,0,l,c);const m=u.getImageData(0,0,l,c),p=ol(m.data,m.width,m.height,{inversionAttempts:"attemptBoth"});return p&&typeof p.data=="string"?p.data:null}finally{URL.revokeObjectURL(n)}}function Za(e){if(!e)return null;if(typeof e=="string")return e;if(typeof e=="object"){if(typeof e.text=="string")return e.text;if(typeof e.decodedText=="string")return e.decodedText;if(typeof e.data=="string")return e.data;if(Array.isArray(e)&&e.length>0)return Za(e[0])}return null}function an(e){if(e==null)return null;const s=String(e).trim();if(!s)return null;const n=s.match(/#?snake=?(.*)/),o=n?n[1]:s;try{return decodeURIComponent(o)||null}catch{return o||null}}function it(e,s,n,o){if(typeof e=="function"){const c=e,d=n,u=o||{};c(m=>{const p={...m.logs||{}},g=Array.isArray(p[s])?[...p[s]]:[];if(typeof d=="number"){const f=g[d]||{};g[d]={...f,...u}}else n&&typeof n=="object"&&g.push(n);return{...m,logs:{...p,[s]:g}}});return}const a=e;if(!a)return a;const r=n,l={...a.logs||{}};return l[s]=[...l[s]||[],r],{...a,logs:l}}function eo(e){if(!e)return[];const s=e.split(/\n\s*\n/).map(o=>o.trim()).filter(Boolean),n=[];for(const o of s){let a=o.split(/\n/).map(c=>c.trim()).filter(Boolean);a=a.filter(c=>!/^ball python\s*\(python regius\)$/i.test(c));const r={name:"",sex:"F",morphs:[],hets:[],tags:[],groups:[],imageUrl:void 0},l=c=>(c||"").split(/[,/]/).map(d=>d.trim()).filter(Boolean);if(a.length>=4){const c=a[0].match(/^(.*?)\s*\(([^)]+)\)\s*$/),d=a[2].toLowerCase();if(c&&/female|male|f|m/i.test(d)){r.name=c[1].trim(),r.id=c[2].trim(),r.sex=/female/i.test(d)?"F":/male/i.test(d)?"M":"F";const u=a[3],m=/([^,]+(?:\([^)]*\))?)/g,p=[];let g;for(;(g=m.exec(u))!==null;){const f=g[1].trim();f&&p.push(f)}for(let f of p){const y=f.match(/^(.+?)\s*\(([^)]+)\)\s*$/);let j=f,w=null;y&&(j=y[1].trim(),w=y[2].trim().toLowerCase()),w?/regular/i.test(w)?r.morphs.push(j):/heterozygous66|heterozygous 66|66%|\b66\b/i.test(w)?r.hets.push(`66% ${j}`):/heterozygous50|heterozygous 50|50%|\b50\b/i.test(w)?r.hets.push(`50% ${j}`):/heterozygous|het/i.test(w)?r.hets.push(`${j}`):/\bpos(?:s?i?a?ble)?\b/i.test(w)?r.hets.push(`${j} (possible)`):r.hets.push(`${j} (${w})`):r.morphs.push(j)}r.name&&n.push(r);continue}}for(const c of a){const d=c.toLowerCase();if(d.startsWith("name:")&&(r.name=c.split(":").slice(1).join(":").trim()),d.startsWith("sex:")&&(/female/i.test(c)?r.sex="F":/male/i.test(c)&&(r.sex="M")),d.startsWith("morphs:")||d.startsWith("morph:")||d.includes("morph")){const u=c.split(":"),m=u.length>1?u.slice(1).join(":"):c.replace(/morphs?:/i,"").trim();r.morphs=l(m)}if(d.startsWith("hets:")||d.startsWith("het:")||d.includes("het")){const u=c.split(":"),m=u.length>1?u.slice(1).join(":"):c.replace(/hets?:/i,"").trim();r.hets=l(m)}}if(!r.name&&a.length){const c=a[0],d=c.match(/^(.+?)\s*\((male|female|m|f)\)/i);if(d)r.name=d[1].trim(),r.sex=/male/i.test(d[2])?"M":"F";else{const u=c.split(/[-–—|\t]/).map(m=>m.trim()).filter(Boolean);u.length>=2&&/^(male|female|m|f)$/i.test(u[1])?(r.name=u[0],r.sex=/male/i.test(u[1])?"M":"F",u.length>2&&(r.morphs=l(u.slice(2).join(", ")))):r.name=c}}if((!r.sex||r.sex==="")&&a.some(c=>/male|female|\bM\b|\bF\b/i.test(c)))for(const c of a){if(/female/i.test(c)){r.sex="F";break}if(/male/i.test(c)){r.sex="M";break}}if((!r.morphs||!r.morphs.length)&&a.length>1){for(const c of a.slice(1))if(/morphs?:|visuals?:/i.test(c)||/,/.test(c)||/\//.test(c)){const d=c.split(/:|–|-|—/).map(p=>p.trim()).filter(Boolean),u=d.length>1?d.slice(1).join(":"):d[0],m=l(u);if(m.length){r.morphs=m;break}}}if((!r.hets||!r.hets.length)&&a.length>1){for(const c of a.slice(1))if(/hets?:/i.test(c)||/het\b/i.test(c)){const d=c.split(/:|–|-|—/).map(p=>p.trim()).filter(Boolean),u=d.length>1?d.slice(1).join(":"):d[0],m=l(u);if(m.length){r.hets=m;break}}}r.name=(r.name||"").trim(),r.morphs=Array.isArray(r.morphs)?r.morphs.map(c=>c.trim()).filter(Boolean):r.morphs?[String(r.morphs).trim()]:[],r.hets=Array.isArray(r.hets)?r.hets.map(c=>c.trim()).filter(Boolean):r.hets?[String(r.hets).trim()]:[],r.name&&n.push(r)}return n}function Oc(e){if(!e)return[];const s=e.split(/\n\s*\n/).map(o=>o.trim()).filter(Boolean),n=[];for(const o of s){let a=o.split(/\n/).map(y=>y.trim()).filter(Boolean);if(a=a.filter(y=>!/^ball python\s*\(python regius\)$/i.test(y)),a.length<3)continue;const r=a[0].match(/^(.*?)\s*\(([^)]+)\)\s*$/);if(!r)continue;const l=r[1].trim(),c=r[2].trim(),d=a[1]?a[1].toLowerCase():"",u=/female/i.test(d)?"F":/male/i.test(d)?"M":"F",p=(a[2]||"").split(",").map(y=>y.trim()).filter(Boolean),g=[],f=[];for(const y of p){const j=y.match(/^(.+?)\s*\(([^)]+)\)\s*$/);let w=y,D=null;j&&(w=j[1].trim(),D=j[2].trim().toLowerCase()),D?/regular/i.test(D)?g.push(w):/heterozygous66|heterozygous 66|66%|\b66\b/i.test(D)?f.push(`66% ${w}`):/heterozygous50|heterozygous 50|50%|\b50\b/i.test(D)?f.push(`50% ${w}`):/heterozygous|het/i.test(D)?f.push(`${w}`):/\bpos(?:s?i?a?ble)?\b/i.test(D)?f.push(`${w} (possible)`):f.push(`${w} (${D})`):g.push(w)}n.push({name:l,id:c,sex:u,morphs:g,hets:f})}return n}function Uc(e,s=null){const n=Nt(e.sex,"F"),o=[...Array.isArray(e.morphs)?e.morphs:e.morphs?[String(e.morphs)]:[],...Array.isArray(e.hets)?e.hets:e.hets?[String(e.hets)]:[],...Array.isArray(e.genetics)?e.genetics:e.genetics?[String(e.genetics)]:[]],a=Kn(o),r=Is(e.birthDate||e.hatchDate||e.birthdate||null),l=r?It(r):null,c=(e.id||"").toString().trim(),d=Array.isArray(e.__existingRecords)?e.__existingRecords:null,u=Array.isArray(e.__existingIds)?e.__existingIds:[],m=d&&d.length?d.map(A=>{if(!A)return null;if(typeof A=="string"){const pe=A;return{id:pe,idSequence:gt(pe,s)}}const G=A.id!=null?String(A.id):"";if(!G)return null;const le=Number(A.idSequence),ee=Number.isFinite(le)&&le>0?Math.floor(le):gt(G,s);return{id:G,idSequence:ee}}).filter(Boolean):u.map(A=>String(A)).filter(Boolean).map(A=>({id:A,idSequence:gt(A,s)})),p=new Set(m.map(A=>A.id));let g=Number(e.year);(!Number.isFinite(g)||g<=0)&&(g=new Date().getFullYear());let f=e.name||"",y=!1;if(e.name){const A=String(e.name).trim().match(/^(20\d{2})\b[-\s:/]*(.*)$/);A&&(y=!0,g=Number(A[1])||g,f=(A[2]||"").trim()||f)}Number.isFinite(l)&&(g=l);let j="";if(c){let A=c;if(p.has(A)){let G=2;for(;p.has(`${c}-${G}`);)G+=1;A=`${c}-${G}`}j=A}const w=c||e.name||"",D=String(w).match(/-(\d+)$/),b=D?Number(D[1]):null,I=j||Qt(f||(n==="F"?"NewFemale":"NewMale"),g,m,b,{hadYear:y,originalRawName:String(e.name||""),morphs:a.morphs,hets:a.hets,idConfig:s,sex:n,birthYear:l}),P=gt(I,s),E=Number(e.weight),k=Number.isFinite(E)?E:0,O=(Array.isArray(e.groups)?e.groups:Xn(e.groups)).map(A=>String(A).trim()).filter(Boolean),S=(Array.isArray(e.tags)?e.tags:Xn(e.tags)).map(A=>String(A).trim()).filter(Boolean),z=String(e.status||"Active").trim()||"Active",B=typeof e.notes=="string"?e.notes.trim():"",F=e.imageUrl?String(e.imageUrl):void 0,de=Mt(e.photos),U=F||(de.length?de[de.length-1].url:void 0);return{id:I,name:f&&f.length?f:e.name||(n==="F"?"New Female":"New Male"),sex:n,morphs:a.morphs,hets:a.hets,weight:k,year:g,birthDate:r,tags:S,groups:O,status:z,notes:B,imageUrl:U,photos:de,idSequence:P,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}}}const $n="__SEQ_PLACEHOLDER__";function Qn(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Gc(e,s=1){const n=Number(e);if(!Number.isFinite(n)||n<=0){const a=Number.isFinite(n)?Math.max(1,Math.floor(n)||1):1;return String(a)}const o=String(Math.floor(n));return!s||s<=1?o:o.padStart(s,"0")}function to(e){const s=String(e||"").trim();return/\[SEQ\]/i.test(s)?s:s?/(?:-|_|\.|#|\/|\s)$/.test(s)?`${s}[SEQ]`:`${s}-[SEQ]`:xn.template}function Bc(e=[]){const s=Array.isArray(e)?e:[],n=[];for(const o of s){const a=String(o||"").trim();if(!a)continue;const r=a.match(/(\d+)%\s*(.*)$/i);if(r){const d=r[1],u=(r[2]||"").replace(/[^A-Za-z]/g,"").slice(0,3).toLowerCase();u&&n.push(`${d}%H${u}`);continue}const l=a.match(/^(.+?)\s*\(pos(?:s?i?a?ble)?\)$/i);let c=a;l&&(c=l[1]),c=c.replace(/[^A-Za-z]/g,"").slice(0,3).toLowerCase(),c&&n.push(`H${c}`)}return n.join("")}function zc(e){return String(e||"").replace(/\bhet\b/gi,"").replace(/\bpos(?:s?i?a?ble)?\b|\bprobable\b|\bmaybe\b|\bph\b/gi,"").replace(/\d{1,3}%/g,"").replace(/[()]/g," ").replace(/[^A-Za-z\s]/g," ").replace(/\s+/g," ").trim()}function ma(e){const s=zc(e);if(!s)return"";const n={monarch:"MONA",monsoon:"MONS"},o=s.replace(/[^A-Za-z]/g,"").toLowerCase();if(n[o])return n[o];const a=s.split(/\s+/).map(l=>l.replace(/[^A-Za-z]/g,"")).filter(Boolean);if(!a.length)return"";if(a.length>=2)return a.map(l=>l.charAt(0).toUpperCase()).join("");const r=a[0].toUpperCase();return r.length<=3?r:r.slice(0,3)}function Hc(e=[],s=[]){const n=Array.isArray(e)?e:e?[e]:[],o=Array.isArray(s)?s:s?[s]:[],a=n.map(c=>ma(c)).filter(Boolean),r=o.map(c=>{const d=String(c||"").trim();if(!d)return"";const u=d.match(/(\d{1,3}%)/),m=u?u[1]:"",p=/\bpos(?:s?i?a?ble)?\b/i.test(d)||/\bph\b/i.test(d)||/\bmaybe\b/i.test(d)||/\bprobable\b/i.test(d),g=ma(d);if(!g)return"";const f=[];return m&&f.push(m),p&&!f.includes("pos")&&f.push("pos"),`${f.join("")}h${g}`}).filter(Boolean),l=[...a,...r];return l.length?l.join(""):""}function Vc(e){return e.split(/\s+/).filter(Boolean).map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")}function qc(e=""){const s=String(e??""),n=s.trim(),o=n.replace(/[^A-Za-z]/g,""),a=n.replace(/[^A-Za-z0-9]/g,""),r=a||o||"X",l=r.toUpperCase(),c=r.toLowerCase(),d=n?Vc(n):l,u=n?n.toUpperCase():l,m=n?n.toLowerCase():c,p=n.split(/\s+/).filter(Boolean),g=p.length?p.map(j=>j.charAt(0).toUpperCase()).join(""):l.charAt(0)||"X",f=n.match(/^\s*\(([^)]+)\)/);let y="";if(f){const j=f[1].replace(/[^A-Za-z0-9]/g,"");j&&(y=`(${j.toUpperCase().slice(0,3)})`)}return{rawName:s,lettersOnly:o,sanitizedAlnum:a,prefixCore:r,prefixUpper:l,prefixLower:c,nameTitle:d,nameUpper:u,nameLower:m,initials:g||l.charAt(0)||"X",slugLower:a?a.toLowerCase():c,slugUpper:a?a.toUpperCase():l,parenChunk:y}}function so({name:e,rawName:s,morphs:n,hets:o,year:a,sex:r,birthYear:l}){const c=Number(a)||new Date().getFullYear(),d=Number(l),u=Number.isFinite(d)&&d>0?d:c,m=String(u).slice(-2).padStart(2,"0"),p=qc(e||s),g=Hc(n,o);return{...p,hetSegment:Bc(o),yearFull:c,yearShort:String(c).slice(-2).padStart(2,"0"),birthYearFull:u,birthYearShort:m,sexCode:String(r||"U").trim().charAt(0).toUpperCase()||"U",geneInitials:g}}function no(e,s,n=$n){const o=to(e.template),a={"[YEAR]":String(s.yearFull),"[YR]":s.yearShort,"[YEAROB]":String(s.birthYearFull??s.yearFull),"[YROB]":s.birthYearShort??s.yearShort,"[PREFIX]":s.prefixCore,"[PREFIXU]":s.prefixUpper,"[PREFIXL]":s.prefixLower,"[NAME]":s.nameTitle,"[NAMEU]":s.nameUpper,"[NAMEL]":s.nameLower,"[INITIALS]":s.initials,"[SLUG]":s.slugLower,"[SLUGU]":s.slugUpper,"[PAREN]":s.parenChunk,"[HETS]":s.hetSegment,"[SEX]":s.sexCode,"[TEXT]":e.customText||"","[GEN3]":s.geneInitials||"","[-]":"-"};let r=o;for(const[c,d]of Object.entries(a))r=r.replace(new RegExp(Qn(c),"g"),d);let l;return n===$n?l=$n:Number.isFinite(Number(n))?l=Gc(n,e.sequencePadding):l=String(n||""),r=r.replace(/\[SEQ\]/gi,l),e.uppercase&&(r=r.toUpperCase()),r.trim()}function ro(e){const s=to(e),n=/\[([A-Z0-9-]+)\]/gi;let o=0;const a=[];let r,l=!1;for(;(r=n.exec(s))!==null;){const d=s.slice(o,r.index);d&&a.push(Qn(d));const u=(r[1]||"").toUpperCase();u==="SEQ"?l?a.push("(?:\\d+)"):(a.push("(\\d+)"),l=!0):u==="-"?a.push("(?:-)"):a.push("(?:.*?)"),o=r.index+r[0].length}const c=s.slice(o);return c&&a.push(Qn(c)),new RegExp(`^${a.join("")}$`,"i")}function gt(e,s=null){if(!e)return null;const n=Ms(s);if(!(n!=null&&n.template))return null;const o=ro(n.template),a=String(e).match(o);if(!a||a.length<2)return null;const r=Number(a[1]);return!Number.isFinite(r)||r<=0?null:r}function Qt(e,s,n=[],o=null,a={}){const{hadYear:r=!1,originalRawName:l="",morphs:c=[],hets:d=[],idConfig:u=null,sex:m="U",birthYear:p=null,forceSequence:g=null}=a||{},f=Ms(u),y=Array.isArray(n)?n.map(B=>{if(!B)return null;if(typeof B=="string"){const de=B;return{id:de,idSequence:gt(de,f)}}if(typeof B=="object"){if(B.id||B.id===""){const U=B.id,A=typeof U=="string"?U:U!=null?String(U):"";if(!A)return null;const G=Number(B.idSequence),le=Number.isFinite(G)&&G>0?Math.floor(G):gt(A,f);return{id:A,idSequence:le}}const de=String(B);return de?{id:de,idSequence:gt(de,f)}:null}const F=String(B);return F?{id:F,idSequence:gt(F,f)}:null}).filter(B=>B&&B.id):[],j=y.map(B=>B.id).filter(Boolean),w=j.map(B=>B.toLowerCase()),D=new Set(w),b=D.size,I=new Set;y.forEach(B=>{const F=Number(B.idSequence);Number.isFinite(F)&&F>0&&I.add(Math.floor(F))});const P=Number(s)||new Date().getFullYear(),E=e&&String(e).trim()||l&&String(l).trim()||(m==="M"?"New Male":"New Female"),k=so({name:E,rawName:r?l:e,morphs:c,hets:d,year:P,sex:m,birthYear:p??P}),R=B=>no(f,k,B),O=ro(f.template);for(const B of j){if(!B||typeof B!="string")continue;const F=B.match(O);if(!F)continue;const de=Number(F[1]);Number.isFinite(de)&&de>0&&I.add(Math.floor(de))}const K=Number(g);if(Number.isFinite(K)&&K>0){const B=Math.floor(K),F=R(B);if(!D.has(F.toLowerCase()))return F}let S=Math.max(1,b+1);for(;I.has(S);)S+=1;let z=R(S);for(;D.has(z.toLowerCase());){for(S+=1;I.has(S);)S+=1;z=R(S)}return z}function Kn(e){const s=Array.isArray(e)?e.slice():e?String(e).split(GENE_TOKEN_SPLIT_REGEX).map(l=>l.trim()).filter(Boolean):[],n=[],o=[];for(let l of s){if(!l)continue;const c=String(l).trim(),d=c.toLowerCase();if(/\([^)]*\bregular\b[^)]*\)/i.test(c)){const m=c.replace(/\([^)]*\bregular\b[^)]*\)/i,"").replace(/[()]/g,"").trim();n.push(Zt(m));continue}const u=c.match(/(\d+)%/);if(u){const m=u[1];let p=c.replace(/(\d+)%/,"").replace(/\bheterozygous\b/ig,"").replace(/\bhet\b/ig,"").replace(/[()]/g,"").trim();p=Zt(p)||p,o.push(`${m}% ${p}`);continue}if(/\bpos(?:s?i?a?ble)?\b/i.test(d)){const m=c.replace(/\bpos(?:s?i?a?ble)?\b/ig,"").replace(/[()]/g,"").trim();o.push(`${Zt(m)} (possible)`);continue}if(/\bheterozygous\b|\bhet\b/i.test(d)){const m=c.replace(/\bheterozygous\b/ig,"").replace(/\bhet\b/ig,"").replace(/[()]/g,"").trim();o.push(Zt(m));continue}n.push(Zt(c))}const a=Wn(n.map(l=>String(l).trim()).filter(Boolean)),r=Wn(o.map(l=>mn(l)).filter(Boolean));return{morphs:a,hets:r}}function on(e){const s=e.name||"",n=e.id||"",o=e.sex==="M"?"Male":e.sex==="F"?"Female":"Unknown",a=At(e.morphs,e.hets,e.possibleHets),r=a.length?a.join(", "):"-";return`Name - ${s}
ID - ${n}
Gender - ${o}
Genetics - ${r}`}function Yc(e){if(!e||typeof e!="string")return null;const s=e.trim(),n=s.match(/^\s*(.*?)\s*\(([^)]+)\)\s*/);if(!n)return null;const o=n[1].trim(),a=n[2].trim();let r=s.slice(n[0].length).trim();r=r.replace(/Ball Python\s*\(Python regius\)/i,"").trim();const l=r.match(/^(Female|Male|Unknown)\b/i),c=l?l[1][0].toUpperCase()+l[1].slice(1).toLowerCase():"Unknown";let d=l?r.slice(l[0].length).trim():r;if(d=d.replace(/^[-\s:]+/,"").trim(),!d)return{name:o,id:a,gender:c,genetics:[]};const m=d.split(",").map(p=>p.trim()).filter(Boolean).map(p=>{const g=p.match(/^(.+?)\s*\(([^)]+)\)\s*$/),f=g?g[1].trim():p,y=g?g[2].trim().toLowerCase():null;return!y||/^regular$/i.test(y)?f:/heterozygous66|heterozygous 66|66%|^66$/i.test(y)?`66% ${f}`:/heterozygous50|heterozygous 50|50%|^50$/i.test(y)?`50% ${f}`:/heterozygous|^het$/i.test(y)?`${f}`:/\bpos(?:s?i?a?ble)?\b/i.test(y)?`Possible het ${f}`:`het ${f}`});return{name:o,id:a,gender:c,genetics:m}}function Wc(e){const s=(e||"").trim(),n=s.match(/^(.+?)\s*\(([^)]+)\)\s*$/),o=n?n[1].trim():s,a=n?n[2].trim().toLowerCase():null;return!a||/^regular$/i.test(a)?o:/heterozygous66|66%|^66$/i.test(a)?`66% het ${o}`:/heterozygous50|50%|^50$/i.test(a)?`50% het ${o}`:/heterozygous|^het$/i.test(a)?`het ${o}`:/\bpos(?:s?i?a?ble)?\b/i.test(a)?`Possible het ${o}`:`het ${o}`}function Qc(e){if(!e)return[];const s=e.split(/\r?\n/).map(o=>o.trim()).filter(Boolean),n=[];for(const o of s){if(!/\|/.test(o))continue;const a=o.split("|").map(m=>m.trim()).filter(Boolean);if(a.length<2)continue;const r=a[0],l=a[1].match(/female/i)?"F":a[1].match(/male/i)?"M":"Unknown",c=a.slice(2).join(", "),u=(c?c.split(",").map(m=>m.trim()).filter(Boolean):[]).map(Wc);n.push({name:r,sex:l,morphs:u.filter(m=>!/^het\b|^66%|^50%|^possible/i.test(m)),hets:u.filter(m=>/^het\b|^66%|^50%|^Possible/i.test(m))})}return n}function Kc(e){const s=[];let n=0;const o=e.length;let a="",r=[],l=!1;for(;n<o;){const c=e[n];if(l){if(c==='"'){if(n+1<o&&e[n+1]==='"'){a+='"',n+=2;continue}l=!1,n++;continue}a+=c,n++;continue}if(c==='"'){l=!0,n++;continue}if(c===","){r.push(a),a="",n++;continue}if(c==="\r"){n++;continue}if(c===`
`){r.push(a),s.push(r),r=[],a="",n++;continue}a+=c,n++}return(a!==""||r.length)&&(r.push(a),s.push(r)),s}function Xc(e){return String(e||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim()}function Jc(e){const s=Xc(e);return s?/^name$|^animal name$|^snake name$/.test(s)?"name":/^id$|^animal id$|^snake id$|^identifier$/.test(s)?"id":/(^|\s)(sex|gender)(\s|$)/.test(s)?"sex":/(^|\s)(morph|visual|combo)(s)?(\s|$)/.test(s)?"morphs":/(^|\s)(het|hetero)(s)?(\s|$)/.test(s)?"hets":/(^|\s)(genetic|gene|traits?)(s)?(\s|$)/.test(s)?"genetics":/(^|\s)(group|collection|category|rack)(s)?(\s|$)/.test(s)?"groups":/(^|\s)(tag|keyword)(s)?(\s|$)/.test(s)?"tags":/(^|\s)(birth|hatch|dob)(\s|$)/.test(s)?"birthDate":/^year$|^birth year$|^hatch year$/.test(s)?"year":/(^|\s)weight(\s|$)|(^|\s)grams?(\s|$)/.test(s)?"weight":/(^|\s)status(\s|$)/.test(s)?"status":/(^|\s)notes?(\s|$)|(^|\s)comments?(\s|$)/.test(s)?"notes":null:null}function Xn(e){return e==null?[]:String(e).split(/[;|,/\n]/).map(s=>s.trim()).filter(Boolean)}function es(e){if(!e&&e!==0)return[];const s=Array.isArray(e)?e:[e];for(const n of s){if(n===null||typeof n>"u")continue;const o=String(n).trim();if(o)return[o]}return[]}function Is(e){if(!e)return null;const s=String(e).trim();if(!s)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(s))return s;const n=new Date(s);return isNaN(n.getTime())?null:rt(n)}function Zc(e=[]){const s={};return e.forEach((n,o)=>{const a=Jc(n);a&&(s[a]||(s[a]=[]),s[a].push(o))}),{index:s,hasHeader:Object.keys(s).length>0}}function ha(e=[],s={},n){const o=s[n];return!o||!o.length?[]:o.map(a=>(e[a]||"").toString()).filter(Boolean)}function ed({newAnimal:e,setNewAnimal:s,groups:n,setGroups:o,statusOptions:a=[],customStatusTags:r=[],onCreateStatusTag:l,onDeleteStatusTag:c,onCancel:d,onAdd:u,theme:m="blue"}){const p=!!(e.name&&e.name.trim().length),g=(Array.isArray(e.groups)&&e.groups.length?e.groups[0]:"")||"",[f,y]=h.useState(""),j=h.useMemo(()=>new Set(r.map(S=>S.toLowerCase())),[r]),[w,D]=h.useState(!1),b=h.useRef(null);h.useEffect(()=>{if(!w)return;const S=z=>{b.current&&(b.current.contains(z.target)||D(!1))};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[w]),h.useEffect(()=>{D(!1)},[a]),h.useEffect(()=>{if(!w)return;const S=z=>{b.current&&(b.current.contains(z.target)||D(!1))};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[w]);const I=h.useCallback(()=>{const S=(f||"").trim();if(!S)return;const z=typeof l=="function"?l(S):S;z&&(s(B=>({...B,status:z})),y(""))},[f,l,s]),P=h.useCallback(S=>{s(z=>({...z,status:S})),D(!1)},[s]),E=h.useCallback(()=>{s(S=>({...S,status:""})),D(!1)},[s]),k=h.useCallback(S=>{typeof c=="function"&&c(S),D(!1),s(z=>z&&((z.status||"").trim().toLowerCase()===S.toLowerCase()?{...z,status:""}:z))},[c,s]),R=h.useCallback(S=>{const z=S.target.value;s(B=>({...B||{},name:z}))},[s]),O=h.useCallback(S=>{const z=S.target.value;s(B=>({...B||{},id:z,autoId:!1}))},[s]),K=h.useCallback(S=>{const z=S.target.value;s(B=>({...B||{},sex:z}))},[s]);return t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm max-h-[68vh] overflow-auto",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e&&e.name||"",onChange:R,placeholder:"e.g., Athena"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"ID"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm font-mono",value:e&&e.id||"",onChange:O,placeholder:"Optional: custom ID (e.g., 25Ath-2)"}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"If you leave this blank an ID will be generated. If the ID you enter already exists a suffix will be appended to make it unique."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-2 py-1 bg-white text-sm",value:e&&e.sex||"F",onChange:K,children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"})]})]}),t.jsxs("div",{ref:b,className:"relative",children:[t.jsx("label",{className:"text-xs font-medium",children:"Tag"}),t.jsxs("button",{type:"button",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm bg-white text-left flex items-center justify-between",onClick:()=>D(S=>!S),children:[t.jsx("span",{children:(e.status||"").trim()||"No tag"}),t.jsx("span",{className:"text-[10px] text-neutral-500",children:"v"})]}),w&&t.jsxs("div",{className:"absolute z-40 mt-1 w-full rounded-xl border border-neutral-200 bg-white shadow-lg",children:[t.jsx("button",{type:"button",className:"w-full px-3 py-2 text-left text-sm hover:bg-neutral-100",onClick:E,children:"No tag"}),t.jsx("div",{className:"border-t border-neutral-100"}),a.length?a.map(S=>t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-sm hover:bg-neutral-50",children:[t.jsx("button",{type:"button",className:"flex-1 text-left",onClick:()=>P(S),children:S}),t.jsx("button",{type:"button",className:"ml-3 text-sm font-semibold text-rose-500 hover:text-rose-600",onClick:()=>k(S),title:"Delete tag",children:"-"})]},S)):t.jsx("div",{className:"px-3 py-2 text-sm text-neutral-400",children:"No tags available yet."})]}),t.jsxs("div",{className:"mt-2 grid w-full grid-cols-[minmax(0,1fr)_auto] gap-2",children:[t.jsx("input",{className:"w-full border rounded-lg px-2 py-1 text-sm",value:f,onChange:S=>y(S.target.value),onKeyDown:S=>{S.key==="Enter"&&(S.preventDefault(),I())},placeholder:"Create new tag"}),t.jsx("button",{type:"button",className:te("px-2.5 py-1 rounded-lg text-sm border transition-colors whitespace-nowrap",f.trim()?Fe(m,!0):"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:I,disabled:!f.trim(),children:"Add tag"})]}),Array.isArray(a)&&a.length>0&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.map(S=>{const z=j.has(S.toLowerCase());return t.jsxs("span",{className:te("inline-flex items-center gap-1 rounded-full px-2 py-1 text-[11px]",z?"border border-neutral-200 bg-neutral-50 text-neutral-600":"border border-neutral-100 bg-white text-neutral-500"),children:[t.jsx("span",{children:S}),typeof c=="function"&&t.jsx("button",{type:"button",className:"h-4 w-4 rounded-full border border-neutral-300 text-[10px] leading-[10px] text-neutral-500 hover:border-rose-400 hover:text-rose-500",title:"Delete tag",onClick:()=>c(S),children:"×"})]},S)})}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"Tags let you group animals for availability. Removing a tag clears it from any animals using it."})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Genetics (morphs & hets)"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-2 py-2 text-sm",value:e.morphHetInput||"",onChange:S=>{const z=S.target.value,{morphs:B,hets:F}=Ss(z);s(de=>({...de,morphHetInput:z,morphs:B,hets:F}))},placeholder:`Clown
Pastel
Het Hypo`}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"List each trait on its own line (commas, slashes, or percentages are still supported when pasting)."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Weight (g)"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e.weight,onChange:S=>s(z=>({...z,weight:S.target.value})),placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Year"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e.year,onChange:S=>s(z=>({...z,year:S.target.value})),placeholder:"2025"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e.birthDate||"",onChange:S=>{const z=S.target.value;s(B=>{const F=z?Is(z)||z:"",de=It(F||z),U={...B,birthDate:F};return de?U.year=String(de):F||(U.birthDate=""),U})}})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Group"}),n.length?t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-2 py-2 text-sm bg-white",value:g,onChange:S=>{const z=S.target.value.trim();s(B=>({...B,groups:z?[z]:[]}))},children:[t.jsx("option",{value:"",children:"No group"}),n.map(S=>t.jsx("option",{value:S,children:S},S))]}):t.jsx("div",{className:"mt-1 text-xs text-neutral-500",children:"No groups yet. Add one below."}),t.jsx("div",{className:"mt-3 border border-dashed border-neutral-200 rounded-xl p-3 bg-white",children:t.jsx(lo,{onAdd:S=>{S&&(o(z=>z.includes(S)?z:[...z,S]),s(z=>({...z,groups:[S]})))}})})]})]}),t.jsxs("div",{className:"p-4 border-t flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Data is local only in this demo."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:d,children:"Cancel"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm text-white",p?Fe(m,!0):Fe(m,!1)),disabled:!p,onClick:u,children:"Add animal"})]})]})]})}function td(){var Ar,Dr;const[e,s]=h.useState(ca),[n,o]=h.useState(Ic),[a,r]=h.useState("animals"),[l,c]=h.useState("active"),[d,u]=h.useState("All"),[m,p]=h.useState("all"),[g,f]=h.useState(""),y="all",[j,w]=h.useState("all"),[D,b]=h.useState([]),[I,P]=h.useState([]),[E,k]=h.useState([]),[R,O]=h.useState([]),[K,S]=h.useState([]),[z,B]=h.useState(()=>[...Ec]),[F,de]=h.useState("blue"),[U,A]=h.useState(()=>{const i=Ps(Lt.breeder,null);return us(i)}),[G,le]=h.useState(()=>ls(Ps(Lt.backupSettings,null))),[ee,pe]=h.useState(()=>wc(Ps(Lt.backupSnapshot,null))),[Q,se]=h.useState(()=>Ac(Ps(Lt.backupVault,[]))),[xe,oe]=h.useState(()=>[...Ds]),[Ae,Oe]=h.useState(()=>[...Es]),[Ge,W]=h.useState(null),[ce,$]=h.useState(!1),[_,ue]=h.useState(Fn),[me,Ce]=h.useState(""),[Ne,Ee]=h.useState([]),[$e,Pe]=h.useState(!1),[ae,H]=h.useState(!1),[J,ge]=h.useState(!0),[Se,Be]=h.useState(null),[He,Qe]=h.useState(!1),[ve,pt]=h.useState(null),[fe,De]=h.useState(null),[M,re]=h.useState(null),[X,we]=h.useState(null),[Ie,ie]=h.useState(!1),[Ke,Re]=h.useState(!1),[Ve,Ue]=h.useState(null),[Xe,ct]=h.useState(null),[mt,ut]=h.useState(null),We=h.useRef(null),qe=h.useRef(null),[at,_e]=h.useState(!1),[ot,Ft]=h.useState(""),[jt,Ct]=h.useState(!1),ke=h.useRef(null);h.useEffect(()=>{if(!jt)return;const i=x=>{ke.current&&(ke.current.contains(x.target)||Ct(!1))};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[jt]),h.useEffect(()=>{a!=="pairings"&&He&&Qe(!1)},[a,He]);const yt=h.useCallback(i=>{const x=(i||"").trim();if(!x)return"";const v=la.some(N=>N.toLowerCase()===x.toLowerCase());return O(N=>{const L=N.some(V=>V.toLowerCase()===x.toLowerCase());return v?L?N.filter(V=>V.toLowerCase()!==x.toLowerCase()):N:L?N:[...N,x]}),S(N=>N.filter(L=>L.toLowerCase()!==x.toLowerCase())),x},[O,S]),Ye=h.useCallback(i=>{const x=(i||"").trim();if(!x)return;const v=x.toLowerCase();O(N=>N.filter(L=>L.toLowerCase()!==v)),S(N=>N.some(L=>L.toLowerCase()===v)?N:[...N,x]),k(N=>N.filter(L=>L.toLowerCase()!==v)),s(N=>N.map(L=>{const V=typeof(L==null?void 0:L.status)=="string"?L.status.trim():"";return!V||V.toLowerCase()!==v?L:{...L,status:""}})),ue(N=>{if(!N)return N;const L=(N.status||"").trim();return!L||L.toLowerCase()!==v?N:{...N,status:""}}),De(N=>{if(!N)return N;const L=(N.status||"").trim();return!L||L.toLowerCase()!==v?N:{...N,status:""}})},[O,S,k,s,ue,De]),Ht=h.useCallback(i=>{const x=(i||"").trim();x&&k(v=>{const N=new Set(v);return N.has(x)?N.delete(x):N.add(x),Array.from(N)})},[]),C=h.useCallback(()=>{k([])},[]),[T,q]=h.useState(()=>{const i={feed:"Mouse",size:"pinky",sizeDetail:"",form:"Frozen/thawed",formDetail:"",notes:"",refused:!1},x=Ps(Lt.lastFeedDefaults,i)||i;return{...i,...x}});h.useEffect(()=>{Rs(Lt.lastFeedDefaults,T)},[T]),h.useEffect(()=>{Rs(Lt.breeder,us(U))},[U]),h.useEffect(()=>{if(typeof document>"u")return;const i=typeof(U==null?void 0:U.logoUrl)=="string"?U.logoUrl.trim():"",x=i||mc;let N=document.querySelector("link[rel='icon']")||document.querySelector("link[rel='shortcut icon']");if(N||(N=document.createElement("link"),N.setAttribute("rel","icon"),document.head.appendChild(N)),N.getAttribute("href")!==x&&N.setAttribute("href",x),i){const L=i.match(/^data:(image\/[^;]+);/i);L&&L[1]?N.setAttribute("type",L[1]):N.removeAttribute("type"),N.removeAttribute("sizes")}else N.setAttribute("type","image/png"),N.setAttribute("sizes","512x512")},[U==null?void 0:U.logoUrl]),h.useEffect(()=>{Rs(Lt.backupSettings,G)},[G]),h.useEffect(()=>{if(!ee){if(typeof window<"u")try{window.localStorage.removeItem(Lt.backupSnapshot)}catch(i){console.warn("Failed to clear backup snapshot",i)}return}Rs(Lt.backupSnapshot,ee)},[ee]),h.useEffect(()=>{Rs(Lt.backupVault,Q)},[Q]),h.useEffect(()=>{const i=ls(G).maxVaultEntries;typeof i!="number"||i<=0||se(x=>Array.isArray(x)?x.length<=i?x:x.slice(0,i):[])},[G,se]);const ye=h.useCallback(i=>{le(x=>ls({...x||{},...i||{}}))},[]),Le=h.useCallback(()=>({version:1,generatedAt:new Date().toISOString(),snakes:e,pairings:n,groups:z,breederInfo:us(U),theme:F,lastFeedDefaults:T}),[e,n,z,U,F,T]),Ze=h.useCallback((i,x={})=>{if(!i||typeof i!="object")return null;const v=x.source==="auto"?"auto":"manual",N=typeof x.savedAt=="string"&&x.savedAt?x.savedAt:new Date().toISOString(),L=typeof x.name=="string"&&x.name.trim()?x.name.trim():`${v==="auto"?"Auto":"Manual"} backup • ${xt(N)}`,V=Wa({id:typeof x.id=="string"&&x.id.trim()?x.id.trim():Ls(v==="auto"?"auto-backup":"manual-backup"),name:L,createdAt:N,updatedAt:N,source:v,payload:i});if(!V)return null;const{maxVaultEntries:ne}=ls(G);return se(Y=>{const Z=(Array.isArray(Y)?Y:[]).filter(Te=>Te.id!==V.id),be=[V,...Z];return be.sort((Te,Je)=>new Date(Je.createdAt||0).getTime()-new Date(Te.createdAt||0).getTime()),typeof ne=="number"&&ne>0?be.slice(0,ne):be}),V},[se,G]),st=h.useCallback((i,x)=>{const v=typeof x=="string"?x.trim():"";if(!v)return;const N=new Date().toISOString();se(L=>(Array.isArray(L)?L:[]).map(ne=>ne.id===i?{...ne,name:v,updatedAt:N}:ne))},[se]),lt=h.useCallback(i=>{se(x=>Array.isArray(x)?x.filter(v=>v.id!==i):[])},[se]),bt=h.useCallback(()=>{let i;try{i=Le()}catch(N){console.error("Failed to build backup payload",N);return}let x;try{x=JSON.parse(JSON.stringify(i))}catch(N){console.error("Failed to serialize auto backup payload",N);return}const v=new Date().toISOString();pe({savedAt:v,payload:x}),le(N=>ls({...N||{},lastRun:v})),Ze(x,{source:"auto",savedAt:v,name:`Auto backup • ${xt(v)}`})},[Le,Ze,le]);h.useEffect(()=>{if(typeof window>"u")return;const i=Nc(G.frequency);if(!i)return;let x=!1;const v=()=>{if(x)return;const L=G.lastRun?new Date(G.lastRun).getTime():0;(!L||Number.isNaN(L)||Date.now()-L>=i)&&bt()};v();const N=window.setInterval(v,5*60*1e3);return()=>{x=!0,window.clearInterval(N)}},[G.frequency,G.lastRun,bt]);const ft=h.useCallback(i=>{if(!i||typeof i!="object")throw new Error("Backup file is empty or invalid.");const v=(Array.isArray(i.snakes)?i.snakes:[]).map(Sc).filter(Boolean),L=(Array.isArray(i.pairings)?i.pairings:[]).map(kc).filter(Boolean),V=Array.isArray(i.groups)?i.groups.map(be=>String(be||"").trim()).filter(Boolean):[],ne=us(i.breederInfo||i.breeder),Y=["blue","green","dark"],he=typeof i.theme=="string"&&Y.includes(i.theme)?i.theme:null,Z=i.lastFeedDefaults&&typeof i.lastFeedDefaults=="object"?{...i.lastFeedDefaults}:null;s(v),o(L),B(V),A(ne),he&&de(he),Z&&q(Z),pe(null),le(be=>ls({...be||{},lastRun:null}))},[s,o,B,A,de,q,pe,le]);h.useEffect(()=>{try{const i=window.localStorage.getItem(ta);i&&(i==="all"||i==="males"||i==="females"||i==="groups")&&p(i)}catch(i){console.warn("Failed to restore pending animal view",i)}},[]),h.useEffect(()=>{try{window.localStorage.setItem(ta,m)}catch(i){console.warn("Failed to persist animal view",i)}},[m]),h.useEffect(()=>{l!=="completed"&&d!=="All"&&u("All")},[l,d]),h.useEffect(()=>{ce&&ue(i=>{if(!i||i.autoId===!1&&String(i.id||"").trim().length>0)return i;const v=Nt(i.sex,"F"),N=Ss(i.morphHetInput||""),L=Array.isArray(i.morphs)&&i.morphs.length?i.morphs:N.morphs,V=Array.isArray(i.hets)&&i.hets.length?i.hets:N.hets,ne=It(i.birthDate),Y=Number(i.year),he=Number.isFinite(Y)&&Y>0?Y:new Date().getFullYear(),Z=ne??he,be=Qt(i.name,Z,e,null,{idConfig:U==null?void 0:U.idGenerator,sex:v,morphs:L,hets:V,birthYear:ne}),Te=ne?String(ne):i.year,Je=gt(be,U==null?void 0:U.idGenerator);return(i.id||"")===be&&i.year===Te&&i.autoId===!0&&i.idSequence===Je?i:{...i,id:be,year:Te,autoId:!0,idSequence:Je}})},[ce,e,U,_.name,_.sex,_.morphHetInput,_.morphs,_.hets,_.year,_.birthDate,_.autoId,_.idSequence]);const St=h.useCallback(i=>{!i||i===m||p(i)},[m]),[bn,Gt]=h.useState(!1),[et,Bt]=h.useState({maleId:"",femaleId:"",goals:[],notes:"",startDate:rt(new Date)}),[ns,Vt]=h.useState(null),qs=typeof(fe==null?void 0:fe.status)=="string"?fe.status:"",rs=h.useMemo(()=>{const i=new Set(la);R.forEach(L=>{const V=(L||"").trim();V&&i.add(V)}),e.forEach(L=>{const V=typeof(L==null?void 0:L.status)=="string"?L.status.trim():"";V&&i.add(V)});const x=typeof(_==null?void 0:_.status)=="string"?_.status.trim():"";x&&i.add(x);const v=typeof qs=="string"?qs.trim():"";v&&i.add(v);const N=new Set(K.map(L=>L.toLowerCase()));return Array.from(i).filter(L=>!N.has(L.toLowerCase())).sort((L,V)=>L.localeCompare(V))},[R,K,e,_.status,qs]);h.useMemo(()=>new Set(R.map(i=>i.toLowerCase())),[R]);const ho=(qs||"").trim(),dr=h.useCallback(()=>{const i=(ot||"").trim();if(!i)return;const x=yt(i);x&&(De(v=>v&&{...v,status:x}),Ft(""))},[ot,yt]);h.useEffect(()=>{Ct(!1)},[rs]);const po=h.useCallback(i=>{De(x=>x&&{...x,status:i}),Ct(!1)},[De,Ct]),fo=h.useCallback(()=>{De(i=>i&&{...i,status:""}),Ct(!1)},[De,Ct]),xo=h.useCallback(i=>{Ye(i),Ct(!1)},[Ye]);h.useEffect(()=>{ve||(Ft(""),Ct(!1))},[ve]),h.useEffect(()=>{s(i=>{let x=!1;const v=i.map(N=>{const L=zt(N==null?void 0:N.sex);return!N||L==="UNKNOWN"||N.sex===L?N:(x=!0,{...N,sex:L})});return x?v:i})},[]),h.useEffect(()=>{mt&&(e.some(i=>i.id===mt)||ut(null))},[mt,e]);const ys=h.useCallback(i=>i?(Array.isArray(i.groups)?i.groups:es(i.groups)).some(v=>typeof v!="string"?!1:v.trim().toLowerCase()==="breeders"):!1,[]),ur=h.useMemo(()=>e.filter(Os).filter(ys),[e,ys]),mr=h.useMemo(()=>e.filter(rn).filter(ys),[e,ys]),hr=h.useMemo(()=>{const i=[],x=[];return n.forEach(v=>{Na(v)?x.push(v):i.push(v)}),{active:i,completed:x}},[n]),Ys=hr.active,as=hr.completed,pr=Ys.length,go=as.length,Ts=h.useMemo(()=>as.map(i=>{const x=dt({...i}),v=bs(x),N=gn({clutchDate:(v==null?void 0:v.clutchDate)||"",preLayDate:(v==null?void 0:v.preLayDate)||"",ovulationDate:(v==null?void 0:v.ovulationDate)||"",hatchDate:(v==null?void 0:v.hatchDate)||"",startDate:x.startDate||""}),L=N&&typeof N=="string"&&N.trim()?N:"Unknown";return{pairing:i,year:L}}),[as]),Fs=h.useMemo(()=>{const i=new Set;Ts.forEach(({year:v})=>{i.add(v||"Unknown")});const x=Array.from(i);return x.sort((v,N)=>{const L=Y=>/^\d{4}$/.test(Y)?Number(Y):null,V=L(v),ne=L(N);return V!==null&&ne!==null?ne-V:V!==null?-1:ne!==null?1:v.localeCompare(N)}),x},[Ts]);h.useEffect(()=>{l==="completed"&&d!=="All"&&(Fs.includes(d)||u(Fs[0]||"All"))},[l,d,Fs]);const fr=h.useMemo(()=>l!=="completed"?as:d==="All"?Ts.map(i=>i.pairing):Ts.filter(i=>i.year===d).map(i=>i.pairing),[l,as,Ts,d]),bo=l==="completed"?fr:Ys,yo=fr.length;h.useEffect(()=>{if(ns){if(Ys.some(i=>i.id===ns)){l!=="active"&&c("active");return}as.some(i=>i.id===ns)&&l!=="completed"&&c("completed")}},[ns,Ys,as,l]),h.useEffect(()=>{const i=window.location.hash.match(/#snake=(.+)/);if(i){const x=decodeURIComponent(i[1]),v=e.find(N=>N.id===x);v&&(pt(v),De(nn(v)))}},[e]),h.useEffect(()=>{const i=window.location.hash.match(/#pairing=(.+)/);if(i){const x=decodeURIComponent(i[1]),v=n.find(N=>N.id===x);v&&(r("pairings"),c(Na(v)?"completed":"active"),Vt(v.id))}},[n]),h.useEffect(()=>{if(!M){we(null);return}const i=`${window.location.origin}${window.location.pathname}#snake=${encodeURIComponent(M)}`;Rn.toDataURL(i,{width:300}).then(x=>we(x)).catch(()=>we(null))},[M]);const Ns=h.useCallback(i=>{let x=Array.isArray(i)?i.slice():[];if(x=yd(x,g,y),Array.isArray(E)&&E.length){const L=new Set(E.map(V=>String(V||"").trim()).filter(Boolean));x=x.filter(V=>L.size===0?!0:L.has(String((V==null?void 0:V.status)||"").trim()))}const v=Array.isArray(D)&&D.length>0,N=Array.isArray(I)&&I.length>0;return v||N?x=x.filter(L=>{const V=Array.isArray(L==null?void 0:L.groups)?L.groups:[],ne=v?V.some(he=>D.includes(he)):!0,Y=N?V.some(he=>I.includes(he)):!1;return!(v&&!ne||N&&Y)}):j!=="all"&&(x=x.filter(L=>(L.groups||[]).includes(j))),J||(x=x.filter(L=>Array.isArray(L.groups)&&L.groups.length)),x},[g,y,E,D,I,j,J]),yn=h.useMemo(()=>Ns(e),[Ns,e]),xr=h.useMemo(()=>Ns(e.filter(Os)),[Ns,e]),gr=h.useMemo(()=>Ns(e.filter(rn)),[Ns,e]),Nn=h.useMemo(()=>m==="groups"?[]:m==="all"?yn:m==="females"?xr:m==="males"?gr:yn,[m,yn,xr,gr]),No=m==="groups"?"Groups":m==="females"?"Females":m==="males"?"Males":"All animals";h.useMemo(()=>Object.fromEntries(e.map(i=>[i.id,i])),[e]);const wo=h.useMemo(()=>Object.fromEntries(e.filter(rn).map(i=>[i.id,i])),[e]),vo=h.useMemo(()=>Object.fromEntries(e.filter(Os).map(i=>[i.id,i])),[e]),jo=t.jsxs("div",{className:"flex flex-col items-center gap-2 w-full",children:[t.jsx("span",{className:"text-base font-semibold",children:`${No} (${Nn.length})`}),t.jsx(Zd,{})]}),wn=Jt(e,et.femaleId||""),vn=Jt(e,et.maleId||""),Ws=h.useCallback(i=>ys(i),[ys]),Qs=h.useCallback(i=>{i&&(Bt({maleId:rn(i)?i.id:"",femaleId:Os(i)?i.id:"",goals:[],notes:"",startDate:rt(new Date)}),Gt(!0))},[Bt,Gt]),Co=h.useCallback(i=>{if(i){if(!Ws(i)){Be({snake:i});return}Qs(i)}},[Ws,Qs]),br=h.useCallback(()=>{Be(null)},[]),So=h.useCallback(()=>{if(!(Se!=null&&Se.snake))return;const i=Se.snake.id;s(v=>v.map(N=>!N||N.id!==i?N:{...N,groups:["Breeders"]})),B(v=>v.includes("Breeders")?v:[...v,"Breeders"]);const x={...Se.snake,groups:["Breeders"]};Be(null),Qs(x)},[Se,s,B,Qs]),yr=h.useCallback(async(i,x,v={})=>{if(!i)return{newEntries:[],combined:null,imageUrl:null};const L=(Array.isArray(x)?x:Array.from(x||[])).filter(be=>be&&(typeof be.type!="string"||be.type.startsWith("image/")));if(!L.length)return{newEntries:[],combined:null,imageUrl:null};const V=v.source==="camera"?"camera":"upload",Y=(await Promise.all(L.map(async be=>{try{const Te=await Ja(be);return Ya({id:Ls("photo"),url:Te,name:be.name||"",type:be.type||"",size:be.size,addedAt:new Date().toISOString(),source:V})}catch(Te){return console.error("Failed to read image file",Te),null}}))).filter(Boolean);if(!Y.length)return{newEntries:[],combined:null,imageUrl:null};let he=null,Z=null;return s(be=>be.map(Te=>{var Et;if(!Te||Te.id!==i)return Te;const Je=Mt(Te.photos),Me=Tn([...Je,...Y]),$t=((Et=Y[Y.length-1])==null?void 0:Et.url)||(Me.length?Me[Me.length-1].url:void 0)||Te.imageUrl||(Me.length?Me[Me.length-1].url:void 0);return he=Me,Z=$t,{...Te,photos:Me,imageUrl:$t}})),{newEntries:Y,combined:he,imageUrl:Z}},[s]),ko=h.useCallback((i,x)=>{!i||!x||s(v=>v.map(N=>{if(!N||N.id!==i)return N;const L=Mt(N.photos).filter(ne=>ne.id!==x);let V=N.imageUrl;return L.some(ne=>ne.url===V)||(V=L.length?L[L.length-1].url:void 0),{...N,photos:L,imageUrl:V}}))},[s]),Ao=h.useCallback((i,x)=>{!i||!x||s(v=>v.map(N=>{if(!N||N.id!==i)return N;const L=Mt(N.photos),V=L.find(ne=>ne.id===x);return V?{...N,photos:L,imageUrl:V.url}:N}))},[s]),Nr=h.useCallback(i=>{i&&ut(i)},[]),wr=h.useCallback(()=>{ut(null)},[]),Dt=h.useMemo(()=>mt&&e.find(i=>i.id===mt)||null,[e,mt]),Ks=h.useMemo(()=>Dt?Mt(Dt.photos):[],[Dt]),Do=h.useCallback(i=>!Number.isFinite(i)||i<=0?"":i>=1024*1024?`${(i/(1024*1024)).toFixed(1)} MB`:i>=1024?`${(i/1024).toFixed(1)} KB`:`${i} B`,[]),vr=h.useMemo(()=>Array.isArray(fe==null?void 0:fe.photos)?fe.photos.length:0,[fe==null?void 0:fe.photos]),Xs=h.useCallback(async(i,x)=>{if(!(ve!=null&&ve.id))return;const v=Array.isArray(i)?i.filter(Boolean):Array.from(i||[]).filter(Boolean);if(v.length)try{_e(!0);const N=await yr(ve.id,v,{source:x}),L=Array.isArray(N==null?void 0:N.newEntries)?N.newEntries:[],V=Array.isArray(N==null?void 0:N.combined)?N.combined:null,ne=typeof(N==null?void 0:N.imageUrl)=="string"?N.imageUrl:null;if(!L.length)return;De(Y=>{if(!Y)return Y;const he=Mt(Y.photos),Z=V||Tn([...he,...L]),be=ne||Y.imageUrl||(Z.length?Z[Z.length-1].url:Y.imageUrl);return{...Y,photos:Z,imageUrl:be}}),pt(Y=>{if(!Y)return Y;const he=Mt(Y.photos),Z=V||Tn([...he,...L]),be=ne||Y.imageUrl||(Z.length?Z[Z.length-1].url:Y.imageUrl);return{...Y,photos:Z,imageUrl:be}})}catch(N){console.error("Failed to add photos",N),alert("Could not save those pictures. Please try again with smaller images.")}finally{_e(!1)}},[ve,yr]),Eo=h.useCallback(async i=>{var v;const x=(v=i==null?void 0:i.target)==null?void 0:v.files;x&&x.length&&await Xs(x,"camera"),i!=null&&i.target&&(i.target.value="")},[Xs]),Io=h.useCallback(async i=>{var v;const x=(v=i==null?void 0:i.target)==null?void 0:v.files;x&&x.length&&await Xs(x,"upload"),i!=null&&i.target&&(i.target.value="")},[Xs]),Lo=h.useCallback(()=>{const i=We.current;i&&i.click()},[]),Mo=h.useCallback(()=>{const i=qe.current;i&&i.click()},[]),To=h.useCallback(()=>{ve!=null&&ve.id&&Nr(ve.id)},[ve,Nr]);function Fo(){Bt({maleId:"",femaleId:"",goals:[],notes:"",startDate:rt(new Date)}),c("active"),Gt(!0)}const jr=h.useCallback(i=>{i&&(H(a==="animals"&&m==="groups"),r("animals"),p(Os(i)?"females":"males"),pt(i),De(nn(i)))},[m,a]),Js=h.useCallback(()=>{pt(null),De(null),ae&&(r("animals"),p("groups"),H(!1))},[ae]),Cr=h.useCallback(i=>{i&&Ue(i)},[]),Sr=h.useCallback(i=>{i&&(s(x=>{const v=x.filter(N=>N.id!==i);return v.length?v:ca()}),o(x=>x.filter(v=>v.maleId!==i&&v.femaleId!==i)),ve&&ve.id===i&&Js())},[Js,ve]),$o=h.useCallback(()=>{Ve&&(Sr(Ve.id),Ue(null))},[Sr,Ve]),Po=h.useCallback(()=>{Ue(null)},[]);function Ro(){var wt;const i=Nt(_.sex,"F"),x=Ss(_.morphHetInput||""),v=Array.isArray(_.morphs)?_.morphs.map(nt=>String(nt).trim()).filter(Boolean):x.morphs,N=Array.isArray(_.hets)?_.hets.map(nt=>String(nt).trim()).filter(Boolean):x.hets,L=e.map(nt=>nt.id),V=Is(_.birthDate||null),ne=It(V),Y=Number(_.year),he=Number.isFinite(Y)&&Y>0?Y:new Date().getFullYear(),Z=ne??he;let be=(_.id||"").toString().trim();if(_.autoId===!1&&be.length>0){if(L.includes(be)){let nt=2,kt=`${be}-${nt}`;for(;L.includes(kt);)nt+=1,kt=`${be}-${nt}`;be=kt}}else be=Qt(_.name,Z,e,null,{idConfig:U==null?void 0:U.idGenerator,sex:i,morphs:v,hets:N,birthYear:ne});let Je=Number(_.idSequence);(!Number.isFinite(Je)||Je<=0)&&(Je=gt(be,U==null?void 0:U.idGenerator)||null);const Me=es(_.groups),ht=Mt(_.photos),$t=((wt=_.imageUrl)==null?void 0:wt.trim())||(ht.length?ht[ht.length-1].url:void 0),Et=(_.status||"").trim()||"Active",ze={id:be,name:_.name.trim()||(i==="F"?"New Female":"New Male"),sex:i,morphs:v,hets:N,weight:Number(_.weight)||0,year:Z,birthDate:V||null,tags:[],groups:Me,status:Et,imageUrl:$t,photos:ht,logs:fs(_.logs),idSequence:Number.isFinite(Je)&&Je>0?Je:null,isDemo:!1};s(nt=>[...nt.filter(qt=>!qt.isDemo),ze]),B(nt=>Array.from(new Set([...nt||[],...ze.groups]))),$(!1),ue(Fn())}function _o(){const i=eo(me);Ee(i)}function Oo(){const i=new Set(e.map(Y=>`${(Y.name||"").trim().toLowerCase()}|${Nt(Y.sex,"F")}`)),x=e.map(Y=>Y.id),v=e.map(Y=>({id:Y.id,idSequence:Y.idSequence})),N=new Map((z||[]).map(Y=>[String(Y).trim().toLowerCase(),Y])),L=Y=>{const he=String(Y||"").trim();if(!he)return null;const Z=he.toLowerCase();return N.has(Z)?N.get(Z):(N.set(Z,he),he)},V=[];for(const Y of Ne){const he=Uc({...Y,__existingIds:x,__existingRecords:v},U==null?void 0:U.idGenerator),Z=Nt(he.sex,"F"),Te=`${(he.name||"").trim().toLowerCase()}|${Z}`;if(i.has(Te))continue;i.add(Te),x.push(he.id),v.push({id:he.id,idSequence:he.idSequence});const Je=es((he.groups||[]).map(L).filter(Boolean));V.push({...he,sex:Z,groups:Je,isDemo:!1})}if(!V.length){Ce(""),Ee([]),r("animals"),p("all");return}s(Y=>[...Y.filter(Z=>!Z.isDemo),...V]);const ne=Array.from(new Set(V.flatMap(Y=>Y.groups||[])));ne.length&&B(Y=>Array.from(new Set([...Y||[],...ne]))),Ce(""),Ee([]),r("animals"),p("all"),Pe(!1)}const Uo=(i,x,v,N)=>{const L=String(i||"Unknown Year").trim()||"Unknown Year",V=String(x).trim()||"Male",ne=String(v).trim()||"Female",Y=`${L} ${V} X ${ne}`.replace(/\s+/g," ").trim();if(!N.has(Y))return Y;let he=2,Z=`${Y} (${he})`;for(;N.has(Z);)he+=1,Z=`${Y} (${he})`;return Z};function Go(){const i=et.femaleId||"",x=et.maleId||"";if(!i||!x)return;const v=Jt(e,i),N=Jt(e,x),L=(v==null?void 0:v.name)||"Female",V=(N==null?void 0:N.name)||"Male",ne=`${L} × ${V}`,Y=It(et.startDate)||new Date().getFullYear(),he={femaleId:i,maleId:x,label:ne,startDate:et.startDate,lockObserved:!1,goals:et.goals||[],notes:et.notes||"",appointments:Xa(et.startDate,5)};he.appointments&&he.appointments.length&&(he.startDate=he.appointments[0].date);let Z="";o(be=>{const Te=new Set(be.map(ht=>ht==null?void 0:ht.id).filter(Boolean)),Je=Uo(Y,V,L,Te);Z=Je;const Me={...he,id:Je};return[...be,dt(Me)]}),Gt(!1),r("pairings"),Vt(Z)}const kr=h.useCallback(i=>{if(!i||!i.pairing||!i.count||i.count<=0)return;const x=dt({...i.pairing}),v=i.hatchedDate||rt(new Date),N=ts(v)||new Date,L=Number.isFinite(N.getFullYear())?N.getFullYear():new Date().getFullYear(),V=Jt(e,x==null?void 0:x.maleId),ne=Jt(e,x==null?void 0:x.femaleId),Y=`${(ne==null?void 0:ne.name)||"Dam"} × ${(V==null?void 0:V.name)||"Sire"}`,he=e.map(Me=>({id:Me.id,idSequence:Me.idSequence})),Z=new Set(he.map(Me=>Me.id)),be=he.map(Me=>({...Me})),Te=U!=null&&U.idGenerator?{...U.idGenerator}:null,Je=Array.from({length:i.count},(Me,ht)=>{const Et=`Hatchling ${i.existingCount+ht+1} (${Y})`,ze=Qt(Et,L,be,null,{idConfig:Te,sex:"F",morphs:[],hets:[],birthYear:L});Z.add(ze);const wt=gt(ze,Te);return be.push({id:ze,idSequence:wt}),{id:ze,autoId:!0,name:Et,sex:"F",morph:"",weight:"",birthDate:v,idSequence:wt}});ct({pairingId:x.id,pairing:x,entries:Je,currentIndex:0,hatchedDate:v,total:i.count,existingCount:i.existingCount,previousHatch:i.previousHatch||x.hatch,context:{pairingName:Y,sireName:(V==null?void 0:V.name)||"",damName:(ne==null?void 0:ne.name)||"",groupName:`Hatchlings ${L}`,year:L,idConfig:Te,existingIdsBase:he.map(Me=>Me.id),existingRecordsBase:he}})},[e,U]),ws=h.useCallback((i,x,v)=>{if(!i)return i;const N=Array.isArray(i.entries)?i.entries:[];if(!N[x])return i;const L=i.context||{},V=Array.isArray(L.existingIdsBase)?L.existingIdsBase.map(ze=>String(ze||"").trim()).filter(Boolean):[],ne=new Set(V),Z=(Array.isArray(L.existingRecordsBase)?L.existingRecordsBase:[]).map(ze=>{if(!ze)return null;if(typeof ze=="string"){const qt=ze;return{id:qt,idSequence:gt(qt,L.idConfig)}}const wt=ze.id!=null?String(ze.id):"";if(!wt)return null;const nt=Number(ze.idSequence),kt=Number.isFinite(nt)&&nt>0?Math.floor(nt):gt(wt,L.idConfig);return{id:wt,idSequence:kt}}).filter(Boolean).map(ze=>({...ze}));N.forEach((ze,wt)=>{if(wt===x)return;const nt=String((ze==null?void 0:ze.id)||"").trim();if(nt){ne.add(nt);const kt=Number(ze==null?void 0:ze.idSequence),qt=Number.isFinite(kt)&&kt>0?Math.floor(kt):gt(nt,L.idConfig);Z.push({id:nt,idSequence:qt})}});const be=N[x].name||L.pairingName||`Hatchling ${x+1}`,Te=Nt(v??N[x].sex,"F"),Je=It(N[x].birthDate),Me=Je??L.year??new Date().getFullYear(),ht=Qt(be,Me,Z,null,{idConfig:L.idConfig,sex:Te,morphs:[],hets:[],birthYear:Je??Me});if(!ht)return i;const $t=gt(ht,L.idConfig),Et=N.map((ze,wt)=>wt===x?{...ze,id:ht,autoId:!0,idSequence:$t}:ze);return{...i,entries:Et}},[]),vs=h.useCallback((i,x)=>{ct(v=>{if(!v)return v;const N=Array.isArray(v.entries)?v.entries:[];if(i<0||i>=N.length)return v;const L=N.map((V,ne)=>{if(ne!==i)return V;const Y={...V,...x};return!Object.prototype.hasOwnProperty.call(x,"autoId")&&Object.prototype.hasOwnProperty.call(x,"id")&&(Y.autoId=!1),Y});return{...v,entries:L}})},[]),Bo=h.useCallback((i,x)=>{vs(i,{id:x})},[vs]),zo=h.useCallback((i,x)=>{vs(i,{morph:x})},[vs]),Ho=h.useCallback((i,x)=>{vs(i,{weight:x})},[vs]),Vo=h.useCallback((i,x)=>{ct(v=>{var Y;if(!v)return v;const N=Array.isArray(v.entries)?v.entries:[];if(i<0||i>=N.length)return v;const L=x?Is(x)||x:"",V=N.map((he,Z)=>Z===i?{...he,birthDate:L}:he);let ne={...v,entries:V};return(Y=N[i])!=null&&Y.autoId&&(ne=ws(ne,i,V[i].sex)),ne})},[ws]),qo=h.useCallback((i,x)=>{const v=Nt(x,"F");ct(N=>{var he;if(!N)return N;const L=Array.isArray(N.entries)?N.entries:[];if(i<0||i>=L.length)return N;const V=!!((he=L[i])!=null&&he.autoId),ne=L.map((Z,be)=>be===i?{...Z,sex:v}:Z);let Y={...N,entries:ne};return V&&(Y=ws(Y,i,v)),Y})},[ws]),Yo=h.useCallback(i=>{ct(x=>{var v,N;return ws(x,i,(N=(v=x==null?void 0:x.entries)==null?void 0:v[i])==null?void 0:N.sex)})},[ws]),Wo=h.useCallback(()=>{ct(i=>{if(!i)return i;const x=Array.isArray(i.entries)?i.entries.length:0,v=Math.min(x-1,(i.currentIndex||0)+1);return v===i.currentIndex?i:{...i,currentIndex:v}})},[]),Qo=h.useCallback(()=>{ct(i=>{if(!i)return i;const x=Math.max(0,(i.currentIndex||0)-1);return x===i.currentIndex?i:{...i,currentIndex:x}})},[]),jn=h.useCallback(()=>{ct(null)},[]),Ko=h.useCallback(()=>{ct(i=>{if(!i)return i;const x=Array.isArray(i.entries)?i.entries:[];if(!x.length)return null;const v=i.context||{},N=i.pairing||null,L=i.hatchedDate||rt(new Date),V=v.groupName||null,ne=new Set(e.map(Z=>Z.id)),Y=e.map(Z=>({id:Z.id,idSequence:Z.idSequence})),he=[];return x.forEach((Z,be)=>{const Te=Z.name||v.pairingName||`Hatchling ${be+1}`,Je=Nt(Z.sex,"F");let Me=String(Z.id||"").trim();const ht=Z.birthDate||L,$t=ht?Is(ht)||ht:"",Et=It($t||ht),ze=Et??v.year??new Date().getFullYear();if(Me||(Me=Qt(Te,ze,Y,null,{idConfig:v.idConfig,sex:Je,morphs:[],hets:[],birthYear:Et??ze})),!Me)return;if(ne.has(Me)){let Sn=2,kn=`${Me}-${Sn}`;for(;ne.has(kn);)Sn+=1,kn=`${Me}-${Sn}`;Me=kn}ne.add(Me);const wt=gt(Me,U==null?void 0:U.idGenerator);Y.push({id:Me,idSequence:wt});const nt=$t||ht,kt=ts(nt),qt=kt&&Number.isFinite(kt.getFullYear())?kt.getFullYear():ze,{morphs:tl,hets:sl}=Ss(Z.morph||""),Cn=Number(Z.weight),nl=Number.isFinite(Cn)&&Cn>=0?Cn:0;he.push({id:Me,name:Te,sex:Je,morphs:tl,hets:sl,weight:nl,year:qt,birthDate:nt,pairingId:(N==null?void 0:N.id)||i.pairingId||null,sireId:(N==null?void 0:N.maleId)||null,damId:(N==null?void 0:N.femaleId)||null,tags:["hatchling"],groups:V?es(V):[],status:"Active",imageUrl:void 0,logs:fs(),idSequence:wt,isDemo:!1})}),he.length&&(s(Z=>[...Z.filter(Te=>!Te.isDemo),...he]),V&&B(Z=>Z.includes(V)?Z:[...Z,V]),typeof window<"u"&&typeof window.alert=="function"&&window.alert(`${he.length} hatchlings added${V?` to ${V}`:""}.`)),null})},[e,s,B,U]),Xo=h.useCallback(()=>{De(i=>{var Z;if(!i||String(i.id||"").trim())return i;const v=e.filter(be=>be&&be.id!==(ve==null?void 0:ve.id)).map(be=>({id:be.id,idSequence:be.idSequence})),N=Number(i.year)||(i.birthDate?((Z=ts(i.birthDate))==null?void 0:Z.getFullYear())||new Date().getFullYear():new Date().getFullYear()),L=i.birthDate?It(i.birthDate):null,V=Number(i.idSequence),ne=Number.isFinite(V)&&V>0?Math.floor(V):null,Y=Qt(i.name,N,v,null,{idConfig:U==null?void 0:U.idGenerator,sex:i.sex||"U",morphs:i.morphs||[],hets:i.hets||[],birthYear:L??N,forceSequence:ne});if(!Y)return i;const he=gt(Y,U==null?void 0:U.idGenerator);return{...i,id:Y,idSequence:he??ne??i.idSequence??null,autoId:!0}})},[e,ve,U]),Jo=h.useCallback(()=>{De(i=>{var he;if(!i)return i;const x=e.filter(Z=>Z&&Z.id!==(ve==null?void 0:ve.id)).map(Z=>({id:Z.id,idSequence:Z.idSequence})),v=Number(i.year)||(i.birthDate?((he=ts(i.birthDate))==null?void 0:he.getFullYear())||new Date().getFullYear():new Date().getFullYear()),N=i.birthDate?It(i.birthDate):null,L=Number(i.idSequence),V=Number.isFinite(L)&&L>0?Math.floor(L):null,ne=Qt(i.name,v,x,null,{idConfig:U==null?void 0:U.idGenerator,sex:i.sex||"U",morphs:i.morphs||[],hets:i.hets||[],birthYear:N??v,forceSequence:V});if(!ne)return i;const Y=gt(ne,U==null?void 0:U.idGenerator);return{...i,id:ne,idSequence:Y??V??i.idSequence??null,autoId:!0}})},[e,ve,U]),Zo=h.useCallback((i,x)=>{let v=null;o(N=>N.map(L=>{var Te,Je,Me;if(L.id!==i)return L;const V=dt({...L}),ne=typeof x=="function"?x(V):x,Y=dt({...V,...ne||{}});Y.id=L.id;const he=(Te=V==null?void 0:V.hatch)!=null&&Te.recorded?Number(V.hatch.hatchedCount||0):0,Z=(Je=Y==null?void 0:Y.hatch)!=null&&Je.recorded?Number(Y.hatch.hatchedCount||0):0,be=(Me=Y==null?void 0:Y.hatch)!=null&&Me.recorded?Math.max(0,Z-he):0;return be>0&&(v={pairing:{...V,...Y},count:be,hatchedDate:Y.hatch.date,existingCount:he,previousHatch:{...V.hatch}}),Y})),v&&kr(v)},[o,kr]),el=F==="green"?{"--primary":"#059669","--primary-border":"#059669","--primary-contrast":"#fff"}:F==="dark"?{"--primary":"#374151","--primary-border":"#374151","--primary-contrast":"#fff"}:{"--primary":"#0ea5e9","--primary-border":"#0ea5e9","--primary-contrast":"#fff"};return t.jsxs("div",{className:"app-root w-full min-h-screen bg-neutral-50 text-neutral-900",style:el,children:[t.jsx("div",{className:"px-5 py-4 border-b bg-white sticky top-0 z-10",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[U.logoUrl?t.jsx("img",{src:U.logoUrl,alt:"logo",className:"w-10 h-10 rounded-full object-cover border"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-50 flex items-center justify-center text-xs text-neutral-400 border",children:"Logo"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-semibold tracking-tight",children:"Breeding Planner"}),t.jsx("div",{className:"text-xs text-neutral-600",children:U.businessName?`${U.businessName} • ${U.name}`:""})]})]})}),t.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[t.jsx(vt,{theme:F,active:a==="animals",onClick:()=>r("animals"),children:"Animals"}),t.jsx(vt,{theme:F,active:a==="pairings",onClick:()=>r("pairings"),children:"Breeding Planner"}),t.jsx(vt,{theme:F,active:a==="calendar",onClick:()=>r("calendar"),children:"Calendar"}),t.jsx(vt,{theme:F,active:a==="setup",onClick:()=>r("setup"),children:"Setup"}),t.jsx("div",{className:"ml-2",children:t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-sm bg-white",value:F,onChange:i=>de(i.target.value),children:[t.jsx("option",{value:"blue",children:"Blue"}),t.jsx("option",{value:"green",children:"Green"}),t.jsx("option",{value:"dark",children:"Dark"})]})}),t.jsx("div",{className:"ml-auto flex items-center gap-2",children:t.jsx("input",{value:g,onChange:i=>f(i.target.value),placeholder:"Search name, morph, het, tag",className:"px-3 py-2 border rounded-xl text-sm w-64 focus:outline-none focus:ring-2 focus:ring-black/10"})})]})]})}),t.jsxs("div",{className:"max-w-7xl mx-auto p-5",children:[a==="animals"&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(vt,{theme:F,active:m==="all",onClick:()=>St("all"),children:"All"}),t.jsx(vt,{theme:F,active:m==="males",onClick:()=>St("males"),children:"Males"}),t.jsx(vt,{theme:F,active:m==="females",onClick:()=>St("females"),children:"Females"}),t.jsx(vt,{theme:F,active:m==="groups",onClick:()=>St("groups"),children:"Groups"})]}),t.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[t.jsx("button",{onClick:()=>ie(!0),className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),children:"Export QR"}),t.jsx("button",{onClick:()=>Re(!0),className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),children:"Scan QR"}),t.jsx("button",{onClick:()=>{ue(Fn()),$(!0)},className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),children:"+ Add animal"}),t.jsx("button",{onClick:()=>Pe(!0),className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),children:"Import animals"})]})]}),m==="groups"?t.jsx(Rd,{groups:z,setGroups:B,snakes:e,theme:F,onOpenSnake:jr,onDeleteGroup:i=>{if(e.some(v=>(v.groups||[]).includes(i)))return alert("Group in use by some snakes. Remove from those snakes first.");B(v=>v.filter(N=>N!==i)),j===i&&w("all")}}):t.jsxs(Vs,{title:jo,children:[t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500",children:"Tags"}),rs.length>0&&t.jsx("span",{className:"text-[11px] text-neutral-500",children:E.length?`${E.length} selected`:"Showing all"}),E.length>0&&t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 border rounded-lg bg-white hover:bg-neutral-50",onClick:C,children:"Clear"})]}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:rs.length?rs.map(i=>{const x=E.includes(i);return t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("label",{className:te("inline-flex items-center gap-1 px-2 py-1 border rounded-lg text-[12px] bg-white transition-colors",x?"border-sky-500 text-sky-700 bg-sky-50":"border-neutral-200 text-neutral-700 hover:border-sky-400"),children:[t.jsx("input",{type:"checkbox",className:"w-3 h-3",checked:x,onChange:()=>Ht(i)}),t.jsx("span",{children:i})]}),t.jsx("button",{type:"button",className:"h-5 w-5 inline-flex items-center justify-center rounded-full border border-neutral-200 text-[11px] leading-none text-neutral-500 hover:border-rose-400 hover:text-rose-500",title:"Delete tag",onClick:()=>Ye(i),children:"×"})]},i)}):t.jsx("div",{className:"text-xs text-neutral-500",children:"No tags yet. Add one from an animal card."})})]}),t.jsx(ad,{groups:z,showGroups:D,setShowGroups:b,hiddenGroups:I,setHiddenGroups:P,showUnassigned:J,setShowUnassigned:ge}),t.jsxs("div",{className:"grid sm:grid-cols-2 xl:grid-cols-3 gap-3",children:[Nn.map(i=>t.jsx(fd,{s:i,groups:z,setSnakes:s,setQrFor:re,onEdit:x=>{pt(x),De(nn(x))},onQuickPair:x=>Co(x),onDelete:Cr,pairings:n,onOpenPairing:x=>{const v=n.find(N=>N.id===x);v&&(r("pairings"),Vt(v.id))},lastFeedDefaults:T,setLastFeedDefaults:q},i.id)),!Nn.length&&t.jsx("div",{className:"col-span-full text-sm text-neutral-500",children:"No animals match your filters."})]})]})]}),a==="pairings"&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs(vt,{theme:F,active:l==="active",onClick:()=>{c("active"),Vt(null),u("All")},children:["Active projects (",pr,")"]}),t.jsxs(vt,{theme:F,active:l==="completed",onClick:()=>{c("completed"),Vt(null),u("All")},children:["Completed projects (",go,")"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Qe(i=>!i),className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!He)),"aria-pressed":He,children:He?"Hide advisor":"Breeding advisor"}),t.jsx("button",{type:"button",onClick:Fo,className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),children:"New pairing"})]})]}),l==="completed"&&Fs.length>0&&t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(vt,{theme:F,active:d==="All",onClick:()=>u("All"),children:"All years"}),Fs.map(i=>t.jsx(vt,{theme:F,active:d===i,onClick:()=>u(i),children:i},i))]}),He&&t.jsx("div",{className:"flex flex-col gap-4",children:t.jsx(sc,{males:mr,females:ur})}),t.jsx(wd,{snakes:e,pairings:bo,onDelete:i=>{o(x=>x.filter(v=>v.id!==i)),Vt(x=>x===i?null:x)},onOpenSnake:jr,onUpdatePairing:Zo,focusedPairingId:ns,onFocusPairing:Vt,theme:F,title:l==="completed"?`Completed projects (${yo}${d!=="All"?` • ${d}`:""})`:`Breeding Planner (${pr})`,emptyMessage:l==="completed"?d==="All"?"No completed projects yet. Hatchlings will land here once the cycle is marked finished.":`No completed projects recorded for ${d}.`:"No active pairings yet. Use “New pairing”.",variant:"collapsed"})]}),a==="calendar"&&t.jsx(Od,{snakes:e,pairings:n,theme:F,onOpenPairing:i=>{const x=n.find(v=>v.id===i);x&&(r("pairings"),Vt(x.id))}}),a==="setup"&&t.jsx(Nd,{breederInfo:U,setBreederInfo:A,theme:F,onSaved:()=>r("animals"),createBackupPayload:Le,onRestoreBackup:ft,backupSettings:G,updateBackupSettings:ye,autoBackupSnapshot:ee,onTriggerAutoBackup:bt,backupVault:Q,onCreateVaultEntry:Ze,onRenameVaultEntry:st,onDeleteVaultEntry:lt,snakes:e,pairings:n,animalExportFields:xe,setAnimalExportFields:oe,pairingExportFields:Ae,setPairingExportFields:Oe,exportFeedback:Ge,setExportFeedback:W})]}),Dt&&t.jsx("div",{className:te("fixed inset-0 flex items-center justify-center p-4 z-[80]",Kt(F)),onClick:wr,children:t.jsxs("div",{className:"relative w-full max-w-4xl bg-white text-neutral-900 rounded-2xl shadow-xl border border-neutral-200 max-h-[90vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"flex items-start justify-between gap-4 px-5 pt-5",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-base font-semibold",children:Dt.name||"Unnamed snake"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:Dt.id}),t.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[Ks.length," photo",Ks.length===1?"":"s"," stored"]})]}),t.jsx("button",{className:"text-sm px-3 py-1.5 border rounded-lg",onClick:wr,children:"Close"})]}),t.jsx("div",{className:"px-5 pb-5 overflow-y-auto max-h-[70vh] mt-4",children:Ks.length?t.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:Ks.map(i=>{const x=!!(Dt.imageUrl&&i.url===Dt.imageUrl),v=xt(i.addedAt)||"",N=typeof i.size=="number"?Do(i.size):"",L=i.name||`${Dt.name||Dt.id||"snake"}-${i.id}`;return t.jsxs("div",{className:"border border-neutral-200 rounded-xl overflow-hidden bg-neutral-50 flex flex-col",children:[t.jsxs("div",{className:"relative bg-black/5",children:[t.jsx("img",{src:i.url,alt:i.name||`${Dt.name||"Snake"} photo`,className:"w-full h-full object-cover",loading:"lazy"}),x&&t.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500 text-white shadow",children:"Cover"})]}),t.jsxs("div",{className:"p-3 flex-1 flex flex-col gap-2 text-sm",children:[t.jsx("div",{className:"flex items-start justify-between gap-2",children:t.jsx("div",{className:"font-medium truncate",title:i.name||L,children:i.name||"Untitled photo"})}),t.jsxs("div",{className:"text-xs text-neutral-500",children:[i.source==="camera"?"Captured on device":"Uploaded file",N?` • ${N}`:""]}),v&&t.jsxs("div",{className:"text-xs text-neutral-500",children:["Added ",v]}),t.jsxs("div",{className:"mt-auto flex flex-wrap items-center gap-2 pt-2",children:[t.jsx("a",{href:i.url,download:L,target:"_blank",rel:"noopener noreferrer",className:"text-xs px-2 py-1 border rounded-lg hover:bg-neutral-100",children:"Open"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg hover:bg-neutral-100 disabled:opacity-60",onClick:()=>Ao(Dt.id,i.id),disabled:x,children:x?"Current cover":"Set as cover"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 hover:bg-rose-50",onClick:()=>{window.confirm("Remove this photo?")&&ko(Dt.id,i.id)},children:"Remove"})]})]})]},i.id)})}):t.jsx("div",{className:"text-sm text-neutral-500",children:"No photos saved for this snake yet. Use the card buttons to add some."})})]})}),ce&&t.jsx("div",{className:te("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Kt(F)),onClick:()=>$(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh]",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:"Add animal"}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:()=>$(!1),children:"Close"})]}),t.jsx(ed,{newAnimal:_,setNewAnimal:ue,groups:z,setGroups:B,statusOptions:rs,customStatusTags:R,onCreateStatusTag:yt,onDeleteStatusTag:Ye,onCancel:()=>$(!1),onAdd:Ro,theme:F})]})}),Se&&t.jsx("div",{className:te("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Kt(F)),onClick:br,children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-xl border p-6 space-y-4",onClick:i=>i.stopPropagation(),children:[t.jsx("div",{className:"text-lg font-semibold text-center",children:"Breeders only"}),t.jsx("p",{className:"text-sm text-neutral-600 text-center",children:"Only snakes in the Breeders group can be paired."}),t.jsxs("p",{className:"text-xs text-neutral-500 text-center",children:["Add"," ",t.jsx("span",{className:"font-semibold text-neutral-700",children:((Ar=Se==null?void 0:Se.snake)==null?void 0:Ar.name)||((Dr=Se==null?void 0:Se.snake)==null?void 0:Dr.id)||"this snake"})," ","to Breeders and continue?"]}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:br,children:"Cancel"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm text-white",Fe(F,!0)),onClick:So,children:"Add to Breeders & pair"})]})]})}),Xe&&(()=>{var Y,he;const i=Array.isArray(Xe.entries)?Xe.entries.length:0,x=i?Math.min(i-1,Math.max(0,Xe.currentIndex||0)):0,v=i?Xe.entries[x]:null,N=((Y=Xe.context)==null?void 0:Y.pairingName)||"Hatchling",L=((he=Xe.context)==null?void 0:he.groupName)||"",V=x===i-1,ne=v&&String(v.id||"").trim().length>0;return t.jsx("div",{className:te("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Kt(F)),onClick:jn,children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh] flex flex-col",onClick:Z=>Z.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:"Log hatchlings"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-0.5",children:i>0?`Hatchling ${x+1} of ${i}`:"No hatchlings to record"})]}),t.jsx("button",{type:"button",className:"text-sm px-2 py-1",onClick:jn,children:"Close"})]}),t.jsx("div",{className:"p-4 overflow-auto flex-1",children:v?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-sm text-neutral-600",children:["Pairing: ",t.jsx("span",{className:"font-medium text-neutral-800",children:N})]}),L&&t.jsxs("div",{className:"text-xs text-neutral-500",children:["New hatchlings will be placed in ",t.jsx("span",{className:"font-medium text-neutral-700",children:L}),"."]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Hatchling ID"}),t.jsxs("div",{className:"mt-1 flex gap-2",children:[t.jsx("input",{className:"flex-1 border rounded-xl px-3 py-2 text-sm",value:v.id||"",onChange:Z=>Bo(x,Z.target.value)}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-xl text-sm border",v.autoId?"text-neutral-600":"text-neutral-700"),onClick:()=>Yo(x),children:"Regenerate"})]}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:v.autoId?"Generated automatically based on pairing.":"ID locked—edit to override or regenerate."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm bg-white",value:v.sex||"F",onChange:Z=>qo(x,Z.target.value),children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"}),t.jsx("option",{value:"U",children:"Unknown"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Weight (g)"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm",value:v.weight,onChange:Z=>Ho(x,Z.target.value),placeholder:"e.g., 75"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Morph / het notes"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm",value:v.morph||"",onChange:Z=>zo(x,Z.target.value),placeholder:"e.g., Pastel Clown 66% Het Hypo"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm",value:v.birthDate||"",onChange:Z=>Vo(x,Z.target.value)})]})]})]}):t.jsx("div",{className:"text-sm text-neutral-500",children:"No hatchlings to record."})}),t.jsxs("div",{className:"p-4 border-t flex items-center justify-between gap-3",children:[t.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl text-sm border",onClick:jn,children:"Cancel"}),t.jsxs("div",{className:"flex items-center gap-2",children:[x>0&&t.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl text-sm border",onClick:Qo,children:"Previous"}),!V&&t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-xl text-sm text-white",ne?Fe(F,!0):Fe(F,!1)),onClick:Wo,disabled:!ne,children:"Next"}),V&&t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-xl text-sm text-white",ne?Fe(F,!0):Fe(F,!1)),onClick:Ko,disabled:!ne,children:"Save hatchlings"})]})]})]})})})(),$e&&t.jsx("div",{className:te("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Kt(F)),onClick:()=>Pe(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-5xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh]",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:"Import animals"}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:()=>Pe(!1),children:"Close"})]}),t.jsx("div",{className:"p-4 overflow-auto max-h-[80vh]",children:t.jsx($d,{importText:me,setImportText:Ce,importPreview:Ne,setImportPreview:Ee,runImportPreview:_o,applyImport:Oo,theme:F,onCancel:()=>Pe(!1)})})]})}),bn&&t.jsx("div",{className:te("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Kt(F)),onClick:()=>Gt(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh]",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:"Create pairing"}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:()=>Gt(!1),children:"Close"})]}),t.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] overflow-auto",children:[(()=>{const i=mr.filter(Ws),x=ur.filter(Ws),v=!i.length||!x.length;return t.jsxs(t.Fragment,{children:[v&&t.jsx("div",{className:"sm:col-span-2 text-xs text-amber-600 bg-amber-50 border border-amber-200 rounded-lg p-2",children:"Add at least one male and one female to the Breeders group to enable pairing."}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Male"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",value:et.maleId||"",onChange:N=>Bt(L=>({...L,maleId:N.target.value})),children:[t.jsx("option",{value:"",children:"Select male"}),i.map(N=>{const V=At(N.morphs,N.hets,N.possibleHets).join(" ");return t.jsxs("option",{value:N.id,children:[N.name,V?` • ${V}`:""]},N.id)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Female"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",value:et.femaleId||"",onChange:N=>Bt(L=>({...L,femaleId:N.target.value})),children:[t.jsx("option",{value:"",children:"Select female"}),x.map(N=>{const V=At(N.morphs,N.hets,N.possibleHets).join(" ");return t.jsxs("option",{value:N.id,children:[N.name,V?` • ${V}`:""]},N.id)})]})]})]})})(),et.maleId&&et.femaleId&&t.jsxs("div",{className:"sm:col-span-2 text-xs text-neutral-500",children:["Pairing label will be saved as ",(wn==null?void 0:wn.name)||et.femaleId," × ",(vn==null?void 0:vn.name)||et.maleId,"."]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Starting date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:et.startDate||"",onChange:i=>Bt(x=>({...x,startDate:i.target.value}))})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{className:"mt-1 w-full border rounded-xl px-3 py-2",rows:3,value:et.notes||"",onChange:i=>Bt(x=>({...x,notes:i.target.value})),placeholder:"Ultrasound size, rotation plan, etc."})]})]}),t.jsxs("div",{className:"p-5 border-t flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Appointments generate monthly from the start date. Calendar staggers same-male appointments by 3 days."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:()=>Gt(!1),children:"Cancel"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm text-white",et.femaleId&&et.maleId?Fe(F,!0):Fe(F,!1)),disabled:!et.femaleId||!et.maleId,onClick:()=>{if(!et.maleId||!et.femaleId){alert("Choose a breeder male and female first.");return}Go()},children:"Add pairing"})]})]})]})}),ve&&fe&&t.jsx("div",{className:te("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Kt(F)),children:t.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-2xl shadow-xl border max-h-[92vh] flex flex-col",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-5 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:ve.name}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border border-rose-200 text-rose-600",onClick:()=>Cr(ve),children:"Delete"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),onClick:async()=>{try{await hd(fe,U,F,n)}catch(i){console.error(i),alert("Export failed")}},children:"Export PDF"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),onClick:()=>{const i=ve.id,x=fe.id||i,v=Nt(fe.sex,Nt(ve.sex,"F")),N=(fe.status||"").trim()||"Active",L=es(fe.groups);s(V=>V.map(ne=>ne.id===i?{...fe,id:x,sex:v,status:N,groups:L}:ne)),o(V=>V.map(ne=>({...ne,maleId:ne.maleId===i?x:ne.maleId,femaleId:ne.femaleId===i?x:ne.femaleId}))),Js()},children:"Save changes"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm",Fe(F,!0)),onClick:Js,children:"Cancel"})]})]}),t.jsxs("div",{className:"p-5 grid grid-cols-1 md:grid-cols-3 gap-4 overflow-auto min-h-0 flex-1",children:[t.jsxs("div",{className:"md:col-span-1 space-y-1",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Name"}),t.jsx("input",{className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm",value:fe.name,onChange:i=>De(x=>({...x,name:i.target.value}))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"ID"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 border rounded-lg text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:Xo,disabled:!!(fe.id||"").trim(),children:"Generate ID"}),t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 border rounded-lg text-neutral-700",onClick:Jo,children:"Update ID"})]})]}),t.jsx("input",{className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm font-mono",value:fe.id,onChange:i=>De(x=>({...x,id:i.target.value}))}),!(fe.id||"").trim()&&t.jsx("div",{className:"mt-0.5 text-[11px] text-neutral-500",children:"Will use your breeder wizard settings the first time you generate."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm bg-white",value:fe.sex,onChange:i=>De(x=>({...x,sex:i.target.value})),children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"})]})]}),t.jsxs("div",{ref:ke,className:"relative",children:[t.jsx("label",{className:"text-xs font-medium",children:"Tag"}),t.jsxs("button",{type:"button",className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm bg-white text-left flex items-center justify-between",onClick:()=>Ct(i=>!i),children:[t.jsx("span",{children:ho||"No tag"}),t.jsx("span",{className:"text-[10px] text-neutral-500",children:"v"})]}),jt&&t.jsxs("div",{className:"absolute z-40 mt-1 w-full rounded-xl border border-neutral-200 bg-white shadow-lg",children:[t.jsx("button",{type:"button",className:"w-full px-3 py-2 text-left text-sm hover:bg-neutral-100",onClick:fo,children:"No tag"}),t.jsx("div",{className:"border-t border-neutral-100"}),rs.length?rs.map(i=>t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-sm hover:bg-neutral-50",children:[t.jsx("button",{type:"button",className:"flex-1 text-left",onClick:()=>po(i),children:i}),t.jsx("button",{type:"button",className:"ml-3 text-sm font-semibold text-rose-500 hover:text-rose-600",onClick:()=>xo(i),title:"Delete tag",children:"-"})]},i)):t.jsx("div",{className:"px-3 py-2 text-sm text-neutral-400",children:"No tags available yet."})]}),t.jsxs("div",{className:"mt-2 grid w-full grid-cols-[minmax(0,1fr)_auto] gap-2",children:[t.jsx("input",{className:"w-full border rounded-lg px-2 py-1 text-sm",value:ot,onChange:i=>Ft(i.target.value),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),dr())},placeholder:"Create new tag"}),t.jsx("button",{type:"button",className:te("px-2.5 py-1 rounded-lg text-sm border transition-colors whitespace-nowrap",ot.trim()?Fe(F,!0):"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:dr,disabled:!ot.trim(),children:"Add tag"})]}),t.jsx("div",{className:"text-[11px] text-neutral-500 mt-1",children:"Create and assign custom tags to track sales channels or availability. Use the dropdown above to select a tag or remove it with the minus icon."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth date"}),t.jsx("input",{type:"date",className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm",value:fe.birthDate||"",onChange:i=>De(x=>({...x,birthDate:i.target.value}))}),t.jsx("div",{className:"text-xs text-neutral-500 mt-0.5",children:fe.birthDate?je(fe.birthDate):""})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Genetics (morphs & hets)"}),t.jsx("textarea",{rows:3,className:"mt-0.5 w-full border rounded-xl px-2 py-2 text-sm",value:$c(fe.morphs,fe.hets),onChange:i=>{const{morphs:x,hets:v}=Ss(i.target.value);De(N=>({...N,morphs:x,hets:v}))},placeholder:`Clown
Pastel
Het Hypo`}),t.jsx("div",{className:"text-[11px] text-neutral-500 mt-0.5",children:"One trait per line works best. Prefix recessive targets with “Het”, “Possible”, or a percentage when needed."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Weight (g)"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:fe.weight,onChange:i=>De(x=>({...x,weight:Number(i.target.value)||0}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Group"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm bg-white",value:Array.isArray(fe.groups)&&fe.groups[0]||"",onChange:i=>{const x=i.target.value.trim();De(v=>({...v,groups:x?[x]:[]}))},children:[t.jsx("option",{value:"",children:"No group"}),z.map(i=>t.jsx("option",{value:i,children:i},i))]}),t.jsx("div",{className:"mt-2 border border-dashed border-neutral-200 rounded-xl p-3 bg-white",children:t.jsx(lo,{onAdd:i=>{i&&(B(x=>x.includes(i)?x:[...x,i]),De(x=>({...x,groups:[i]})))}})}),t.jsxs("div",{className:"text-[11px] text-neutral-500 mt-1",children:["Existing: ",z.join(", ")||"—"]})]})]}),t.jsxs("div",{className:"md:col-span-2 space-y-5",children:[t.jsxs("div",{className:"p-3 border rounded-xl bg-white",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium text-sm",children:"Pairing overview"}),t.jsx("div",{className:"text-xs text-neutral-500",children:"Know which projects involve this animal."})]}),t.jsx("div",{className:"space-y-2",children:(()=>{const i=zt(fe.sex)==="F",x=(fe.id||"").trim(),v=x?n.filter(L=>{if(!L)return!1;const V=(L.maleId||"").trim(),ne=(L.femaleId||"").trim();return!V&&!ne?!1:i?ne===x:V===x}):[];if(!v.length)return t.jsx("div",{className:"text-xs text-neutral-500",children:"No pairings recorded yet."});const N=i?wo:vo;return v.map(L=>{var be;const V=yc(L),Y=((i?L.maleId:L.femaleId)||"").trim(),he=Y?((be=N[Y])==null?void 0:be.name)||Y:"Partner not set",Z=Array.isArray(L.appointments)?L.appointments.length:0;return t.jsxs("div",{className:"border rounded-lg px-3 py-2 bg-neutral-50",children:[t.jsxs("div",{className:"text-xs font-semibold text-neutral-700 truncate",children:[L.label||"Pairing"," (#",L.id,")"]}),t.jsxs("div",{className:"text-xs text-neutral-600 truncate",children:["Partner: ",he||"Unknown partner"]}),t.jsxs("div",{className:"text-[11px] text-neutral-500 truncate",children:[Z," appointment",Z===1?"":"s"," scheduled"]}),V?t.jsxs("div",{className:"text-[11px] text-neutral-500 truncate",children:["Status: ",V]}):null]},L.id)})})()})]}),t.jsxs("div",{className:"mt-4 p-2 border rounded-xl bg-neutral-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium text-sm",children:"Logs"}),t.jsx("div",{className:"text-xs text-neutral-500",children:"Edit recent feeds, weights, sheds, cleanings, meds"})]}),t.jsx(_d,{editSnakeDraft:fe,setEditSnakeDraft:De,lastFeedDefaults:T,setLastFeedDefaults:q})]}),t.jsxs("div",{className:"mt-4 flex flex-col items-end gap-3",children:[t.jsxs("div",{style:{width:318,height:318},className:"rounded-lg overflow-hidden border-2 border-neutral-200 relative",children:[fe.imageUrl?t.jsx("img",{src:fe.imageUrl,alt:fe.name,className:"w-full h-full object-cover object-center"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm text-neutral-500 bg-neutral-50",children:"No image"}),at&&t.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center text-sm text-neutral-600",children:"Saving pictures…"})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[t.jsx("input",{ref:We,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:Eo}),t.jsx("input",{ref:qe,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:Io}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:Lo,disabled:at||!(ve!=null&&ve.id),children:"Take picture"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:Mo,disabled:at||!(ve!=null&&ve.id),children:"Upload picture"}),t.jsxs("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:To,disabled:!(ve!=null&&ve.id),children:["View pictures",vr?` (${vr})`:""]}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{De(i=>i&&{...i,imageUrl:void 0}),pt(i=>i&&{...i,imageUrl:void 0})},disabled:!(fe!=null&&fe.imageUrl),children:"Clear cover"})]})]})]})]})]})}),t.jsx("div",{className:"py-10"}),M&&(()=>{const i=e.find(x=>x.id===M);return t.jsx(od,{id:M,name:i==null?void 0:i.name,morphs:i==null?void 0:i.morphs,hets:i==null?void 0:i.hets,dataUrl:X,onClose:()=>re(null)})})(),t.jsx(ld,{open:Ie,onClose:()=>ie(!1),snakes:e,groups:z,onGenerate:i=>md(i,U),theme:F}),Ke&&t.jsx(sd,{onClose:()=>Re(!1),onFound:i=>{Re(!1);const x=e.find(v=>v.id===i);x?(pt(x),De(nn(x))):alert(`No snake found with ID: ${i}`)}}),t.jsx(nd,{snake:Ve,onCancel:Po,onConfirm:$o,theme:F}),t.jsx(eu,{theme:F})]})}function sd({onClose:e,onFound:s}){const n=h.useRef(null),o=h.useRef(null),a=h.useRef(null),[r,l]=h.useState(""),c=h.useMemo(()=>{if(typeof navigator>"u")return"camera";const b=navigator.userAgent||"";return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile/i.test(b)?"camera":"scanner"},[]),[d,u]=h.useState(()=>{if(typeof window<"u")try{const b=window.localStorage.getItem(ia);if(b==="camera"||b==="scanner")return b}catch{}return c}),m=d==="camera",p=h.useCallback(async()=>{const b=o.current;if(!b)return;o.current=null;const I=[];typeof b.stop=="function"&&I.push(b.stop().catch(()=>{})),typeof b.clear=="function"&&I.push(b.clear().catch(()=>{})),typeof b.close=="function"&&I.push(b.close().catch(()=>{})),I.length&&await Promise.allSettled(I)},[]),g=h.useCallback(b=>{b!=="camera"&&b!=="scanner"||(u(I=>I===b?I:b),b!=="camera"&&p().catch(()=>{}))},[p]),f=h.useCallback(async()=>{var P,E;if(n.current)return n.current;if(typeof window>"u")return null;let b=null;try{b=await xs(()=>import("./vendor-CCGeIgWZ.js").then(k=>k.i),__vite__mapDeps([1,2]))}catch(k){console.warn("Failed to import html5-qrcode via ESM",k)}const I={Html5Qrcode:(b==null?void 0:b.Html5Qrcode)||((P=b==null?void 0:b.default)==null?void 0:P.Html5Qrcode)||window.Html5Qrcode||null,Html5QrcodeScanner:(b==null?void 0:b.Html5QrcodeScanner)||((E=b==null?void 0:b.default)==null?void 0:E.Html5QrcodeScanner)||window.Html5QrcodeScanner||null};return!I.Html5Qrcode&&!I.Html5QrcodeScanner?null:(n.current=I,I)},[]);h.useEffect(()=>{let b=!0;return m?((async()=>{await p().catch(()=>{});const P=await f();if(!b)return;if(!P){alert("QR scanner library failed to load. Check your connection and reload.");return}if(!document.getElementById("qr-scan-root"))return;const{Html5QrcodeScanner:k,Html5Qrcode:R}=P;try{if(k){const O=new k("qr-scan-root",{fps:10,qrbox:250},!1);o.current=O,O.render(K=>{const S=an(K);S&&(b&&s(S),p().catch(()=>{}))},()=>{})}else if(R){const O=new R("qr-scan-root");o.current=O,await O.start({facingMode:{ideal:"environment"}},{fps:10,qrbox:250},K=>{const S=an(K);S&&(b&&s(S),p().catch(()=>{}))},()=>{})}else throw new Error("html5-qrcode module unavailable")}catch(O){console.error("QR importer failed",O),b&&alert("Unable to start QR scanner. Verify camera permissions and try again.")}})(),()=>{b=!1,p().catch(()=>{})}):(p().catch(()=>{}),()=>{b=!1,p().catch(()=>{})})},[f,m,s,p]),h.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(ia,d)}catch{}},[d]),h.useEffect(()=>{if(d!=="scanner")return;const b=a.current;if(b){try{b.focus({preventScroll:!0})}catch{try{b.focus()}catch{}}if(typeof b.select=="function")try{b.select()}catch{}}},[d]);const y=async b=>{const I=b.target.files&&b.target.files[0];if(I){b.target&&(b.target.value="");try{const P=await f();let E=null;if(P&&P.Html5Qrcode){const{Html5Qrcode:R}=P;try{let O=null;typeof R.scanFileV2=="function"?O=await R.scanFileV2(I,!0):typeof R.scanFile=="function"&&(O=await R.scanFile(I,!0)),E=Za(O)}catch(O){console.warn("html5-qrcode file scan failed, will fall back to jsQR",O)}}if(E||(E=await _c(I)),!E){alert("Could not read a QR code from that image. Try a clearer, well-lit photo.");return}const k=an(E);if(!k){alert("Could not parse an ID from that QR code.");return}s(k)}catch(P){console.error("file scan failed",P),alert("Failed to scan uploaded image")}}},j=h.useCallback(()=>{const b=r.trim();if(!b){alert("Scan or paste a QR value first.");return}const I=an(b);if(!I){alert("Scan or paste a QR value first.");return}l(""),s(I)},[r,s]),w=b=>{b.key==="Enter"&&(b.preventDefault(),j())},D=r.trim().length>0;return t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow w-full max-w-md",onClick:b=>b.stopPropagation(),children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-lg",children:"Scan QR Code"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Choose how you'd like to scan. Cameras shine on mobile; USB readers are handy on desktop."})]}),t.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:e,children:"✕"})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"text-xs font-medium text-neutral-600",children:"Scan method"}),t.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>g("camera"),className:te("px-3 py-1.5 rounded-lg text-sm border transition-colors",m?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-neutral-700 border-neutral-200 hover:border-sky-400"),children:"Device camera"}),t.jsx("button",{type:"button",onClick:()=>g("scanner"),className:te("px-3 py-1.5 rounded-lg text-sm border transition-colors",m?"bg-white text-neutral-700 border-neutral-200 hover:border-sky-400":"bg-sky-600 text-white border-sky-600 shadow-sm"),children:"USB / handheld scanner"})]}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:[m?"Camera starts automatically. Switch if you prefer a USB reader.":"Input field below is ready for your USB reader. Switch if you need the device camera."," ","Your choice is remembered. Suggested default: ",c==="camera"?"device camera (mobile).":"USB / handheld scanner (desktop)."]})]}),t.jsx("div",{className:"mt-3",children:t.jsx("div",{id:"qr-scan-root",className:te("w-full h-56 rounded-lg border-2 border-dashed flex items-center justify-center transition-colors",m?"border-neutral-200 bg-neutral-50":"border-neutral-300 bg-neutral-100"),children:m?t.jsx("div",{className:"text-center text-sm text-neutral-500 px-4",children:"Align the QR inside the box"}):t.jsx("div",{className:"text-center text-sm text-neutral-500 px-4",children:"Camera disabled. Trigger your USB scanner and the scanned text will appear below."})},d)}),t.jsx("div",{className:"mt-3 text-xs text-neutral-500",children:m?"Tip: Hold the camera steady and ensure the code is well-lit. If the camera is blocked, upload a photo instead.":"Tip: USB readers usually act like keyboards. If the field below loses focus, click it once before scanning."}),t.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[t.jsx("label",{className:"text-sm",children:"Upload image:"}),t.jsx("input",{type:"file",accept:"image/*",onChange:y})]}),t.jsxs("div",{className:"mt-4 border-t border-neutral-200 pt-4",children:[t.jsx("div",{className:"text-sm font-medium",children:m?"Using a USB / handheld scanner?":"Scanner input"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:m?"Most external QR readers act like keyboards. Click the field below, then trigger your scanner to fill it.":"We focused this field so your USB reader can type the QR value automatically. You can also paste a code manually."}),t.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row gap-2",children:[t.jsx("input",{ref:a,type:"text",value:r,onChange:b=>l(b.target.value),onKeyDown:w,className:"flex-1 border rounded-lg px-3 py-2 text-sm font-mono",placeholder:m?"Scan or paste the QR contents here":"Scanner-ready: trigger your reader or paste the QR contents here",inputMode:"text",autoComplete:"off",autoFocus:d==="scanner"}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm border transition-colors",D?"bg-sky-600 text-white border-sky-600":"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:j,disabled:!D,children:"Look up"})]})]}),t.jsx("div",{className:"mt-4 flex justify-end",children:t.jsx("button",{className:"px-3 py-2 rounded-lg border",onClick:e,children:"Close"})})]})})}function nd({snake:e,onCancel:s,onConfirm:n,theme:o="blue"}){return e?t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-[70]",onClick:s,children:t.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-xl border p-5",onClick:a=>a.stopPropagation(),children:[t.jsxs("div",{className:"font-semibold text-lg",children:["Delete ",e.name||"this snake","?"]}),t.jsx("p",{className:"mt-2 text-sm text-neutral-600 leading-relaxed",children:"This removes the animal and detaches any pairings linked to it. Demo animals will return automatically whenever your collection is empty, so you always have something to explore."}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:s,children:"Cancel"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm text-white",o==="dark"?"bg-rose-500 hover:bg-rose-600":"bg-rose-600 hover:bg-rose-700"),onClick:n,children:"Delete"})]})]})}):null}function rd(e){return e==="green"?{active:"bg-emerald-600 text-white border-emerald-600",soft:"bg-emerald-300"}:e==="dark"?{active:"bg-neutral-800 text-white border-neutral-700",soft:"bg-neutral-600"}:{active:"bg-sky-600 text-white border-sky-600",soft:"bg-sky-300"}}function Fe(e,s=!0){return e==="green"?s?"bg-emerald-600 text-white":"bg-emerald-300 text-white":e==="dark"?s?"bg-neutral-800 text-white":"bg-neutral-600 text-white":s?"bg-sky-600 text-white":"bg-sky-300 text-white"}function Kt(e){return e==="green"?"bg-emerald-900/20":e==="dark"?"bg-neutral-900/40":"bg-sky-900/20"}function vt({theme:e="blue",active:s,onClick:n,children:o}){const a=rd(e);return t.jsx("button",{className:te("px-3 py-1.5 rounded-lg text-sm border",s?a.active:"bg-white hover:bg-neutral-50"),onClick:n,children:o})}function Vs({title:e,children:s}){return t.jsxs("div",{className:"bg-white border rounded-2xl shadow-sm",children:[t.jsx("div",{className:"px-4 py-3 border-b font-semibold",children:e}),t.jsx("div",{className:"p-4",children:s})]})}function ao({children:e}){return t.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full border bg-neutral-50",children:e})}function ad({groups:e,showGroups:s,setShowGroups:n,hiddenGroups:o,setHiddenGroups:a,showUnassigned:r=!0,setShowUnassigned:l}){const c=y=>{typeof n!="function"||typeof a!="function"||n(j=>{const w=new Set(j||[]);return w.has(y)?w.delete(y):(w.add(y),a(D=>(D||[]).filter(b=>b!==y))),[...w]})},d=y=>{typeof a!="function"||typeof n!="function"||a(j=>{const w=new Set(j||[]);return w.has(y)?w.delete(y):(w.add(y),n(D=>(D||[]).filter(b=>b!==y))),[...w]})},u=()=>{typeof n=="function"&&n([]),typeof a=="function"&&a([])},m=()=>{typeof l=="function"&&l(y=>!y)},p=new Set(s||[]),g=new Set(o||[]),f=p.size>0||g.size>0;return t.jsxs("div",{className:"space-y-2 mb-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx("button",{type:"button",disabled:!f,className:te("px-2.5 py-1 rounded-lg border text-xs font-medium transition-colors",f?"bg-white hover:bg-neutral-50 border-neutral-300":"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:u,children:"Clear filters"}),t.jsx("button",{type:"button",className:te("px-2.5 py-1 rounded-lg border text-xs font-medium transition-colors",r?"bg-amber-100 border-amber-300 text-amber-900":"bg-white hover:bg-neutral-50 border-neutral-300"),onClick:m,children:r?"Hide unassigned":"Show unassigned"})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.map(y=>{const j=p.has(y)?"show":g.has(y)?"hide":"neutral";return t.jsxs("div",{className:te("inline-flex items-center gap-1 text-sm px-2.5 py-1 rounded-lg border transition-colors",j==="show"?"bg-emerald-50 border-emerald-400 text-emerald-700":j==="hide"?"bg-rose-50 border-rose-400 text-rose-700":"bg-white border-neutral-300 text-neutral-700"),children:[t.jsx("span",{className:"font-medium mr-0.5",children:y}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",onClick:()=>c(y),className:te("px-1.5 py-0.5 rounded-md border text-[10px] uppercase tracking-wide",j==="show"?"bg-emerald-500 border-emerald-500 text-white":"bg-white border-neutral-300 text-neutral-600 hover:bg-neutral-50"),children:"Show"}),t.jsx("button",{type:"button",onClick:()=>d(y),className:te("px-1.5 py-0.5 rounded-md border text-[10px] uppercase tracking-wide",j==="hide"?"bg-rose-500 border-rose-500 text-white":"bg-white border-neutral-300 text-neutral-600 hover:bg-neutral-50"),children:"Hide"})]})]},y)}),!e.length&&t.jsx("span",{className:"text-xs text-neutral-500",children:"No groups yet."})]})]})}function od({id:e,name:s,morphs:n,hets:o,dataUrl:a,onClose:r}){if(!e)return null;const l=At(n,o,possibleHets);return t.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-4",onClick:r,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",onClick:c=>c.stopPropagation(),children:[t.jsxs("div",{className:"font-medium mb-2",children:["QR for ",s||e]}),t.jsxs("div",{className:"text-sm text-neutral-500 mb-2",children:["ID: ",t.jsx("span",{className:"font-mono",children:e})]}),t.jsx("div",{className:"space-y-1 mb-3",children:l.length?t.jsx(cr,{label:"Genetics",genes:l,size:"md"}):t.jsx("div",{className:"text-xs text-neutral-500 uppercase tracking-wide",children:"Genetics: -"})}),a?t.jsx("img",{src:a,className:"w-64 h-64",alt:`QR ${e}`}):t.jsx("div",{className:"w-64 h-64 flex items-center justify-center",children:"Generating…"}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[a&&t.jsx("a",{className:"px-3 py-2 rounded-lg text-sm border",download:`snake-${e}.png`,href:a,children:"Download"}),t.jsx("button",{className:"px-3 py-2 rounded-lg text-sm border",onClick:r,children:"Close"})]})]})})}function ld({open:e,onClose:s,snakes:n,groups:o,onGenerate:a,theme:r="blue"}){const[l,c]=h.useState("all"),[d,u]=h.useState([]),[m,p]=h.useState([]);h.useEffect(()=>{e||(c("all"),u([]),p([]))},[e]);const g=async()=>{let f=[];l==="all"?f=n:l==="groups"?f=n.filter(y=>(y.groups||[]).some(j=>d.includes(j))):f=n.filter(y=>m.includes(y.id)),a(f),s()};return e?t.jsx("div",{className:te("fixed inset-0 flex items-center justify-center p-4 z-50",Kt(r)),onClick:s,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow w-full max-w-2xl",onClick:f=>f.stopPropagation(),children:[t.jsx("div",{className:"font-medium mb-2",children:"Export QR to PDF (100mm × 50mm)"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{children:t.jsxs("label",{className:"inline-flex items-center gap-2",children:[t.jsx("input",{type:"radio",checked:l==="all",onChange:()=>c("all")})," All snakes"]})}),t.jsxs("div",{children:[t.jsxs("label",{className:"inline-flex items-center gap-2",children:[t.jsx("input",{type:"radio",checked:l==="groups",onChange:()=>c("groups")})," By groups"]}),l==="groups"&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:o.map(f=>{const y=d.includes(f);return t.jsxs("label",{className:"inline-flex items-center gap-2 px-2 py-1 border rounded-lg",children:[t.jsx("input",{type:"checkbox",checked:y,onChange:j=>{const w=j.target.checked;u(D=>{const b=new Set(D||[]);return w?b.add(f):b.delete(f),[...b]})}}),f]},f)})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"inline-flex items-center gap-2",children:[t.jsx("input",{type:"radio",checked:l==="selected",onChange:()=>c("selected")})," Selected snakes"]}),l==="selected"&&t.jsx("div",{className:"mt-2 max-h-40 overflow-auto border rounded p-2",children:n.map(f=>{const y=m.includes(f.id);return t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:y,onChange:j=>{const w=j.target.checked;p(D=>{const b=new Set(D||[]);return w?b.add(f.id):b.delete(f.id),[...b]})}}),f.name," ",t.jsx("span",{className:"text-xs text-neutral-500",children:f.id})]},f.id)})})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-lg border",onClick:s,children:"Cancel"}),t.jsx("button",{className:te("px-3 py-2 rounded-lg text-white",Fe(r,!0)),onClick:g,children:"Generate PDF"})]})]})}):null}const id=.352778;function oo(e,s,n,o=18,a=8){if(!s)return a;let r=o;for(;r>=a;){if(e.setFontSize(r),e.getTextWidth(s)<=n)return r;r-=1}return e.setFontSize(a),a}function hs(e,s=1.2){return e*id*s}const cd=typeof document<"u"&&typeof document.createElement=="function";async function dd(e,s){try{if(cd){const o=document.createElement("canvas");if(await new Promise((a,r)=>{Rn.toCanvas(o,e,{width:600,margin:1},l=>l?r(l):a())}),s)try{const a=o.getContext("2d");if(a){const r=await ud(s),c=600*.2,d=c*.25,u=(600-c)/2,m=(600-c)/2;a.fillStyle="#ffffff",a.fillRect(u-d/2,m-d/2,c+d,c+d),a.drawImage(r,u,m,c,c)}}catch(a){console.warn("Unable to overlay logo on QR code",a)}return o.toDataURL("image/png")}}catch(o){console.warn("Falling back to basic QR generation",o)}return await Rn.toDataURL(e,{width:600,margin:1})}function ud(e){return new Promise((s,n)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>s(o),o.onerror=n,o.src=e})}async function md(e,s={}){const{jsPDF:n}=await xs(async()=>{const{jsPDF:c}=await import("./jspdf-5IEmIIiP.js").then(d=>d.j);return{jsPDF:c}},__vite__mapDeps([0,1,2])),o=100,a=50,r=6,l=new n({unit:"mm",format:[o,a],orientation:"landscape"});for(let c=0;c<e.length;c++){const d=e[c],u=`${window.location.origin}${window.location.pathname}#snake=${encodeURIComponent(d.id)}`;try{const m=await dd(u,s==null?void 0:s.logoUrl),p=Math.min(a-r*2,38),g=r,f=(a-p)/2;l.addImage(m,"PNG",g,f,p,p);const y=1.5;l.setDrawColor(50),l.setLineWidth(.3),l.rect(g-y,f-y,p+y*2,p+y*2);const j=Math.max(20,o-r-(g+p)-8),w=d.name||"Unnamed",D=d.id?`ID: ${d.id}`:"",I=At(d.morphs,d.hets,d.possibleHets).join(", "),P=oo(l,w,j,18,10),E=10;let k=9;const R=6;l.setFontSize(P);const O=l.splitTextToSize(w,j),K=hs(P,1),S=O.length*K,z=I?[`Genetics: ${I}`]:[],B=a-r*2,F=se=>{l.setFontSize(se);const xe=[];z.forEach(Ae=>{const Oe=l.splitTextToSize(Ae,j);xe.push(...Oe)});const oe=xe.length?xe.length*hs(se,1):0;return{lines:xe,height:oe}};let{lines:de,height:U}=F(k);const A=3;let G=de.length?2:0;const le=D?hs(E,1):0;let ee=S+A+le+G+U;for(;ee>B&&k>R;)k-=1,{lines:de,height:U}=F(k),G=de.length?2:0,ee=S+A+le+G+U;let pe=(a-ee)/2;pe<r&&(pe=r);const Q=g+p+8;try{l.setFont(void 0,"bold")}catch{}l.setFontSize(P),l.text(O,Q,pe,{baseline:"top"}),pe+=S+A;try{l.setFont(void 0,"normal")}catch{}D&&(l.setFontSize(E),l.text(D,Q,pe,{baseline:"top"}),pe+=le+G),de.length&&(l.setFontSize(k),l.text(de,Q,pe,{baseline:"top"}))}catch(m){console.error("QR gen failed",m)}l.setDrawColor(120),l.setLineWidth(.4),l.rect(1.5,1.5,o-3,a-3),c<e.length-1&&l.addPage([o,a],"landscape")}l.save("qr-labels.pdf")}async function hd(e,s={},n="blue",o=[]){const{jsPDF:a}=await xs(async()=>{const{jsPDF:Q}=await import("./jspdf-5IEmIIiP.js").then(se=>se.j);return{jsPDF:Q}},__vite__mapDeps([0,1,2])),r=new a({unit:"mm",format:"a4"}),l=210,c=297,d=15;let u=20;const m=8,p={blue:"#1E40AF",green:"#059669",dark:"#374151"},g=p[n]||p.blue,y=zt(e==null?void 0:e.sex)==="F"?co(e==null?void 0:e.id,o):[];function j(Q){const se=String(Q).replace("#",""),xe=parseInt(se.length===3?se.split("").map(oe=>oe+oe).join(""):se,16);return{r:xe>>16&255,g:xe>>8&255,b:xe&255}}function w(Q){return Q?String(Q).replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/[_-]+/g," ").split(/\s+/).map(xe=>xe?xe.charAt(0).toUpperCase()+xe.slice(1):"").join(" "):""}function D(Q=!1){if(r.setDrawColor(g),r.setLineWidth(1.5),r.rect(m,m,l-m*2,297-m*2),Q){u=20;try{if(s&&s.logoUrl)try{r.addImage(s.logoUrl,"PNG",d,u,20,20)}catch{}}catch{}const se=d+24;r.setFontSize(14),s.businessName?(r.text(s.businessName,se,u+6),r.setFontSize(12),r.text(s.name||"",se,u+12)):s.name&&r.text(s.name,se,u+6),r.setFontSize(10);const xe=[];s.email&&xe.push(s.email),s.phone&&xe.push(s.phone),xe.length&&r.text(xe.join(" • "),se,u+18);const oe=u+26;r.setLineWidth(.6),r.setDrawColor(180),r.line(m+4,oe,l-m-4,oe),u=oe+6,r.setFontSize(16),r.text(e.name||"",l/2,u,{align:"center"}),u+=10,r.setFontSize(10),r.text(`ID: ${e.id||""}`,d,u),r.text(`Sex: ${e.sex||""}`,d+70,u),r.text(`Birth date: ${e.birthDate?je(e.birthDate):""}`,d+110,u),u+=7,r.text(`Weight: ${e.weight||""} g`,d,u),r.text(`Groups: ${(e.groups||[]).join(", ")}`,d+70,u),u+=8;const Ae=At(e.morphs,e.hets,e.possibleHets),Oe=Ae.length?Ae.join(", "):"-";r.text(`Genetics: ${Oe}`,d,u),u+=8;const Ge=u+2;r.setLineWidth(.6),r.setDrawColor(180),r.line(m+4,Ge,l-m-4,Ge),u=Ge+8}else u=m+18}D(!0);const b=e.logs||{},I=l-d*2,P=c-m-6;function E(Q,se){return u+Q>P?(r.addPage(),D(!1),typeof se=="function"&&se(),!0):!1}function k(Q,se,xe,oe={}){const Oe=oe.cellFontSize||10,Ge=Math.max(4,Math.round(Oe*.35278*.8)),W=Oe*.35278*1.05,ce=se.length,$=se.map(Ee=>Ee.width||I/ce);function _(){r.setFontSize(12),r.text(Q,d,u),u+=8;let Ee=d;const $e=j(g);r.setFillColor($e.r,$e.g,$e.b),r.rect(d,u,I,9,"F");for(let Pe=0;Pe<ce;Pe++){r.setDrawColor(0),r.setLineWidth(.3),r.rect(Ee,u,$[Pe],9,"S"),r.setFontSize(8),r.setTextColor(255);try{r.setFont(void 0,"bold")}catch{}const ae=w(se[Pe].title||se[Pe].key||""),H=Ee+$[Pe]/2,J=u+9/2;r.text(String(ae),H,J,{align:"center",baseline:"middle"});try{r.setFont(void 0,"normal")}catch{}Ee+=$[Pe]}u+=9,r.setFontSize(Oe),r.setTextColor(10)}E(19,_)||_(),xe.forEach((Ee,$e)=>{r.setFontSize(Oe);let Pe=1;const ae=[];for(let Se=0;Se<ce;Se++){const Be=se[Se].key;let He="";typeof Be=="function"?He=Be(Ee)||"":He=Ee&&typeof Ee[Be]<"u"?Ee[Be]:"";let Qe="";He===null||typeof He>"u"?Qe="":typeof He=="boolean"?Qe=He?"Yes":"No":Array.isArray(He)?Qe=He.join(", "):typeof He=="object"?Qe=JSON.stringify(He):Qe=String(He);const ve=typeof Be=="string"?Be:se[Se].title;typeof Qe=="string"&&(ve==="date"||/date$/i.test(String(ve)))&&(Qe=je(Qe)||Qe);const pt=r.splitTextToSize(Qe,Math.max(10,$[Se]-4));ae.push(pt),pt.length>Pe&&(Pe=pt.length)}const J=Math.max(Ge,Math.ceil(Pe*W))+4;E(J+2,_);let ge=d;for(let Se=0;Se<ce;Se++){const Be=$[Se];r.setDrawColor(0),r.setLineWidth(.25),r.rect(ge,u,Be,J,"S");const He=ae[Se]||[""],Qe=ge+3,ve=u+J/2-(He.length-1)*W/2;r.setFontSize(Oe),r.text(He,Qe,ve),ge+=Be}u+=J});const me=Math.max(Ge,Math.ceil(W))+4;E(me+2,_),r.setDrawColor(0),r.setLineWidth(.3),r.rect(d,u,I,me,"S"),r.setFontSize(Math.max(8,Oe));const Ce=u+2+W/2;r.text(`Total entries: ${xe.length}`,d+3,Ce),u+=me+4;const Ne=typeof oe.spacingAfter=="number"?oe.spacingAfter:0;Ne>0&&(E(Ne,null)||(u+=Ne))}function R(){E(7,null)||(u+=2,r.setDrawColor(200),r.setLineWidth(.4),r.line(d,u,d+I,u),u+=4)}function O(Q){if(!Array.isArray(Q)||!Q.length)return;const se=()=>{r.setFontSize(12),r.text("Breeding cycles",d,u),u+=7},xe=Ge=>{r.setFontSize(10),r.text(String(Ge),d,u),u+=5.5};se();const oe=9,Ae=4,Oe=hs(oe,1.05);Q.forEach(Ge=>{E(6,()=>{D(!1),se()}),xe(Ge.year),(Ge.cycles||[]).forEach(W=>{const ce=[],$=W.label||`Pairing ${W.id||""}`;if(ce.push(`• ${$}`),W.locks&&W.locks.length){const me=W.locks.map(Ce=>Ce.display||xt(Ce.iso)).filter(Boolean).join(", ");me&&ce.push(`   Locks: ${me}`)}W.ovulationDate&&ce.push(`   Ovulation: ${je(W.ovulationDate)}`),W.preLayDate&&ce.push(`   Pre-Lay Shed: ${je(W.preLayDate)}`),W.clutchDate&&ce.push(`   Eggs laid: ${je(W.clutchDate)}`),W.hatchDate&&ce.push(`   Hatched: ${je(W.hatchDate)}`),ce.length===1&&ce.push("   No events recorded");const _=ce.flatMap(me=>r.splitTextToSize(me,I-Ae)),ue=_.length*Oe+2;E(ue+2,()=>{D(!1),se(),xe(Ge.year)}),r.setFontSize(oe),r.text(_,d+Ae,u,{baseline:"top"}),u+=ue}),u+=2})}y.length&&(O(y),R());const K=(b.feeds||[]).slice().reverse(),S=[{title:"Date",key:"date",width:26},{title:"Food",key:"feed",width:46},{title:"Size",key:Q=>{if(!Q)return"";const se=[Q.size,Q.sizeDetail,Q.preySize,Q.portionSize,Q.itemSize],xe=se.find(oe=>typeof oe=="string"&&oe.trim().length)||se.find(oe=>typeof oe=="number");return typeof xe=="number"?`${xe}`:xe||""},width:30},{title:"Weight",key:Q=>Q&&(Q.weightGrams||Q.grams)?`${Q.weightGrams||Q.grams} g`:"",width:24},{title:"Form",key:Q=>{const se=Q&&(Q.method||Q.form),xe=Q&&(Q.methodDetail||Q.formDetail);return se?se==="Other"?xe||"Other":se:""},width:36},{title:"Notes",key:"notes",width:I-162}];k("Feed",S,K,{cellFontSize:6,spacingAfter:0}),R();const z=(b.weights||[]).slice().reverse(),B=[{title:"Date",key:"date",width:30},{title:"Grams",key:Q=>Q&&typeof Q.grams<"u"?`${Q.grams} g`:"",width:30},{title:"Notes",key:"notes",width:I-60}];k("Weights",B,z,{cellFontSize:6,spacingAfter:0}),R();const F=(b.cleanings||[]).slice().reverse(),de=[{title:"Date",key:"date",width:30},{title:"Type",key:Q=>Q&&Q.deep?"Deep cleaning":"Quick cleaning",width:40},{title:"Notes",key:"notes",width:I-70}];k("Cleanings",de,F,{cellFontSize:6,spacingAfter:0}),R();const U=(b.sheds||[]).slice().reverse(),A=[{title:"Date",key:"date",width:30},{title:"Status",key:Q=>Q&&Q.complete?"Complete":"Incomplete",width:30},{title:"Notes",key:"notes",width:I-60}];k("Sheds",A,U,{cellFontSize:6,spacingAfter:0}),R();const G=(b.meds||[]).slice().reverse(),le=[{title:"Date",key:"date",width:30},{title:"Drug",key:"drug",width:48},{title:"Dose",key:Q=>Q&&(Q.dose||Q.dose===0)?`${Q.dose} mg`:"",width:26},{title:"Notes",key:"notes",width:I-104}];k("Meds",le,G,{cellFontSize:6,spacingAfter:0});const ee=r.getNumberOfPages();for(let Q=1;Q<=ee;Q++)r.setPage(Q),r.setFontSize(9),r.text(`Page ${Q} / ${ee}`,d,12);const pe=`${e.id||"snake"}-${(e.name||"").replace(/\s+/g,"_")}.pdf`;r.save(pe)}async function pd(e={}){const{jsPDF:s}=await xs(async()=>{const{jsPDF:S}=await import("./jspdf-5IEmIIiP.js").then(z=>z.j);return{jsPDF:S}},__vite__mapDeps([0,1,2])),n=100,o=50,a=6,r=new s({unit:"mm",format:[n,o],orientation:"landscape"}),l=e.clutchNumber?String(e.clutchNumber):"—",c=e.label?e.label:e.clutchNumber?`Clutch #${l}`:"Clutch Card",d=e.femaleName||"—",u=e.maleName||"—",m=S=>{if(S===null||typeof S>"u")return"";const z=String(S).trim();return!z||z==="—"?"":z},p=m(e.femaleGenetics),g=m(e.maleGenetics);r.setDrawColor(80),r.setLineWidth(.5),r.roundedRect(3,3,n-6,o-6,2,2);const f=oo(r,c,n-a*2,18,12);try{r.setFont(void 0,"bold")}catch{}r.setFontSize(f),r.text(c,n/2,a,{align:"center",baseline:"top"});try{r.setFont(void 0,"normal")}catch{}const y=e.clutchDate||"",j=y?ps(y,59):"",w=(()=>{const S=e.eggsTotal;if(S===null||typeof S>"u"||S==="")return"—";if(typeof S=="number"&&Number.isFinite(S))return String(S);const z=Number(S);return Number.isFinite(z)?String(z):String(S)})(),D=[{label:"Clutch #",value:l},{label:"Date",value:y?je(y):"—"},{label:"Female",value:d,secondary:p},{label:"Male",value:u,secondary:g},{label:"Eggs",value:w},{label:"Est. hatch",value:j?je(j):"—"}];let I=a+hs(f,.9)+2;const P=n-a*2,E=10;r.setFontSize(E);const k=hs(E,1.05),R=Math.max(8,E-1);D.forEach(S=>{const z=`${S.label}: ${S.value}`,B=r.splitTextToSize(z,P);if(r.text(B,a,I,{baseline:"top"}),I+=B.length*k,S.secondary){r.setFontSize(R);const F=r.splitTextToSize(`   ${S.secondary}`,P);r.text(F,a,I,{baseline:"top"}),I+=F.length*hs(R,1.05),r.setFontSize(E)}});const K=(e.label||(e.clutchNumber?`clutch-${e.clutchNumber}`:"clutch-card")).toString().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"clutch-card";r.save(`${K}.pdf`)}function fd({s:e,onEdit:s,onQuickPair:n,onDelete:o,groups:a=[],setSnakes:r,setQrFor:l,pairings:c=[],onOpenPairing:d,lastFeedDefaults:u,setLastFeedDefaults:m}){var U;const p=typeof s=="function",g=typeof n=="function",f=typeof o=="function",[y,j]=h.useState(!1),[w,D]=h.useState(null),[b,I]=h.useState({date:rt(new Date),notes:"",grams:0,feed:"Mouse",size:"pinky",sizeDetail:"",form:"",formDetail:"",drug:"",dose:"",refused:!1}),P=h.useRef(null),E=h.useMemo(()=>At(e==null?void 0:e.morphs,e==null?void 0:e.hets,e==null?void 0:e.possibleHets),[e==null?void 0:e.morphs,e==null?void 0:e.hets,e==null?void 0:e.possibleHets]),k=h.useMemo(()=>zt(e==null?void 0:e.sex),[e==null?void 0:e.sex]),R=h.useMemo(()=>(typeof(e==null?void 0:e.status)=="string"?e.status.trim():"")||"Active",[e==null?void 0:e.status]),O=h.useMemo(()=>{var le;return(Array.isArray((le=e==null?void 0:e.logs)==null?void 0:le.weights)?e.logs.weights:[]).map((ee,pe)=>{const Q=typeof(ee==null?void 0:ee.grams)=="number"?ee.grams:typeof(ee==null?void 0:ee.weightGrams)=="number"?ee.weightGrams:typeof(ee==null?void 0:ee.weight)=="number"?ee.weight:Number((ee==null?void 0:ee.grams)??(ee==null?void 0:ee.weightGrams)??(ee==null?void 0:ee.weight)??(ee==null?void 0:ee.value));if(!Number.isFinite(Q))return null;const se=(ee==null?void 0:ee.date)||(ee==null?void 0:ee.loggedAt)||(ee==null?void 0:ee.createdAt)||null,oe=(typeof se=="string"?ts(se):null)||(se?new Date(se):null);return!(oe instanceof Date)||Number.isNaN(oe.getTime())?null:{grams:Q,date:oe,label:je(oe)||oe.toLocaleDateString(),rawDate:se||oe.toISOString(),index:pe}}).filter(Boolean).sort((ee,pe)=>ee.date.getTime()-pe.date.getTime()).slice(-12)},[(U=e==null?void 0:e.logs)==null?void 0:U.weights]),K=h.useMemo(()=>{if(e!=null&&e.imageUrl)return e.imageUrl;if(Array.isArray(e==null?void 0:e.photos)&&e.photos.length){const A=e.photos[e.photos.length-1];return(A==null?void 0:A.url)||null}return null},[e==null?void 0:e.imageUrl,e==null?void 0:e.photos]),S=h.useMemo(()=>k!=="F"?[]:co(e==null?void 0:e.id,c),[k,e==null?void 0:e.id,c]);function z(A){if(!A)return{key:"feeds",defaults:{}};const G=String(A).toLowerCase();return G.includes("weight")?{key:"weights",defaults:{grams:0}}:G.includes("feed")||G.includes("feeding")?{key:"feeds",defaults:{feed:"Mouse",size:"pinky",grams:0}}:G.includes("shed")?{key:"sheds",defaults:{complete:!0}}:G.includes("clean")?{key:"cleanings",defaults:{deep:!1}}:G.includes("med")?{key:"meds",defaults:{drug:"",dose:""}}:{key:"feeds",defaults:{}}}function B(A,G){G&&G.stopPropagation();const ee={feeds:"Feed",weights:"Weight",cleanings:"Cleaning",sheds:"Shed",meds:"Meds"}[A]||A;try{const Q=P.current;Q&&Q.scrollIntoView({block:"nearest",behavior:"smooth"})}catch{}const pe=z(ee);pe.key==="feeds"&&u?I({date:rt(new Date),notes:u.notes||"",grams:pe.defaults.grams||0,feed:u.feed||pe.defaults.feed||"Mouse",size:u.size||pe.defaults.size||"pinky",sizeDetail:u.sizeDetail||"",form:u.form||pe.defaults.form||"",formDetail:u.formDetail||"",refused:!1,drug:pe.defaults.drug||"",dose:pe.defaults.dose||""}):I({date:rt(new Date),notes:"",grams:pe.defaults.grams||0,feed:pe.defaults.feed||"Mouse",size:pe.defaults.size||"pinky",sizeDetail:pe.defaults.sizeDetail||"",form:pe.defaults.form||"",formDetail:pe.defaults.formDetail||"",drug:pe.defaults.drug||"",dose:pe.defaults.dose||"",refused:!1}),D(ee)}function F(){D(null)}function de(A,G={}){if(!r){alert("Editing not enabled"),F();return}const le=(A||"").toLowerCase();let ee="feeds";le.includes("weight")?ee="weights":le.includes("feed")?ee="feeds":le.includes("shed")?ee="sheds":le.includes("clean")?ee="cleanings":le.includes("med")&&(ee="meds");const pe={date:b.date};ee==="weights"&&(pe.grams=Number(b.grams)||0);const Q=G.forceRefused===!0;if(ee==="feeds"&&(pe.feed=b.feed,pe.size=b.size==="Other"?b.sizeDetail||"":b.size,pe.weightGrams=Number(b.grams)||0,b.form?(pe.method=b.form==="Other"?"Other":b.form,pe.methodDetail=b.form==="Other"&&b.formDetail||""):(pe.method="Other",pe.methodDetail=""),pe.refused=Q?!0:!!b.refused),ee==="meds"&&(pe.drug=b.drug,pe.dose=b.dose),pe.notes=b.notes||"",r(se=>se.map(xe=>xe.id===e.id?{...xe,logs:{...xe.logs,[ee]:[...xe.logs[ee]||[],pe]}}:xe)),ee==="feeds"&&typeof m=="function")try{m({feed:b.feed,size:b.size,sizeDetail:b.sizeDetail||"",form:b.form,formDetail:b.formDetail||"",notes:b.notes||"",refused:!1})}catch{}F()}return t.jsxs("div",{ref:P,className:"relative bg-white border rounded-xl p-2 flex flex-col gap-1 min-h-[280px] max-h-[520px] min-w-0 text-sm",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0",children:K?t.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border ring-1 ring-white/60 shadow-sm",children:t.jsx("img",{src:K,alt:e!=null&&e.name?`${e.name} photo`:"Snake photo",className:"w-full h-full object-cover object-center",onError:A=>{A.currentTarget.style.display="none"}})}):t.jsx("div",{className:"w-12 h-12 rounded-full border bg-neutral-50 flex items-center justify-center text-[11px] text-neutral-400 text-center leading-tight px-1 ring-1 ring-white/60 shadow-sm",children:"No picture"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-medium text-base truncate",children:e.name}),t.jsx("div",{className:"text-xs font-mono text-neutral-500 mt-1 truncate",children:e.id}),t.jsx("div",{className:"text-xs text-neutral-500",children:e.birthDate?je(e.birthDate):""})]}),t.jsx("div",{className:"shrink-0",children:t.jsx(ao,{children:k==="M"?"♂":k==="F"?"♀":"•"})})]}),t.jsx("div",{className:"mt-1 space-y-1",children:E.length?t.jsx(cr,{label:"Genetics",genes:E,size:"sm"}):t.jsx("div",{className:"text-[11px] uppercase tracking-wide text-neutral-500",children:"Genetics: -"})})]})]}),t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p&&t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg",onClick:()=>s(e),children:"Edit"}),g&&t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg",onClick:()=>n(e),children:"Pair"}),t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg",onClick:()=>{typeof l=="function"&&l(e.id)},children:"QR"}),f&&t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg text-rose-600",onClick:()=>o(e),title:"Delete snake",children:"Delete"})]}),t.jsx("div",{className:"flex-1 overflow-auto",children:t.jsx("div",{className:"mt-2 grid grid-cols-2 gap-1",children:(()=>{const A=e.logs||{},G=A.feeds&&A.feeds.length?A.feeds[A.feeds.length-1]:null,le=A.weights&&A.weights.length?A.weights[A.weights.length-1]:null,ee=A.cleanings&&A.cleanings.length?A.cleanings[A.cleanings.length-1]:null,pe=A.sheds&&A.sheds.length?A.sheds[A.sheds.length-1]:null,Q=A.meds&&A.meds.length?A.meds[A.meds.length-1]:null,se=e.groups||[];return[{key:"feeds",entry:G},{key:"weights",entry:le},{key:"cleanings",entry:ee},{key:"sheds",entry:pe},{key:"meds",entry:Q},{key:"groups",groups:se}].map(oe=>{const Ae=oe.key,Oe=oe.entry&&oe.entry.date||"",Ge=Ae==="feeds"?"Feed":Ae==="weights"?"Weight":Ae==="cleanings"?"Cleaning":Ae==="sheds"?"Shed":Ae==="meds"?"Meds":"Group",W=["feeds","weights","cleanings","sheds","meds"].includes(Ae),ce=mo[Ae]||{bg:"#efefef",border:"#ddd"};return t.jsxs("div",{onClick:$=>{W&&($.stopPropagation(),B(Ae,$))},role:W?"button":void 0,className:te(W?"cursor-pointer":"","w-full px-2 py-1 text-[11px] rounded-lg border flex flex-col justify-between gap-1 min-h-[48px]"),style:{backgroundColor:ce.bg,borderColor:ce.border},children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-[10px] text-neutral-600 font-semibold uppercase",children:Ge}),t.jsx("div",{className:"text-[10px] text-neutral-600",children:je(Oe)||" "})]}),t.jsxs("div",{className:"min-w-0",children:[Ae==="feeds"?(()=>{if(!oe.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const $=oe.entry,_=($.feed||$.item||"").trim(),ue=($.size||"").trim(),me=typeof $.weightGrams=="number"&&$.weightGrams>0?`${$.weightGrams} g`:typeof $.grams=="number"&&$.grams>0?`${$.grams} g`:"",Ce=$.method?$.methodDetail?`${$.method} (${$.methodDetail})`:$.method:"";let Ne="";if(!$.refused){const $e=[];_&&$e.push(_),ue&&$e.push(ue),me&&$e.push(me),Ce&&$e.push(Ce),Ne=$e.join(" • ")}const Ee=$.refused?"Refused feed":Ne||"Feed";return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:te("truncate",$.refused?"font-semibold text-rose-600":"font-medium text-neutral-800"),children:Ee}),$.refused&&Ne?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:Ne}):null,$.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:$.notes}):null]})})():null,Ae==="weights"?(()=>{if(!oe.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const $=oe.entry;return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium",children:typeof $.grams=="number"?`${$.grams} g`:`${$.grams||""}`}),$.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:$.notes}):null]})})():null,Ae==="cleanings"?(()=>{if(!oe.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const $=oe.entry;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium",children:["Cleaning",$.deep?" • deep":""]}),$.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:$.notes}):null]})})():null,Ae==="sheds"?(()=>{if(!oe.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const $=oe.entry;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium",children:["Shed",$.complete?" • complete":""]}),$.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:$.notes}):null]})})():null,Ae==="meds"?(()=>{if(!oe.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const $=oe.entry;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium truncate",children:[$.drug," ",$.dose?`• ${$.dose}`:""]}),$.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:$.notes}):null]})})():null,Ae==="groups"?(()=>{const $=oe.groups||[];if(!$.length)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const _=$.join(", ");return _.trim().toLowerCase()==="group"?t.jsx("div",{className:"text-sm text-neutral-700",children:"—"}):t.jsx("div",{className:"font-medium truncate",children:_})})():null]})]},Ae)})})()})}),w&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 p-4",onClick:A=>{A.stopPropagation(),F()},children:t.jsxs("div",{className:"pointer-events-auto w-full max-w-md bg-white border rounded-xl shadow-2xl p-4 max-h-[90vh] overflow-y-auto",onClick:A=>A.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"text-base font-semibold",children:["Add ",w]}),t.jsx("button",{className:"text-sm px-2 py-1 border rounded-lg text-neutral-500 hover:text-neutral-700",onClick:A=>{A.stopPropagation(),F()},children:"Close"})]}),t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Date"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",type:"date",value:b.date,onChange:A=>I(G=>({...G,date:A.target.value}))})]}),w.toLowerCase().includes("feed")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Feed type"}),t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:b.feed||"",onChange:A=>I(G=>({...G,feed:A.target.value,size:A.target.value==="Mouse"||A.target.value==="Rat"?G.size||"pinky":""})),children:[t.jsx("option",{value:"Mouse",children:"Mouse"}),t.jsx("option",{value:"Rat",children:"Rat"}),t.jsx("option",{value:"Chick",children:"Chick"}),t.jsx("option",{value:"Other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Size"}),b.feed==="Mouse"||b.feed==="Rat"?t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:b.size||"",onChange:A=>I(G=>({...G,size:A.target.value})),children:[t.jsx("option",{value:"pinky",children:"pinky"}),t.jsx("option",{value:"fuzzy",children:"fuzzy"}),t.jsx("option",{value:"medium",children:"medium"}),t.jsx("option",{value:"adult",children:"adult"}),t.jsx("option",{value:"Other",children:"Other"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:b.size||"",onChange:A=>I(G=>({...G,size:A.target.value})),children:[t.jsx("option",{value:"",children:"Select"}),t.jsx("option",{value:"Other",children:"Other"})]}),b.size==="Other"&&t.jsx("input",{className:"mt-2 w-full px-2 py-1 border rounded",placeholder:"Custom size",value:b.sizeDetail||"",onChange:A=>I(G=>({...G,sizeDetail:A.target.value}))})]}),b.size==="Other"&&b.feed!=="Mouse"&&b.feed!=="Rat"&&t.jsx("input",{className:"mt-2 w-full px-2 py-1 border rounded",placeholder:"Custom size",value:b.sizeDetail||"",onChange:A=>I(G=>({...G,sizeDetail:A.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Weight (g)"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",type:"number",value:b.grams,onChange:A=>I(G=>({...G,grams:A.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Form"}),t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:b.form||"",onChange:A=>I(G=>({...G,form:A.target.value})),children:[t.jsx("option",{value:"",children:"Select"}),t.jsx("option",{value:"Live",children:"Live"}),t.jsx("option",{value:"Freshly killed",children:"Freshly killed"}),t.jsx("option",{value:"Frozen/thawed",children:"Frozen/thawed"}),t.jsx("option",{value:"Other",children:"Other"})]}),b.form==="Other"&&t.jsx("input",{className:"mt-2 w-full px-2 py-1 border rounded",placeholder:"Method details",value:b.formDetail||"",onChange:A=>I(G=>({...G,formDetail:A.target.value}))})]})]}),w.toLowerCase().includes("weight")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Grams"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",type:"number",value:b.grams,onChange:A=>I(G=>({...G,grams:A.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Recent progress"}),t.jsx(xd,{data:O})]})]}),w.toLowerCase().includes("med")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Drug"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",value:b.drug,onChange:A=>I(G=>({...G,drug:A.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Dose"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",value:b.dose,onChange:A=>I(G=>({...G,dose:A.target.value}))})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Notes"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",value:b.notes,onChange:A=>I(G=>({...G,notes:A.target.value}))})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"px-2 py-1 border rounded",onClick:A=>{A.stopPropagation(),F()},children:"Cancel"}),t.jsx("button",{className:"px-2 py-1 border rounded text-rose-600",onClick:A=>{A.stopPropagation(),de(w,{forceRefused:!0})},children:"Refused feed"}),t.jsx("button",{className:"px-2 py-1 bg-emerald-500 text-white rounded",onClick:A=>{A.stopPropagation(),de(w)},children:"Add"})]})]})]})}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Assign group"}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[a.map(A=>t.jsxs("label",{className:"inline-flex items-center gap-1 px-2 py-0.5 border rounded-lg bg-white text-[11px] min-w-0",children:[t.jsx("input",{type:"radio",name:`group-${e.id}`,className:"w-3 h-3",checked:(e.groups||[]).includes(A),onChange:()=>{r&&r(G=>G.map(le=>le.id===e.id?{...le,groups:[A]}:le))}}),t.jsx("span",{className:"truncate max-w-[8rem]",children:A})]},A)),t.jsxs("label",{className:"inline-flex items-center gap-1 px-2 py-0.5 border rounded-lg bg-white text-[11px]",children:[t.jsx("input",{type:"radio",name:`group-${e.id}`,className:"w-3 h-3",checked:!(e.groups||[]).length,onChange:()=>{r&&r(A=>A.map(G=>G.id===e.id?{...G,groups:[]}:G))}}),t.jsx("span",{children:"None"})]})]})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsx(bd,{status:R}),t.jsx("div",{className:"text-xs",children:R})]}),k==="F"&&S.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Breeding cycles"}),t.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-auto pr-1",children:S.map(A=>t.jsxs("div",{className:"rounded-lg border bg-neutral-50 p-2 space-y-1",children:[t.jsx("div",{className:"text-[10px] font-semibold uppercase text-neutral-500",children:A.year}),A.cycles.map(G=>{var le;return t.jsxs("div",{className:"rounded-lg border bg-white px-2 py-1 text-[11px] space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("div",{className:"font-medium truncate",children:G.label}),d&&G.id&&t.jsx("button",{className:"text-[10px] px-1.5 py-0.5 border rounded-lg",onClick:()=>d(G.id),children:"Open"})]}),t.jsxs("div",{className:"space-y-0.5 text-neutral-700",children:[G.locks&&G.locks.length?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Locks:"})," ",t.jsx("span",{children:G.locks.map(ee=>ee.display||xt(ee.iso)).filter(Boolean).join(", ")})]}):null,G.ovulationDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Ovulation:"})," ",t.jsx("span",{children:je(G.ovulationDate)})]}):null,G.preLayDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Pre-Lay Shed:"})," ",t.jsx("span",{children:je(G.preLayDate)})]}):null,G.clutchDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Eggs laid:"})," ",t.jsx("span",{children:je(G.clutchDate)})]}):null,G.hatchDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Hatched:"})," ",t.jsx("span",{children:je(G.hatchDate)})]}):null,!((le=G.locks)!=null&&le.length)&&!G.ovulationDate&&!G.preLayDate&&!G.clutchDate&&!G.hatchDate?t.jsx("div",{className:"text-neutral-500",children:"No cycle events recorded."}):null]})]},G.id)})]},A.year))})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Pairings"}),(()=>{const A=c.filter(le=>le.maleId===e.id||le.femaleId===e.id),G=A.slice(0,3);return t.jsxs("div",{className:"flex flex-col gap-1 max-h-36 overflow-auto",children:[G.map(le=>t.jsxs("button",{className:"text-sm text-left px-2 py-1 rounded-lg border hover:bg-neutral-50 min-w-0",onClick:()=>d?d(le.id):null,children:[t.jsx("div",{className:"font-medium truncate",children:le.label||`${le.femaleId} × ${le.maleId}`}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Start: ",le.startDate?je(le.startDate):"—"]})]},le.id)),A.length===0&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No pairings"}),A.length>3&&t.jsxs("button",{className:"text-xs mt-1 px-2 py-1 border rounded-lg text-neutral-700",onClick:()=>j(!0),children:["+",A.length-3," more"]})]})})()]}),y&&t.jsx(gd,{snake:e,pairings:c.filter(A=>A.maleId===e.id||A.femaleId===e.id),onClose:()=>j(!1),onOpenPairing:A=>{j(!1),d&&d(A)}})]})}function xd({data:e=[]}){const s="#0ea5e9",a={top:18,right:28,bottom:32,left:42},r=320-a.left-a.right,l=140-a.top-a.bottom,c=h.useMemo(()=>`weight-gradient-${Math.random().toString(36).slice(2,8)}`,[]);if(!Array.isArray(e)||e.length===0)return t.jsx("div",{className:"mt-2 border rounded-lg bg-neutral-50 px-3 py-4 text-xs text-neutral-500",children:"No weight history yet. Log a weight to start tracking progress."});const d=e.map(E=>E.grams),u=Math.min(...d),p=Math.max(...d)-u||1,g=a.top+l,f=E=>new Intl.NumberFormat(void 0,{maximumFractionDigits:1}).format(E),y=e.map((E,k)=>{const R=e.length===1?.5:k/(e.length-1),O=a.left+r*R,K=a.top+l-(E.grams-u)/p*l;return{x:O,y:K,grams:E.grams,label:E.label||""}}),j=y.map((E,k)=>`${k===0?"M":"L"}${E.x.toFixed(2)} ${E.y.toFixed(2)}`).join(" "),w=y.length>1?`${j} L${y[y.length-1].x.toFixed(2)} ${g.toFixed(2)} L${y[0].x.toFixed(2)} ${g.toFixed(2)} Z`:null,D=y[y.length-1],b=y[0],I=D.grams-b.grams,P=`${I>=0?"+":""}${f(I)} g`;return t.jsxs("div",{className:"mt-2 border rounded-lg bg-neutral-50 p-3",children:[t.jsxs("svg",{viewBox:"0 0 320 140",role:"img","aria-label":"Weight trend chart",className:"w-full h-32",children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:c,x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:s,stopOpacity:"0.28"}),t.jsx("stop",{offset:"100%",stopColor:s,stopOpacity:"0"})]})}),t.jsx("rect",{x:a.left,y:a.top,width:r,height:l,fill:"#f8fafc",rx:12}),t.jsx("line",{x1:a.left,y1:g,x2:a.left+r,y2:g,stroke:"#e2e8f0",strokeDasharray:"4 4"}),w?t.jsx("path",{d:w,fill:`url(#${c})`}):null,t.jsx("path",{d:j,fill:"none",stroke:s,strokeWidth:2.5,strokeLinejoin:"round",strokeLinecap:"round"}),y.map((E,k)=>t.jsx("circle",{cx:E.x,cy:E.y,r:4,fill:"#fff",stroke:s,strokeWidth:2},`weight-point-${k}`))]}),t.jsxs("div",{className:"mt-2 text-[11px] text-neutral-600 grid grid-cols-2 gap-y-1",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-700",children:"Latest:"})," ",f(D.grams)," g"]}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"font-semibold text-neutral-700",children:"Change:"})," ",P]}),t.jsx("div",{className:"col-span-2 text-neutral-500",children:y.length>1?`From ${b.label} to ${D.label}`:`Logged on ${D.label}`})]}),y.length>1&&t.jsxs("div",{className:"mt-1 flex justify-between text-[10px] uppercase tracking-wide text-neutral-400",children:[t.jsx("span",{children:e[0].label}),t.jsx("span",{children:e[e.length-1].label})]})]})}function gd({snake:e,pairings:s,onClose:n,onOpenPairing:o}){return t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",onClick:n,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow w-full max-w-md",onClick:a=>a.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:["Pairings for ",e.name]}),t.jsx("div",{className:"text-xs text-neutral-500",children:"Click a pairing to open it."})]}),t.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:n,children:"Close"})]}),t.jsx("div",{className:"mt-3 space-y-2 max-h-72 overflow-auto",children:s.length?s.map(a=>t.jsxs("div",{className:"p-2 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-medium truncate",children:a.label}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Start: ",a.startDate?je(a.startDate):"—"]})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>o&&o(a.id),children:"Open"})})]}),t.jsxs("div",{className:"mt-2 text-xs",children:["Appointments:",t.jsx("div",{className:"mt-1 space-y-1",children:(a.appointments||[]).map(r=>t.jsxs("div",{className:"text-[11px] px-2 py-1 rounded border bg-neutral-50",children:[je(r.date)," ",r.notes?`• ${r.notes}`:""]},r.id))})]})]},a.id)):t.jsx("div",{className:"text-sm text-neutral-500",children:"No pairings"})})]})})}function bd({status:e}){const s=e==="Active"?"bg-emerald-500":e==="Hold"?"bg-amber-500":"bg-rose-500";return t.jsx("span",{className:te("inline-block w-2 h-2 rounded-full",s)})}function yd(e,s,n){const o=String(s||"").trim().toLowerCase(),a=o?o.split(/\s+/).filter(Boolean):[],r=String(n).trim().toLowerCase();return e.filter(l=>{if(!l||r!=="all"&&!(Array.isArray(l.tags)?l.tags:[]).some(m=>String(m||"").trim().toLowerCase()===r))return!1;if(!a.length)return!0;const c=At(l.morphs,l.hets,l.possibleHets),d=[l.id,l.name,...Array.isArray(c)?c:[],l.morphHetInput,...Array.isArray(l.morphs)?l.morphs:[],...Array.isArray(l.hets)?l.hets:[],...Array.isArray(l.tags)?l.tags:[],...Array.isArray(l.groups)?l.groups:[]].map(u=>String(u||"").trim().toLowerCase()).filter(Boolean);return d.length?a.every(u=>d.some(m=>m.includes(u))):!1})}function lo({onAdd:e}){const[s,n]=h.useState("");return t.jsxs("div",{className:"flex gap-2 px-2",children:[t.jsx("input",{className:"flex-1 border rounded-lg px-2 py-1 text-sm",placeholder:"Add new group",value:s,onChange:o=>n(o.target.value)}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const o=s.trim();o&&(e(o),n(""))},children:"Add"})]})}function Nd({breederInfo:e,setBreederInfo:s,theme:n="blue",onSaved:o,createBackupPayload:a,onRestoreBackup:r,backupSettings:l,updateBackupSettings:c,autoBackupSnapshot:d,onTriggerAutoBackup:u,backupVault:m,onCreateVaultEntry:p,onRenameVaultEntry:g,onDeleteVaultEntry:f,snakes:y,pairings:j,animalExportFields:w,setAnimalExportFields:D,pairingExportFields:b,setPairingExportFields:I,exportFeedback:P,setExportFeedback:E}){const k=us(e),R=h.useMemo(()=>Ms(k.idGenerator),[k.idGenerator]),O=h.useCallback(C=>{s(T=>{const q=us(T),ye=typeof C=="function"?C(q):C;return us(ye)})},[s]),K=h.useCallback(C=>{O(T=>{const q={...T.idGenerator,...C||{}};return{...T,idGenerator:Ms(q)}})},[O]),S=h.useCallback(()=>{O(C=>({...C,idGenerator:or()}))},[O]),z=h.useCallback(C=>{const T=R.template||"",q=C==="[-]"?"[-]":C,ye=re.current,Le=(ft,St)=>{we.current={start:ft,end:St}};if(C!=="[-]"&&T.includes(q)){const ft=T.indexOf(q);if(ft===-1)return;const St=`${T.slice(0,ft)}${T.slice(ft+q.length)}`;X.current={start:ft,end:ft,focus:!0},Le(ft,ft),K({template:St});return}let Ze=T.length,st=T.length;if(ye&&typeof ye.selectionStart=="number"&&typeof ye.selectionEnd=="number")Ze=ye.selectionStart,st=ye.selectionEnd;else if(we.current){const{start:ft,end:St}=we.current;typeof ft=="number"&&typeof St=="number"&&(Ze=ft,st=St)}const lt=`${T.slice(0,Ze)}${q}${T.slice(st)}`,bt=Ze+q.length;X.current={start:bt,end:bt,focus:!0},Le(bt,bt),K({template:lt})},[R.template,K]),B=h.useCallback(()=>{const C=re.current;if(!C)return;const T=typeof C.selectionStart=="number"?C.selectionStart:C.value.length,q=typeof C.selectionEnd=="number"?C.selectionEnd:T;we.current={start:T,end:q}},[]),[F,de]=h.useState("info"),[U,A]=h.useState(null),[G,le]=h.useState(null),ee=h.useRef(null),pe=h.useRef(null),Q=h.useMemo(()=>ls(l),[l]),se=h.useMemo(()=>Array.isArray(m)?m:[],[m]),xe=h.useMemo(()=>Cs(w,Ds,is),[w]),oe=h.useMemo(()=>Cs(b,Es,cs),[b]),Ae=h.useMemo(()=>oa(is),[]),Oe=h.useMemo(()=>oa(cs),[]),Ge=h.useMemo(()=>new Set(xe),[xe]),W=h.useMemo(()=>new Set(oe),[oe]),ce=typeof Q.maxVaultEntries=="number"&&Q.maxVaultEntries>0?String(Q.maxVaultEntries):"unlimited",$=Q.maxVaultEntries?`Keeping the latest ${Q.maxVaultEntries} backups. Oldest entries are pruned automatically.`:"Keeping all backups (no limit).",_=h.useMemo(()=>{if(!d||typeof d!="object")return null;const C=d.payload||{};return{snakes:Array.isArray(C.snakes)?C.snakes.length:0,pairings:Array.isArray(C.pairings)?C.pairings.length:0,groups:Array.isArray(C.groups)?C.groups.length:0}},[d]),ue=Q.lastRun?xt(Q.lastRun):"Never",me=(U==null?void 0:U.context)==="manual"?U:null,Ce=U&&typeof U.context=="string"&&U.context.startsWith("auto")?U:null,Ne=U&&typeof U.context=="string"&&U.context.startsWith("vault")?U:null,Ee=P&&P.context==="animals"?P:null,$e=P&&P.context==="pairings"?P:null,Pe=Array.isArray(y)&&y.length>0,ae=Array.isArray(j)&&j.length>0,[H,J]=h.useState(()=>k.name||k.businessName||_s.name),[ge,Se]=h.useState(()=>_s.year),[Be,He]=h.useState(()=>_s.birthYear),[Qe,ve]=h.useState(_s.sex),[pt,fe]=h.useState(1),[De,M]=h.useState(()=>_s.genes||""),re=h.useRef(null),X=h.useRef(null),we=h.useRef({start:null,end:null}),Ie=h.useCallback(()=>{if(typeof a!="function"){A({type:"error",message:"Backup export is unavailable.",context:"manual",timestamp:new Date().toISOString()});return}try{const C=a(),T=JSON.stringify(C,null,2),q=new Date().toISOString(),ye=q.replace(/[:.]/g,"-");if(typeof window>"u"||typeof document>"u")throw new Error("Downloads are not supported in this environment.");const Le=Mn("breeding-planner-backup",ye),Ze=new Blob([T],{type:$s}),st=URL.createObjectURL(Ze),lt=document.createElement("a");lt.href=st,lt.download=Le,document.body.appendChild(lt),lt.click(),document.body.removeChild(lt),window.setTimeout(()=>URL.revokeObjectURL(st),1e3),A({type:"success",message:`Backup downloaded (${Array.isArray(C.snakes)?C.snakes.length:0} snakes, ${Array.isArray(C.pairings)?C.pairings.length:0} pairings).`,context:"manual",timestamp:q})}catch(C){console.error(C),A({type:"error",message:(C==null?void 0:C.message)||"Unable to download backup.",context:"manual",timestamp:new Date().toISOString()})}},[a]),ie=h.useCallback(()=>{if(typeof a!="function"||typeof p!="function"){A({type:"error",message:"Backup vault is unavailable.",context:"vault",timestamp:new Date().toISOString()});return}try{const C=a(),T=new Date().toISOString();let q=`Manual backup • ${xt(T)}`;if(typeof window<"u"&&typeof window.prompt=="function"){const Le=window.prompt("Name this backup file",q);Le&&Le.trim()&&(q=Le.trim())}const ye=p(C,{source:"manual",name:q,savedAt:T});A({type:ye?"success":"error",message:ye?`Saved “${ye.name}” to the backup vault.`:"Failed to save backup to the vault.",context:"vault",timestamp:T})}catch(C){console.error(C),A({type:"error",message:(C==null?void 0:C.message)||"Unable to save the backup to the vault.",context:"vault",timestamp:new Date().toISOString()})}},[a,p]),Ke=h.useCallback(()=>{if(!d||!d.payload){A({type:"error",message:"No automatic backup is available yet.",context:"auto-download",timestamp:new Date().toISOString()});return}try{if(typeof window>"u"||typeof document>"u")throw new Error("Downloads are not supported in this environment.");const C=d.payload,T=JSON.stringify(C,null,2),ye=(d.savedAt||new Date().toISOString()).replace(/[:.]/g,"-"),Le=Mn("breeding-planner-auto-backup",ye),Ze=new Blob([T],{type:$s}),st=URL.createObjectURL(Ze),lt=document.createElement("a");lt.href=st,lt.download=Le,document.body.appendChild(lt),lt.click(),document.body.removeChild(lt),window.setTimeout(()=>URL.revokeObjectURL(st),1e3),A({type:"success",message:"Latest automatic backup downloaded.",context:"auto-download",timestamp:new Date().toISOString()})}catch(C){console.error(C),A({type:"error",message:(C==null?void 0:C.message)||"Unable to download the automatic backup.",context:"auto-download",timestamp:new Date().toISOString()})}},[d]),Re=h.useCallback(C=>{D(T=>{const q=Cs(T,Ds,is);return C?q.includes(C)?q.length<=1?q:q.filter(Le=>Le!==C):[...q,C]:q})},[D]),Ve=h.useCallback(()=>{D(is.map(C=>C.key))},[D]),Ue=h.useCallback(()=>{D([...Ds])},[D]),Xe=h.useCallback(C=>{I(T=>{const q=Cs(T,Es,cs);return C?q.includes(C)?q.length<=1?q:q.filter(Le=>Le!==C):[...q,C]:q})},[I]),ct=h.useCallback(()=>{I(cs.map(C=>C.key))},[I]),mt=h.useCallback(()=>{I([...Es])},[I]),ut=h.useCallback(async()=>{const C=new Date().toISOString();try{const T=sa(y,j,xe);if(!T.columns.length)throw new Error("Select at least one field before exporting.");if(!T.rows.length)throw new Error("No animals available to export.");const q=C.replace(/[:.]/g,"-");await ra(T,{title:"Animals export",subtitle:`${T.rows.length} animals • ${T.columns.length} fields`,fileName:`animals-export-${q}.pdf`}),E({type:"success",message:`Exported ${T.rows.length} animals to PDF.`,context:"animals",timestamp:new Date().toISOString()})}catch(T){console.error("Animals PDF export failed",T),E({type:"error",message:(T==null?void 0:T.message)||"Failed to export animals to PDF.",context:"animals",timestamp:new Date().toISOString()})}},[y,j,xe,E]),We=h.useCallback(async()=>{const C=new Date().toISOString();try{const T=sa(y,j,xe);if(!T.columns.length)throw new Error("Select at least one field before exporting.");if(!T.rows.length)throw new Error("No animals available to export.");const q=C.replace(/[:.]/g,"-");await aa(T,{fileName:`animals-export-${q}.xlsx`,sheetName:"Animals"}),E({type:"success",message:`Exported ${T.rows.length} animals to spreadsheet.`,context:"animals",timestamp:new Date().toISOString()})}catch(T){console.error("Animals sheet export failed",T),E({type:"error",message:(T==null?void 0:T.message)||"Failed to export animals to spreadsheet.",context:"animals",timestamp:new Date().toISOString()})}},[y,j,xe,E]),qe=h.useCallback(async()=>{const C=new Date().toISOString();try{const T=na(j,y,oe);if(!T.columns.length)throw new Error("Select at least one field before exporting.");if(!T.rows.length)throw new Error("No breeding projects available to export.");const q=C.replace(/[:.]/g,"-");await ra(T,{title:"Breeding projects export",subtitle:`${T.rows.length} projects • ${T.columns.length} fields`,fileName:`pairings-export-${q}.pdf`}),E({type:"success",message:`Exported ${T.rows.length} projects to PDF.`,context:"pairings",timestamp:new Date().toISOString()})}catch(T){console.error("Pairings PDF export failed",T),E({type:"error",message:(T==null?void 0:T.message)||"Failed to export breeding projects to PDF.",context:"pairings",timestamp:new Date().toISOString()})}},[j,y,oe,E]),at=h.useCallback(async()=>{const C=new Date().toISOString();try{const T=na(j,y,oe);if(!T.columns.length)throw new Error("Select at least one field before exporting.");if(!T.rows.length)throw new Error("No breeding projects available to export.");const q=C.replace(/[:.]/g,"-");await aa(T,{fileName:`pairings-export-${q}.xlsx`,sheetName:"Pairings"}),E({type:"success",message:`Exported ${T.rows.length} projects to spreadsheet.`,context:"pairings",timestamp:new Date().toISOString()})}catch(T){console.error("Pairings sheet export failed",T),E({type:"error",message:(T==null?void 0:T.message)||"Failed to export breeding projects to spreadsheet.",context:"pairings",timestamp:new Date().toISOString()})}},[j,y,oe,E]),_e=h.useCallback(C=>{var q;const T=((q=C==null?void 0:C.target)==null?void 0:q.value)||"off";typeof c=="function"&&c({frequency:T})},[c]),ot=h.useCallback(C=>{var ye;if(typeof c!="function")return;const T=(ye=C==null?void 0:C.target)==null?void 0:ye.value;if(T==="unlimited"){c({maxVaultEntries:"unlimited"});return}const q=parseInt(T,10);Number.isFinite(q)&&q>0&&c({maxVaultEntries:q})},[c]),Ft=h.useCallback(()=>{if(typeof u!="function"){A({type:"error",message:"Automatic backup is unavailable.",context:"auto",timestamp:new Date().toISOString()});return}try{u(),A({type:"success",message:"Automatic backup created.",context:"auto",timestamp:new Date().toISOString()})}catch(C){console.error(C),A({type:"error",message:(C==null?void 0:C.message)||"Automatic backup failed.",context:"auto",timestamp:new Date().toISOString()})}},[u]),jt=h.useCallback(C=>{const T=se.find(q=>q.id===C);if(!T){A({type:"error",message:"Backup file not found.",context:"vault-download",timestamp:new Date().toISOString()});return}try{if(typeof window>"u"||typeof document>"u")throw new Error("Downloads are not supported in this environment.");const q=JSON.stringify(T.payload,null,2),Le=T.name.replace(/[\\/:*?"<>|]+/g,"-")||"breeding-planner-backup",Ze=Mn(Le,T.id),st=new Blob([q],{type:$s}),lt=URL.createObjectURL(st),bt=document.createElement("a");bt.href=lt,bt.download=Ze,document.body.appendChild(bt),bt.click(),document.body.removeChild(bt),window.setTimeout(()=>URL.revokeObjectURL(lt),1e3),A({type:"success",message:`Downloaded “${T.name}”.`,context:"vault-download",timestamp:new Date().toISOString()})}catch(q){console.error(q),A({type:"error",message:(q==null?void 0:q.message)||"Unable to download the backup.",context:"vault-download",timestamp:new Date().toISOString()})}},[se]),Ct=h.useCallback(C=>{const T=se.find(q=>q.id===C);if(!T){le({type:"error",message:"Backup file not found.",timestamp:new Date().toISOString()});return}try{if(typeof r!="function")throw new Error("Restore handler is unavailable.");r(T.payload),le({type:"success",message:`Restored data from “${T.name}”.`,timestamp:new Date().toISOString()})}catch(q){console.error(q),le({type:"error",message:(q==null?void 0:q.message)||"Failed to restore backup.",timestamp:new Date().toISOString()})}},[se,r]),ke=h.useCallback(C=>{if(typeof g!="function")return;const T=se.find(q=>q.id===C);if(T&&typeof window<"u"&&typeof window.prompt=="function"){const q=window.prompt("Rename backup",T.name);q&&q.trim()&&(g(C,q.trim()),A({type:"success",message:`Renamed backup to “${q.trim()}”.`,context:"vault-rename",timestamp:new Date().toISOString()}))}},[g,se]),yt=h.useCallback(C=>{if(typeof f!="function")return;const T=se.find(ye=>ye.id===C);if(!T)return;let q=!0;typeof window<"u"&&typeof window.confirm=="function"&&(q=window.confirm(`Delete “${T.name}”? This cannot be undone.`)),q&&(f(C),A({type:"success",message:`Deleted “${T.name}”.`,context:"vault-delete",timestamp:new Date().toISOString()}))},[f,se]),Ye=h.useCallback(async C=>{var q,ye,Le,Ze;const T=(ye=(q=C==null?void 0:C.target)==null?void 0:q.files)==null?void 0:ye[0];if(T)try{const st=((Ze=(Le=C==null?void 0:C.target)==null?void 0:Le.dataset)==null?void 0:Ze.allowLegacyJson)==="true",lt=typeof T.name=="string"?T.name:"",bt=lt.toLowerCase(),ft=!!lt&&bt.endsWith(js),St=!!lt&&bt.endsWith(".json");if(!ft&&(!st||!St))throw new Error(`Select a ${js} backup${st?" or legacy .json file":""}.`);if(T.type){const et=T.type.toLowerCase(),Bt=[$s,"application/octet-stream"],ns=["application/json","text/json","application/octet-stream"];if(ft&&!Bt.includes(et))throw new Error("Unsupported backup file type.");if(!ft&&st&&St&&!ns.includes(et))throw new Error("Unsupported legacy backup file type.")}const bn=await T.text(),Gt=JSON.parse(bn);if(typeof r!="function")throw new Error("Restore handler is unavailable.");await Promise.resolve(r(Gt)),le({type:"success",message:`Restored data from ${T.name}`,timestamp:new Date().toISOString()})}catch(st){console.error(st),le({type:"error",message:(st==null?void 0:st.message)||"Failed to restore backup.",timestamp:new Date().toISOString()})}finally{C!=null&&C.target&&(C.target.value="")}},[r]);h.useEffect(()=>{const C=k.name||k.businessName;C&&!H&&J(C)},[k.name,k.businessName,H]),h.useEffect(()=>{var q;const C=X.current;if(!C)return;const T=re.current;if(T)try{C.focus&&T.focus();const ye=((q=T.value)==null?void 0:q.length)??0,Le=Math.max(0,Math.min(C.start??ye,ye)),Ze=Math.max(0,Math.min(C.end??ye,ye));T.setSelectionRange(Le,Ze),we.current={start:Le,end:Ze}}catch{}X.current=null},[R.template]);const Ht=h.useMemo(()=>{try{const C=Number(ge),T=Number.isFinite(C)&&C>0?C:new Date().getFullYear(),q=Number(Be),ye=Number.isFinite(q)&&q>0?q:T,Le=Number(pt),Ze=Number.isFinite(Le)&&Le>0?Le:1,st=Ss(De),lt=st.morphs||[],bt=st.hets||[],ft=so({name:H,rawName:H,morphs:lt,hets:bt,year:T,sex:Qe,birthYear:ye});return no(R,ft,Ze)}catch{return"Template error"}},[R,H,ge,Be,Qe,pt,De]);return t.jsxs(Vs,{title:"Setup",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[t.jsx(vt,{theme:n,active:F==="info",onClick:()=>de("info"),children:"Breeder info"}),t.jsx(vt,{theme:n,active:F==="id",onClick:()=>de("id"),children:"ID wizard"}),t.jsx(vt,{theme:n,active:F==="export",onClick:()=>de("export"),children:"Data exports"}),t.jsx(vt,{theme:n,active:F==="backup",onClick:()=>de("backup"),children:"Backups"})]}),F==="info"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:k.name,onChange:C=>O(T=>({...T,name:C.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Business name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:k.businessName,onChange:C=>O(T=>({...T,businessName:C.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Email"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:k.email,onChange:C=>O(T=>({...T,email:C.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Phone"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:k.phone,onChange:C=>O(T=>({...T,phone:C.target.value}))})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Logo"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("input",{id:"breeder-logo-upload",type:"file",accept:"image/*",className:"hidden",onChange:async C=>{const T=C.target.files&&C.target.files[0];if(T)try{const q=await Ja(T);O(ye=>({...ye,logoUrl:q}))}catch(q){console.error(q)}}}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:()=>{const C=document.getElementById("breeder-logo-upload");C&&C.click()},children:"Upload logo"}),k.logoUrl&&t.jsx("img",{src:k.logoUrl,alt:"logo",className:"w-20 h-20 object-cover rounded-md border"})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{className:te("px-3 py-2 rounded-lg text-white",Fe(n,!0)),onClick:()=>{alert("Breeder info saved locally for this demo"),typeof o=="function"&&o()},children:"Save"})})]}),F==="id"&&t.jsxs("div",{className:"border-t pt-4 space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"ID generator wizard"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Define how automatic IDs are created when you add animals, generate hatchlings, or import data."})]}),t.jsx("button",{type:"button",className:"text-xs px-2 py-1 border rounded-lg",onClick:S,children:"Reset to default"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Template"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2 font-mono text-sm",ref:re,value:R.template,onChange:C=>{K({template:C.target.value}),B()},onSelect:B,onKeyUp:B,onClick:B,onFocus:B,onBlur:B,placeholder:xn.template}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Use tokens such as ",t.jsx("code",{children:"[YROB]"}),", ",t.jsx("code",{children:"[GEN3]"}),", ",t.jsx("code",{children:"[SEX]"}),", and ",t.jsx("code",{children:"[SEQ]"}),". The sequence token is required—well append it automatically if you omit it."]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sequence padding"}),t.jsx("input",{type:"number",min:1,max:6,className:"mt-1 w-full border rounded-xl px-3 py-2",value:R.sequencePadding,onChange:C=>K({sequencePadding:parseInt(C.target.value,10)||1})}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"Pads the [SEQ] number (e.g., 001)."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Letter casing"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:R.uppercase,onChange:C=>K({uppercase:C.target.checked})}),t.jsx("span",{className:"text-sm",children:"Force uppercase output"})]}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Uncheck to keep mixed case like ",t.jsx("em",{children:"Ath"}),"."]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Free text token value"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:R.customText,onChange:C=>K({customText:C.target.value}),placeholder:"BREED"}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Rendered wherever ",t.jsx("code",{children:"[TEXT]"})," appears in your template."]})]})]}),t.jsxs("div",{className:"border rounded-xl bg-neutral-50 p-4 space-y-3",children:[t.jsx("div",{className:"font-medium text-sm",children:"Live preview"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sample name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:H,onChange:C=>J(C.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Year"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-3 py-2",value:ge,onChange:C=>Se(C.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth year"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-3 py-2",value:Be,onChange:C=>He(C.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",value:Qe,onChange:C=>ve(C.target.value),children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sequence"}),t.jsx("input",{type:"number",min:1,className:"mt-1 w-full border rounded-xl px-3 py-2",value:pt,onChange:C=>fe(C.target.value)})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Sample genes"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:De,onChange:C=>M(C.target.value),placeholder:"Enchi, Fire, Clown"}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"Comma, slash, or newline separated list. Each gene contributes a three-letter chunk."})]})]}),t.jsxs("div",{className:"text-sm",children:["Example ID: ",t.jsx("code",{className:"font-mono text-base font-semibold",children:Ht})]})]}),t.jsxs("div",{className:"space-y-1 text-[11px] text-neutral-600",children:[t.jsx("div",{className:"font-semibold text-neutral-700",children:"Available tokens"}),t.jsx("div",{className:"space-y-1.5",children:jc.map(({token:C,description:T})=>{const q=C,ye=(R.template||"").includes(q);return t.jsxs("button",{type:"button","aria-pressed":ye,onClick:()=>z(C),className:te("w-full flex items-center gap-3 rounded-lg border px-2 py-1.5 text-left transition",ye?"border-blue-500/60 bg-blue-50 text-blue-700 shadow-sm":"border-neutral-200 bg-white hover:border-blue-400 hover:bg-blue-50/40"),children:[t.jsx("span",{className:te("font-mono text-[10px] px-1.5 py-0.5 rounded border",ye?"border-blue-400 bg-white text-blue-700":"border-neutral-200 bg-neutral-50 text-neutral-700"),children:C}),t.jsx("span",{className:"flex-1 text-[11px] sm:text-xs text-neutral-600",children:T}),t.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:ye?"Remove":"Add"})]},C)})})]})]}),F==="export"&&t.jsx("div",{className:"border-t pt-4 space-y-6",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Data exports"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Choose the columns to include and download PDF or spreadsheet summaries for animals and breeding projects."})]}),t.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[t.jsxs("div",{className:"border rounded-xl bg-white p-3 shadow-sm space-y-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Animals"}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Selected ",xe.length," of ",is.length," fields."]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm text-white",Fe(n,!0),Pe?"":"opacity-60 cursor-not-allowed"),onClick:ut,disabled:!Pe,children:"Export PDF"}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm border",Pe?"":"opacity-60 cursor-not-allowed"),onClick:We,disabled:!Pe,children:"Export sheet (.xlsx)"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-neutral-500",children:[t.jsx("button",{type:"button",className:"underline",onClick:Ve,children:"Select all"}),t.jsx("button",{type:"button",className:"underline",onClick:Ue,children:"Reset defaults"})]}),t.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:Ae.map(C=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500",children:C.section}),t.jsx("div",{className:"space-y-1.5",children:C.fields.map(T=>{const q=Ge.has(T.key);return t.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-700",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-neutral-300",checked:q,onChange:()=>Re(T.key)}),t.jsx("span",{children:T.label})]},T.key)})})]},C.section))}),!Pe&&t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Add animals to enable exports."}),Ee&&t.jsxs("div",{className:te("text-xs",Ee.type==="success"?"text-emerald-600":"text-red-600"),children:[Ee.message,Ee.timestamp?` • ${xt(Ee.timestamp)}`:""]})]}),t.jsxs("div",{className:"border rounded-xl bg-white p-3 shadow-sm space-y-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Breeding projects"}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Selected ",oe.length," of ",cs.length," fields."]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm text-white",Fe(n,!0),ae?"":"opacity-60 cursor-not-allowed"),onClick:qe,disabled:!ae,children:"Export PDF"}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm border",ae?"":"opacity-60 cursor-not-allowed"),onClick:at,disabled:!ae,children:"Export sheet (.xlsx)"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-neutral-500",children:[t.jsx("button",{type:"button",className:"underline",onClick:ct,children:"Select all"}),t.jsx("button",{type:"button",className:"underline",onClick:mt,children:"Reset defaults"})]}),t.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:Oe.map(C=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500",children:C.section}),t.jsx("div",{className:"space-y-1.5",children:C.fields.map(T=>{const q=W.has(T.key);return t.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-700",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-neutral-300",checked:q,onChange:()=>Xe(T.key)}),t.jsx("span",{children:T.label})]},T.key)})})]},C.section))}),!ae&&t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Build at least one pairing to enable exports."}),$e&&t.jsxs("div",{className:te("text-xs",$e.type==="success"?"text-emerald-600":"text-red-600"),children:[$e.message,$e.timestamp?` • ${xt($e.timestamp)}`:""]})]})]})]})}),F==="backup"&&t.jsxs("div",{className:"border-t pt-4 space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Manual backup"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Download a Breeding Planner backup containing all animals, pairings, groups, breeder info, and settings."})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm text-white",Fe(n,!0)),onClick:Ie,children:["Download backup (",js,")"]}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:ie,children:"Save to vault"})]}),me&&t.jsxs("span",{className:te("text-xs",me.type==="success"?"text-emerald-600":"text-red-600"),children:[me.message,me.timestamp?` • ${xt(me.timestamp)}`:""]})]}),t.jsxs("div",{className:"space-y-3 border-t pt-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Automatic backups"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Keep an automatic snapshot while the planner is open in your browser."})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 text-sm",children:[t.jsx("label",{className:"text-xs font-medium uppercase tracking-wide text-neutral-500",children:"Schedule"}),t.jsxs("select",{className:"border rounded-lg px-3 py-2 bg-white text-sm",value:Q.frequency,onChange:_e,children:[t.jsx("option",{value:"off",children:"Off"}),t.jsx("option",{value:"nightly",children:"Every night"}),t.jsx("option",{value:"weekly",children:"Every week"}),t.jsx("option",{value:"monthly",children:"Every month"})]})]}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Last automatic backup: ",ue,".",_&&(_.snakes||_.pairings||_.groups)?t.jsxs("span",{children:[" ","Includes ",_.snakes," snakes, ",_.pairings," pairings, ",_.groups," groups."]}):null]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm text-white",Fe(n,!0)),onClick:Ft,children:"Run now"}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-lg text-sm border",d?"":"opacity-60 cursor-not-allowed"),onClick:Ke,disabled:!d,children:"Download latest snapshot"})]}),Ce&&t.jsxs("div",{className:te("text-xs",Ce.type==="success"?"text-emerald-600":"text-red-600"),children:[Ce.message,Ce.timestamp?` • ${xt(Ce.timestamp)}`:""]})]}),t.jsxs("div",{className:"space-y-3 border-t pt-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Backup vault"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Stored backups with unique identifiers. Rename, download, restore, or remove them here."})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 text-sm",children:[t.jsx("label",{className:"text-xs font-medium uppercase tracking-wide text-neutral-500",children:"Retention limit"}),t.jsx("select",{className:"border rounded-lg px-3 py-2 bg-white text-sm w-full sm:w-auto",value:ce,onChange:ot,children:fc.map(C=>{const T=C==="unlimited"?"unlimited":String(C),q=C==="unlimited"?"Unlimited (no pruning)":`Keep last ${C}`;return t.jsx("option",{value:T,children:q},T)})})]}),t.jsx("div",{className:"text-[11px] text-neutral-500",children:$}),t.jsx("div",{className:"text-xs text-neutral-500",children:se.length?`${se.length} backup${se.length===1?"":"s"} saved.`:"No backups saved yet."}),Ne&&t.jsxs("div",{className:te("text-xs",Ne.type==="success"?"text-emerald-600":"text-red-600"),children:[Ne.message,Ne.timestamp?` • ${xt(Ne.timestamp)}`:""]}),t.jsx("div",{className:"space-y-2",children:se.length?se.map(C=>{const T=xt(C.createdAt),q=C.updatedAt&&C.updatedAt!==C.createdAt?xt(C.updatedAt):null;let ye=null;try{const Le=JSON.stringify(C.payload);ye=Math.max(1,Math.ceil(Le.length/1024))}catch{ye=null}return t.jsxs("div",{className:"border rounded-xl bg-white p-3 shadow-sm space-y-2",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm text-neutral-800",children:C.name}),t.jsxs("div",{className:"text-[11px] text-neutral-500 space-x-2",children:[t.jsx("span",{children:C.source==="auto"?"Auto backup":"Manual backup"}),t.jsxs("span",{children:["Created ",T]}),q&&t.jsxs("span",{children:["Updated ",q]}),ye&&t.jsxs("span",{children:["~",ye," KB"]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg border text-xs",onClick:()=>jt(C.id),children:"Download"}),t.jsx("button",{type:"button",className:te("px-3 py-1.5 rounded-lg text-xs text-white",Fe(n,!0)),onClick:()=>Ct(C.id),children:"Restore"}),t.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg border text-xs",onClick:()=>ke(C.id),children:"Rename"}),t.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg border text-xs text-red-600",onClick:()=>yt(C.id),children:"Delete"})]})]}),t.jsxs("div",{className:"text-[10px] text-neutral-400 break-words",children:["ID: ",C.id]})]},C.id)}):t.jsx("div",{className:"text-xs text-neutral-500",children:"Create a manual or automatic backup to populate the vault."})})]}),t.jsxs("div",{className:"space-y-3 border-t pt-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Restore from backup"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Upload a Breeding Planner backup file or import a legacy JSON export to replace the current data."})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsx("input",{ref:ee,type:"file",accept:`${$s},${js}`,className:"hidden",onChange:Ye}),t.jsx("input",{ref:pe,type:"file",accept:"application/json,.json","data-allow-legacy-json":"true",className:"hidden",onChange:Ye}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:()=>{ee.current&&ee.current.click()},children:"Choose backup file"}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:()=>{pe.current&&pe.current.click()},children:"Import legacy JSON"}),t.jsxs("span",{className:"text-xs text-neutral-500",children:[js," or .json files"]})]}),G&&t.jsxs("div",{className:te("text-xs",G.type==="success"?"text-emerald-600":"text-red-600"),children:[G.message,G.timestamp?` • ${xt(G.timestamp)}`:""]}),t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Restoring replaces everything in the app. Download a backup first to stay safe."})]})]})]})}function wd({snakes:e,pairings:s,onDelete:n,onOpenSnake:o,onUpdatePairing:a,theme:r="blue",focusedPairingId:l=null,onFocusPairing:c,title:d,emptyMessage:u="No pairings yet. Use “New pairing”.",variant:m="default"}){const p=typeof n=="function"?n:null,g=typeof o=="function"?o:null,f=Array.isArray(s)?s:[],y=d||`Breeding Planner (${f.length})`,j=m==="collapsed",w=j?"flex flex-col gap-3":"space-y-4";return t.jsx(Vs,{title:y,children:t.jsxs("div",{className:w,children:[f.map((D,b)=>t.jsx(vd,{pairing:D,pairingNumber:b+1,snakes:e,onDelete:p,onOpenSnake:g,onUpdatePairing:a,theme:r,isFocused:l===D.id,onFocus:c?()=>c(D.id):void 0,variant:m},D.id)),!f.length&&t.jsx("div",{className:te("text-sm text-neutral-500",j&&"w-full"),children:u})]})})}function vd({pairing:e,pairingNumber:s,snakes:n,onDelete:o,onOpenSnake:a,onUpdatePairing:r,theme:l="blue",isFocused:c=!1,onFocus:d,variant:u="default"}){var Oe,Ge;const m=h.useRef(null),[p,g]=h.useState(!1),[f,y]=h.useState(u!=="collapsed");h.useEffect(()=>{if(c&&m.current)try{m.current.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},[c]),h.useEffect(()=>{c&&typeof d=="function"&&d()},[c,d]);const j=u==="collapsed";h.useEffect(()=>{y(!j)},[j]),h.useEffect(()=>{j&&c&&y(!0)},[j,c]);const w=h.useMemo(()=>dt(e||{}),[e]),D=h.useMemo(()=>Jt(n,w.femaleId),[n,w.femaleId]),b=h.useMemo(()=>Jt(n,w.maleId),[n,w.maleId]),I=(D==null?void 0:D.name)||w.femaleId||"Female",P=(b==null?void 0:b.name)||w.maleId||"Male",E=`${I} × ${P}`,k=h.useMemo(()=>D?At(D.morphs,D.hets,D.possibleHets):[],[D]),R=h.useMemo(()=>b?At(b.morphs,b.hets,b.possibleHets):[],[b]),O=D?k.length?k.join(", "):"Normal":"—",K=b?R.length?R.join(", "):"Normal":"—",S=h.useCallback(W=>{typeof r=="function"&&r(e.id,W)},[r,e.id]);h.useEffect(()=>{S(W=>{if(!W)return W;const ce=(W.label||"").trim(),$=E;return!ce&&W.label!==$?{...W,label:$}:W})},[E,S]);const z=w.label||E,B=h.useMemo(()=>io(b,D),[b,D]),F=h.useMemo(()=>{if(!B)return!1;const W=Array.isArray(B.perGene)?B.perGene:[],ce=Array.isArray(B.combined)?B.combined:[];return W.length>0||ce.length>0},[B]);h.useEffect(()=>{!F&&p&&g(!1)},[F,p]);const de=h.useMemo(()=>n.filter(W=>{var Ne;if(!W)return!1;const ce=Array.isArray(W.tags)?W.tags:[],$=Array.isArray(W.groups)?W.groups:[];if(!(ce.includes("hatchling")||$.some(Ee=>/^hatchlings\b/i.test(Ee))))return!1;const ue=W.pairingId===e.id||((Ne=W==null?void 0:W.metadata)==null?void 0:Ne.pairingId)===e.id,me=W.damId&&W.damId===e.femaleId&&W.sireId&&W.sireId===e.maleId,Ce=typeof W.name=="string"&&z&&W.name.includes(z);return ue||me||Ce}),[n,e,z]),U=h.useMemo(()=>bs(w),[w]),A=h.useMemo(()=>gn({clutchDate:U.clutchDate,preLayDate:U.preLayDate,ovulationDate:U.ovulationDate,hatchDate:U.hatchDate,startDate:w.startDate||""}),[U.clutchDate,U.preLayDate,U.ovulationDate,U.hatchDate,w.startDate]),G=w.startDate?je(w.startDate):"—",le=U.hatchDate||((Oe=w==null?void 0:w.hatch)!=null&&Oe.recorded?(Ge=w==null?void 0:w.hatch)==null?void 0:Ge.date:"")||U.clutchDate||"",ee=le?je(le):"—",pe=h.useCallback(()=>{S(W=>{const ce=Xa(W.startDate||rt(new Date),5),$={...W,appointments:ce};return $.startDate=$.appointments&&$.appointments[0]?$.appointments[0].date:$.startDate,$})},[S]),Q=h.useCallback(()=>{S(W=>{var $;const ce=[...W.appointments||[],{id:Ls(),date:rt(new Date),lockObserved:!1,lockLoggedAt:null,notes:""}];return{...W,appointments:ce,startDate:(($=ce[0])==null?void 0:$.date)||W.startDate||null}})},[S]),se=h.useCallback(()=>{typeof a!="function"||!b||a(b)},[a,b]),xe=h.useCallback(()=>{typeof a!="function"||!D||a(D)},[a,D]),oe=h.useCallback(async()=>{var $,_;const W=($=w==null?void 0:w.clutch)==null?void 0:$.date;if(!W){alert("Please add a clutch date before generating the clutch card.");return}let ce=(_=w==null?void 0:w.clutch)==null?void 0:_.eggsTotal;if(ce===""||typeof ce>"u")ce=null;else if(typeof ce=="string"){const ue=Number(ce);ce=Number.isFinite(ue)?ue:ce}try{const ue=b?R.length?R.join(", "):"Normal":"—",me=D?k.length?k.join(", "):"Normal":"—";await pd({clutchNumber:s,clutchDate:W,femaleName:I,femaleGenetics:me,maleName:P,maleGenetics:ue,eggsTotal:ce,label:z})}catch(ue){console.error("Failed to generate clutch card",ue),alert("Unable to generate clutch card PDF.")}},[w,s,I,P,k,R,z,D,b]),Ae=te("border rounded-xl shadow-sm bg-white focus:outline-none w-full p-3",c?"ring-2 ring-sky-400 ring-offset-1":"ring-0");return f?t.jsxs("div",{ref:m,className:Ae,tabIndex:-1,children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-semibold leading-tight text-sm sm:text-base",children:t.jsxs("div",{className:"truncate",children:["Clutch #",s," • ",A]})}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-600 space-y-1",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"truncate text-[12px] text-neutral-800 flex items-center gap-1",children:[t.jsx("span",{className:"text-[11px] text-neutral-500",children:"♂"}),typeof a=="function"&&b?t.jsx("button",{type:"button",className:"truncate font-medium text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:se,children:P}):t.jsx("span",{className:"truncate font-medium",children:P})]}),t.jsx("div",{className:"truncate",children:K})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"truncate text-[12px] text-neutral-800 flex items-center gap-1",children:[t.jsx("span",{className:"text-[11px] text-neutral-500",children:"♀"}),typeof a=="function"&&D?t.jsx("button",{type:"button",className:"truncate font-medium text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:xe,children:I}):t.jsx("span",{className:"truncate font-medium",children:I})]}),t.jsx("div",{className:"truncate",children:O})]})]}),t.jsx("div",{className:"flex gap-1 flex-wrap mt-1",children:(e.goals||[]).slice(0,4).map(W=>t.jsx(ao,{children:W},W))})]}),t.jsxs("div",{className:"flex gap-2 shrink-0",children:[typeof o=="function"&&t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>o(e.id),children:"Delete"}),f&&t.jsx("button",{type:"button",className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>y(!1),children:"Collapse"})]})]}),t.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Label"}),t.jsx("input",{className:"w-full border rounded-xl px-3 py-2 text-sm",value:z,onChange:W=>S(ce=>({...ce,label:W.target.value}))})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Starting date"}),t.jsx("input",{type:"date",className:"w-full border rounded-xl px-3 py-2 text-sm",value:w.startDate||"",onChange:W=>S(ce=>({...ce,startDate:W.target.value}))})]})]}),t.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] gap-3 min-w-0",children:[t.jsxs("div",{className:"flex flex-col gap-3 min-w-0",children:[t.jsxs("div",{className:"border rounded-2xl bg-white shadow-sm p-3 flex flex-col gap-3 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Appointments"}),t.jsx("div",{className:"text-[13px] text-neutral-500",children:"Manage pairing touchpoints"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:pe,children:"Generate 5 months"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:Q,children:"+ Add appointment"})]})]}),t.jsxs("div",{className:"flex-1 flex flex-col gap-2 min-w-0",children:[(w.appointments||[]).map((W,ce)=>t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[minmax(0,150px)_minmax(0,1fr)_auto] gap-2 items-center min-w-0",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-sm min-w-0",value:W.date,onChange:$=>{const _=$.target.value;S(ue=>{const me=[...ue.appointments||[]];return me[ce]={...me[ce],date:_},{...ue,appointments:me}})}}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3 gap-1",children:[t.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!W.lockObserved,onChange:$=>{const _=$.target.checked;S(ue=>{const me=[...ue.appointments||[]],Ce=me[ce]||{};let Ne=Ce.notes||"",Ee=Ce.lockLoggedAt||null;if(_){const $e=dc();Ee=$e,Ne=uc(Ne,rr($e))}else Ee=null;return me[ce]={...Ce,lockObserved:_,lockLoggedAt:Ee,notes:Ne},{...ue,appointments:me}})}}),"Lock"]}),t.jsx("input",{placeholder:"Notes",className:"border rounded-lg px-2 py-1 text-xs flex-1 min-w-0",value:W.notes||"",onChange:$=>{const _=$.target.value;S(ue=>{const me=[...ue.appointments||[]];return me[ce]={...me[ce],notes:_},{...ue,appointments:me}})}})]}),t.jsx("button",{className:"text-[11px] px-2 py-1 border rounded-lg",onClick:()=>{S($=>{var ue;const _=[...$.appointments||[]];return _.splice(ce,1),{...$,appointments:_,startDate:((ue=_[0])==null?void 0:ue.date)||$.startDate||null}})},children:"Remove"})]},W.id)),!(w.appointments||[]).length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No appointments yet."})]})]}),t.jsx(Md,{lifecycle:U,theme:l})]}),t.jsx(Ld,{edit:w,setEdit:S,theme:l,onCreateClutchCard:oe,lifecycle:U})]}),t.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:2,className:"w-full border rounded-xl px-3 py-2 text-sm",value:w.notes||"",onChange:W=>S(ce=>({...ce,notes:W.target.value}))})]}),de.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"Hatchlings"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:de.map(W=>t.jsx("button",{type:"button",className:te("px-2 py-0.5 text-xs rounded-full border bg-amber-50 text-amber-900",a?"hover:bg-amber-100 transition-colors":"cursor-default opacity-80"),onClick:a?()=>a(W):void 0,title:W.name||W.id,children:W.name||W.id},W.id))})]}),F&&t.jsx("div",{className:"mt-4",children:t.jsxs("div",{className:"border rounded-xl bg-neutral-50",children:[t.jsxs("button",{type:"button",className:"w-full flex items-center justify-between px-3 py-2 text-xs font-semibold text-neutral-700",onClick:()=>g(W=>!W),"aria-expanded":p,children:[t.jsx("span",{children:"Genetics calculator"}),t.jsx("span",{className:"text-[11px] text-neutral-500",children:p?"Hide":"Show"})]}),p&&t.jsx("div",{className:"border-t px-3 pb-3",children:t.jsx(jd,{male:b,female:D,odds:B})})]})})]}):t.jsx("button",{ref:m,type:"button",className:te(Ae,"text-left cursor-pointer"),onClick:()=>{y(!0),typeof d=="function"&&d()},"aria-expanded":!1,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500 shrink-0",children:["Clutch #",s," • ",A]}),t.jsxs("div",{className:"text-[11px] text-neutral-500 flex items-center gap-1",children:[t.jsx("span",{className:"font-semibold",children:"View details"}),t.jsx("span",{"aria-hidden":"true",children:"›"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-neutral-800",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-[12rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"♂ Male"}),typeof a=="function"&&b?t.jsx("button",{type:"button",className:"truncate font-medium text-sm text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:se,children:P}):t.jsx("span",{className:"font-medium truncate",children:P})]}),t.jsxs("div",{className:"flex items-center gap-2 min-w-[12rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"♀ Female"}),typeof a=="function"&&D?t.jsx("button",{type:"button",className:"truncate font-medium text-sm text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:xe,children:I}):t.jsx("span",{className:"font-medium truncate",children:I})]}),t.jsxs("div",{className:"flex items-center gap-2 min-w-[10rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"Start"}),t.jsx("span",{className:"font-medium",children:G})]}),t.jsxs("div",{className:"flex items-center gap-2 min-w-[10rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"End"}),t.jsx("span",{className:"font-medium",children:ee})]})]})]})})}function jd({male:e,female:s,odds:n}){const o=h.useMemo(()=>n||io(e,s),[n,e,s]),a=(o==null?void 0:o.perGene)||[],r=(o==null?void 0:o.combined)||[];return!a.length&&!r.length?null:t.jsxs("div",{className:"mt-3",children:[a.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"Genetics odds"}),t.jsx("div",{className:"flex flex-col gap-2",children:a.map(l=>t.jsxs("div",{className:"rounded-lg border bg-neutral-50 px-2 py-2",children:[t.jsx("div",{className:"text-xs font-semibold text-neutral-700",children:l.gene}),t.jsx("div",{className:"mt-1 flex flex-wrap gap-1.5",children:l.outcomes.map(c=>t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border bg-white px-2 py-0.5 text-[11px]",children:[t.jsx("span",{className:"font-semibold",children:hn(c.probability)}),t.jsx("span",{children:c.label})]},`${l.gene}-${c.label}`))}),l.notes?t.jsx("div",{className:"mt-1 text-[10px] text-neutral-500",children:l.notes}):null]},l.gene))})]}),r.length>0&&t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"Combined genetics odds"}),t.jsx("div",{className:"flex flex-col gap-1.5",children:r.map(l=>{const c=(l.breakdown||[]).filter(d=>d.label&&d.label!=="Normal");return t.jsxs("div",{className:"rounded-lg border bg-white px-2 py-1.5 text-[11px] text-neutral-700",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[t.jsx("span",{className:"font-semibold text-neutral-900",children:hn(l.probability)}),t.jsx("span",{children:l.label})]}),c.length?t.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-neutral-500",children:c.map(d=>t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-1.5 py-0.5 bg-neutral-50",children:[t.jsx("span",{className:"font-semibold text-neutral-700",children:d.gene}),t.jsx("span",{children:d.label})]},`${l.key}-${d.gene}`))}):null]},l.key)})})]})]})}function io(e,s){if(!e||!s)return{perGene:[],combined:[]};const n=pa(e),o=pa(s),a=new Set([...n.keys(),...o.keys()]),r=[];for(const c of a){const d=n.get(c)||null,u=o.get(c)||null,m=(d==null?void 0:d.displayName)||(u==null?void 0:u.displayName)||"";if(!m||/^normal$/i.test(m))continue;const p=Ad(m,d,u);if(!p)continue;let g=null;if(p==="Recessive")g=Dd(m,d,u);else if(p==="Incomplete Dominant"||p==="Dominant")g=Ed(m,d,u,p);else continue;if(!g||!g.outcomes||!g.outcomes.length||!g.outcomes.some(j=>j.label!=="Normal"&&j.probability>1e-4))continue;const y=[`Inheritance: ${p}`];g.sireDescriptor&&y.push(`Sire: ${g.sireDescriptor}`),g.damDescriptor&&y.push(`Dam: ${g.damDescriptor}`),r.push({gene:m,inheritance:p,outcomes:g.outcomes,notes:y.join(" • ")})}r.sort((c,d)=>c.gene.localeCompare(d.gene));const l=Cd(r);return{perGene:r,combined:l}}function Cd(e,s=12,n=.01){if(!Array.isArray(e)||!e.length)return[];let o=[{probability:1,breakdown:[],labelParts:[],geneOutcomes:[]}];e.forEach(r=>{const l=Array.isArray(r.outcomes)&&r.outcomes.length?r.outcomes:[{label:"Normal",probability:1}],c=new Map;o.forEach(d=>{l.forEach(u=>{const m=d.probability*(u.probability||0);if(m<=0)return;const p=[...d.breakdown,{gene:r.gene,label:u.label}],g=u.label&&u.label!=="Normal"?[...d.labelParts,u.label]:[...d.labelParts],f=[...d.geneOutcomes,`${r.gene}:${u.label}`],y=f.join("|"),j=c.get(y);j?j.probability+=m:c.set(y,{probability:m,breakdown:p,labelParts:g,geneOutcomes:f})})}),o=Array.from(c.values()),o.sort((d,u)=>u.probability-d.probability),o.length>1024&&(o=o.slice(0,1024))}),o.sort((r,l)=>l.probability-r.probability);const a=[];return o.forEach(r=>{(r.probability>=n||a.length<s)&&a.push(r)}),a.slice(0,s).map(r=>({key:r.geneOutcomes.join("|"),label:r.labelParts.length?r.labelParts.join(" + "):"Normal (all genes)",probability:r.probability,breakdown:r.breakdown}))}function pa(e){const s=new Map;if(!e)return s;const n=(o,a)=>{s.has(o)||s.set(o,{key:o,displayName:a||"",group:null,visualCount:0,superVisual:!1,hetCount:0,possibleHetProbabilities:[],morphTokens:[],hetTokens:[]});const r=s.get(o);if(a&&((!r.displayName||r.displayName.length<a.length)&&(r.displayName=a),!r.group||r.group==="Other")){const l=gs(a);l&&(r.group=l)}return r};return(Array.isArray(e.morphs)?e.morphs:[]).forEach(o=>{const a=Sd(o);if(!a)return;const r=zs(a.gene);if(!r)return;const l=n(r,a.displayName);l.visualCount+=1,l.superVisual=l.superVisual||!!a.isSuper,l.morphTokens.push(a.original)}),(Array.isArray(e.hets)?e.hets:[]).forEach(o=>{const a=kd(o);if(!a)return;const r=zs(a.gene);if(!r)return;const l=n(r,a.displayName);l.hetTokens.push(a.original),a.isCertain?l.hetCount+=1:l.possibleHetProbabilities.push(Math.max(0,Math.min(1,a.probability))),(!l.group||l.group==="Other")&&(l.group="Recessive")}),s}function Sd(e){if(!e)return null;const s=String(e).trim();if(!s)return null;let n=s,o=!1;const a=n.match(/^super[\s-]+(.+)$/i);if(a&&a[1])o=!0,n=a[1].trim();else{const l=n.match(/^Super([A-Z].*)$/);l&&l[1]&&(o=!0,n=l[1].trim())}const r=n.replace(/\s+/g," ").trim();return r?{gene:r,displayName:r,isSuper:o,original:s}:null}function kd(e){if(!e)return null;const s=String(e).trim();if(!s)return null;let n=s,o=1,a=!1;const r=n.match(/^(\d{1,3})%\s*(.+)$/i);if(r&&r[2]&&(a=!0,o=Math.min(1,parseInt(r[1],10)/100),n=r[2].trim()),/^possible\s+/i.test(n)?(a||(o=Math.min(o,.5)),n=n.replace(/^possible\s+/i,"").trim()):/^probable\s+/i.test(n)?(a||(o=Math.min(o,.66)),n=n.replace(/^probable\s+/i,"").trim()):/^maybe\s+/i.test(n)&&(a||(o=Math.min(o,.33)),n=n.replace(/^maybe\s+/i,"").trim()),n=n.replace(/^het\s+/i,"").trim(),!n)return null;const l=n,c=o>=.999;return{gene:n,displayName:l,probability:o,isCertain:c,original:s}}function Ad(e,s,n){const o=[s==null?void 0:s.group,n==null?void 0:n.group,gs(e)].filter(Boolean),a=o.find(l=>l&&l!=="Other");if(a)return a;const r=fa(s)||fa(n);return r||o[0]||null}function fa(e){return e?(e.hetCount||0)>0||(e.possibleHetProbabilities||[]).some(s=>s>0)?"Recessive":e.superVisual||(e.visualCount||0)>0?"Incomplete Dominant":null:null}function xa(e){if(!e)return{descriptor:"Normal",states:[{genotype:"NN",probability:1}]};if((e.visualCount||0)>0)return{descriptor:"Visual",states:[{genotype:"rr",probability:1}]};if((e.hetCount||0)>0)return{descriptor:"Het",states:[{genotype:"Nr",probability:1}]};const s=(e.possibleHetProbabilities||[]).filter(n=>n>0);if(s.length){const n=Math.max(...s),o=Math.max(0,Math.min(1,n));return o>=.999?{descriptor:"Het (proven)",states:[{genotype:"Nr",probability:1}]}:{descriptor:`${hn(o)} possible het`,states:[{genotype:"Nr",probability:o},{genotype:"NN",probability:1-o}]}}return{descriptor:"Normal",states:[{genotype:"NN",probability:1}]}}function ga(e){return e==="rr"?[{allele:"r",probability:1}]:e==="Nr"||e==="rN"?[{allele:"r",probability:.5},{allele:"N",probability:.5}]:[{allele:"N",probability:1}]}function Dd(e,s,n){const o=xa(s),a=xa(n),r=new Map;return o.states.forEach(c=>{a.states.forEach(d=>{const u=c.probability*d.probability;if(u<=0)return;const m=ga(c.genotype),p=ga(d.genotype);m.forEach(g=>{p.forEach(f=>{const y=u*g.probability*f.probability;if(y<=0)return;const j=(g.allele==="r"?1:0)+(f.allele==="r"?1:0),w=j===2?`Visual ${e}`:j===1?`Het ${e}`:"Normal";r.set(w,(r.get(w)||0)+y)})})})}),{outcomes:Array.from(r.entries()).map(([c,d])=>({label:c,probability:d})).filter(c=>c.probability>1e-4).sort((c,d)=>d.probability-c.probability),sireDescriptor:o.descriptor,damDescriptor:a.descriptor}}function ba(e,s){if(!e)return{descriptor:"Normal",states:[{copies:0,probability:1}]};if(e.superVisual)return{descriptor:s==="Incomplete Dominant"?"Super visual":"Homozygous visual",states:[{copies:2,probability:1}]};if((e.visualCount||0)>0)return{descriptor:"Visual",states:[{copies:1,probability:1}]};if((e.hetCount||0)>0)return{descriptor:"Carrier",states:[{copies:1,probability:1}]};const n=(e.possibleHetProbabilities||[]).filter(o=>o>0);if(n.length){const o=Math.max(...n),a=Math.max(0,Math.min(1,o));return a>=.999?{descriptor:"Visual (likely homozygous)",states:[{copies:1,probability:1}]}:{descriptor:`${hn(a)} possible carrier`,states:[{copies:1,probability:a},{copies:0,probability:1-a}]}}return{descriptor:"Normal",states:[{copies:0,probability:1}]}}function ya(e){return e>=2?[{allele:"A",probability:1}]:e>=1?[{allele:"A",probability:.5},{allele:"a",probability:.5}]:[{allele:"a",probability:1}]}function Ed(e,s,n,o){const a=ba(s,o),r=ba(n,o),l=new Map;return a.states.forEach(d=>{r.states.forEach(u=>{const m=d.probability*u.probability;if(m<=0)return;const p=ya(d.copies),g=ya(u.copies);p.forEach(f=>{g.forEach(y=>{const j=m*f.probability*y.probability;if(j<=0)return;const w=(f.allele==="A"?1:0)+(y.allele==="A"?1:0);let D;w===0?D="Normal":w===2&&o==="Incomplete Dominant"?D=`Super ${e}`:D=e,l.set(D,(l.get(D)||0)+j)})})})}),{outcomes:Array.from(l.entries()).map(([d,u])=>({label:d,probability:u})).filter(d=>d.probability>1e-4).sort((d,u)=>u.probability-d.probability),sireDescriptor:a.descriptor,damDescriptor:r.descriptor}}function hn(e){if(!Number.isFinite(e)||e<=0)return"0%";if(e>=.9995)return"100%";const s=e*100,n=Math.round(s*10)/10;return Number.isInteger(n)?`${n}%`:`${n.toFixed(1)}%`}function bs(e={}){const s=(e==null?void 0:e.ovulation)||{},n=(e==null?void 0:e.preLayShed)||{},o=(e==null?void 0:e.clutch)||{},a=(e==null?void 0:e.hatch)||{},r=!!s.observed,l=!!n.observed,c=!!o.recorded,d=!!a.recorded,u=s.date||"",m=n.date||"",p=o.date||"",g=a.scheduledDate||"",f=a.date||"",y=u?ps(u,21):null,j=m?ps(m,30):null,w=p?ps(p,60):null,D=g||w,b=o.eggsTotal,I=o.fertileEggs,P=o.slugs,E=typeof b=="number"&&Number.isFinite(b)?Math.max(0,b):null,k=typeof I=="number"&&Number.isFinite(I)?Math.max(0,I):null,R=I===""||typeof I>"u"?"":String(I),O=P===""||typeof P>"u"?"":String(P),K=b===""||typeof b>"u"?"":String(b),S=r&&!l,z=l&&!c,B=c&&!d,G=[S&&y?{key:"preLay",label:"Pre-Lay ETA",targetDate:y,totalDays:21}:null,z&&j?{key:"eggLay",label:"Egg Lay ETA",targetDate:j,totalDays:30}:null,B&&w?{key:"hatch",label:"Hatch ETA",targetDate:w,totalDays:60}:null,!B&&D&&!d&&E!==0?{key:"scheduled",label:"Scheduled Hatch",targetDate:D,totalDays:null}:null].filter(Boolean),le=G.length?G[0]:null;return{ovulationObserved:r,preLayObserved:l,clutchRecorded:c,hatchedRecorded:d,ovulationDate:u,preLayDate:m,clutchDate:p,hatchScheduledDate:g,preLayWindowTarget:y,eggLayingTarget:j,hatchTarget:w,hatchCountdownTarget:D,hatchDate:f,eggsTotalNumber:E,fertileEggsNumber:k,clutchFertileValue:R,clutchTotalValue:K,clutchSlugsValue:O,timerQueue:G,activeTimer:le,hasActiveTimers:G.length>0}}function Na(e){if(!e)return!1;const s=dt({...e});return!!bs(s).hatchedRecorded}function gn({clutchDate:e,preLayDate:s,ovulationDate:n,hatchDate:o,startDate:a}){const r=[e,s,n,o,a];for(const l of r){if(!l)continue;const c=Date.parse(l);if(!Number.isNaN(c))return String(new Date(c).getFullYear());const d=String(l).match(/^(\d{4})/);if(d)return d[1]}return"Unknown"}function Id(e){if(!e)return null;const s=dt({...e}),n=bs(s),o=(s.appointments||[]).filter(f=>f&&f.lockObserved&&(f.lockLoggedAt||f.date)).map(f=>{const y=f.lockLoggedAt||f.date||"",j=Date.parse(y),w=xt(y)||je(f.date)||"";return{iso:y,display:w,notes:f.notes?String(f.notes).trim():"",timestamp:Number.isNaN(j)?null:j}}).filter(f=>f.iso).sort((f,y)=>{const j=typeof f.timestamp=="number"?f.timestamp:1/0,w=typeof y.timestamp=="number"?y.timestamp:1/0;return j-w}).map(({timestamp:f,...y})=>y),a=n.ovulationDate||"",r=n.preLayDate||"",l=n.clutchDate||"",c=n.hatchDate||"";if(!(o.length||a||r||l||c))return null;const u=gn({clutchDate:l,preLayDate:r,ovulationDate:a,hatchDate:c,startDate:s.startDate||""}),m=l||r||a||c||s.startDate||"",p=m&&!Number.isNaN(Date.parse(m))?Date.parse(m):null,g=s.label||`${s.femaleId||"Female"} × ${s.maleId||"Male"}`;return{id:s.id||`${s.femaleId||"female"}-${s.maleId||"male"}-${u}`,label:g,year:u,startDate:s.startDate||"",locks:o,ovulationDate:a,preLayDate:r,clutchDate:l,hatchDate:c,sortValue:p}}function co(e,s=[]){if(!e||!Array.isArray(s)||!s.length)return[];const n=s.filter(r=>r&&r.femaleId===e).map(Id).filter(Boolean);if(!n.length)return[];const o=new Map;n.forEach(r=>{const l=r.year||"Unknown";o.has(l)||o.set(l,[]),o.get(l).push(r)});const a=r=>{const l=Number(r);return Number.isFinite(l)?l:-1/0};return Array.from(o.entries()).sort((r,l)=>{const c=a(l[0])-a(r[0]);return c!==0?c:String(l[0]).localeCompare(String(r[0]))}).map(([r,l])=>{const c=l.slice().sort((d,u)=>{const m=typeof d.sortValue=="number"?d.sortValue:-1/0;return(typeof u.sortValue=="number"?u.sortValue:-1/0)-m}).map(({sortValue:d,...u})=>u);return{year:r,cycles:c}})}function Ld({edit:e,setEdit:s,theme:n="blue",onCreateClutchCard:o,lifecycle:a}){var ce,$,_,ue,me,Ce,Ne,Ee,$e,Pe;const[r,l]=h.useState(null),[c,d]=h.useState({date:"",notes:""}),[u,m]=h.useState({date:"",notes:""}),[p,g]=h.useState({fertileEggs:"",slugs:""}),[f,y]=h.useState({date:"",hatchedCount:"",notes:""}),j=a||bs(e),{ovulationObserved:w,preLayObserved:D,clutchRecorded:b,hatchedRecorded:I,ovulationDate:P,preLayDate:E,clutchDate:k,preLayWindowTarget:R,eggLayingTarget:O,hatchTarget:K,eggsTotalNumber:S,fertileEggsNumber:z,clutchFertileValue:B,clutchSlugsValue:F}=j,de=h.useMemo(()=>{if(typeof S=="number")return S;const ae=typeof z=="number"?z:(()=>{if(B===""||typeof B>"u")return null;const J=Number(B);return Number.isFinite(J)&&J>=0?J:null})(),H=(()=>{if(F===""||typeof F>"u")return null;const J=Number(F);return Number.isFinite(J)&&J>=0?J:null})();return ae===null&&H===null?null:Math.max(0,ae??0)+Math.max(0,H??0)},[S,z,B,F]),U=typeof z=="number"?z:typeof S=="number"?S:null,A=typeof z=="number"?"fertile eggs":"eggs laid",G=typeof o=="function"&&b&&!!k;h.useEffect(()=>{var ae,H;r==="ovulation"&&d({date:((ae=e==null?void 0:e.ovulation)==null?void 0:ae.date)||rt(new Date),notes:((H=e==null?void 0:e.ovulation)==null?void 0:H.notes)||""})},[r,(ce=e==null?void 0:e.ovulation)==null?void 0:ce.date,($=e==null?void 0:e.ovulation)==null?void 0:$.notes]),h.useEffect(()=>{var ae,H;r==="preLay"&&m({date:((ae=e==null?void 0:e.preLayShed)==null?void 0:ae.date)||rt(new Date),notes:((H=e==null?void 0:e.preLayShed)==null?void 0:H.notes)||""})},[r,(_=e==null?void 0:e.preLayShed)==null?void 0:_.date,(ue=e==null?void 0:e.preLayShed)==null?void 0:ue.notes]),h.useEffect(()=>{r==="clutch"&&g({fertileEggs:B===""?"":B,slugs:F===""?"0":F})},[r,B,F]),h.useEffect(()=>{var ae,H,J;r==="hatched"&&y({date:((ae=e==null?void 0:e.hatch)==null?void 0:ae.date)||rt(new Date),hatchedCount:(H=e==null?void 0:e.hatch)!=null&&H.hatchedCount?String(e.hatch.hatchedCount):"",notes:((J=e==null?void 0:e.hatch)==null?void 0:J.notes)||""})},[r,e==null?void 0:e.hatch]);const le=h.useCallback(ae=>{s(H=>{const J=dt({...H});if(ae)J.clutch.recorded=!0,J.clutch.date=J.clutch.date||rt(new Date),!J.hatch.scheduledDate&&J.clutch.date&&(J.hatch.scheduledDate=ps(J.clutch.date,60));else{const ge=Gs();J.clutch={...ge.clutch},J.hatch={...ge.hatch}}return J})},[s]),ee=h.useCallback((ae,H)=>{s(J=>{const ge=dt({...J});if(ge.clutch.recorded=!0,ae==="date"){const Se=H||"";ge.clutch.date=Se,!ge.hatch.scheduledDate&&Se&&(ge.hatch.scheduledDate=ps(Se,60))}else if(ae==="fertileEggs"||ae==="slugs"){const Se=H??"";if(Se==="")ge.clutch[ae]="";else{const Qe=Number(Se);ge.clutch[ae]=Number.isFinite(Qe)?Math.max(0,Qe):ge.clutch[ae]}const Be=typeof ge.clutch.fertileEggs=="number"&&Number.isFinite(ge.clutch.fertileEggs)?Math.max(0,ge.clutch.fertileEggs):null,He=typeof ge.clutch.slugs=="number"&&Number.isFinite(ge.clutch.slugs)?Math.max(0,ge.clutch.slugs):null;if(Be===null&&He===null)ge.clutch.eggsTotal="";else{const Qe=Math.max(0,Be??0)+Math.max(0,He??0);ge.clutch.eggsTotal=Qe}}else ae==="notes"&&(ge.clutch.notes=H||"");return ge})},[s]),pe=h.useCallback(()=>{s(ae=>{const H=dt({...ae});return H.hatch={...Gs().hatch},H})},[s]),Q=h.useCallback(()=>{l("hatched")},[l]),se=h.useCallback(()=>{s(ae=>{const H=dt({...ae});let J=Number(p.fertileEggs);(!Number.isFinite(J)||J<0)&&(J=0);let ge=p.slugs===""?0:Number(p.slugs);return(!Number.isFinite(ge)||ge<0)&&(ge=0),H.clutch.recorded=!0,H.clutch.date=H.clutch.date||rt(new Date),H.clutch.fertileEggs=J,H.clutch.slugs=ge,H.clutch.eggsTotal=J+ge,!H.hatch.scheduledDate&&H.clutch.date&&(H.hatch.scheduledDate=ps(H.clutch.date,60)),H}),l(null)},[p,s,l]),xe=h.useCallback(()=>{s(ae=>{const H=dt({...ae});if(H.ovulation.observed=!0,H.ovulation.date=c.date||"",H.ovulation.notes=c.notes||"",H.ovulation.date&&(H.appointments=Fd(H.appointments||[],H.ovulation.date)),H.preLayShed.observed&&H.preLayShed.date){const J=va(H.ovulation.date,H.preLayShed.date);H.preLayShed.intervalFromOvulation=Number.isFinite(J)?J:null}return H}),l(null)},[c,s,l]),oe=h.useCallback(()=>{s(ae=>{const H=dt({...ae});H.preLayShed.observed=!0,H.preLayShed.date=u.date||"",H.preLayShed.notes=u.notes||"";const J=H.ovulation.observed&&H.ovulation.date&&u.date?va(H.ovulation.date,u.date):null;return H.preLayShed.intervalFromOvulation=Number.isFinite(J)?J:null,H}),l(null)},[u,s,l]),Ae=h.useMemo(()=>{const ae=p.fertileEggs;if(ae==="")return!0;const H=Number(ae);if(!Number.isFinite(H)||H<0)return!0;if(p.slugs==="")return!1;const J=Number(p.slugs);return!Number.isFinite(J)||J<0},[p]),Oe=h.useMemo(()=>{const ae=p.fertileEggs,H=p.slugs,J=ae!==""&&Number.isFinite(Number(ae)),ge=H!==""&&Number.isFinite(Number(H));if(!J&&!ge)return null;const Se=J?Math.max(0,Number(ae)):0,Be=ge?Math.max(0,Number(H)):0;return Se+Be},[p]),Ge=h.useCallback(()=>{s(ae=>{const H=dt({...ae});let J=f.hatchedCount===""?0:Number(f.hatchedCount);(!Number.isFinite(J)||J<0)&&(J=0);const ge=typeof H.clutch.fertileEggs=="number"&&Number.isFinite(H.clutch.fertileEggs)?Math.max(0,H.clutch.fertileEggs):typeof H.clutch.eggsTotal=="number"&&Number.isFinite(H.clutch.eggsTotal)?Math.max(0,H.clutch.eggsTotal):null;return typeof ge=="number"&&(J=Math.min(J,ge)),H.hatch={...H.hatch,recorded:!0,date:f.date,hatchedCount:J,notes:f.notes||""},H}),l(null)},[f,s]),W="rounded-xl border border-neutral-200 bg-white p-2 flex flex-col gap-2 text-[11px] min-w-0 overflow-hidden";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"border rounded-2xl bg-white shadow-sm p-3 flex flex-col gap-3 h-full max-h-[60vh] min-h-0 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Breeding cycle"}),t.jsx("div",{className:"text-[12px] text-neutral-500",children:"Track sheds, clutches, and hatch"})]}),t.jsxs("div",{className:"flex flex-col gap-2.5 min-w-0 overflow-auto pr-1",children:[t.jsxs("div",{className:"flex flex-col gap-2.5 lg:grid lg:grid-cols-2 lg:gap-2.5 lg:items-stretch",children:[t.jsxs("div",{className:te(W,"flex-1 lg:h-full"),children:[t.jsxs("div",{className:"flex-1 text-center space-y-1",children:[t.jsx("div",{className:"text-[12px] font-semibold uppercase tracking-wide text-neutral-500",children:"Ovulation"}),t.jsx("div",{className:"text-neutral-700 text-[13px]",children:P?je(P):"—"}),w&&((me=e==null?void 0:e.ovulation)!=null&&me.notes)?t.jsx("div",{className:"text-[11px] text-neutral-500 leading-snug max-h-12 overflow-hidden mx-auto",children:e.ovulation.notes}):null,w&&R&&t.jsxs("div",{className:"text-[11px] text-neutral-500",children:["Pre-lay window ",je(R)]})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mt-2",children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>l("ovulation"),children:w?"Edit details":"Log ovulation"}),w&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>{s(ae=>{const H=dt({...ae});return H.ovulation={observed:!1,date:"",notes:""},H.preLayShed={...Gs().preLayShed},H})},children:"Clear"})]})]}),t.jsxs("div",{className:te(W,"flex-1 lg:h-full"),children:[t.jsxs("div",{className:"flex-1 text-center space-y-1",children:[t.jsx("div",{className:"text-[12px] font-semibold uppercase tracking-wide text-neutral-500",children:"Pre-Lay Shed"}),t.jsx("div",{className:"text-neutral-700 text-[13px]",children:E?je(E):"—"}),D&&Number.isFinite((Ce=e==null?void 0:e.preLayShed)==null?void 0:Ce.intervalFromOvulation)&&t.jsxs("div",{className:"text-[11px] text-neutral-500",children:[e.preLayShed.intervalFromOvulation," days after ovulation"]}),D&&((Ne=e==null?void 0:e.preLayShed)!=null&&Ne.notes)?t.jsx("div",{className:"text-[11px] text-neutral-500 leading-snug max-h-12 overflow-hidden mx-auto",children:e.preLayShed.notes}):null,D&&O&&t.jsxs("div",{className:"text-[11px] text-neutral-500",children:["Egg window ",je(O)]})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mt-2",children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>l("preLay"),disabled:!w,children:D?"Edit details":"Log pre-lay shed"}),D&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>{s(ae=>{const H=dt({...ae});return H.preLayShed={...Gs().preLayShed},H})},children:"Clear"})]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:te(W,"w-full lg:max-w-xl"),children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx("div",{className:"font-semibold uppercase tracking-wide text-neutral-500",children:"Clutch & Hatch"}),t.jsx("div",{className:"text-neutral-700 text-[13px]",children:b&&k?`Laid ${je(k)}`:"No egg laid recorded"})]}),t.jsxs("div",{className:"mt-3 w-full text-left space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:"Egg laying date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2 text-xs",value:k,onChange:ae=>ee("date",ae.target.value),disabled:!b})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:"Number of fertile eggs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2 text-xs",value:B,onChange:ae=>ee("fertileEggs",ae.target.value),disabled:!b})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:"Number of slugs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2 text-xs",value:F,onChange:ae=>ee("slugs",ae.target.value),disabled:!b})]})]})]}),t.jsxs("div",{className:"mt-3 flex flex-col gap-2 items-center text-xs text-neutral-600",children:[t.jsx("div",{className:"text-[11px] text-neutral-500",children:b?"Egg laid recorded":"No egg laid yet"}),t.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-neutral-500",children:[t.jsx("span",{children:"Expected on"}),t.jsx("span",{className:"text-neutral-700 font-medium",children:K?je(K):"—"})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[!b&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>l("clutch"),children:"Eggs laid"}),b&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>o==null?void 0:o(),disabled:!G,children:"Create clutch card"}),!I&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:Q,children:"Eggs hatched"}),t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg text-rose-600 border-rose-300",onClick:()=>le(!1),children:"Clear egg record"})]})]})]}),t.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-neutral-50 px-3 py-2 mt-2 flex items-start justify-between gap-3 w-full",children:[t.jsxs("div",{className:"space-y-1 text-left",children:[t.jsx("div",{className:"text-[11px] font-medium uppercase tracking-wide text-neutral-500",children:"Hatched"}),t.jsx("div",{className:"text-[13px] text-neutral-700",children:I&&((Ee=e==null?void 0:e.hatch)!=null&&Ee.date)?`Hatched ${je(e.hatch.date)}`:"Not yet"}),I&&t.jsxs("div",{className:"text-[11px] text-neutral-500 space-y-1",children:[t.jsxs("div",{children:["Hatched count: ",(($e=e==null?void 0:e.hatch)==null?void 0:$e.hatchedCount)||0]}),(Pe=e==null?void 0:e.hatch)!=null&&Pe.notes?t.jsxs("div",{children:["Notes: ",e.hatch.notes]}):null]})]}),t.jsx("div",{className:"flex flex-col items-end gap-2",children:I&&t.jsxs("div",{className:"flex flex-col items-end gap-2",children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:Q,children:"View / edit hatch"}),t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg text-rose-600 border-rose-300",onClick:pe,children:"Clear hatch record"})]})})]}),t.jsxs("div",{className:"mt-2 text-[11px] text-neutral-500",children:["Total eggs laid: ",typeof de=="number"?de:"—"," (fertile + slugs)"]})]})})]})]}),r==="ovulation"&&t.jsx(ln,{title:"Ovulation details",theme:n,onClose:()=>l(null),onConfirm:xe,disableConfirm:!c.date,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Ovulation date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:c.date,onChange:ae=>d(H=>({...H,date:ae.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-3 py-2",value:c.notes,onChange:ae=>d(H=>({...H,notes:ae.target.value}))})]})]})}),r==="preLay"&&t.jsx(ln,{title:"Pre-Lay shed details",theme:n,onClose:()=>l(null),onConfirm:oe,disableConfirm:!u.date,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Pre-Lay shed date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:u.date,onChange:ae=>m(H=>({...H,date:ae.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-3 py-2",value:u.notes,onChange:ae=>m(H=>({...H,notes:ae.target.value}))})]})]})}),r==="clutch"&&t.jsx(ln,{title:"Log eggs laid",theme:n,onClose:()=>l(null),onConfirm:se,disableConfirm:Ae,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Number of fertile eggs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2",value:p.fertileEggs,onChange:ae=>{const H=ae.target.value;if(H===""){g(ge=>({...ge,fertileEggs:""}));return}let J=Number(H);Number.isFinite(J)&&(J<0&&(J=0),g(ge=>({...ge,fertileEggs:String(J)})))}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Number of slugs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2",value:p.slugs,onChange:ae=>{const H=ae.target.value;if(H===""){g(ge=>({...ge,slugs:""}));return}let J=Number(H);Number.isFinite(J)&&(J<0&&(J=0),g(ge=>({...ge,slugs:String(J)})))}}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Total eggs laid will be saved as fertile eggs + slugs",typeof Oe=="number"?` = ${Oe}`:"","."]})]})]})}),r==="hatched"&&t.jsx(ln,{title:"Hatch details",theme:n,onClose:()=>l(null),onConfirm:Ge,disableConfirm:!f.date,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Hatch date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:f.date,onChange:ae=>y(H=>({...H,date:ae.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Number hatched"}),t.jsx("input",{type:"number",min:"0",max:U??void 0,className:"mt-1 w-full border rounded-xl px-3 py-2",value:f.hatchedCount,onChange:ae=>{const H=ae.target.value;if(H===""){y(ge=>({...ge,hatchedCount:""}));return}let J=Number(H);(!Number.isFinite(J)||J<0)&&(J=0),U!==null&&J>U&&(J=U),y(ge=>({...ge,hatchedCount:String(J)}))}}),U!==null&&t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Maximum allowed: ",U," (",A,")"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-3 py-2",value:f.notes,onChange:ae=>y(H=>({...H,notes:ae.target.value}))})]})]})})]})}function Md({lifecycle:e,theme:s="blue",className:n}){const o=(e==null?void 0:e.timerQueue)||[],a=o.length>0,[r,l]=h.useState(new Date),c=!!(e!=null&&e.hatchedRecorded),d=(e==null?void 0:e.hatchDate)||"",u=!!(e&&(e.ovulationObserved||e.preLayObserved||e.clutchRecorded||e.hatchedRecorded||e.ovulationDate||e.preLayDate||e.clutchDate));return h.useEffect(()=>{if(a||c)return;const m=setInterval(()=>l(new Date),6e4);return()=>clearInterval(m)},[a,c]),!a&&!u?null:c?t.jsxs("div",{className:te("border rounded-2xl bg-white shadow-sm p-4 sm:p-5 flex flex-col gap-4",n),children:[t.jsx("div",{className:"flex flex-wrap items-end justify-between gap-2",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Cycle timers"}),t.jsx("div",{className:"text-sm text-neutral-600",children:"Breeding cycle status"})]})}),t.jsxs("div",{className:"flex flex-col gap-2 text-sm text-neutral-600",children:[t.jsx("div",{className:"font-medium text-neutral-700",children:"This breeding cycle is over."}),d?t.jsxs("div",{className:"text-xs text-neutral-500",children:["Hatched on ",je(d)]}):null]})]}):t.jsxs("div",{className:te("border rounded-2xl bg-white shadow-sm p-4 sm:p-5 flex flex-col gap-4",n),children:[t.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Cycle timers"}),t.jsx("div",{className:"text-sm text-neutral-600",children:"Upcoming breeding milestones"})]}),a&&t.jsxs("div",{className:"text-xs text-neutral-500",children:[o.length," active"]})]}),a?t.jsx("div",{className:"flex flex-col gap-3",children:o.map(m=>t.jsx(Td,{label:m.label,targetDate:m.targetDate,totalDays:typeof m.totalDays=="number"?m.totalDays:null,theme:s,size:"lg"},m.key))}):t.jsxs("div",{className:"flex flex-col gap-2 text-sm text-neutral-600",children:[t.jsx("div",{children:"No active timers yet. Log ovulation, pre-lay, or clutch events to start tracking milestones."}),t.jsxs("div",{className:"text-xs font-medium text-neutral-500",children:["Current time: ",xt(r)]})]})]})}function ln({title:e,onClose:s,onConfirm:n,children:o,theme:a="blue",confirmLabel:r="Save",disableConfirm:l=!1}){return t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[70]",onClick:s,children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-xl border p-5",onClick:c=>c.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("div",{className:"font-semibold",children:e}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:s,children:"Close"})]}),t.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-auto pr-1",children:o}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:s,children:"Cancel"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm",Fe(a,!0)),onClick:n,disabled:l,children:r})]})]})})}function Td({label:e,targetDate:s,totalDays:n=null,theme:o="blue",size:a="sm"}){const[r,l]=h.useState(Date.now());if(h.useEffect(()=>{if(!s)return;const y=setInterval(()=>l(Date.now()),6e4);return()=>clearInterval(y)},[s]),!s)return null;const c=ts(s);if(!c)return null;const d=c.getTime()-r,u=d<0,m=u?`Overdue by ${wa(-d)}`:`Due in ${wa(d)}`;let p=null;if(n&&n>0){const y=n*864e5,j=y-d;p=u?100:Math.min(100,Math.max(0,j/y*100))}const g=o==="green"?"bg-emerald-100 border border-emerald-300 text-emerald-700":o==="dark"?"bg-slate-200 border border-slate-400 text-slate-800":"bg-sky-100 border border-sky-300 text-sky-700",f=a==="lg"?"px-4 py-3 rounded-2xl gap-3 text-sm sm:text-base":"px-3 py-1.5 rounded-full gap-2 text-xs";return t.jsxs("div",{className:te("countdown-badge flex flex-wrap items-center font-semibold w-full",f,g,u&&"overdue"),children:[p!==null&&t.jsx("span",{className:"countdown-progress",style:{width:`${p}%`}}),t.jsx("span",{className:"break-words leading-tight",children:e}),t.jsx("span",{className:"break-words leading-tight",children:m}),t.jsx("span",{className:"break-words leading-tight",children:je(s)})]})}function wa(e){const s=Math.max(0,Math.floor(e)),n=Math.round(s/6e4),o=Math.floor(n/(60*24)),a=Math.floor((n-o*60*24)/60),r=n-o*60*24-a*60;return o>0?`${o}d ${a}h`:a>0?`${a}h ${r}m`:`${Math.max(r,0)}m`}function Fd(e=[],s){return!s||!Array.isArray(e)||!e.length||e.filter(o=>(o.date||"")<=s).length<3?e:e.filter(o=>(o.date||"")<=s)}function va(e,s){const n=ts(e),o=ts(s);if(!n||!o)return null;const a=o.getTime()-n.getTime();return Math.round(a/864e5)}function ts(e){if(!e)return null;const[s,n,o]=String(e).split("-").map(Number);if(!s||!n||!o)return null;const a=new Date(s,n-1,o,12);return isNaN(a.getTime())?null:a}function $d({importText:e,setImportText:s,importPreview:n,setImportPreview:o,runImportPreview:a,applyImport:r,theme:l="blue",onCancel:c}){const[d,u]=h.useState(null),[m,p]=h.useState(!1),g=h.useRef();return t.jsxs(Vs,{title:"Import snakes from text",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Paste text exported from the PDF"}),t.jsx("textarea",{className:"mt-1 w-full h-64 border rounded-xl px-3 py-2",value:e,onChange:f=>s(f.target.value.replace(/Ball Python\s*\(Python regius\)/ig,"")),placeholder:"Paste content here..."}),t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Upload PDF"}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("input",{id:"import-pdf-input",type:"file",accept:"application/pdf",className:"hidden",onChange:async f=>{const y=f.target.files&&f.target.files[0];if(u(y||null),!!y){p(!0);try{const j=await Pd(y);s(j);let w=Oc(j);if(w&&w.length){const E=w.map(k=>{const R=Nt(k.sex,"F");return{name:k.name,sex:R,morphs:k.morphs||[],hets:k.hets||[],previewText:on({...k,sex:R})}});o(E);return}const b=j.split(/\r?\n/).map(E=>E.trim()).filter(Boolean).map(E=>Yc(E)).filter(Boolean);if(b&&b.length){const E=b.map(k=>{const R=[],O=[];(k.genetics||[]).forEach(S=>{const z=String(S).toLowerCase();/^het\b|\bhet\b|^66%|^50%|possible/i.test(z)?O.push(S):R.push(S)});const K=Nt(k.gender&&k.gender[0],"F");return{name:k.name,sex:K,morphs:R,hets:O,previewText:on({name:k.name,id:k.id||"",sex:K,morphs:R,hets:O})}});o(E);return}const I=Qc(j);if(I&&I.length){const E=I.map(k=>{const R=Nt(k.sex,"F");return{name:k.name,sex:R,morphs:k.morphs||[],hets:k.hets||[],previewText:on({name:k.name,id:"",sex:R,morphs:k.morphs,hets:k.hets})}});o(E);return}const P=eo(j);o(P)}catch(j){console.error("pdf parse failed",j),alert("Failed to parse PDF")}finally{p(!1)}}}}),t.jsx("input",{id:"import-sheet-input",ref:g,type:"file",accept:".csv,.xlsx,.xls,text/csv",className:"hidden",onChange:async f=>{const y=f.target.files&&f.target.files[0];if(y){p(!0);try{const j=(y.name||"").toLowerCase();let w="";if(j.endsWith(".csv")||j.endsWith(".txt"))w=await y.text();else if(j.endsWith(".xlsx")||j.endsWith(".xls")){let O;try{O=await xs(()=>import("./xlsx-D_0l8YDs.js"),[])}catch(F){console.error("xlsx import failed",F),alert('To import Excel files please install the "xlsx" package: npm install xlsx');return}const K=await y.arrayBuffer(),S=O.read(K,{type:"array"}),z=S.SheetNames[0],B=S.Sheets[z];w=O.utils.sheet_to_csv(B)}else{alert("Unsupported file type. Please upload CSV or XLSX.");return}const D=Kc(w||"");if(!D||!D.length){o([]);return}const{index:b,hasHeader:I}=Zc(D[0]||[]),P=O=>{if(!O||!O.length)return null;const K=O.map(_=>(_||"").toString());if(K.every(_=>!_.trim()))return null;const S=_=>{const ue=ha(K,b,_);return ue.length?ue[0].trim():""},z=_=>ha(K,b,_).flatMap(Xn),B=S("name"),F=S("id"),de=S("sex"),U=S("status"),A=S("year"),G=S("weight"),le=S("birthDate"),ee=S("notes"),pe=[...z("genetics"),...z("morphs")],Q=z("hets").map(_=>{const ue=_.trim();if(!ue)return"";const me=ue.toLowerCase();return me.includes("het")||/\d+%/.test(me)||me.includes("possible")?ue:`het ${ue}`}).filter(Boolean),{morphs:se,hets:xe}=Kn([...pe,...Q]),oe=Array.from(new Set(z("groups"))),Ae=Array.from(new Set(z("tags"))),Oe=Nt(de,"F"),Ge=Number(A),W=G&&G.trim()?G:"",ce=Is(le)||le||null,$=U?U.trim():"";return!B&&!F&&!se.length&&!xe.length&&!oe.length&&!Ae.length?null:{name:B,id:F,sex:Oe,morphs:se,hets:xe,groups:oe,tags:Ae,weight:W,year:Number.isFinite(Ge)?Ge:void 0,birthDate:ce,status:$,notes:ee||void 0}},E=I?D.slice(1):D;let k=I?E.map(P).filter(Boolean):[];if(!k.length){let O=D;D[0].map(z=>(z||"").toString().toLowerCase()).some(z=>z.includes("name")||z.includes("gender")||z.includes("gen"))&&(O=D.slice(1)),k=O.map(z=>{const B=z.map(oe=>(oe||"").trim());if(!B.length||B.every(oe=>!oe))return null;const F=B[0]||"",de=(B[1]||"").trim(),U=(B[2]||"").trim(),A=(B[3]||"").trim(),G=(B[4]||"").trim(),le=de.toLowerCase();let ee="F";/^f$/.test(le)||/\bfemale\b/.test(le)?ee="F":(/^m$/.test(le)||/\bmale\b/.test(le))&&(ee="M");const pe=U?U.split(GENE_TOKEN_SPLIT_REGEX).map(oe=>oe.trim()).filter(Boolean):[],Q=Kn(pe),se=A?A.split(/[;,|]/).map(oe=>oe.trim()).filter(Boolean):[],xe=G?G.split(/[;,|]/).map(oe=>oe.trim()).filter(Boolean):[];return F||Q.morphs.length||Q.hets.length||se.length||xe.length?{name:F,id:"",sex:ee,morphs:Q.morphs,hets:Q.hets,groups:se,tags:xe}:null}).filter(Boolean)}if(!k.length){o([]);return}const R=k.map(O=>{const K=Nt(O.sex,"F"),S={name:O.name,id:O.id||"",sex:K,morphs:O.morphs||[],hets:O.hets||[]};return{...O,sex:K,previewText:on(S)}});o(R),s(w)}catch(j){console.error("sheet import error",j),o([])}finally{p(!1);try{f.target.value=null}catch{}}}}}),t.jsx("button",{className:te("text-xs px-2 py-1 rounded-lg",Fe(l,!0)),onClick:()=>{const f=document.getElementById("import-pdf-input");f&&f.click()},disabled:m,children:m?"Parsing…":"Upload PDF"}),t.jsx("button",{className:te("text-xs px-2 py-1 rounded-lg","ml-2",Fe(l,!0)),onClick:()=>{const f=document.getElementById("import-sheet-input");f&&f.click()},disabled:m,children:m?"Parsing…":"Upload Sheet"}),t.jsx("div",{className:"text-xs text-neutral-500",children:d?d.name:"No file selected"})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:a,children:"Preview"}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm border","bg-white"),onClick:()=>{s(""),u(null),o([]),c&&c()},children:"Cancel"}),t.jsxs("button",{className:te("px-3 py-2 rounded-xl text-sm text-white",n.length?Fe(l,!0):Fe(l,!1)),disabled:!n.length,onClick:r,children:["Import ",n.length?`(${n.length})`:""]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-medium",children:"Preview"}),t.jsxs("div",{className:"mt-1 border rounded-xl p-2 h-64 overflow-auto bg-neutral-50",children:[!n.length&&t.jsx("div",{className:"text-sm text-neutral-500",children:"Click Preview to see parsed snakes."}),n.map((f,y)=>t.jsx("div",{className:"text-sm py-1 border-b last:border-b-0",children:f.previewText?t.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:f.previewText}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium",children:[f.name," ",t.jsxs("span",{className:"text-xs text-neutral-500",children:["(",f.sex,")"]})]}),(()=>{const j=At(f.morphs,f.hets,f.possibleHets);return t.jsx("div",{className:"space-y-1 mt-1 text-[10px]",children:j.length?t.jsx(cr,{label:"Genetics",genes:j,size:"xs"}):t.jsx("div",{className:"text-neutral-500 uppercase tracking-wide",children:"Genetics: -"})})})()]})},y))]})]})]}),t.jsx("div",{className:"text-xs text-neutral-500 mt-3",children:"Row 1 column titles (Name, ID, Gender, Morphs, etc.) are mapped automatically—double-check the preview before importing."})]})}async function Pd(e){const s=await e.arrayBuffer(),n=new Uint8Array(s);let o;try{o=await _n.getDocument({data:n}).promise}catch(r){throw console.error("pdfjs failed to load document",r),r}let a="";for(let r=1;r<=o.numPages;r++){const d=(await(await o.getPage(r)).getTextContent()).items||[];let u=[],m=null,p="";for(const f of d){const y=f.str||"",j=f.transform&&typeof f.transform[5]<"u"?Math.round(f.transform[5]):0;if(m===null){m=j,p=y;continue}Math.abs(j-m)>5?(u.push(p.trim()),p=y,m=j):p=(p?p+" ":"")+y}p&&u.push(p.trim());const g=u.join(`
`);a+=g+`

`}return a}function Rd({groups:e,setGroups:s,snakes:n,onDeleteGroup:o,onOpenSnake:a,theme:r="blue"}){const[l,c]=h.useState("");return t.jsxs(Vs,{title:"Groups",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{className:"flex-1 border rounded-xl px-3 py-2",placeholder:"New group name",value:l,onChange:d=>c(d.target.value)}),t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:()=>{const d=l.trim();d&&(s(u=>u.includes(d)?u:[...u,d]),c(""))},children:"Add"})]}),t.jsxs("div",{className:"mt-4 space-y-4",children:[e.map(d=>{const u=n.filter(m=>(m.groups||[]).includes(d));return t.jsxs("div",{className:"p-3 border rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:[d," ",t.jsxs("span",{className:"text-xs text-neutral-500",children:["(",u.length,")"]})]}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Members"})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>o(d),children:"Delete"})})]}),t.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:u.length?u.map(m=>t.jsxs("button",{type:"button",onClick:()=>a&&a(m),className:"text-sm px-2 py-1 rounded-full border bg-neutral-50 flex items-center gap-2 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-sky-200",children:[t.jsx("span",{className:"font-medium",children:m.name}),(()=>{const p=zt(m.sex),g=p==="M"?"♂":p==="F"?"♀":"•";return t.jsx("span",{className:"text-xs text-neutral-500",children:g})})()]},m.id)):t.jsx("div",{className:"text-xs text-neutral-500",children:"No snakes in this group."})})]},d)}),!e.length&&t.jsx("div",{className:"py-2 text-xs text-neutral-500",children:"No groups yet."})]}),t.jsx("div",{className:"mt-4 text-xs text-neutral-500",children:"Tip: Edit a snake to assign or change its group."})]})}function _d({editSnakeDraft:e,setEditSnakeDraft:s,lastFeedDefaults:n,setLastFeedDefaults:o}){const a=h.useRef(null),r=h.useRef(null),l=h.useRef(null),c=h.useRef(null),d=h.useRef(null),u=(m,p)=>{s(g=>{const f=[...g.logs[m]||[]];return f.splice(p,1),{...g,logs:{...g.logs,[m]:f}}})};return h.useEffect(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[e.logs.feeds.length]),h.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e.logs.weights.length]),h.useEffect(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[e.logs.sheds.length]),h.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[e.logs.cleanings.length]),h.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[e.logs.meds.length]),t.jsxs(t.Fragment,{children:[t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Feeds"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=rt(new Date),p=n||{feed:"Mouse",size:"",form:"Frozen/thawed",formDetail:"",notes:""},g=p.form||"Frozen/thawed",f=p.formDetail||"";s(y=>({...y,logs:{...y.logs,feeds:[...y.logs.feeds,{date:m,feed:p.feed||"Mouse",size:p.size||"",weightGrams:0,method:g,methodDetail:f,notes:p.notes||"",refused:!1}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:a,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.feeds.map((m,p)=>m.refused?t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-7 gap-2 items-center text-xs",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-xs text-neutral-900 sm:col-span-2 min-w-[8rem] w-full",value:m.date,onChange:f=>it(s,"feeds",p,{date:f.target.value})}),t.jsx("div",{className:"sm:col-span-3 font-semibold text-rose-600",children:"Refused feed"}),t.jsxs("div",{className:"sm:col-span-2 flex justify-end gap-2 flex-wrap",children:[t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>it(s,"feeds",p,{refused:!1}),children:"Undo refused"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600",onClick:()=>u("feeds",p),children:"Delete"})]})]},p):t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-7 gap-2 items-center text-xs",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-xs text-neutral-900 sm:col-span-2 min-w-[8rem] w-full",value:m.date,onChange:f=>it(s,"feeds",p,{date:f.target.value})}),t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-xs sm:col-span-1 w-full",value:m.feed||"",onChange:f=>it(s,"feeds",p,{feed:f.target.value,size:f.target.value==="Mouse"||f.target.value==="Rat"?m.size||"pinky":""}),children:[t.jsx("option",{value:"Mouse",children:"Mouse"}),t.jsx("option",{value:"Rat",children:"Rat"}),t.jsx("option",{value:"Chick",children:"Chick"}),t.jsx("option",{value:"Other",children:"Other"})]}),m.feed==="Mouse"||m.feed==="Rat"?t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-xs sm:col-span-1 w-full",value:m.size||"",onChange:f=>it(s,"feeds",p,{size:f.target.value}),children:[t.jsx("option",{value:"pinky",children:"pinky"}),t.jsx("option",{value:"fuzzy",children:"fuzzy"}),t.jsx("option",{value:"medium",children:"medium"}),t.jsx("option",{value:"adult",children:"adult"})]}):t.jsx("input",{className:"border rounded-lg px-2 py-1 text-xs sm:col-span-1 w-full",placeholder:"Size",value:m.size||"",onChange:f=>it(s,"feeds",p,{size:f.target.value})}),t.jsx("input",{type:"number",className:"border rounded-lg px-2 py-1 text-xs w-full sm:col-span-1",placeholder:"g",value:typeof m.weightGrams=="number"?m.weightGrams:m.weightGrams||0,onChange:f=>it(s,"feeds",p,{weightGrams:Number(f.target.value)||0})}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-2 sm:col-span-2",children:[t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-xs w-full sm:w-auto",value:m.method||"",onChange:f=>it(s,"feeds",p,{method:f.target.value}),children:[t.jsx("option",{value:"Live",children:"Live"}),t.jsx("option",{value:"Freshly killed",children:"Freshly killed"}),t.jsx("option",{value:"Frozen/thawed",children:"Frozen/thawed"}),t.jsx("option",{value:"Other",children:"Other"})]}),m.method==="Other"&&t.jsx("input",{className:"border rounded-lg px-2 py-1 text-xs w-full sm:w-auto",placeholder:"Method details",value:m.methodDetail||"",onChange:f=>it(s,"feeds",p,{methodDetail:f.target.value})})]}),t.jsx("div",{className:"sm:col-span-7",children:t.jsx("input",{className:"border rounded-lg px-2 py-1 text-xs w-full",placeholder:"Notes",value:m.notes||"",onChange:f=>it(s,"feeds",p,{notes:f.target.value})})}),t.jsxs("div",{className:"sm:col-span-7 flex justify-end items-center gap-2 flex-wrap",children:[t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>it(s,"feeds",p,{refused:!0}),children:"Mark refused"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600",onClick:()=>u("feeds",p),children:"Delete"})]})]},p)),!e.logs.feeds.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Weights"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=rt(new Date);s(p=>({...p,logs:{...p.logs,weights:[...p.logs.weights,{date:m,grams:0,notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:r,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.weights.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:g=>it(s,"weights",p,{date:g.target.value})}),t.jsx("input",{type:"number",className:"border rounded-lg px-2 py-1",placeholder:"grams",value:m.grams,onChange:g=>it(s,"weights",p,{grams:Number(g.target.value)||0})}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:g=>it(s,"weights",p,{notes:g.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-5",onClick:()=>u("weights",p),children:"Delete"})]},p)),!e.logs.weights.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Sheds"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=rt(new Date);s(p=>({...p,logs:{...p.logs,sheds:[...p.logs.sheds,{date:m,complete:!0,notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:l,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.sheds.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:g=>it(s,"sheds",p,{date:g.target.value})}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!m.complete,onChange:g=>it(s,"sheds",p,{complete:g.target.checked})}),"Complete"]}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:g=>it(s,"sheds",p,{notes:g.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-5",onClick:()=>u("sheds",p),children:"Delete"})]},p)),!e.logs.sheds.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Cleanings"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=rt(new Date);s(p=>({...p,logs:{...p.logs,cleanings:[...p.logs.cleanings,{date:m,deep:!1,notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:c,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.cleanings.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:g=>it(s,"cleanings",p,{date:g.target.value})}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!m.deep,onChange:g=>it(s,"cleanings",p,{deep:g.target.checked})}),"Deep clean"]}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:g=>it(s,"cleanings",p,{notes:g.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-5",onClick:()=>u("cleanings",p),children:"Delete"})]},p)),!e.logs.cleanings.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Meds"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=rt(new Date);s(p=>({...p,logs:{...p.logs,meds:[...p.logs.meds,{date:m,drug:"",dose:"",notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:d,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.meds.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:g=>it(s,"meds",p,{date:g.target.value})}),t.jsx("input",{className:"border rounded-lg px-2 py-1",placeholder:"Drug",value:m.drug||"",onChange:g=>it(s,"meds",p,{drug:g.target.value})}),t.jsx("input",{className:"border rounded-lg px-2 py-1",placeholder:"Dose",value:m.dose||"",onChange:g=>it(s,"meds",p,{dose:g.target.value})}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:g=>it(s,"meds",p,{notes:g.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-6",onClick:()=>u("meds",p),children:"Delete"})]},p)),!e.logs.meds.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]})]})}function Od({snakes:e,pairings:s,theme:n="blue",onOpenPairing:o}){const a=new Date,[r,l]=h.useState(a.getFullYear()),[c,d]=h.useState(a.getMonth()),[u,m]=h.useState([]),[p,g]=h.useState({feeds:!0,weights:!0,cleanings:!0,sheds:!0,meds:!0,breeding:!0,clutch:!0}),[f,y]=h.useState(null),[j,w]=h.useState(null),D=h.useMemo(()=>Object.fromEntries(e.map(M=>[M.id,M])),[e]),b=h.useMemo(()=>Object.fromEntries(e.filter(M=>M.sex==="M").map(M=>[M.id,M])),[e]),I=h.useMemo(()=>Object.fromEntries(e.filter(M=>M.sex==="F").map(M=>[M.id,M])),[e]),P=h.useMemo(()=>Object.fromEntries(s.map(M=>[M.id,M])),[s]),{isSupported:E,isReady:k,isSignedIn:R,user:O,calendars:K,selectedCalendarId:S,setSelectedCalendarId:z,isLoadingCalendars:B,isSyncing:F,lastError:de,signIn:U,signOut:A,syncEvents:G}=ic(),le=Wd(r,c),ee=h.useCallback(M=>{g(re=>({...re,[M]:!re[M]}))},[]),pe=h.useCallback(M=>{y(re=>re===M?null:M)},[]),Q=h.useMemo(()=>[{key:"feeds",label:"Feeds"},{key:"weights",label:"Weights"},{key:"cleanings",label:"Cleaning"},{key:"sheds",label:"Sheds"},{key:"meds",label:"Meds"},{key:"breeding",label:"Breeding appointments"},{key:"clutch",label:"Clutch actions"}],[]),se=h.useCallback(M=>{let re=c+M,X=r;for(;re<0;)re+=12,X-=1;for(;re>11;)re-=12,X+=1;l(X),d(re)},[c,r]),xe=h.useCallback(M=>{l(re=>re+M)},[]),oe=5,Ae=7,Oe=h.useCallback((M,re)=>{const X=Zn(M,re),we=[],Ie={};return s.forEach(ie=>{(ie.appointments||[]).forEach(Ke=>{var Ue;const Re=new Date(Ke.date);if(Re.getFullYear()!==M||Re.getMonth()!==re)return;Ie[ie.maleId]||(Ie[ie.maleId]={});const Ve=Re.getDate();Ie[ie.maleId][Ve]||(Ie[ie.maleId][Ve]=[]),Ie[ie.maleId][Ve].push({pairing:ie,appt:Ke,femaleName:((Ue=I[ie.femaleId])==null?void 0:Ue.name)||ie.femaleId})})}),Object.keys(Ie).forEach(ie=>{const Ke=Ie[ie];Object.keys(Ke).map(Re=>Number(Re)).sort((Re,Ve)=>Re-Ve).forEach(Re=>{const Ve=Ke[Re].sort((ut,We)=>(ut.femaleName||"").localeCompare(We.femaleName||"")),Ue=new Set,Xe=ut=>{for(const We of Ue)if(Math.abs(We-ut)<3)return!1;return!0},mt=()=>{for(let We=0;We<50;We++){let qe;We===0?qe=0:We%2===1?qe=(We+1)/2*3:qe=-(We/2)*3;const at=Re+qe;if(!(at<1||at>X)&&!Ue.has(at)&&Xe(at))return at}return null};for(let ut=0;ut<Ve.length;ut++){const We=Ve[ut];let qe=mt();if(qe===null){let _e=null;for(let ot=0;ot<=X;ot++){const Ft=[Re-ot,Re+ot].filter(jt=>jt>=1&&jt<=X);for(const jt of Ft)if(!Ue.has(jt)&&Xe(jt)){_e=jt;break}if(_e!==null)break}qe=_e}if(qe===null){for(let _e=1;_e<=X;_e++)if(!Ue.has(_e)){qe=_e;break}}qe===null&&(qe=Math.min(Math.max(Re,1),X)),Ue.add(qe),qe+1<=X&&Ue.add(qe+1),qe+2<=X&&Ue.add(qe+2);const at=new Date(M,re,qe);for(let _e=0;_e<3;_e++){const ot=new Date(at);ot.setDate(ot.getDate()+_e),ot.getFullYear()===M&&ot.getMonth()===re&&we.push({date:rt(ot),maleId:ie,femaleId:We.pairing.femaleId,pairingId:We.pairing.id,apptId:We.appt.id,type:"pairing",spanOffset:_e,notes:We.appt.notes||"",lockObserved:!!We.appt.lockObserved,lockLoggedAt:We.appt.lockLoggedAt||null})}}})}),s.forEach(ie=>{var Re,Ve,Ue,Xe,ct,mt,ut,We;const Ke=(qe,at)=>{if(!qe)return;const _e=new Date(qe);Number.isNaN(_e.getTime())||_e.getFullYear()!==M||_e.getMonth()!==re||we.push({date:rt(_e),type:"clutch",stage:at,pairingId:ie.id,maleId:ie.maleId,femaleId:ie.femaleId})};(Re=ie==null?void 0:ie.ovulation)!=null&&Re.observed&&((Ve=ie==null?void 0:ie.ovulation)!=null&&Ve.date)&&Ke(ie.ovulation.date,"ovulation"),(Ue=ie==null?void 0:ie.preLayShed)!=null&&Ue.observed&&((Xe=ie==null?void 0:ie.preLayShed)!=null&&Xe.date)&&Ke(ie.preLayShed.date,"preLay"),(ct=ie==null?void 0:ie.clutch)!=null&&ct.recorded&&((mt=ie==null?void 0:ie.clutch)!=null&&mt.date)&&Ke(ie.clutch.date,"clutch"),(ut=ie==null?void 0:ie.hatch)!=null&&ut.recorded&&((We=ie==null?void 0:ie.hatch)!=null&&We.date)&&Ke(ie.hatch.date,"hatch")}),e.forEach(ie=>{const Ke=ie.logs||{},Re=Ve=>{(Ke[Ve]||[]).forEach(Ue=>{try{const Xe=new Date(Ue.date);Xe.getFullYear()===M&&Xe.getMonth()===re&&we.push({date:rt(Xe),type:"activity",activityKey:Ve,snakeId:ie.id,entry:Ue})}catch{}})};["feeds","weights","sheds","cleanings","meds"].forEach(Re)}),we},[s,I,e]),Ge=h.useCallback(()=>{m(Oe(r,c))},[Oe,r,c]);h.useEffect(()=>{Ge()},[Ge]);const W=h.useCallback(M=>{if(M.type==="activity"){const re=M.activityKey;return re?p[re]!==!1:!0}return M.type==="pairing"?!(p.breeding===!1||f&&M.maleId&&M.maleId!==f):M.type==="clutch"?!(p.clutch===!1||f&&M.maleId&&M.maleId!==f):!(f&&M.maleId&&M.maleId!==f)},[p,f]),ce=h.useMemo(()=>u.filter(W),[u,W]),$=h.useMemo(()=>qd({pairings:s,snakes:e}),[s,e]),_=h.useMemo(()=>{const{start:M,end:re}=$;if(!M||!re)return null;const X=M.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),we=re.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"});return X===we?X:`${X} – ${we}`},[$]),ue=h.useMemo(()=>{if(!u.length)return[];const M=new Date;M.setHours(0,0,0,0);const re=new Date(M);re.setDate(re.getDate()+Ae);const X=[];return u.forEach(we=>{var Xe,ct,mt;if(we.type!=="pairing"||typeof we.spanOffset=="number"&&we.spanOffset>0||!we.date)return;const Ie=new Date(`${we.date}T00:00:00`);if(Number.isNaN(Ie.getTime())||(Ie.setHours(0,0,0,0),Ie<M||Ie>re))return;const ie=Math.round((Ie.getTime()-M.getTime())/(24*60*60*1e3)),Ke=((Xe=b[we.maleId])==null?void 0:Xe.name)||we.maleId||"Male",Re=((ct=I[we.femaleId])==null?void 0:ct.name)||we.femaleId||"Female",Ve=((mt=P[we.pairingId])==null?void 0:mt.label)||"";let Ue=Ie.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"});ie===0?Ue="Today":ie===1&&(Ue="Tomorrow"),X.push({id:`${we.pairingId||we.maleId||"pairing"}-${we.date}`,maleName:Ke,femaleName:Re,pairingLabel:Ve,whenLabel:Ue,diffDays:ie})}),X.sort((we,Ie)=>we.diffDays!==Ie.diffDays?we.diffDays-Ie.diffDays:we.maleName.localeCompare(Ie.maleName))},[u,b,I,P,Ae]),me=h.useCallback((M,re,X)=>{const we=[];let Ie=M,ie=re;for(let Ke=0;Ke<X;Ke++)we.push(...Oe(Ie,ie)),ie+=1,ie>11&&(ie=0,Ie+=1);return we},[Oe]),Ce=h.useMemo(()=>{if(!E)return[];if(!ce.length)return[];const M=new Set;return ce.map(re=>Ca(re,{pairingsById:P,snakesById:D,malesById:b,femalesById:I})).filter(re=>!re||re.uid&&M.has(re.uid)?!1:(re.uid&&M.add(re.uid),!0))},[E,ce,P,D,b,I]),Ne=h.useMemo(()=>{if(!E)return[];const M=me(r,c,oe).filter(X=>X.type==="pairing").filter(W);if(!M.length)return[];const re=new Set;return M.map(X=>Ca(X,{pairingsById:P,snakesById:D,malesById:b,femalesById:I})).filter(X=>!X||X.uid&&re.has(X.uid)?!1:(X.uid&&re.add(X.uid),!0))},[E,me,r,c,oe,W,P,D,b,I]),Ee=h.useMemo(()=>{if(!Array.isArray(K))return[];const M=new Set;return K.reduce((re,X)=>(!(X!=null&&X.id)||M.has(X.id)||(M.add(X.id),re.push({id:X.id,summary:X.summary||X.id})),re),[])},[K]),$e=h.useMemo(()=>{if(!S)return"Google Calendar";const M=Ee.find(re=>re.id===S);return M?M.summary:S==="primary"?"Primary calendar":"Google Calendar"},[S,Ee]),Pe=h.useMemo(()=>{if(F)return"Syncing...";const M=Ce.length;return M?`Sync ${M} event${M===1?"":"s"}`:"Sync to Google"},[F,Ce]),ae=!R||F||!Ce.length,H=!k||B||F,J=h.useMemo(()=>{if(F)return"Syncing...";const M=Ne.length;return M?`Sync ${M} events (${oe} mo)`:`Sync ${oe} months`},[F,Ne,oe]),ge=!R||F||!Ne.length,Se=h.useMemo(()=>new Date(r,c,1).toLocaleString(void 0,{month:"long",year:"numeric"}),[r,c]),Be=h.useMemo(()=>new Date(r,c+oe-1,1).toLocaleString(void 0,{month:"long",year:"numeric"}),[r,c,oe]);h.useEffect(()=>{de&&w({kind:"error",text:de.message||String(de)})},[de]),h.useEffect(()=>{R||w(null)},[R]);const He=h.useCallback(()=>{if(!ce.length){window.alert("No calendar entries to export for the current view. Try adjusting your filters or refreshing first.");return}const M=ja({events:ce,pairingsById:P,snakesById:D,malesById:b,femalesById:I});if(!M){window.alert("Unable to build the calendar export. Please try again.");return}const re=new Blob([M],{type:"text/calendar;charset=utf-8"}),X=String(c+1).padStart(2,"0"),we=`breeding-planner-${r}-${X}.ics`,Ie=URL.createObjectURL(re),ie=document.createElement("a");ie.href=Ie,ie.download=we,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),setTimeout(()=>URL.revokeObjectURL(Ie),0)},[ce,P,D,b,I,c,r]),Qe=h.useCallback(()=>{const{start:M,end:re}=$;if(!M||!re){window.alert("No calendar entries found to export. Add appointments or logs first.");return}const X=M.getFullYear(),we=M.getMonth(),Ie=re.getFullYear(),ie=re.getMonth(),Ke=Vd(X,we,Ie,ie),Re=me(X,we,Ke).filter(W);if(!Re.length){window.alert("No calendar entries matched your current filters for the full range. Adjust filters and try again.");return}const Ve=[],Ue=new Set;Re.forEach(_e=>{const ot=[_e.type||"",_e.date||"",_e.pairingId||"",_e.apptId||"",_e.snakeId||"",_e.activityKey||"",_e.stage||""].join("|");Ue.has(ot)||(Ue.add(ot),Ve.push(_e))});const Xe=ja({events:Ve,pairingsById:P,snakesById:D,malesById:b,femalesById:I});if(!Xe){window.alert("Unable to build the calendar export. Please try again.");return}const ct=`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}`,mt=`${re.getFullYear()}-${String(re.getMonth()+1).padStart(2,"0")}`,ut=`breeding-planner-${ct}-to-${mt}.ics`,We=new Blob([Xe],{type:"text/calendar;charset=utf-8"}),qe=URL.createObjectURL(We),at=document.createElement("a");at.href=qe,at.download=ut,document.body.appendChild(at),at.click(),document.body.removeChild(at),setTimeout(()=>URL.revokeObjectURL(qe),0)},[$,me,W,P,D,b,I]),ve=h.useCallback(async()=>{if(!E){w({kind:"error",text:"Google Calendar sync is not configured. Add VITE_GOOGLE_CLIENT_ID and reload."});return}if(!R){k&&U(),w({kind:"info",text:"Connect Google Calendar and try syncing again."});return}if(!Ce.length){w({kind:"info",text:"No events in the current view to sync."});return}try{w({kind:"info",text:"Syncing events to Google Calendar..."});const{synced:M=0}=await G(Ce);w({kind:"success",text:`Synced ${M} event${M===1?"":"s"} to ${$e}.`})}catch(M){const re=M instanceof Error?M.message:String(M);w({kind:"error",text:re})}},[E,R,k,U,Ce,G,$e]),pt=h.useCallback(()=>{if(!E){w({kind:"error",text:"Google Calendar sync is not available. Add VITE_GOOGLE_CLIENT_ID and reload."});return}if(!k){w({kind:"info",text:"Preparing Google services. Please try again in a moment."});return}H||(w({kind:"info",text:"Opening Google sign-in..."}),U())},[E,k,H,U]),fe=h.useCallback(async()=>{if(!E){w({kind:"error",text:"Google Calendar sync is not configured. Add VITE_GOOGLE_CLIENT_ID and reload."});return}if(!R){k&&U(),w({kind:"info",text:"Connect Google Calendar and try syncing again."});return}if(!Ne.length){w({kind:"info",text:`No breeding appointments found between ${Se} and ${Be}.`});return}try{w({kind:"info",text:`Syncing ${Ne.length} breeding appointments from ${Se} to ${Be}...`});const{synced:M=0}=await G(Ne);w({kind:"success",text:`Synced ${M} event${M===1?"":"s"} from ${Se} to ${Be} into ${$e}.`})}catch(M){const re=M instanceof Error?M.message:String(M);w({kind:"error",text:re})}},[E,R,k,U,Ne,Se,Be,G,$e]),De=h.useMemo(()=>Array.from(new Set(u.filter(re=>re.type==="pairing").map(re=>re.maleId).filter(Boolean))).map(re=>{var X;return{id:re,name:((X=b[re])==null?void 0:X.name)||re,colors:re?ka(re,n):null,isActive:f===re}}),[u,b,n,f]);return t.jsxs("div",{className:"bg-white border rounded-2xl shadow-sm",children:[t.jsxs("div",{className:"px-4 py-3 border-b flex flex-wrap items-center gap-3",children:[t.jsx("div",{className:"font-semibold mr-2",children:"Monthly calendar"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>se(-1),"aria-label":"Previous month",children:"←"}),t.jsx("select",{className:"border rounded-lg px-2 py-1 text-sm",value:c,onChange:M=>d(Number(M.target.value)),children:Array.from({length:12},(M,re)=>re).map(M=>t.jsx("option",{value:M,children:new Date(2e3,M,1).toLocaleString("en",{month:"long"})},M))}),t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>se(1),"aria-label":"Next month",children:"→"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>xe(-1),"aria-label":"Previous year",children:"←"}),t.jsx("input",{className:"border rounded-lg px-2 py-1 w-24",type:"number",value:r,onChange:M=>l(Number(M.target.value)||r)}),t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>xe(1),"aria-label":"Next year",children:"→"})]}),t.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[E?R?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-2 border rounded-lg px-2 py-1 bg-white text-xs",children:[t.jsxs("div",{className:"leading-tight",children:[t.jsx("div",{className:"font-semibold text-[11px]",children:(O==null?void 0:O.name)||(O==null?void 0:O.email)||"Google account"}),O!=null&&O.email?t.jsx("div",{className:"text-[10px] text-neutral-600",children:O.email}):null]}),t.jsx("button",{type:"button",className:"text-[11px] text-rose-600 disabled:opacity-60",onClick:A,disabled:F,children:"Sign out"})]}),t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-sm min-w-[160px]",value:S||"primary",onChange:M=>z(M.target.value),disabled:B||F,title:`Sync target: ${$e}`,children:[t.jsx("option",{value:"primary",children:"Primary calendar"}),Ee.filter(M=>M.id!=="primary").map(M=>t.jsx("option",{value:M.id,children:M.summary},M.id))]}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-xl text-sm",Fe(n,!0),ae?"opacity-60 cursor-not-allowed":""),onClick:ve,disabled:ae,title:Ce.length?`Ready to sync ${Ce.length} event${Ce.length===1?"":"s"}`:void 0,children:Pe}),t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-xl text-sm border bg-white",ge?"opacity-60 cursor-not-allowed":""),onClick:fe,disabled:ge,title:Ne.length?`Sync ${Ne.length} breeding event${Ne.length===1?"":"s"} spanning ${Se} to ${Be}`:`No breeding appointments found between ${Se} and ${Be}`,children:J})]}):t.jsx("button",{type:"button",className:te("px-3 py-2 rounded-xl text-sm",Fe(n,!0),H?"opacity-60 cursor-not-allowed":""),onClick:pt,disabled:H,children:k?"Connect Google Calendar":"Preparing Google..."}):t.jsxs("div",{className:"text-[11px] text-neutral-500 max-w-xs",children:["Set ",t.jsx("code",{children:"VITE_GOOGLE_CLIENT_ID"})," to enable Google Calendar sync."]}),t.jsx("button",{className:te("px-3 py-2 rounded-xl text-sm",Fe(n,!0)),onClick:Ge,children:"Refresh"}),t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:He,children:"Export Google Calendar"}),t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:Qe,title:_?`Download appointments from ${_}`:"Download all appointments",children:"Export Full Calendar"})]})]}),j?t.jsx("div",{className:te("px-4 py-2 text-xs border-b",j.kind==="error"?"bg-rose-50 text-rose-700 border-rose-200":j.kind==="success"?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-sky-50 text-sky-700 border-sky-200"),children:j.text}):null,ue.length?t.jsxs("div",{className:"px-4 py-2 border-b bg-amber-50 text-amber-800 text-xs",children:[t.jsx("div",{className:"text-[11px] uppercase tracking-wide font-semibold text-amber-700",children:"Upcoming pairings"}),t.jsx("ul",{className:"mt-1 space-y-1",children:ue.map(M=>t.jsxs("li",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-0.5",children:[t.jsxs("span",{className:"font-medium",children:["Pair ",M.maleName," with ",M.femaleName]}),t.jsxs("span",{className:"text-[11px] text-amber-600",children:[M.whenLabel,M.pairingLabel?` • ${M.pairingLabel}`:""]})]},M.id))})]}):null,t.jsx("div",{className:"px-4 py-3 border-b bg-neutral-50",children:t.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-neutral-700",children:Q.map(M=>t.jsxs("label",{className:te("flex items-center gap-2 rounded-lg border px-2 py-1 bg-white",p[M.key]?"border-sky-200 shadow-sm":"border-neutral-200 opacity-80"),children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!p[M.key],onChange:()=>ee(M.key)}),t.jsx("span",{children:M.label})]},M.key))})}),t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"grid grid-cols-7 text-xs font-medium text-neutral-500",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(M=>t.jsx("div",{className:"p-2",children:M},M))}),t.jsx("div",{className:"grid grid-cols-7 gap-px bg-neutral-200 rounded-lg overflow-hidden",children:le.map((M,re)=>t.jsxs("div",{className:te("min-h[110px] bg-white p-2",M.current?"":"bg-neutral-50"),children:[t.jsx("div",{className:"text-xs text-neutral-500",children:M.day}),ce.filter(X=>X.date===Yd(M.year,M.month,M.day)).map((X,we)=>{var Xe,ct,mt,ut,We,qe,at,_e,ot,Ft,jt,Ct;if(X.type==="activity"){const ke=mo[X.activityKey]||{bg:"#efefef",border:"#ddd"},yt=e.find(Ye=>Ye.id===X.snakeId);if(X.activityKey==="feeds"&&X.entry){const Ye=X.entry,Ht=(Ye.feed||Ye.item||"").trim(),C=(Ye.size||"").trim(),T=typeof Ye.weightGrams=="number"&&Ye.weightGrams>0?`${Ye.weightGrams} g`:typeof Ye.grams=="number"&&Ye.grams>0?`${Ye.grams} g`:"",q=Ye.method?Ye.methodDetail?`${Ye.method} (${Ye.methodDetail})`:Ye.method:"";let ye="";if(!Ye.refused){const Ze=[];Ht&&Ze.push(Ht),C&&Ze.push(C),T&&Ze.push(T),q&&Ze.push(q),ye=Ze.join(" • ")}const Le=Ye.refused?"Refused feed":ye||"Feed";return t.jsx("div",{className:te("text-[11px] px-2 py-1 rounded-full border flex items-start gap-2"),style:{backgroundColor:ke.bg,borderColor:ke.border},children:t.jsxs("div",{className:"truncate",children:[t.jsxs("div",{className:"font-medium truncate",children:[(yt==null?void 0:yt.name)||X.snakeId," • ",Le]}),Ye.refused&&ye?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:ye}):null,Ye.notes?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:Ye.notes}):null]})},we)}return t.jsxs("div",{className:te("text-[11px] px-2 py-0.5 rounded-full border flex items-center gap-2"),style:{backgroundColor:ke.bg,borderColor:ke.border},children:[t.jsx("span",{className:"font-medium",children:(yt==null?void 0:yt.name)||X.snakeId}),t.jsx("span",{className:"text-xs text-neutral-700",children:X.activityKey.replace(/s$/,"")})]},we)}if(X.type==="clutch"){const ke=s.find(q=>q.id===X.pairingId),yt=((Xe=b[X.maleId])==null?void 0:Xe.name)||X.maleId,Ye=((ct=I[X.femaleId])==null?void 0:ct.name)||X.femaleId,Ht={ovulation:"Ovulation observed",preLay:"Pre-lay shed",clutch:"Clutch laid",hatch:"Hatch recorded"},C={ovulation:"border-sky-200 bg-sky-50",preLay:"border-amber-200 bg-amber-50",clutch:"border-rose-200 bg-rose-50",hatch:"border-emerald-200 bg-emerald-50"};let T="";if(X.stage==="clutch"){const q=(mt=ke==null?void 0:ke.clutch)==null?void 0:mt.eggsTotal,ye=(ut=ke==null?void 0:ke.clutch)==null?void 0:ut.slugs,Le=[];typeof q=="number"&&Number.isFinite(q)&&Le.push(`Eggs: ${q}`),typeof ye=="number"&&Number.isFinite(ye)&&Le.push(`Slugs: ${ye}`),Le.length?T=Le.join(" • "):(We=ke==null?void 0:ke.clutch)!=null&&We.notes&&(T=ke.clutch.notes)}else if(X.stage==="hatch"){const q=(qe=ke==null?void 0:ke.hatch)==null?void 0:qe.hatchedCount;typeof q=="number"&&Number.isFinite(q)?T=`Hatched: ${q}`:(at=ke==null?void 0:ke.hatch)!=null&&at.notes&&(T=ke.hatch.notes)}else X.stage==="preLay"?(_e=ke==null?void 0:ke.preLayShed)!=null&&_e.intervalFromOvulation&&Number.isFinite(ke.preLayShed.intervalFromOvulation)?T=`${ke.preLayShed.intervalFromOvulation} days after ovulation`:(ot=ke==null?void 0:ke.preLayShed)!=null&&ot.notes&&(T=ke.preLayShed.notes):X.stage==="ovulation"&&(T=((Ft=ke==null?void 0:ke.ovulation)==null?void 0:Ft.notes)||"");return t.jsxs("button",{onClick:()=>{o&&o(X.pairingId)},className:te("text-xs px-2 py-1 rounded-lg border flex flex-col text-left w-full",C[X.stage]||"border-neutral-200 bg-neutral-50"),children:[t.jsx("div",{className:"font-medium truncate",children:Ht[X.stage]||"Clutch action"}),t.jsxs("div",{className:"text-[11px] text-neutral-500 truncate",children:[yt," × ",Ye]}),T?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:T}):null]},we)}const Ie=s.find(ke=>ke.id===X.pairingId),ie=((jt=b[X.maleId])==null?void 0:jt.name)||X.maleId,Ke=((Ct=I[X.femaleId])==null?void 0:Ct.name)||X.femaleId,Re=ka(X.maleId,n),Ve=X.spanOffset===0&&X.lockObserved&&X.lockLoggedAt?rr(X.lockLoggedAt):null;let Ue=null;return X.spanOffset===0&&X.notes&&(Ue=X.notes.split(`
`).map(yt=>yt.trim()).filter(Boolean).find(yt=>!Ve||yt!==Ve)||null),t.jsxs("button",{onClick:()=>{o&&o(X.pairingId)},className:"text-xs px-2 py-1 rounded-lg border flex items-center gap-2 text-left w-full",style:{borderColor:Re.border,background:Re.fill},children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-1 align-middle",style:{backgroundColor:Re.dot}}),t.jsxs("div",{className:"truncate",children:[t.jsxs("div",{className:"font-medium truncate",children:[ie," × ",Ke]}),Ie!=null&&Ie.label?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:Ie.label}):null,Ve?t.jsx("div",{className:"text-[11px] text-emerald-600 truncate",children:Ve}):null,Ue?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:Ue}):null]})]},we)})]},re))}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[De.map(M=>{const re=M.colors?{borderColor:M.colors.border,background:M.isActive?M.colors.fill:void 0,opacity:f&&!M.isActive?.5:1}:void 0;return t.jsxs("button",{type:"button",onClick:()=>pe(M.id),className:"text-xs px-2 py-1 border rounded-lg flex items-center gap-1 transition-opacity",style:re,"aria-pressed":M.isActive,children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-1 align-middle",style:M.colors?{backgroundColor:M.colors.dot}:void 0}),M.name]},M.id)}),!De.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No appointments in this view."})]})]})]})}function ja({events:e,pairingsById:s,snakesById:n,malesById:o,femalesById:a}){if(!Array.isArray(e)||e.length===0)return"";const r=Hd(new Date),l=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Breeding Planner//EN","CALSCALE:GREGORIAN","X-WR-CALNAME:Breeding Planner"];return e.forEach(c=>{const d=Ud(c,{dtStamp:r,pairingsById:s,snakesById:n,malesById:o,femalesById:a});Array.isArray(d)&&d.length&&l.push(...d)}),l.push("END:VCALENDAR"),l.join(`\r
`)}function uo(e,s){var g,f,y,j,w,D;if(!e||!e.date)return null;const n=new Date(`${e.date}T00:00:00`);if(Number.isNaN(n.getTime()))return null;const o=[];let a="",r=1;const l=e.pairingId?(g=s.pairingsById)==null?void 0:g[e.pairingId]:null,c=e.maleId?((y=(f=s.malesById)==null?void 0:f[e.maleId])==null?void 0:y.name)||(l==null?void 0:l.maleId)||e.maleId:"",d=e.femaleId?((w=(j=s.femalesById)==null?void 0:j[e.femaleId])==null?void 0:w.name)||(l==null?void 0:l.femaleId)||e.femaleId:"";if(e.type==="pairing"){if(typeof e.spanOffset=="number"&&e.spanOffset>0)return null;r=3,a=`Breeding: ${c||"Male"} × ${d||"Female"}`,l!=null&&l.label&&o.push(`Project: ${l.label}`),e.lockObserved&&e.lockLoggedAt&&o.push(rr(e.lockLoggedAt)),e.notes&&o.push(e.notes)}else if(e.type==="clutch"){a=`${{ovulation:"Ovulation observed",preLay:"Pre-lay shed",clutch:"Clutch laid",hatch:"Hatch recorded"}[e.stage]||"Clutch event"}: ${c||"Male"} × ${d||"Female"}`;const I=Gd(e.stage,l);I&&o.push(I)}else if(e.type==="activity"){const b=(D=s.snakesById)==null?void 0:D[e.snakeId],I=e.activityKey?e.activityKey.replace(/s$/,""):"Activity",P=(b==null?void 0:b.name)||e.snakeId||"";a=`${Zt(I)}${P?`: ${P}`:""}`;const E=Bd(e.activityKey,e.entry);E&&o.push(E)}else return null;if(!a)return null;const u=new Date(n);u.setDate(u.getDate()+r);const p=[e.type||"event",e.date||"",e.pairingId||"",e.apptId||"",e.snakeId||"",e.activityKey||"",e.stage||""].filter(Boolean).join("-")||`event-${Jn(n)}`;return{summary:a,descriptionParts:o,description:o.join(`
`),startDate:n,endDate:u,durationDays:r,uid:p}}function Ud(e,s){const n=uo(e,s);if(!n)return null;const o=Jn(n.startDate),a=Jn(n.endDate);if(!o||!a)return null;const r=`${n.uid}@breeding-planner`,l=["BEGIN:VEVENT",`UID:${Pn(r)}`,`DTSTAMP:${s.dtStamp}`,`DTSTART;VALUE=DATE:${o}`,`DTEND;VALUE=DATE:${a}`,`SUMMARY:${Pn(n.summary)}`];return n.description&&l.push(`DESCRIPTION:${Pn(n.description)}`),l.push("STATUS:CONFIRMED"),l.push("END:VEVENT"),l}function Ca(e,s){const n=uo(e,s);if(!n)return null;const o=Sa(n.startDate),a=Sa(n.endDate);if(!o||!a)return null;const r=(()=>{if(typeof window>"u")return{title:"Breeding Planner"};try{return{title:"Breeding Planner",url:window.location.origin}}catch{return{title:"Breeding Planner"}}})();return{uid:n.uid,summary:n.summary,description:n.description,startDate:o,endDate:a,source:r,extendedProperties:{private:{breedingPlannerId:n.uid,breedingPlannerVersion:"1"}}}}function Gd(e,s){var n,o,a,r,l,c,d,u;if(!s)return"";if(e==="clutch"){const m=[],p=(n=s==null?void 0:s.clutch)==null?void 0:n.eggsTotal;typeof p=="number"&&Number.isFinite(p)&&m.push(`Eggs: ${p}`);const g=(o=s==null?void 0:s.clutch)==null?void 0:o.slugs;return typeof g=="number"&&Number.isFinite(g)&&m.push(`Slugs: ${g}`),m.length?m.join(`
`):((a=s==null?void 0:s.clutch)==null?void 0:a.notes)||""}if(e==="hatch"){const m=(r=s==null?void 0:s.hatch)==null?void 0:r.hatchedCount;return typeof m=="number"&&Number.isFinite(m)?`Hatched: ${m}`:((l=s==null?void 0:s.hatch)==null?void 0:l.notes)||""}if(e==="preLay"){const m=(c=s==null?void 0:s.preLayShed)==null?void 0:c.intervalFromOvulation;return typeof m=="number"&&Number.isFinite(m)?`${m} days after ovulation`:((d=s==null?void 0:s.preLayShed)==null?void 0:d.notes)||""}return e==="ovulation"&&((u=s==null?void 0:s.ovulation)==null?void 0:u.notes)||""}function Bd(e,s){if(!s)return"";const n=[];if(e==="feeds"){const o=[];s.feed?o.push(s.feed):s.item&&o.push(s.item),s.size&&o.push(s.size),o.length&&n.push(`Item: ${o.join(" ")}`);const a=typeof s.weightGrams=="number"&&s.weightGrams>0?`${s.weightGrams} g`:typeof s.grams=="number"&&s.grams>0?`${s.grams} g`:null;if(a&&n.push(`Weight: ${a}`),s.method){const r=s.methodDetail?`${s.method} (${s.methodDetail})`:s.method;n.push(`Method: ${r}`)}return s.notes&&n.push(`Notes: ${s.notes}`),n.join(`
`)}return e==="weights"?(typeof s.grams=="number"&&s.grams>0&&n.push(`Weight: ${s.grams} g`),typeof s.weightGrams=="number"&&s.weightGrams>0&&n.push(`Weight: ${s.weightGrams} g`),s.notes&&n.push(`Notes: ${s.notes}`),n.join(`
`)):e==="cleanings"?(s.deep===!0&&n.push("Deep clean"),s.notes&&n.push(`Notes: ${s.notes}`),n.join(`
`)):e==="sheds"?(s.complete===!0&&n.push("Complete shed"),s.complete===!1&&n.push("Incomplete shed"),s.notes&&n.push(`Notes: ${s.notes}`),n.join(`
`)):e==="meds"?(s.drug&&n.push(`Drug: ${s.drug}`),s.dose&&n.push(`Dose: ${s.dose}`),s.notes&&n.push(`Notes: ${s.notes}`),n.join(`
`)):zd(s)}function zd(e){const s=[];return Object.entries(e||{}).forEach(([n,o])=>{n==="date"||n==="id"||n==="createdAt"||n==="updatedAt"||o==null||o===""||typeof o!="object"&&s.push(`${Zt(n)}: ${o}`)}),s.join(`
`)}function Pn(e){return String(e||"").replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;")}function Jn(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";const s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${s}${n}${o}`}function Hd(e){return!(e instanceof Date)||Number.isNaN(e.getTime())?"":e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}Z$/,"Z")}function Sa(e){if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";const s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${o}`}function Vd(e,s,n,o){if(!Number.isFinite(e)||!Number.isFinite(s)||!Number.isFinite(n)||!Number.isFinite(o))return 1;const a=e*12+s,r=n*12+o;if(!Number.isFinite(a)||!Number.isFinite(r))return 1;const l=r-a;return l>=0?l+1:1}function qd({pairings:e=[],snakes:s=[]}){let n=null,o=null;const a=r=>{if(!r)return;const l=new Date(r);Number.isNaN(l.getTime())||(l.setHours(0,0,0,0),(!n||l<n)&&(n=new Date(l)),(!o||l>o)&&(o=new Date(l)))};return(Array.isArray(e)?e:[]).forEach(r=>{var c,d,u,m,p;if(!r)return;const l=dt({...r});(Array.isArray(l.appointments)?l.appointments:[]).forEach(g=>a(g==null?void 0:g.date)),a((c=l==null?void 0:l.ovulation)==null?void 0:c.date),a((d=l==null?void 0:l.preLayShed)==null?void 0:d.date),a((u=l==null?void 0:l.clutch)==null?void 0:u.date),a((m=l==null?void 0:l.hatch)==null?void 0:m.date),a((p=l==null?void 0:l.hatch)==null?void 0:p.scheduledDate)}),(Array.isArray(s)?s:[]).forEach(r=>{!r||!r.logs||["feeds","weights","sheds","cleanings","meds"].forEach(l=>{(Array.isArray(r.logs[l])?r.logs[l]:[]).forEach(d=>a(d==null?void 0:d.date))})}),{start:n,end:o}}function Zn(e,s){return new Date(e,s+1,0).getDate()}function Yd(e,s,n){return`${e}-${String(s+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`}function Wd(e,s){const n=new Date(e,s,1).getDay(),o=Zn(e,s),a=s-1,r=a<0?e-1:e,l=Zn(r,(a+12)%12),c=[];for(let m=0;m<n;m++)c.push({year:r,month:(a+12)%12,day:l-n+1+m,current:!1});for(let m=1;m<=o;m++)c.push({year:e,month:s,day:m,current:!0});const d=(s+1)%12,u=d===0?e+1:e;for(;c.length%7;)c.push({year:u,month:d,day:c.length%7,current:!1});return c}function Qd(e){const s=typeof e=="string"||typeof e=="number"?String(e):"";let n=0;for(let o=0;o<s.length;o++)n=n*31+s.charCodeAt(o)>>>0;return n}function ka(e,s="blue"){const o=Qd(e)%360,a=s==="dark"?55:62,r=s==="dark"?55:45,l=s==="dark"?38:50,c=s==="dark"?22:92,d=s==="dark"?.35:.25;return{border:`hsl(${o}, ${a}%, ${l}%)`,dot:`hsl(${o}, ${a}%, ${r}%)`,fill:`hsla(${o}, ${a}%, ${c}%, ${d})`}}const mo={feeds:{bg:"#9EB7B8",border:"#9EB7B8"},weights:{bg:"#BBC7B4",border:"#BBC7B4"},cleanings:{bg:"#E6B6A0",border:"#E6B6A0"},sheds:{bg:"#ECD1A5",border:"#ECD1A5"},meds:{bg:"#DCAD9A",border:"#DCAD9A"},groups:{bg:"#FAF5EE",border:"#FAF5EE"},pairing:{bg:"#ECB5CE",border:"#ECB5CE"}},Kd="bg-violet-200 border border-violet-300 text-violet-800",cn={Het:Kd,Recessive:"bg-violet-300 border border-violet-400","Incomplete Dominant":"bg-rose-300 border border-rose-400",Dominant:"bg-sky-300 border border-sky-400",Other:"bg-emerald-300 border border-emerald-400"};function Xd(e,s){if(Lc(e))return cn.Het;const n=s||gs(e);return cn[n]||cn.Other}const Jd=[{key:"Recessive",label:"Recessive"},{key:"Het",label:"Het / Possible Het"},{key:"Incomplete Dominant",label:"Incomplete Dominant"},{key:"Dominant",label:"Dominant"},{key:"Other",label:"Other / Polygenic"}],Aa={sm:{container:"text-[11px]",label:"text-[10px]",chip:"text-[11px] px-2 py-0.5"},md:{container:"text-sm",label:"text-[11px]",chip:"text-xs px-2 py-0.5"},xs:{container:"text-[10px]",label:"text-[9px]",chip:"text-[10px] px-1.5 py-0.5"}};function cr({label:e,genes:s=[],size:n="sm",className:o}){const a=Array.isArray(s)?s.filter(Boolean):[];if(!a.length)return null;const r=Aa[n]||Aa.sm;return t.jsxs("div",{className:te("flex flex-wrap items-center gap-1 leading-snug",r.container,o),children:[t.jsxs("span",{className:te("uppercase tracking-wide text-neutral-500 mr-1",r.label),children:[e,":"]}),a.map((l,c)=>{const d=gs(l),u=Xd(l,d);return t.jsx("span",{className:te("inline-flex items-center rounded-md border font-medium break-words",r.chip,u),children:l},`${e}-${l}-${c}`)})]})}function Zd({className:e}){return t.jsx("div",{className:te("flex flex-wrap items-center justify-center gap-3 text-[11px] font-normal",e),children:Jd.map(s=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:te("inline-block h-3 w-3 rounded-sm",cn[s.key])}),t.jsx("span",{className:"text-neutral-600 whitespace-nowrap",children:s.label})]},s.key))})}function eu({theme:e="blue",className:s}){const[n,o]=h.useState(!1);return h.useEffect(()=>{function a(){o(window.scrollY>200)}return window.addEventListener("scroll",a,{passive:!0}),a(),()=>window.removeEventListener("scroll",a)},[]),t.jsx("button",{type:"button",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:te("fixed bottom-6 right-6 z-50 rounded-full shadow-lg border backdrop-blur-sm transition-opacity duration-200 flex items-center justify-center h-12 w-12 text-white",n?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none",Fe(e,!0),s),"aria-label":"Scroll to top",children:t.jsx("span",{className:"text-xl leading-none",children:"↑"})})}function ps(e,s){const n=new Date(e);return n.setDate(n.getDate()+s),`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`}const tu=rl.createRoot(document.getElementById("root"));tu.render(t.jsx(al.StrictMode,{children:t.jsx(td,{})}));
