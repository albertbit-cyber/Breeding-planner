const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf-BBNVmQfp.js","assets/vendor-CCGeIgWZ.js","assets/pdfjs-DJpon-Fg.js"])))=>i.map(i=>d[i]);
import{r as h,j as t,c as Yl,R as Wl}from"./vendor-react-szI2idXW.js";import{_ as ns}from"./jspdf-BBNVmQfp.js";import{b as Pn,j as Ql}from"./vendor-CCGeIgWZ.js";import{p as $n}from"./pdfjs-DJpon-Fg.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const bt=1e-6,Tt=()=>({0:0,1:0,2:0}),on=e=>({0:e[0]??0,1:e[1]??0,2:e[2]??0}),Sr=Object.freeze({0:1,1:0,2:0}),Kl=e=>e.trim().toLowerCase().replace(/\s+/g," "),Xl=e=>{let s=e.trim();return s?(s=s.replace(/\(([^)]*)\)/g," $1 "),s=s.replace(/\b(?:possible|pos|probable|het|ph|carrier)\b/gi,""),s=s.replace(/\d+(?:\.\d+)?\s*%/g,""),s=s.replace(/\s+/g," ").trim(),s||(s=e.trim()),s.split(" ").filter(Boolean).map(a=>a.length<=2?a.toUpperCase():/^[A-Z]+$/.test(a)?a:a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ")||e.trim()):""},kr=e=>Math.abs(e[2]-1)<bt?3:Math.abs(e[1]-1)<bt?2:e[1]>bt?1:0,Jl=(e,s)=>{const n=e[1]??0,l=s[1]??0,a=1-(1-n)*(1-l),r=Tt();return r[1]=a,r[0]=1-a,r},Zl=(e,s,n,l)=>{const a=kr(l);return e?(a>e.level?(e.distribution=on(l),e.level=a):a===e.level&&a===1&&(e.distribution=Jl(e.distribution,l),e.level=kr(e.distribution)),(n==="recessive"||!e.type||e.type!==n&&n==="co-dom"&&e.type==="dominant")&&(e.type=n),e):{gene:s,type:n,distribution:on(l),level:a}},eo=e=>{const s=e.trim();return/^super\s+/i.test(s)?{gene:s.replace(/^super\s+/i,"").trim(),alleleCount:2}:{gene:s,alleleCount:1}},to=e=>{const s=e.match(/(\d+(?:\.\d+)?)\s*%/);if(s){const n=Number(s[1]);if(!Number.isNaN(n))return Math.max(0,Math.min(1,n/100))}},Ar=e=>{const s=new Map,n=(l,a,r)=>{const o=Xl(l),c=Kl(o),d=s.get(c);s.set(c,Zl(d,o,a,r))};return(e.morphs||[]).forEach(l=>{if(!(l!=null&&l.name))return;const a=l.name.trim();if(a)if(l.type==="recessive"){const r=Tt();r[2]=1,n(a,"recessive",r)}else if(l.type==="co-dom"){const r=eo(a),o=Tt();o[r.alleleCount]=1,n(r.gene,"co-dom",o)}else if(l.type==="dominant"||l.type==="polygenic"||l.type==="co-dom"){const r=Tt();r[1]=1,n(a,"dominant",r)}else{const r=Tt();r[1]=1,n(a,"dominant",r)}}),(e.hets||[]).forEach(l=>{if(!l)return;const a=Tt();a[1]=1,n(l,"recessive",a)}),(e.possibleHets||[]).forEach(l=>{if(!l)return;const a=to(l)??.5,r=Tt();r[1]=a,r[0]=1-a,n(l,"recessive",r)}),s},Dr=e=>e<=0?0:e>=2?1:.5,so=(e,s)=>{const n=Tt(),l=[[0,e[0]??0],[1,e[1]??0],[2,e[2]??0]],a=[[0,s[0]??0],[1,s[1]??0],[2,s[2]??0]];l.forEach(([o,c])=>{c<=bt||a.forEach(([d,u])=>{if(u<=bt)return;const m=c*u,p=Dr(o),b=Dr(d),f=p*b,N=p*(1-b),S=(1-p)*b,A=N+S,E=(1-p)*(1-b);n[2]+=m*f,n[1]+=m*A,n[0]+=m*E})});const r=n[0]+n[1]+n[2];return r>bt&&(n[0]/=r,n[1]/=r,n[2]/=r),n},no=(e,s,n)=>{const l=[],a=(r,o)=>{r>bt&&l.push({labels:o,prob:r})};if(s==="recessive")a(n[2]??0,[e]),a(n[1]??0,[`het ${e}`]),a(n[0]??0,[]);else if(s==="co-dom")a(n[2]??0,[`Super ${e}`]),a(n[1]??0,[e]),a(n[0]??0,[]);else{const r=(n[1]??0)+(n[2]??0);a(r,[e]),a(n[0]??0,[])}return l.length?l:[{labels:[],prob:1}]},ro=(e,s)=>{const n=Ar(e),l=Ar(s),a=new Set([...n.keys(),...l.keys()]);return Array.from(a).map(r=>{const o=n.get(r),c=l.get(r),d=(o==null?void 0:o.gene)??(c==null?void 0:c.gene)??r,u=(o==null?void 0:o.type)??(c==null?void 0:c.type)??"recessive",m=o?o.distribution:on(Sr),p=c?c.distribution:on(Sr);return{gene:d,type:u,parentA:m,parentB:p}})},ao=e=>{let s=[{labels:[],prob:1}];e.forEach(r=>{const o=so(r.parentA,r.parentB),c=no(r.gene,r.type,o),d=[];c.forEach(u=>{s.forEach(m=>{const p=m.prob*u.prob;p<=bt||d.push({labels:[...m.labels,...u.labels],prob:p})})}),s=d.length?d:s});const n=new Map;s.forEach(r=>{const o=r.labels.slice().sort((u,m)=>u.localeCompare(m)),c=o.join("|"),d=n.get(c);d?d.prob+=r.prob:n.set(c,{labels:o,prob:r.prob})});let l=0;n.forEach(r=>{l+=r.prob}),l>bt&&Math.abs(l-1)>1e-6&&n.forEach(r=>{r.prob=r.prob/l});const a=Array.from(n.values()).filter(r=>r.prob>bt).map(r=>({genotype:r.labels,prob:r.prob,flags:[]})).sort((r,o)=>o.prob-r.prob);return a.length?a:[{genotype:[],prob:1,flags:[]}]},lo=(e,s)=>{const n=ro(e,s);return n.length?ao(n):[{genotype:[],prob:1,flags:[]}]},Rn=(e,s)=>lo(e,s);var Er={};const ps=60*60*1e3,gt=e=>!e||!Number.isFinite(e)||e<=0?0:e,oo=typeof window<"u"&&typeof window.document<"u",io=()=>{const e=new Map,s=new Map,n=(l,a)=>{const r=gt(a);if(!r)return!1;const o=Date.now()-r*ps;return l.ts<o};return{getSearchCache(l,a){if(!l)return null;const r=e.get(l);return r?n(r,a)?(e.delete(l),null):r.value:null},setSearchCache(l,a,r){if(l&&(e.set(l,{value:a,ts:Date.now()}),gt(r))){const o=gt(r),c=Date.now()-o*ps;Array.from(e.entries()).forEach(([d,u])=>{u.ts<c&&e.delete(d)})}},getPageCache(l,a){if(!l)return null;const r=s.get(l);return r?n(r,a)?(s.delete(l),null):r.value:null},setPageCache(l,a,r){if(l&&(s.set(l,{value:a,ts:Date.now()}),gt(r))){const o=gt(r),c=Date.now()-o*ps;Array.from(s.entries()).forEach(([d,u])=>{u.ts<c&&s.delete(d)})}}}},co=()=>{const e=require("fs"),s=require("path"),n=(()=>{try{return require("better-sqlite3")}catch{return null}})(),l=Er.CACHE_DB_PATH?s.resolve(process.cwd(),Er.CACHE_DB_PATH):s.resolve(process.cwd(),"data","cache.sqlite");let a=null;const r=()=>{if(a)return a;if(!n)throw new Error("better-sqlite3 is required for caching. Install it by running 'npm install better-sqlite3'.");const c=l;e.mkdirSync(s.dirname(c),{recursive:!0});const d=new n(c);return d.pragma("journal_mode = WAL"),d.exec("CREATE TABLE IF NOT EXISTS search_hits (query TEXT PRIMARY KEY, json TEXT NOT NULL, ts INTEGER NOT NULL)"),d.exec("CREATE TABLE IF NOT EXISTS pages (url TEXT PRIMARY KEY, html TEXT NOT NULL, ts INTEGER NOT NULL)"),a=d,a},o=(c,d)=>{const u=gt(d);if(u)try{const m=Date.now()-u*ps;r().prepare(`DELETE FROM ${c} WHERE ts < ?`).run(m)}catch{}};return{getSearchCache(c,d){if(!c)return null;try{const m=r().prepare("SELECT json, ts FROM search_hits WHERE query = ?").get(c);if(!m)return null;if(gt(d)){const p=Date.now()-gt(d)*ps;if(m.ts<p)return null}return JSON.parse(m.json)}catch{return null}},setSearchCache(c,d,u){if(c)try{const m=Date.now();r().prepare("INSERT INTO search_hits (query, json, ts) VALUES (?, ?, ?) ON CONFLICT(query) DO UPDATE SET json = excluded.json, ts = excluded.ts").run(c,JSON.stringify(d),m),o("search_hits",u)}catch{}},getPageCache(c,d){if(!c)return null;try{const m=r().prepare("SELECT html, ts FROM pages WHERE url = ?").get(c);if(!m)return null;if(gt(d)){const p=Date.now()-gt(d)*ps;if(m.ts<p)return null}return m.html}catch{return null}},setPageCache(c,d,u){if(c)try{const m=Date.now();r().prepare("INSERT INTO pages (url, html, ts) VALUES (?, ?, ?) ON CONFLICT(url) DO UPDATE SET html = excluded.html, ts = excluded.ts").run(c,d,m),o("pages",u)}catch{}}}},mn=oo?io():co(),uo=(e,s)=>mn.getSearchCache(e,s),mo=(e,s,n)=>mn.setSearchCache(e,s,n),ho=(e,s)=>mn.getPageCache(e,s),po=(e,s,n)=>mn.setPageCache(e,s,n);var Ir={NVM_INC:"/Users/albertbitton/.nvm/versions/node/v20.19.5/include/node",TERM_PROGRAM:"vscode",NODE:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",INIT_CWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_CD_FLAGS:"-q",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/",npm_config_global_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",VSCODE_PYTHON_AUTOACTIVATE_GUARD:"1",TERM_PROGRAM_VERSION:"1.106.0",ZDOTDIR:"/Users/albertbitton",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_DIR:"/Users/albertbitton/.nvm",USER:"albertbitton",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/Users/albertbitton/.nvm/versions/node/v20.19.5/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.gyh6QCvRwm/Listeners",VSCODE_PROFILE_INITIALIZED:"1",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin:/Users/albertbitton/Documents/GitHub/node_modules/.bin:/Users/albertbitton/Documents/node_modules/.bin:/Users/albertbitton/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_package_json:"/Users/albertbitton/Documents/GitHub/Breeding-planner/package.json",_:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin/vite",npm_config_userconfig:"/Users/albertbitton/.npmrc",npm_config_init_module:"/Users/albertbitton/.npm-init.js",USER_ZDOTDIR:"/Users/albertbitton",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run-script",PWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",npm_lifecycle_event:"deploy",EDITOR:"vi",npm_package_name:"breeding-planner",LANG:"en_US.UTF-8",npm_config_npm_version:"10.8.2",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"0.1.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/albertbitton",VSCODE_GIT_ASKPASS_MAIN:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",npm_config_cache:"/Users/albertbitton/.npm",LOGNAME:"albertbitton",npm_lifecycle_script:"vite build && gh-pages -d dist",VSCODE_GIT_IPC_HANDLE:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/vscode-git-c6232d8e0d.sock",NVM_BIN:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_config_user_agent:"npm/10.8.2 node/v20.19.5 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",GIT_PAGER:"cat",npm_node_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",npm_config_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",COLORTERM:"truecolor",NODE_ENV:"production",PUBLIC_URL:""};const fo=8e3,xo=(e,s)=>{const n=Number(e);return Number.isFinite(n)&&n>0?n:s},go=typeof process<"u"&&process&&Ir?Ir:{},va=xo(go.PAGE_CACHE_TTL_HOURS,24),bo=/\$?\b\d{2,5}\b/g,yo=[/\b\d{4}-\d{1,2}-\d{1,2}\b/g,/\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/g,/\b(?:jan|feb|mar|apr|may|jun|jul|aug|sep|sept|oct|nov|dec)[a-z]*\.?\s+\d{1,2},?\s+\d{4}\b/gi],Ps=e=>!Number.isFinite(e)||e<0?0:e>1?1:e,No=e=>{try{return new URL(e)}catch{return null}},vo=async(e,s)=>{const n=new AbortController,l=setTimeout(()=>n.abort(),s);try{return await fetch(e,{signal:n.signal,headers:{"User-Agent":"BreedingPlanner/1.0 (Demand Extractor)",Accept:"text/html,application/xhtml+xml"}})}finally{clearTimeout(l)}};let ft=null;const Lr=new Function("specifier","return import(specifier);"),wo=async()=>{if(ft)return ft;ft={};try{const e=await Lr("jsdom").catch(()=>null);if(ft.JSDOM=e==null?void 0:e.JSDOM,ft.JSDOM)try{const s=await Lr("@mozilla/readability").catch(()=>null);ft.Readability=s==null?void 0:s.Readability}catch{ft.Readability=void 0}}catch{ft.JSDOM=void 0,ft.Readability=void 0}return ft},jo=e=>{const s=e.replace(/[^\d]/g,"");if(!s)return null;const n=Number(s);return!Number.isFinite(n)||n<25||n>5e4?null:n},Co=e=>{const s=e.replace(/\s+/g," ").replace(/[,]/g,"").trim();if(!s)return null;if(s.match(/^\d{4}-\d{1,2}-\d{1,2}$/)){const[r,o,c]=s.split("-").map(d=>Number(d));return new Date(r,o-1,c)}const l=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);if(l){let r=Number(l[3]);const o=Number(l[1]),c=Number(l[2]);return r<100&&(r=r>=70?1900+r:2e3+r),new Date(r,o-1,c)}const a=Date.parse(s);return Number.isNaN(a)?null:new Date(a)},So=(e,s)=>{if(!e.length)return .2;const n=24*60*60*1e3,l=e.reduce((r,o)=>{const d=Math.max(0,s.getTime()-o.getTime())/n;return Math.min(r,d)},Number.POSITIVE_INFINITY);if(!Number.isFinite(l))return .2;const a=Math.exp(-l/45);return Ps(a)},ko=(e,s)=>{if(!e)return[];const n=e.split(new RegExp("(?<=[.!?])\\s+")).map(a=>a.trim()).filter(Boolean);if(!n.length)return[];const l=[];return s&&new Set(Array.from(s)).forEach(r=>{const o=n.find(c=>c.includes(r));o&&l.push(o.substring(0,240))}),l.length||l.push(n[0].substring(0,240)),l.slice(0,3)},Mr=async(e,s,n)=>{var b,f;const{JSDOM:l,Readability:a}=await wo();let r=e,o="";if(l&&a)try{const N=new l(s,{url:e});r=N.window.document.title||r;const A=new a(N.window.document).parse();A!=null&&A.textContent?(o=A.textContent,r=A.title||r):o=((b=N.window.document.body)==null?void 0:b.textContent)||""}catch{o=""}if(!o){const N=s.replace(/<script[^>]*>[\s\S]*?<\/script>/gi," ").replace(/<style[^>]*>[\s\S]*?<\/style>/gi," ").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim(),S=s.match(/<title[^>]*>([^<]*)<\/title>/i);r=((f=S==null?void 0:S[1])==null?void 0:f.trim())||r,o=N}const c=o.match(bo),d=[];c&&c.forEach(N=>{const S=jo(N);S&&d.push(S)});const u=[];yo.forEach(N=>{const S=o.match(N);S&&S.forEach(A=>{const E=Co(A);E&&u.push(E)})});const m=So(u,n),p=ko(o,c);return{url:e,title:r,text:o,prices:d,freshnessScore:m,signals:p}},Ao=e=>{const s=new Set,n=[];return e.forEach(l=>{const a=No(l);if(!a)return;const r=a.host.toLowerCase();s.has(r)||(s.add(r),n.push(a.toString()))}),n},Do=e=>{try{const s=ho(e,va);return typeof s=="string"?s:null}catch{return null}},Eo=(e,s)=>{try{po(e,s,va)}catch{}},Fr=e=>e.length?e.reduce((s,n)=>s+n,0)/e.length:0,Io=async(e,s={})=>{const n=Ao(e);if(!n.length)return{index:0,priceBand:null,signals:[],sources:[]};const l=s.timeoutMs??fo,a=s.now??new Date,r=[],o=[],c=[],d=[],u=E=>{r.push({title:E.title||E.url,url:E.url}),o.push(...E.signals),c.push(...E.prices),d.push(E.freshnessScore)};await Promise.all(n.map(async E=>{try{let y=Do(E);if(y)try{const L=await Mr(E,y,a);u(L);return}catch(L){o.push(`Cached content parse failed for ${E}: ${(L==null?void 0:L.message)||"unknown error"}`),y=null}const _=await vo(E,l);if(!_.ok){o.push(`Skipped ${E} (status ${_.status})`);return}y=await _.text();const U=await Mr(E,y,a);u(U),Eo(E,y)}catch(y){o.push(`Fetch failed for ${E}: ${(y==null?void 0:y.message)||"unknown error"}`)}}));const m=Array.from(new Set(o.map(E=>E.trim()).filter(Boolean))).slice(0,12);let p=null;if(c.length){const E=Math.min(...c),y=Math.max(...c);Number.isFinite(E)&&Number.isFinite(y)&&(p=[E,y])}const b=Ps(m.length/6),f=p?Ps(Fr(c)/5e3):0,N=d.length?Ps(Fr(d)):.2,S=Ps(.4*f+.35*b+.25*N);return{index:Math.round(S*100),priceBand:p,signals:m,sources:r}};var Tr={NVM_INC:"/Users/albertbitton/.nvm/versions/node/v20.19.5/include/node",TERM_PROGRAM:"vscode",NODE:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",INIT_CWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_CD_FLAGS:"-q",TERM:"xterm-256color",SHELL:"/bin/zsh",TMPDIR:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/",npm_config_global_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",VSCODE_PYTHON_AUTOACTIVATE_GUARD:"1",TERM_PROGRAM_VERSION:"1.106.0",ZDOTDIR:"/Users/albertbitton",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",MallocNanoZone:"0",COLOR:"1",npm_config_noproxy:"",npm_config_local_prefix:"/Users/albertbitton/Documents/GitHub/Breeding-planner",NVM_DIR:"/Users/albertbitton/.nvm",USER:"albertbitton",COMMAND_MODE:"unix2003",npm_config_globalconfig:"/Users/albertbitton/.nvm/versions/node/v20.19.5/etc/npmrc",SSH_AUTH_SOCK:"/private/tmp/com.apple.launchd.gyh6QCvRwm/Listeners",VSCODE_PROFILE_INITIALIZED:"1",__CF_USER_TEXT_ENCODING:"0x1F5:0x0:0x0",npm_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/bin/npm-cli.js",PATH:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin:/Users/albertbitton/Documents/GitHub/node_modules/.bin:/Users/albertbitton/Documents/node_modules/.bin:/Users/albertbitton/node_modules/.bin:/Users/node_modules/.bin:/node_modules/.bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/@npmcli/run-script/lib/node-gyp-bin:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/debugCommand:/Users/albertbitton/Library/Application Support/Code/User/globalStorage/github.copilot-chat/copilotCli:/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_package_json:"/Users/albertbitton/Documents/GitHub/Breeding-planner/package.json",_:"/Users/albertbitton/Documents/GitHub/Breeding-planner/node_modules/.bin/vite",npm_config_userconfig:"/Users/albertbitton/.npmrc",npm_config_init_module:"/Users/albertbitton/.npm-init.js",USER_ZDOTDIR:"/Users/albertbitton",__CFBundleIdentifier:"com.microsoft.VSCode",npm_command:"run-script",PWD:"/Users/albertbitton/Documents/GitHub/Breeding-planner",npm_lifecycle_event:"deploy",EDITOR:"vi",npm_package_name:"breeding-planner",LANG:"en_US.UTF-8",npm_config_npm_version:"10.8.2",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",XPC_FLAGS:"0x0",npm_config_node_gyp:"/Users/albertbitton/.nvm/versions/node/v20.19.5/lib/node_modules/npm/node_modules/node-gyp/bin/node-gyp.js",npm_package_version:"0.1.0",XPC_SERVICE_NAME:"0",VSCODE_INJECTION:"1",SHLVL:"2",HOME:"/Users/albertbitton",VSCODE_GIT_ASKPASS_MAIN:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass-main.js",npm_config_cache:"/Users/albertbitton/.npm",LOGNAME:"albertbitton",npm_lifecycle_script:"vite build && gh-pages -d dist",VSCODE_GIT_IPC_HANDLE:"/var/folders/y8/fpxl89d56jzg88wp2wxlmq980000gn/T/vscode-git-c6232d8e0d.sock",NVM_BIN:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin",npm_config_user_agent:"npm/10.8.2 node/v20.19.5 darwin arm64 workspaces/false",VSCODE_GIT_ASKPASS_NODE:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Frameworks/Code Helper (Plugin).app/Contents/MacOS/Code Helper (Plugin)",GIT_ASKPASS:"/Users/albertbitton/Desktop/Visual Studio Code.app/Contents/Resources/app/extensions/git/dist/askpass.sh",GIT_PAGER:"cat",npm_node_execpath:"/Users/albertbitton/.nvm/versions/node/v20.19.5/bin/node",npm_config_prefix:"/Users/albertbitton/.nvm/versions/node/v20.19.5",COLORTERM:"truecolor",NODE_ENV:"production",PUBLIC_URL:""};class fs extends Error{constructor(s,n=!0){super(s),this.name="SearchError",this.retryable=n}}const _n=8,hn=(e,s)=>{if(e==null)return s;const n=Number(e);return Number.isFinite(n)&&n>0?n:s},Lo=(e,s=!1)=>{if(e==null)return s;const n=e.trim().toLowerCase();return["1","true","yes","y","on"].includes(n)?!0:["0","false","no","n","off"].includes(n)?!1:s},yt=typeof process<"u"&&process&&Tr?Tr:{},Xn=typeof window<"u"&&typeof window.document<"u",wa=hn(yt.SEARCH_CACHE_TTL_HOURS,12),ja=Lo(yt.CACHE_ONLY,!1),On=hn(yt.SEARCH_TIMEOUT_MS,8e3),kn=Math.max(1,Math.floor(hn(yt.SEARCH_RETRY_ATTEMPTS,2))),Mo=hn(yt.SEARCH_RETRY_DELAY_MS,300),Fo=e=>new Promise(s=>{setTimeout(s,e)}),To=async(e,s)=>{const n=new AbortController,l=setTimeout(()=>n.abort(),On);try{return await fetch(e,{...s,signal:n.signal})}catch(a){throw(a==null?void 0:a.name)==="AbortError"?new fs(`Search request timed out after ${On}ms`,!0):a}finally{clearTimeout(l)}},Ca=async(e,s)=>{try{const n=await To(e,s);if(!n.ok){const l=await n.text().catch(()=>""),a=n.status>=500||n.status===429;throw new fs(`Search request failed (${n.status}): ${l||n.statusText}`,a)}return await n.json()}catch(n){if(n instanceof fs)throw n;const l=(n==null?void 0:n.message)||"Unknown search error";throw new fs(l,!0)}},Sa=async e=>{let s=0,n;for(;s<kn;){s+=1;try{return await e()}catch(a){if(a instanceof fs){if(!a.retryable||s>=kn)throw a;n=a}else{if(s>=kn)throw a;n=a}}const l=Math.min(On,Mo*s);await Fo(l)}throw n instanceof Error?n:new fs("Search request failed",!0)},ka=e=>{const s=new Set,n=[];return e.forEach(l=>{try{const a=new URL(l.url).hostname.replace(/^www\./i,"").toLowerCase();if(s.has(a))return;s.add(a),n.push(l)}catch{}}),n.slice(0,_n)},Aa=e=>!Number.isFinite(e)||e<=0?_n:Math.min(Math.floor(e),_n),Un=new Map,Po=e=>{try{const s=uo(e,wa);if(Array.isArray(s))return s}catch{}return null},$o=(e,s)=>{try{mo(e,s,wa)}catch{}},Da=e=>{const s=Un.get(e);if(s)return s;const n=Po(e);return n?(Un.set(e,n),n):null},Ea=(e,s)=>{Un.set(e,s),$o(e,s)},Ia=(e,s)=>`${e}:${s.trim().toLowerCase()}`,Jn=e=>({async search(){return typeof console<"u"&&console.warn&&console.warn(`[search] ${e}`),[]}}),Ro=()=>{const e=yt.BING_SEARCH_KEY||yt.AZURE_BING_KEY;if(!e){if(Xn)return Jn("Bing search unavailable: missing API key");throw new Error("Bing search provider selected but no BING_SEARCH_KEY (or AZURE_BING_KEY) is configured.")}return{async search(s,n){var m;const l=Aa(n),a=Ia("bing",s),r=Da(a);if(r)return r.slice(0,l);if(ja)return[];const d=(((m=(await Sa(()=>Ca(`https://api.bing.microsoft.com/v7.0/search?q=${encodeURIComponent(s)}&count=${l*2}`,{headers:{"Ocp-Apim-Subscription-Key":e}}))).webPages)==null?void 0:m.value)||[]).map(p=>({title:p.name||"",url:p.url||""})).filter(p=>p.title&&p.url),u=ka(d);return Ea(a,u),u.slice(0,l)}}},_o=()=>{const e=yt.SERPAPI_API_KEY||yt.SERPAPI_KEY;if(!e){if(Xn)return Jn("SerpAPI search unavailable: missing API key");throw new Error("SerpAPI search provider selected but no SERPAPI_API_KEY (or SERPAPI_KEY) is configured.")}return{async search(s,n){const l=Aa(n),a=Ia("serpapi",s),r=Da(a);if(r)return r.slice(0,l);if(ja)return[];const o=new URLSearchParams({engine:"google",q:s,num:String(Math.max(10,l*2)),api_key:e}),u=((await Sa(()=>Ca(`https://serpapi.com/search.json?${o.toString()}`,{}))).organic_results||[]).map(p=>({title:p.title||"",url:p.link||""})).filter(p=>p.title&&p.url),m=ka(u);return Ea(a,m),m.slice(0,l)}}},Oo=()=>{const e=(yt.SEARCH_PROVIDER||"bing").trim().toLowerCase();switch(e){case"serpapi":return _o();case"bing":return Ro();default:if(Xn)return Jn(`Unknown search provider '${e}', falling back to no-op.`);throw new Error(`Unknown SEARCH_PROVIDER '${e}'. Supported providers: bing, serpapi.`)}},Uo=[{pattern:"Spider x Spider",flag:"Suspect super",penalty:.8},{pattern:"Champagne x Champagne",flag:"Suspect super",penalty:.8},{pattern:"Woma x Woma",flag:"Suspect super",penalty:.8},{pattern:"Cinnamon x Cinnamon",flag:"Deformity risk in supers",penalty:.3},{pattern:"BlackPastel x BlackPastel",flag:"Deformity risk in supers",penalty:.3}],Xs={risk_rules:Uo},Pr=e=>e.trim().toLowerCase(),zo=Array.isArray(Xs==null?void 0:Xs.risk_rules)?Xs.risk_rules.map(e=>({pattern:e.pattern,flag:e.flag,penalty:e.penalty??0})):[],Go=e=>{const s=new Set;return e.forEach(n=>s.add(n)),Array.from(s)},Ho=(e,s)=>{if(!e)return!1;const n=Pr(s.pattern);return Pr(e).includes(n)},Bo=(e,s)=>{let n=0;const l=[];zo.forEach(r=>{Ho(e,r)&&(l.push(r.flag),n+=r.penalty)});const a=Math.min(1,Math.max(0,n));return{risks:Go(l),penalty:a}},$r=e=>e.trim().toLowerCase(),Xt=(e,s)=>{const n=$r(e),l=$r(s);return l?n===l?!0:n.includes(l):!1},qo=(e,s)=>{const n=e.trim();if(!n)return[];const l=new Set;l.add(n);const a=n.toLowerCase(),r=a.startsWith("het ")||a.includes("het "),o=a.includes("possible het");if(!r&&!o){l.add(`Super ${n}`);const c=s.recessiveState;(c==="het"||c==="possibleHet")&&(l.add(`het ${n}`),l.add(`possible het ${n}`))}return Array.from(l)},Rr=(e,s,n)=>qo(s,n).some(a=>e.some(r=>Xt(r,a))),_r=(e,s)=>{var l,a,r;const n=o=>o?Xt(o,s)||Xt(o,`het ${s}`):!1;return!!((l=e.morphs)!=null&&l.some(o=>Xt(o.name,s))||(a=e.hets)!=null&&a.some(o=>Xt(o,s))||(r=e.possibleHets)!=null&&r.some(o=>n(o)))},Or=(e,s)=>{var n;return((n=e.morphs)==null?void 0:n.some(l=>Xt(l.name,s)))??!1},Vo=e=>{let s=e.trim();return s=s.replace(/^(?:het|possible het|pos het)\s+/i,""),s.trim()},Yo=(e,s)=>{var l,a,r;const n=e||[];return!((l=s.avoid)!=null&&l.some(o=>n.some(c=>Xt(c,o)))||(a=s.requireAll)!=null&&a.length&&!s.requireAll.every(c=>Rr(n,c,s))||(r=s.requireAny)!=null&&r.length&&!s.requireAny.some(c=>Rr(n,c,s)))},La=(e,s)=>e.reduce((n,l)=>Yo(l.genotype,s)?n+l.prob:n,0),Wo=(e,s)=>s.reduce((n,l)=>{const a=La(e,l);if(l.minProb&&a<l.minProb)return n;const r=l.weight??1;return n+a*r},0),Qo=(e,s,n)=>{var l,a;return(l=n.avoid)!=null&&l.length&&n.avoid.some(o=>Or(e,o)||Or(s,o))?!1:n.recessiveState==="visual"&&((a=n.requireAll)!=null&&a.length)?n.requireAll.every(r=>{const o=Vo(r);return o?_r(e,o)&&_r(s,o):!0}):!0},Zn=e=>Number.isNaN(e)||e<0?0:e>1?1:e,Ko=e=>{const s=typeof(e==null?void 0:e.index)=="number"?e.index:0;return Zn(s/10)},Xo=e=>{const s=e==null?void 0:e.priceBand;if(!s||s.length!==2)return 0;const[n,l]=s,a=[n,l].filter(c=>typeof c=="number");if(!a.length)return 0;const r=a.reduce((c,d)=>c+(d??0),0)/a.length,o=r/(r+5e3);return Zn(o)},Jo=e=>{if(!(e!=null&&e.length))return 0;const n=(new Set(e.map(l=>l.genotype.slice().sort().join("|"))).size-1)/3;return Zn(n)},Zo=({outcomes:e,demand:s,risks:n,w:l})=>{const a=l.wDemand*Ko(s),r=l.wPrice*Xo(s),o=l.wNovelty*Jo(e),c=l.wRisk*((n==null?void 0:n.penalty)??0),d=a+r+o-c;return Math.max(0,d)},ei=({outcomes:e,demand:s,risks:n,goals:l,w:a})=>{const r=Zo({outcomes:e,demand:s,risks:n,w:a}),o=l!=null&&l.length?Wo(e,l):0,c=r+(a.wGoalFit??1)*o;return{score:Math.max(0,c),goalFit:o}},ti={type:"object",properties:{why_good:{type:"string"},watchouts:{type:"array",items:{type:"string"}},sources:{type:"array",items:{type:"string"}}},required:["why_good","watchouts","sources"]},Js=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),si=e=>{if(!Array.isArray(e))throw new Error("Expected an array of strings");return e.forEach(s=>{if(typeof s!="string")throw new Error("Expected all array items to be strings")}),e},ni=(e,s)=>{let n;try{n=JSON.parse(e)}catch{throw new Error("Response was not valid JSON")}if(!Js(s))throw new Error("Schema must be an object");if(!Js(n))throw new Error("Parsed JSON is not an object");Array.isArray(s.required)&&s.required.forEach(a=>{if(!(a in n))throw new Error(`Missing required property: ${a}`)});const l=Js(s.properties)?s.properties:{};return Object.entries(l).forEach(([a,r])=>{const o=n[a];if(!Js(r))return;const c=r.type;if(c==="string"&&typeof o!="string")throw new Error(`Expected property '${a}' to be a string`);c==="array"&&si(o)}),n},ri=async e=>{throw new Error("No LLM provider configured for justification")},ai=async e=>{const s=await ri();return ni(s,ti)},zn={Recessive:["210 Hypo","Albino","Atomic","Axanthic","Axanthic (GCR)","Axanthic (Jolliff)","Axanthic (MJ)","Axanthic (TSK)","Axanthic (VPI)","Bengal","Black Axanthic","Black Lace","Candy","Caramel Albino","Clown","Cryptic","Desert Ghost","Enhancer","Genetic Stripe","Ghost (Vesper)","Hypo","Lavender Albino","Maple","Metal Flake","Migraine","Monarch","Monsoon","Moray","Orange Crush","Orange Ghost","Paint","Patternless","Piebald","Puzzle","Rainbow","Sahara","Sandstorm","Sunset","Tornado","Tri-stripe","Ultramel","Whitewash","Zebra"],"Incomplete Dominant":["Acid","Ajax","Alloy","Ambush","Arcane","Arroyo","Asphalt","Astro","Bald","Bambino","Bamboo","Banana","Bang","Black Head","Black Pastel","Blade","Bongo","Butter","Cafe","Calico","Carbon","Carnivore","Champagne","Chino","Chocolate","Cinder","Cinnamon","Circle","Citron","Coffee","Copper","Creed","Cypress","Dark Viking","Diesel","Disco","Dot","EMG","Enchi","Epic","Exo-lbb","Fire","Flame","FNR Vanilla","Furrow","Fusion","Gaia","Gallium","GeneX","GHI","Glossy","Gobi","Granite","Gravel","Grim","Het Red Axanthic","Hidden Gene Woma","Hieroglyphic","High Intensity OD","Honey","Huffman","Hydra","Jaguar","Java","Jedi","Jolliff Tiger","Jolt","Joppa","Jungle Woma","KRG","Lace","LC Black Magic","Lemonback","Lesser","Mahogany","Mario","Marvel","Mckenzie","Melt","Microscale","Mocha","Mojave","Mosaic","Motley","Mystic","Nanny","Nico","Nr Mandarin","Nyala","Odium","OFY","Orange Dream","Orbit","Panther","Pastel","Peach","Phantom","Phenomenon","Pixel","Quake","Rain","RAR","Raven","Razor","Reaper","Red Gene","Red Stripe","Rhino","Russo","Saar","Sable","Sandblast","Sapphire","Satin","Scaleless Head","Scrambler","Shadow","Sherg","Shrapnel","Shredder","Smuggler","Spark","Special","Specter","Spider","Splatter","Spotnose","Stranger","Striker","Sulfur","Surge","Taronja","The Darkling","Trick","Trident","Trojan","Twister","Vanilla","Vudoo","Web","Woma","Wookie","Wrecking Ball","X-treme Gene","X-tremist","Yellow Belly","Zuwadi"],Dominant:["Adder","AHI","Ashen","Black Belly","Confusion","Congo","Desert","Eramosa","Frost","Gold Blush","Harlequin","Het Daddy","Josie","Leopard","Mordor","Nova","Oriole","Pinstripe","Redhead","Shatter","Splash","Static","Sunrise","Vesper","Zip Belly"],Polygenic:["Brown Back","Fader","Genetic Black Back","Genetic Reduced"],Other:["Dinker","Hybrid","Normal","Paradox","RECO","Ringer","Ringer Mark"],Locality:["Volta"]},li=["Recessive","Incomplete Dominant","Dominant","Other"],Rs={ultramelanistic:"Ultramel"},Ur=(()=>{const e=new Map;return Object.entries(zn).forEach(([s,n])=>{n.forEach(l=>{l&&e.set(String(l).trim().toLowerCase(),s)})}),e})();function _s(e){return e?String(e).trim().toLowerCase():""}function oi(e){if(!e)return null;const s=new Set,n=p=>{if(!p)return;const b=String(p).trim();if(!b)return;const f=b.toLowerCase();s.has(f)||s.add(f)},l=String(e).trim();if(!l)return null;n(l);const a=l.replace(/\(.*?\)/g,"").trim();a&&a!==l&&n(a);const r=a.replace(/^super[\s-]+/i,"").trim();r&&r!==a&&n(r);const o=a.match(/^super([A-Z].*)$/);o&&o[1]&&n(o[1]);const c=Rs[a.toLowerCase()];c&&n(c);const d=l.match(/^\s*axanthic\s*\(([^)]+)\)/i);if(d&&d[1]){const p=d[1].replace(/\s+/g," ").trim();if(p){const b=p.toLowerCase(),f=[{match:/tsk/,canonical:"TSK"},{match:/gcr/,canonical:"GCR"},{match:/jol(l|liff)/,canonical:"Jolliff"},{match:/mj/,canonical:"MJ"},{match:/vpi/,canonical:"VPI"}];let N=null;for(const{match:S,canonical:A}of f)if(S.test(b)){N=A;break}N||(N=p.replace(/\s*line$/i,"").trim()),N&&n(`Axanthic (${N})`),n("Axanthic")}}const u=r.replace(/^(?:\d{1,3}%\s+)?(?:pos(?:s?i?a?ble)?\s+)?het\s+/i,"").trim();u&&u!==r&&n(u);const m=u.replace(/^(?:\d{1,3}%\s*)/i,"").trim();m&&m!==u&&n(m);for(const p of s){const b=Rs[p];b&&n(b)}for(const p of s){const b=_s(p);if(Ur.has(b))return Ur.get(b)||null}return null}function ii(e){return!e||e==="Polygenic"||e==="Locality"||!li.includes(e)?"Other":e}function rs(e){const s=oi(e);return ii(s)}function Ma(e){const s=rs(e);return s==="Recessive"?"recessive":s==="Incomplete Dominant"?"co-dom":s==="Dominant"?"dominant":"polygenic"}var An={};const ci=6,di=(()=>{if(typeof process<"u"&&process&&An&&An.SUGGESTION_CONCURRENCY){const e=Number(An.SUGGESTION_CONCURRENCY);if(Number.isFinite(e)&&e>0)return e}return 3})(),ui=e=>{const s=new Set;return e.filter(n=>!!(n&&n.trim())).forEach(n=>{const l=n.trim();s.has(l)||s.add(l)}),Array.from(s)},mi=(e,s,n)=>{const l=[],a=r=>{var o,c,d;(o=r.morphs)==null||o.forEach(u=>l.push(u.name)),(c=r.hets)==null||c.forEach(u=>l.push(`${u}`)),(d=r.possibleHets)==null||d.forEach(u=>l.push(u))};return a(e),a(s),n.slice(0,4).forEach(r=>{var o;(o=r.genotype)!=null&&o.length&&l.push(r.genotype.join(" "))}),ui(l).slice(0,6)},hi=e=>e.length?`ball python ${e.join(" ")}`.trim():"ball python morph",zr=e=>{var n;const s=((n=e.morphs)==null?void 0:n.map(l=>l.name).join(" "))||"Normal";return`${e.sex==="M"?"Male":"Female"} ${s}`},Gr=()=>({index:0,priceBand:null,signals:[],sources:[]}),pi=(e,s,n)=>`Projected score ${e.toFixed(2)} with demand index ${s}. ${n}`.trim(),Gn=(e,s)=>s.map(n=>La(e,n)),fi=(e,s)=>{if(!e.length||!s.length)return"No specific goal targets.";let n=0,l=s[0];s.forEach((r,o)=>{r>l&&(l=r,n=o)});const a=e[n];return`${(l*100).toFixed(1)}% chance to hit goal '${a.name}'.`},xi=async(e,s)=>{var n,l;try{const a=await ai(e),r=(n=a.watchouts)!=null&&n.length?` Watchouts: ${a.watchouts.join("; ")}.`:"",o=(l=a.sources)!=null&&l.length?` Sources: ${a.sources.join(", ")}.`:"";return`${a.why_good}${r}${o}`.trim()}catch{return s}},Os=e=>e.toLowerCase().replace(/\s+/g," ").trim(),Hn=e=>e.replace(/^(?:het|possible het|pos het)\s+/i,"").replace(/^visual\s+/i,"").replace(/^super\s+/i,"").trim(),Fa=e=>Hn(e),gi=e=>{const s=new Set;return e.forEach(n=>{(n.requireAll||[]).forEach(l=>{const a=Fa(l);a&&s.add(a)})}),Array.from(s)},Hr=e=>{var s;return((s=e.genotype)==null?void 0:s.map(n=>n.trim()).filter(Boolean))??[]},bi=e=>{const s=[],n=[],l=[],a=[];return e.forEach(r=>{const o=r.trim();if(!o)return;const c=Os(o);if(c.startsWith("possible het")){const d=Hn(o);d&&(l.push(d),a.push(`possible het ${d}`));return}if(c.startsWith("het ")){const d=Hn(o);d&&(n.push(d),a.push(`het ${d}`));return}s.push({name:o,type:Ma(o)}),a.push(o)}),{morphs:s,hets:n,possibleHets:l,displayTokens:a}},yi=(e,s)=>{const n=e.map(Os);let l=0,a=0;return s.forEach(o=>{const c=Os(o);if(n.some(m=>m.startsWith("het ")||m.startsWith("possible het ")?!1:m.includes(c))){l+=1;return}n.some(m=>m.startsWith("het ")?m.replace(/^het\s+/,"").includes(c):m.startsWith("possible het ")?m.replace(/^possible het\s+/,"").includes(c):!1)&&(a+=1)}),{score:l*2+a,visualMatches:l,hetMatches:a}},Ni=(e,s)=>{const n=bi(e),l={morphs:n.morphs,hets:n.hets,possibleHets:n.possibleHets},a={id:`${s}-holdback-f`,sex:"F",morphs:l.morphs,hets:l.hets,possibleHets:l.possibleHets},r={id:`${s}-holdback-m`,sex:"M",morphs:l.morphs,hets:l.hets,possibleHets:l.possibleHets};return{female:a,male:r,traits:n.displayTokens}},vi=(e,s,n,l,a)=>{var U,L;if(!l.length)return;const r=gi(l);if(!r.length)return;const o=e.goalProb??0,c=[{generation:1,title:`Generation 1: ${s.id} × ${n.id}`,summary:o>0?`Direct chance to reach the goal is ${(o*100).toFixed(1)}%.`:`No direct visual expected; produce holdbacks carrying ${r.join(", ")}.`,maleId:s.id,femaleId:n.id,focusTraits:r,successProb:o}];if(!a||o>=.25)return{strategy:"direct",steps:c,cumulativeProb:Math.max(o,0)};const d=e.outcomes.slice(0,8).filter(T=>T.prob>.01);let u=null;if(d.forEach(T=>{const G=Hr(T),H=yi(G,r);if(H.score<=0)return;const ee={outcome:T,...H};if(!u){u=ee;return}if(ee.score>u.score){u=ee;return}ee.score===u.score&&T.prob>u.outcome.prob&&(u=ee)}),!u)return{strategy:"direct",steps:c,cumulativeProb:Math.max(o,0)};const m=u,p=`${s.id}-${n.id}`,b=Ni(Hr(m.outcome),p),f=b.traits.filter(T=>{const G=Fa(T);return G?r.some(H=>Os(G).includes(Os(H))):!1});let N=null;if((U=a.allMales)==null||U.forEach(T=>{if(T.id===s.id)return;const G=Rn(T,b.female),H=Gn(G,l),ee=H.length?Math.max(...H):0;ee<=0||(!N||ee>N.prob)&&(N={prob:ee,partnerId:T.id,partnerSex:"M",holdbackSex:"F",outcomes:G})}),(L=a.allFemales)==null||L.forEach(T=>{if(T.id===n.id)return;const G=Rn(b.male,T),H=Gn(G,l),ee=H.length?Math.max(...H):0;ee<=0||(!N||ee>N.prob)&&(N={prob:ee,partnerId:T.id,partnerSex:"F",holdbackSex:"M",outcomes:G})}),!N)return{strategy:"direct",steps:c,cumulativeProb:Math.max(o,0),holdbackTraits:f,holdbackProb:m.outcome.prob};const S=N,A=f.length?f.join(", "):r.join(", "),E=b.male.id,y=b.female.id;c[0]={...c[0],summary:`Direct goal chance ${(o*100).toFixed(1)}%. Prioritise producing holdbacks carrying ${A}.`},c.push({generation:2,title:`Generation 2: Holdback × ${S.partnerId}`,summary:`Retain the ${S.holdbackSex==="F"?"female":"male"} holdback (${A}). Pair with ${S.partnerId} for ${(S.prob*100).toFixed(1)}% chance at the goal.`,maleId:S.holdbackSex==="F"?S.partnerId:E,femaleId:S.holdbackSex==="F"?y:S.partnerId,focusTraits:r,successProb:S.prob,prerequisiteProb:m.outcome.prob});const _=m.outcome.prob*S.prob;return{strategy:"multi",steps:c,cumulativeProb:_,holdbackTraits:f,holdbackProb:m.outcome.prob}},wi=async(e,s,n,l,a)=>{const r=Rn(e,s),o=mi(e,s,r),c=hi(o);let d=Gr(),u=[];try{u=await Oo().search(c,ci)}catch{}const m=u.map(L=>L.url);try{m.length&&(d=await Io(m))}catch{d=Gr()}const p=`${zr(e)} x ${zr(s)}`,b=Bo(p),f=Gn(r,n),N=f.length?Math.max(...f):0,S=ei({outcomes:r,demand:d,risks:b,goals:n,w:l}),A=fi(n,f);let E=pi(S.score,d.index,A);E=await xi({a:e,b:s,outcomes:r,demand:d,risks:b.risks,goals:n},E);const y=d.sources.length?d.sources:u.map(L=>({title:L.title,url:L.url})),_={maleId:e.id,femaleId:s.id,outcomes:r,score:S.score,demand:d,risks:b.risks,sources:y,rationale:E,goalProb:N,goalFit:S.goalFit},U=vi(_,e,s,n,a);return U&&(_.plan=U),_},ji=(e,s)=>{const n=[];for(let l=0;l<e.length;l+=s)n.push(e.slice(l,l+s));return n},Ci=(e,s,n)=>n.length?n.every(l=>Qo(e,s,l)):!0,Si=async(e,s,n,l)=>{const a=[];if(e.forEach(d=>{s.forEach(u=>{Ci(d,u,n)&&a.push({male:d,female:u})})}),!a.length)return[];const r=Math.max(1,di),o=ji(a,r),c=[];for(const d of o)(await Promise.all(d.map(async({male:m,female:p})=>{try{return await wi(m,p,n,l,{allMales:e,allFemales:s})}catch{return null}}))).forEach(m=>{m&&c.push(m)});return c.sort((d,u)=>u.score-d.score)},ht=e=>e==null?"":String(e).replace(/\s+/g," ").trim(),ki=e=>{const s=ht(e).toLowerCase();return s?s==="m"||s==="male"||/^1[\s.:/]*0$/.test(s)||s.startsWith("m")?"M":s==="f"||s==="female"||/^0[\s.:/]*1$/.test(s)||s.startsWith("f")?"F":null:null},Br=e=>{if(e&&typeof e=="object"){if(Object.prototype.hasOwnProperty.call(e,"name")&&e.name!=null)return ht(e.name);if(Object.prototype.hasOwnProperty.call(e,"label")&&e.label!=null)return ht(e.label)}return ht(e)},Ai=e=>e.split(/[\n\r,;|/+]+/).map(s=>ht(s)).filter(Boolean),Bn=e=>{if(Array.isArray(e))return e.map(n=>Br(n)).filter(Boolean);const s=Br(e);return s?Ai(s):[]},cn=e=>{const s=ht(e);return s?s.split(" ").map(n=>n&&(n.length<=2?n.toUpperCase():/^[A-Z0-9-]+$/.test(n)?n:n.charAt(0).toUpperCase()+n.slice(1).toLowerCase())).join(" "):""},Di=e=>{const s=Bn(e),n=new Set,l=[];return s.forEach(a=>{const r=cn(a),o=_s(r);!r||!o||n.has(o)||(n.add(o),l.push({name:r,type:Ma(r)}))}),l},Ei=e=>{if(!e)return null;let s=ht(e);if(!s)return null;let n="";const l=s.match(/^(\d{1,3}%)(?:\s*)(.*)$/i);l&&(n=l[1].toUpperCase(),s=l[2].trim());let a="";const r=s.match(/^(pos(?:s?i?a?ble)?|probable|maybe|ph)(?:\s*)(.*)$/i);r&&(a=r[1].toLowerCase(),s=r[2].trim()),s=s.replace(/\bhet\b/gi," ").replace(/^het(?=[A-Za-z])/i,"").trim();const c={pos:"Possible",ph:"Possible",possible:"Possible",possiable:"Possible",posible:"Possible",probable:"Probable",maybe:"Maybe"}[a]||"",d=cn(s);if(!d)return null;const u=[];return n&&u.push(n),c&&u.push(c),u.push("Het"),u.push(d),u.join(" ").replace(/\s+/g," ").trim()||null},Ii=(e,s)=>{const n=[],l=[],a=new Set,r=new Set,o=(c,d=!1)=>{const u=Ei(c);if(!u)return;const m=u.toLowerCase();d||/^\d{1,3}%/.test(u)||/^(?:possible|probable|maybe)\b/i.test(u)?r.has(m)||(r.add(m),l.push(u)):a.has(m)||(a.add(m),n.push(u))};return Bn(e).forEach(c=>o(c,!1)),Bn(s).forEach(c=>o(c,!0)),{certain:n,possible:l}},qr=e=>{if(!e||!e.id)return null;const s=ki(e.sex);if(!s)return null;const n=Di(e.morphs),{certain:l,possible:a}=Ii(e.hets,e.possibleHets);return{id:String(e.id),sex:s,morphs:n,hets:l,possibleHets:a.length?a:void 0}},Li="breeders",Zs=.6,Mi={wDemand:1,wPrice:.8,wNovelty:.4,wRisk:.6,wGoalFit:1.2},It=(e,s=0)=>`${(e*100).toFixed(s)}%`,Fi=e=>{if(!e||e.length!==2)return null;const[s,n]=e;return s==null||n==null?null:`$${Number(s).toLocaleString()} – $${Number(n).toLocaleString()}`},Ti="bg-violet-200 border border-violet-300 text-violet-800",Dn={Het:Ti,Recessive:"bg-violet-300 border border-violet-400","Incomplete Dominant":"bg-rose-300 border border-rose-400",Dominant:"bg-sky-300 border border-sky-400",Other:"bg-emerald-300 border border-emerald-400"},Pi=e=>{if(!e)return!1;const s=String(e).toLowerCase();return!!(s.includes("het")||/(^|\s)(pos(?:s?i?a?ble)?|probable|maybe|ph)(\s|$)/i.test(s)||/\d{1,3}%/.test(s))},er=e=>{if(!e)return!1;const s=String(e).replace(/\s+/g," ").trim();if(!s)return!1;const n=s.toLowerCase();return/^(?:\d{1,3}%\s*)?(?:(?:pos(?:s?i?a?ble)?|probable|maybe|ph)\s+)?het\b/.test(n)?!0:Pi(e)},$i=e=>{if(er(e))return Dn.Het;const s=rs(e);return Dn[s]||Dn.Other},qn=(e=[])=>{const s=new Set,n=[];return e.forEach(l=>{if(l==null)return;const a=String(l).trim();if(!a)return;const r=a.toLowerCase();s.has(r)||(s.add(r),n.push(a))}),n},Ta=e=>String(e||"").replace(/^(?:\d{1,3}%\s*)?(?:(?:pos(?:s?i?a?ble)?|probable|maybe|ph)\s+)?het\s+/i,"").replace(/^visual\s+/i,"").replace(/^super\s+/i,"").trim(),_t=e=>{const s=Ta(ht(e));return s?_s(s):""},Zt=(e=[],s)=>{const n=[],l=[];return e.forEach(a=>{const r=ht(a);if(!r)return;const o=_t(r);s&&s.size>0&&(!o||!s.has(o))||(er(r)?l.push(r):n.push(r))}),{visuals:qn(n),hets:qn(l)}},Pa=(e=[],s=3,n)=>{const l=[];return(e||[]).slice(0,s).forEach(a=>{((a==null?void 0:a.genotype)||[]).forEach(r=>{const o=ht(r);o&&l.push(o)})}),Zt(l,n)},Ri=(e=[])=>{const s=[];return e.forEach(n=>{var l,a;(l=n==null?void 0:n.requireAll)!=null&&l.length&&s.push(...n.requireAll),(a=n==null?void 0:n.requireAny)!=null&&a.length&&s.push(...n.requireAny)}),s},Vr=(e=[])=>{const s=Ri(e),n=new Set;return s.forEach(l=>{const a=_t(l);a&&n.add(a)}),{tokens:s,baseGeneKeys:n,groups:Zt(s)}},_i=(e,s)=>{var o,c;if(!s||s.size===0)return!0;const n=Pa((e==null?void 0:e.outcomes)||[],6,s);if(n.visuals.length||n.hets.length)return!0;const l=Zt(((o=e==null?void 0:e.plan)==null?void 0:o.holdbackTraits)??[],s);if(l.visuals.length||l.hets.length)return!0;const a=(((c=e==null?void 0:e.plan)==null?void 0:c.steps)||[]).flatMap(d=>(d==null?void 0:d.focusTraits)||[]),r=Zt(a,s);return!!(r.visuals.length||r.hets.length)},en={visual:"Visual",het:"Het",possibleHet:"Possible het",none:"Normal"},$a=e=>typeof e=="string"&&e.includes("-holdback-"),Oi=(e,s)=>!e||!s?"none":(e.morphs||[]).some(r=>_t(r==null?void 0:r.name)===s)?"visual":(e.hets||[]).some(r=>_t(r)===s)?"het":(e.possibleHets||[]).some(r=>_t(r)===s)?"possibleHet":"none",Ui=(e=[],s)=>{if(!e||!e.length||!s)return"none";let n="none";return e.forEach(l=>{const a=ht(l);if(!(!a||_t(a)!==s)){if(/possible\s+het/i.test(a)||/probable\s+het/i.test(a)){n="possibleHet";return}if(er(a)){n="het";return}n="visual"}}),n},Yr=(e,s,n)=>{var l,a;return s?e&&((l=n==null?void 0:n.advisorAnimals)!=null&&l.has(e))?Oi(n.advisorAnimals.get(e),s):$a(e)?Ui(((a=n==null?void 0:n.plan)==null?void 0:a.holdbackTraits)??[],s):"none":"none"},zi=(e,s)=>{const n=[e,s].sort().join("-");return n==="none-visual"?"100% het":n==="het-het"?"≈66% het":n==="het-none"?"≈50% het":null},Gi=(e=[],s)=>{const n=(e||[]).find(l=>_t(l)===s);return cn(n?Ta(n):s)},Hi=(e,s,n)=>{var r;if(!((r=e==null?void 0:e.focusTraits)!=null&&r.length)||!(s!=null&&s.size))return[];const l=new Set;(e.focusTraits||[]).forEach(o=>{const c=_t(o);c&&s.has(c)&&l.add(c)});const a=[];return l.forEach(o=>{const c=Yr(e.maleId,o,n),d=Yr(e.femaleId,o,n),u=zi(c,d);if(!u)return;const m=Gi(e.focusTraits,o),p=en[c]||en.none,b=en[d]||en.none;a.push(`${m}: ${p} × ${b} → ${u}`)}),a},Wr=({label:e,tokens:s})=>{const n=qn(s).slice(0,12);return n.length?t.jsxs("div",{className:"flex flex-wrap items-center gap-1 text-xs text-neutral-600",children:[t.jsxs("span",{className:"uppercase tracking-wide text-[10px] text-neutral-500 mr-1",children:[e,":"]}),n.map(l=>t.jsx("span",{className:`inline-flex items-center rounded-md font-medium ${$i(l)} text-xs px-2 py-0.5`,children:l},`${e}-${l}`))]}):null},En=()=>[],Qr=e=>{const s=new Map;return(e||[]).forEach(n=>{n!=null&&n.id&&s.set(n.id,n)}),s},Bi=e=>Array.isArray(e)?e.map(s=>typeof s=="string"?s:String(s??"")).map(s=>s.trim()).filter(Boolean):typeof e=="string"?[e.trim()].filter(Boolean):[],Kr=(e=[])=>e.filter(s=>Bi(s==null?void 0:s.groups).some(n=>n.toLowerCase()===Li)),qi=e=>`${e.maleId}::${e.femaleId}`,Vi=({males:e=[],females:s=[],initialGoals:n=[],initialWeights:l=Mi})=>{const a=n[0],r=(a==null?void 0:a.name)??"",o=((a==null?void 0:a.requireAll)??[]).join(", "),c=[r,o].filter(Boolean).join(r&&o?": ":""),d=h.useMemo(()=>Kr(e),[e]),u=h.useMemo(()=>Kr(s),[s]),m=h.useMemo(()=>d.map(qr).filter(Boolean),[d]),p=h.useMemo(()=>u.map(qr).filter(Boolean),[u]),[b,f]=h.useState(n.length?n:En()),[N,S]=h.useState(c),[A]=h.useState(l),[E,y]=h.useState([]),[_,U]=h.useState(!1),[L,T]=h.useState(""),[G,H]=h.useState(n.length?n:[]),ee=h.useMemo(()=>Qr(d),[d]),g=h.useMemo(()=>Qr(u),[u]),I=h.useMemo(()=>{const M=new Map;return m.forEach(R=>{R!=null&&R.id&&M.set(R.id,R)}),p.forEach(R=>{R!=null&&R.id&&M.set(R.id,R)}),M},[m,p]),D=h.useCallback(M=>{if(!M)return"Unknown";const R=ee.get(M)||g.get(M);if(R!=null&&R.name)return R.name;if(R!=null&&R.displayName)return R.displayName;if(R!=null&&R.display_name)return R.display_name;if($a(M)){const[,W]=M.split("-holdback-");return W==="m"?"Holdback Male":W==="f"?"Holdback Female":"Holdback"}return M},[ee,g]),k=h.useMemo(()=>E.slice().sort((M,R)=>(R.score??0)-(M.score??0)),[E]),oe=h.useMemo(()=>k.filter(M=>(M.goalProb??0)>=Zs),[k]),$=h.useMemo(()=>k.filter(M=>(M.goalProb??0)<Zs),[k]),j=h.useMemo(()=>Vr(G),[G]),P=j.groups,te=j.baseGeneKeys,X=h.useCallback(M=>{f(R=>{if(!R.length){const he=En()[0]??{id:`goal-${Date.now().toString(36)}`,name:"Custom goal",requireAll:[],weight:1};return[M(he)]}const[W,...ie]=R;return[M(W),...ie]})},[]),ce=h.useCallback(M=>M.split(/[,\n]/).map(R=>R.trim()).filter(Boolean),[]),q=h.useCallback(M=>{const R=(M??"").trim();if(!R)return{name:"",traits:[]};if(R.includes(":")){const[W,ie=""]=R.split(/:/,2);return{name:W.trim(),traits:ce(ie)}}if(R.includes(" - ")){const[W,ie=""]=R.split(" - ",2);return{name:W.trim(),traits:ce(ie)}}return R.includes(",")?{name:"",traits:ce(R)}:{name:R,traits:[]}},[ce]),V=h.useCallback(M=>{const{name:R,traits:W}=q(M);X(ie=>({...ie,name:R||(ie==null?void 0:ie.name)||"Custom goal",requireAll:W}))},[q,X]),re=M=>{const R=M.target.value;S(R),L&&T(""),V(R)},ae=()=>{S(""),f(En()),H([]),y([]),T(""),U(!1)},pe=async()=>{if(!m.length||!p.length){T("Add animals to the Breeders group to see advisor recommendations.");return}const M=b.filter(R=>{var W,ie;return(((W=R.requireAll)==null?void 0:W.length)??0)>0||(((ie=R.requireAny)==null?void 0:ie.length)??0)>0});if(!M.length){T("Add goal traits before running the advisor.");return}H(M),U(!0),T("");try{const R=Vr(M),ie=(await Si(m,p,M,A)).filter(he=>_i(he,R.baseGeneKeys)).filter(he=>(he.goalProb??0)>0);y(ie)}catch(R){T((R==null?void 0:R.message)||"Failed to generate suggestions")}finally{U(!1)}},we=M=>t.jsxs("div",{className:"font-semibold text-neutral-900",children:[D(M.maleId)," × ",D(M.femaleId)]}),Ie=()=>_?"Crunching punnett squares…":L||(E.length?!oe.length&&$.length?`No pairs meet the high-confidence bar yet, but here are ${$.length} options to review.`:oe.length?`${oe.length} pairing${oe.length===1?"":"s"} meet the ≥ ${It(Zs)} goal confidence target.`:"No pairings crossed the confidence bar. Try adjusting your collections or goals.":"Run the advisor to discover promising pairings."),Y=M=>{var ie,he;const R=(ie=M.outcomes)==null?void 0:ie[0];return R?`${((he=R.genotype)==null?void 0:he.join(" "))||"Unknown morph"} (${It(R.prob,0)} appearance chance)`:"No projection available."},ue=(M,R)=>{var _e,Fe,Pe,ye,Xe;const W=qi(M),ie=R==="high",he=M.goalProb??0,be=M.plan,Ce=(be==null?void 0:be.steps)??[],je=Pa(M.outcomes||[],6,te),Ne=Zt((be==null?void 0:be.holdbackTraits)??[],te),Z=Ce.slice(1).reduce((me,Ae)=>{var tt;return(tt=Ae==null?void 0:Ae.focusTraits)!=null&&tt.length&&me.push(...Ae.focusTraits),me},[]),z=Zt(Z,te),J=[];P.visuals.length&&J.push({label:"Goal Visuals",tokens:P.visuals}),P.hets.length&&J.push({label:"Goal Hets",tokens:P.hets}),je.visuals.length&&J.push({label:"Projected Visuals",tokens:je.visuals}),je.hets.length&&J.push({label:"Projected Hets",tokens:je.hets}),Ne.visuals.length&&J.push({label:"Holdback Visuals",tokens:Ne.visuals}),Ne.hets.length&&J.push({label:"Holdback Hets",tokens:Ne.hets}),z.visuals.length&&J.push({label:"Next-Gen Visuals",tokens:z.visuals}),z.hets.length&&J.push({label:"Next-Gen Hets",tokens:z.hets});const fe=((Fe=(_e=M.demand)==null?void 0:_e.signals)==null?void 0:Fe.slice(0,2))??[],ke=Fi((Pe=M.demand)==null?void 0:Pe.priceBand);return t.jsx("div",{className:`rounded-xl border ${ie?"border-emerald-200 bg-emerald-50":"border-neutral-200 bg-white"} p-4 shadow-sm`,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[we(M),t.jsx("div",{className:"text-sm text-neutral-600",children:Y(M)}),J.length>0&&t.jsx("div",{className:"flex flex-col gap-1",children:J.map(({label:me,tokens:Ae},tt)=>t.jsx(Wr,{label:me,tokens:Ae},`${W}-${me}-${tt}`))}),t.jsxs("div",{className:"text-sm text-neutral-600",children:["Goal success chance: "," ",t.jsx("span",{className:`font-semibold ${ie?"text-emerald-600":"text-amber-600"}`,children:It(he,0)}),!ie&&t.jsx("span",{className:"ml-1 text-xs text-neutral-500",children:"(below confidence target)"})]}),!!fe.length&&t.jsxs("div",{className:"text-sm text-neutral-600",children:["Demand signals: ",fe.join(" • ")]}),ke&&t.jsx("div",{className:"text-sm text-neutral-600",children:ke}),M.rationale&&t.jsx("div",{className:"rounded-lg bg-neutral-50 p-3 text-sm text-neutral-700",children:M.rationale}),!!((ye=M.sources)!=null&&ye.length)&&t.jsxs("div",{className:"text-xs text-neutral-500",children:["Sources: ",M.sources.slice(0,3).map(me=>me.title||me.url).join(", ")]}),be&&t.jsxs("div",{className:"rounded-lg border border-sky-200 bg-sky-50/70 p-3 text-sm text-sky-900",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xs font-semibold uppercase tracking-wide text-sky-700",children:["Multi-generation plan (",be.strategy==="multi"?"2-step":"direct",")"]}),t.jsxs("div",{className:"text-xs font-semibold text-emerald-700",children:["Combined ≈ ",It(be.cumulativeProb??0,1)]})]}),t.jsx("div",{className:"mt-3 space-y-3",children:Ce.map(me=>{const Ae=D(me.maleId),tt=D(me.femaleId),Nt=Hi(me,te,{advisorAnimals:I,plan:be}),st=Zt((me==null?void 0:me.focusTraits)||[],te),kt=[];return st.visuals.length&&kt.push({label:"Focus Visuals",tokens:st.visuals}),st.hets.length&&kt.push({label:"Focus Hets",tokens:st.hets}),t.jsxs("div",{className:"rounded-lg border border-sky-200 bg-white p-3 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-xs font-semibold uppercase tracking-wide text-sky-600",children:["Generation ",me.generation]}),t.jsxs("div",{className:"flex items-center gap-3 text-[11px] font-medium text-sky-700",children:[me.prerequisiteProb!=null&&t.jsxs("span",{children:["Prereq ≈ ",It(me.prerequisiteProb,1)]}),me.successProb!=null&&t.jsxs("span",{children:["Goal ≈ ",It(me.successProb,1)]})]})]}),t.jsxs("div",{className:"mt-1 text-sm font-semibold text-sky-900",children:[Ae," × ",tt]}),t.jsx("div",{className:"mt-1 text-xs text-sky-800",children:me.summary}),kt.length>0&&t.jsx("div",{className:"mt-2 flex flex-col gap-1",children:kt.map(({label:vt,tokens:Ut},zt)=>t.jsx(Wr,{label:vt,tokens:Ut},`${W}-step-${me.generation}-${vt}-${zt}`))}),Nt.length>0&&t.jsx("div",{className:"mt-2 flex flex-col gap-1",children:Nt.map((vt,Ut)=>t.jsx("div",{className:"inline-flex items-center rounded-md bg-violet-100 px-2 py-1 text-[11px] font-medium text-violet-900",children:vt},`${W}-het-${me.generation}-${Ut}`))})]},`${W}-plan-${me.generation}`)})}),t.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 text-xs text-sky-700",children:[be.holdbackProb!=null&&t.jsxs("span",{children:["Holdback ≈ ",It(be.holdbackProb,1)]}),(Xe=be.holdbackTraits)!=null&&Xe.length?t.jsxs("span",{children:["Holdback genes: ",[...Ne.visuals,...Ne.hets].join(", ")||be.holdbackTraits.join(", ")]}):null]})]})]})},W)};return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"rounded-xl border border-neutral-200 bg-white p-5 shadow-sm",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"Breeding Advisor"}),t.jsxs("p",{className:"text-sm text-neutral-600",children:["We only look at animals tagged in the ",t.jsx("strong",{children:"Breeders"})," group and surface pairings that have a very high chance of producing your selected morph goal."]})]}),t.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:t.jsxs("label",{className:"sm:col-span-2 flex flex-col gap-1 text-sm text-neutral-700",children:[t.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Goal (Name and Traits)"}),t.jsx("input",{value:N,onChange:re,placeholder:"Visual Clown: Clown, het Desert Ghost",className:"rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-sky-400 focus:outline-none"}),t.jsx("span",{className:"text-xs text-neutral-500",children:'Format tip: "Goal Name: trait one, trait two". If you only list traits, we’ll build a generic goal.'})]})}),t.jsxs("div",{className:"flex flex-col gap-2 rounded-lg bg-sky-50 p-3 text-sm text-sky-900",children:[t.jsx("div",{className:"font-medium",children:"Status"}),t.jsx("div",{children:Ie()})]}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-neutral-500",children:[t.jsx("span",{children:`${d.length} breeder male${d.length===1?"":"s"}`}),t.jsx("span",{children:"•"}),t.jsx("span",{children:`${u.length} breeder female${u.length===1?"":"s"}`}),t.jsx("span",{children:"•"}),t.jsxs("span",{children:["Confidence bar ≥ ",It(Zs)]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:pe,disabled:_,className:"inline-flex items-center justify-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:cursor-not-allowed disabled:bg-emerald-800",children:_?"Generating...":"Run Advisor"}),t.jsx("button",{type:"button",onClick:ae,disabled:_,className:"inline-flex items-center justify-center rounded-lg border border-neutral-300 px-4 py-2 text-sm font-semibold text-neutral-700 hover:bg-neutral-100 disabled:cursor-not-allowed disabled:opacity-70",children:"Reset Advisor"})]})]})}),t.jsxs("div",{className:"space-y-4",children:[oe.map(M=>ue(M,"high")),$.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"text-sm font-semibold text-neutral-700",children:"Additional pairings worth reviewing"}),$.map(M=>ue(M,"supporting"))]}),!E.length&&!_&&!L&&t.jsxs("div",{className:"rounded-xl border border-dashed border-neutral-300 p-6 text-center text-sm text-neutral-500",children:["Ready when you are—click ",t.jsx("strong",{children:"Run Advisor"})," to discover your strongest breeder pairings."]})]})]})};$n.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${$n.version}/pdf.worker.min.js`;const ds=e=>e?String(e).charAt(0).toUpperCase()+String(e).slice(1):"";function $s(){return{ovulation:{observed:!1,date:"",notes:""},preLayShed:{observed:!1,date:"",notes:"",intervalFromOvulation:null},clutch:{recorded:!1,date:"",eggsTotal:"",fertileEggs:"",slugs:"",notes:""},hatch:{scheduledDate:"",recorded:!1,date:"",hatchedCount:0,notes:""}}}const ne=(...e)=>e.flat().filter(Boolean).join(" "),ys=(e="id")=>`${e}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e6).toString(36)}`,ze=(e=new Date)=>{const s=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${s}-${n}-${l}`},Yi=()=>new Date().toISOString();function We(e){if(!e)return"";const s=e instanceof Date?e:new Date(e);return Number.isNaN(s.getTime())?"":s.toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"})}function it(e){if(!e)return null;const s=String(e).trim();if(!s)return null;const n=s.match(/^(\d{4})/);if(!n)return null;const l=Number(n[1]);return Number.isFinite(l)?l:null}function Wi(e="",s=""){const n=String(s||"").trim();if(!n)return e||"";const l=String(e||"");return l?l.split(`
`).map(r=>r.trim()).includes(n)?l:`${l}${l.endsWith(`
`)?"":`
`}${n}`:n}function Ra(e){const s=We(e);return s?`Lock observed ${s}`:"Lock observed"}const Xr="breedingPlannerPendingAnimalView",ut={snakes:"breedingPlannerSnakes",pairings:"breedingPlannerPairings",groups:"breedingPlannerGroups",breeder:"breedingPlannerBreederInfo",lastFeedDefaults:"breedingPlannerLastFeedDefaults",backupSettings:"breedingPlannerBackupSettings",backupSnapshot:"breedingPlannerBackupSnapshot",backupVault:"breedingPlannerBackupVault"},Qi="/app-icons/icon_512x512.png",Ki=["off","nightly","weekly","monthly"],Xi=20,Ji=[5,10,20,50,100,200,"unlimited"],Zi="bpbackup",us=`.${Zi}`,Ls="application/x-breeding-planner-backup+json",In=(e,s)=>`${e}-${s}${us}`,Qt=[{key:"id",label:"Animal ID",section:"Identity",getter:e=>(e==null?void 0:e.id)||""},{key:"name",label:"Name",section:"Identity",getter:e=>(e==null?void 0:e.name)||""},{key:"sex",label:"Sex",section:"Identity",getter:e=>{const s=Ot(e==null?void 0:e.sex);return s==="UNKNOWN"?"":s}},{key:"status",label:"Status",section:"Identity",getter:e=>(e==null?void 0:e.status)||""},{key:"year",label:"Hatch year",section:"Timeline",getter:e=>e?Number.isFinite(Number(e.year))?Number(e.year):it(e.birthDate)||"":""},{key:"birthDate",label:"Birth date",section:"Timeline",getter:e=>e!=null&&e.birthDate?ve(e.birthDate):""},{key:"weight",label:"Current weight (g)",section:"Husbandry",getter:e=>{const s=e==null?void 0:e.weight;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"genetics",label:"Genetics summary",section:"Genetics",getter:e=>xt(at(e==null?void 0:e.morphs,e==null?void 0:e.hets,e==null?void 0:e.possibleHets))},{key:"morphs",label:"Morphs",section:"Genetics",getter:e=>xt(e==null?void 0:e.morphs)},{key:"hets",label:"Hets",section:"Genetics",getter:e=>xt(e==null?void 0:e.hets)},{key:"tags",label:"Tags",section:"Attributes",getter:e=>xt(e==null?void 0:e.tags)},{key:"groups",label:"Groups",section:"Attributes",getter:e=>xt(e==null?void 0:e.groups)},{key:"sireId",label:"Sire ID",section:"Lineage",getter:e=>(e==null?void 0:e.sireId)||""},{key:"damId",label:"Dam ID",section:"Lineage",getter:e=>(e==null?void 0:e.damId)||""},{key:"projects",label:"Projects (pairings)",section:"Breeding",getter:(e,s={})=>{var l;if(!(e!=null&&e.id))return"";const n=((l=s.pairingsBySnakeId)==null?void 0:l.get(e.id))||[];return n.length?xt(n.map(a=>a.label)):""}},{key:"lastFeedDate",label:"Last feed date",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"feeds");return s!=null&&s.date?ve(s.date):""}},{key:"lastFeedDetails",label:"Last feed details",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"feeds");if(!s)return"";const n=[s.feed,s.size,s.method].map(l=>typeof l=="string"?l.trim():"").filter(Boolean);return typeof s.weightGrams=="number"&&s.weightGrams>0?n.push(`${s.weightGrams} g`):typeof s.grams=="number"&&s.grams>0&&n.push(`${s.grams} g`),xt(n)}},{key:"lastWeightDate",label:"Last weigh date",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"weights");return s!=null&&s.date?ve(s.date):""}},{key:"lastWeightGrams",label:"Last recorded weight (g)",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"weights");return s&&Number.isFinite(Number(s.grams))?Number(s.grams):""}},{key:"lastShedDate",label:"Last shed date",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"sheds");return s!=null&&s.date?ve(s.date):""}},{key:"lastCleaningDate",label:"Last cleaning date",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"cleanings");return s!=null&&s.date?ve(s.date):""}},{key:"lastMedDate",label:"Last medication date",section:"Husbandry",getter:e=>{const s=Yt(e==null?void 0:e.logs,"meds");return s!=null&&s.date?ve(s.date):""}}],xs=["id","name","sex","status","genetics","groups","weight","projects","lastFeedDate"],Kt=[{key:"pairingId",label:"Pairing ID",section:"Identifiers",getter:e=>(e==null?void 0:e.id)||""},{key:"label",label:"Project label",section:"Identifiers",getter:(e,s={})=>s.displayLabel||(e==null?void 0:e.label)||""},{key:"cycleYear",label:"Season year",section:"Timeline",getter:(e,s={})=>s.cycleYear||""},{key:"femaleId",label:"Female ID",section:"Participants",getter:e=>(e==null?void 0:e.femaleId)||""},{key:"femaleName",label:"Female name",section:"Participants",getter:(e,s={})=>s.femaleName||(e==null?void 0:e.femaleId)||""},{key:"femaleGenetics",label:"Female genetics",section:"Participants",getter:(e,s={})=>s.femaleGenetics||""},{key:"maleId",label:"Male ID",section:"Participants",getter:e=>(e==null?void 0:e.maleId)||""},{key:"maleName",label:"Male name",section:"Participants",getter:(e,s={})=>s.maleName||(e==null?void 0:e.maleId)||""},{key:"maleGenetics",label:"Male genetics",section:"Participants",getter:(e,s={})=>s.maleGenetics||""},{key:"startDate",label:"Start date",section:"Timeline",getter:e=>e!=null&&e.startDate?ve(e.startDate):""},{key:"ovulationDate",label:"Ovulation date",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.ovulationDate?ve(s.derived.ovulationDate):""}},{key:"preLayDate",label:"Pre-lay shed",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.preLayDate?ve(s.derived.preLayDate):""}},{key:"clutchDate",label:"Clutch date",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.clutchDate?ve(s.derived.clutchDate):""}},{key:"eggsTotal",label:"Eggs laid",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.clutch)==null?void 0:n.eggsTotal;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"fertileEggs",label:"Fertile eggs",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.clutch)==null?void 0:n.fertileEggs;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"slugs",label:"Slugs",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.clutch)==null?void 0:n.slugs;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"hatchDate",label:"Hatch date",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.hatchDate?ve(s.derived.hatchDate):""}},{key:"hatchScheduledDate",label:"Scheduled hatch",section:"Timeline",getter:(e,s={})=>{var n;return(n=s.derived)!=null&&n.hatchScheduledDate?ve(s.derived.hatchScheduledDate):""}},{key:"hatchedCount",label:"Hatched count",section:"Outcomes",getter:e=>{var n;const s=(n=e==null?void 0:e.hatch)==null?void 0:n.hatchedCount;return Number.isFinite(Number(s))?Number(s):s||""}},{key:"status",label:"Project status",section:"Summary",getter:(e,s={})=>sc(s.derived)},{key:"goals",label:"Goals",section:"Summary",getter:e=>xt(e==null?void 0:e.goals)},{key:"hatchlingsCount",label:"Hatchlings produced",section:"Summary",getter:(e,s={})=>Array.isArray(s.hatchlings)?s.hatchlings.length:""}],gs=["label","cycleYear","femaleName","maleName","clutchDate","eggsTotal","hatchDate","hatchedCount","status"];function ms(e,s,n){const l=new Set(n.map(r=>r.key)),a=Array.isArray(e)?e.filter(r=>l.has(r)):[];return a.length?a:[...s]}function Jr(e=[],s=[],n=xs){const l=ms(n,xs,Qt),a=new Map(Qt.map(m=>[m.key,m])),r=l.map(m=>a.get(m)).filter(Boolean),o=_a(e),c=ec(s,o),d={snakes:e,pairings:s,snakeMap:o,pairingsBySnakeId:c},u=[];return(Array.isArray(e)?e:[]).forEach(m=>{if(!m)return;const p={};r.forEach(b=>{const f=typeof b.getter=="function"?b.getter(m,d):m[b.key];p[b.key]=tr(f)}),u.push(p)}),{columns:r.map(m=>({key:m.key,label:m.label})),rows:u}}function Zr(e=[],s=[],n=gs){const l=ms(n,gs,Kt),a=new Map(Kt.map(u=>[u.key,u])),r=l.map(u=>a.get(u)).filter(Boolean),o=_a(s),c=tc(s),d=[];return(Array.isArray(e)?e:[]).forEach(u=>{if(!u)return;const m=Ve({...u}),p=vs(m),b=m!=null&&m.femaleId?o.get(m.femaleId):null,f=m!=null&&m.maleId?o.get(m.maleId):null,N=Oa(m,b,f),S=fn({clutchDate:p.clutchDate,preLayDate:p.preLayDate,ovulationDate:p.ovulationDate,hatchDate:p.hatchDate,startDate:m.startDate||""}),A=c.get(m.id)||[],E={snakes:s,pairings:e,snakeMap:o,derived:p,displayLabel:N,femaleSnake:b,femaleName:(b==null?void 0:b.name)||m.femaleId||"",femaleGenetics:xt(at(b==null?void 0:b.morphs,b==null?void 0:b.hets,b==null?void 0:b.possibleHets)),maleSnake:f,maleName:(f==null?void 0:f.name)||m.maleId||"",maleGenetics:xt(at(f==null?void 0:f.morphs,f==null?void 0:f.hets,f==null?void 0:f.possibleHets)),cycleYear:S,hatchlings:A},y={};r.forEach(_=>{const U=typeof _.getter=="function"?_.getter(m,E):m[_.key];y[_.key]=tr(U)}),d.push(y)}),{columns:r.map(u=>({key:u.key,label:u.label})),rows:d}}function tr(e){if(e===null||typeof e>"u")return"";if(Array.isArray(e))return e.map(n=>{const l=tr(n);return l===null||typeof l>"u"?"":typeof l=="number"?String(l):l}).filter(Boolean).join(", ");if(e instanceof Date)return ve(e)||e.toISOString();if(typeof e=="object")try{return JSON.stringify(e)}catch{return String(e)}return e}function xt(e){return Array.isArray(e)?e.map(s=>s===null||typeof s>"u"?"":String(s).trim()).filter(Boolean).join(", "):e===null||typeof e>"u"?"":String(e)}function Yt(e,s){if(!e||typeof e!="object")return null;const n=Array.isArray(e[s])?e[s]:[];return n.length?n[n.length-1]:null}function _a(e=[]){const s=new Map;return(Array.isArray(e)?e:[]).forEach(n=>{n&&n.id&&s.set(n.id,n)}),s}function ec(e=[],s=new Map){const n=new Map;return(Array.isArray(e)?e:[]).forEach(l=>{if(!l)return;const a=Ve({...l}),r=a.femaleId?s.get(a.femaleId):null,o=a.maleId?s.get(a.maleId):null,c=Oa(a,r,o);a.femaleId&&(n.has(a.femaleId)||n.set(a.femaleId,[]),n.get(a.femaleId).push({id:a.id,label:c})),a.maleId&&(n.has(a.maleId)||n.set(a.maleId,[]),n.get(a.maleId).push({id:a.id,label:c}))}),n}function tc(e=[]){const s=new Map;return(Array.isArray(e)?e:[]).forEach(n=>{var a;if(!n)return;const l=n.pairingId||((a=n==null?void 0:n.metadata)==null?void 0:a.pairingId)||null;l&&(s.has(l)||s.set(l,[]),s.get(l).push(n))}),s}function Oa(e,s,n){if(e!=null&&e.label&&e.label.trim())return e.label.trim();const l=(s==null?void 0:s.name)||(e==null?void 0:e.femaleId)||"Female",a=(n==null?void 0:n.name)||(e==null?void 0:e.maleId)||"Male";return`${l} × ${a}`}function sc(e){return e?e.hatchedRecorded?"Hatched":e.clutchRecorded?"Eggs laid":e.preLayObserved?"Pre-lay shed":e.ovulationObserved?"Ovulation observed":"Planned":"Planned"}async function ea(e,s={}){const n=Array.isArray(e==null?void 0:e.columns)?e.columns:[],l=Array.isArray(e==null?void 0:e.rows)?e.rows:[],{title:a="",subtitle:r="",fileName:o="export.pdf",orientation:c="landscape"}=s,{jsPDF:d}=await ns(async()=>{const{jsPDF:G}=await import("./jspdf-BBNVmQfp.js").then(H=>H.j);return{jsPDF:G}},__vite__mapDeps([0,1,2])),u=new d({orientation:c,unit:"mm",format:"a4"}),m=12,p=u.internal.pageSize.getWidth(),b=u.internal.pageSize.getHeight(),f=8,N=2,S=4.5;let A=m;if(u.setFontSize(14),a&&(u.text(a,m,A),A+=7),r&&(u.setFontSize(10),u.text(r,m,A),A+=6),u.setFontSize(9),!n.length){u.text("No columns selected.",m,A+5),u.save(o);return}const E=p-m*2,y=22;let _=E/n.length,U=n.map(()=>_);if(_>y){U=n.map(()=>Math.max(y,_));const G=U.reduce((H,ee)=>H+ee,0);if(G>E){const H=E/G;U=U.map(ee=>ee*H)}}else U=n.map(()=>_);const L=()=>{let G=m;u.setFontSize(9),u.setFont(void 0,"bold"),n.forEach((H,ee)=>{u.setFillColor(237,242,247),u.setDrawColor(210),u.rect(G,A,U[ee],f,"FD"),u.setTextColor(51,65,85);const g=H.label||H.key||`Column ${ee+1}`;u.text(g,G+2,A+f-2),G+=U[ee]}),u.setFont(void 0,"normal"),u.setTextColor(17,24,39),A+=f};L(),l.forEach(G=>{const H=n.map((D,k)=>{const oe=G[D.key],$=oe===null||typeof oe>"u"?"":oe,j=String(typeof $=="number"?$:$||""),P=Math.max(10,U[k]-4);return u.splitTextToSize(j,P)}),ee=H.reduce((D,k)=>Math.max(D,k.length||1),1),g=Math.max(f,ee*S+N*2);A+g>b-m&&(u.addPage(void 0,c),A=m,L());let I=m;n.forEach((D,k)=>{const oe=H[k];u.setDrawColor(230),u.rect(I,A,U[k],g),u.text(oe,I+2,A+N+3),I+=U[k]}),A+=g});const T=new Date().toISOString();u.setFontSize(8),u.setTextColor(100),u.text(`Generated ${We(T)||T}`,m,b-m+4),u.save(o)}async function ta(e,s={}){const n=Array.isArray(e==null?void 0:e.columns)?e.columns:[],l=Array.isArray(e==null?void 0:e.rows)?e.rows:[],{fileName:a="export.xlsx"}=s;if(typeof window>"u"||typeof document>"u")throw new Error("Spreadsheet export is only supported in a browser environment.");let r;try{r=await ns(()=>import("./xlsx-D_0l8YDs.js"),[])}catch{throw new Error("XLSX library is unavailable.")}if(!r||!r.utils)throw new Error("XLSX library is unavailable.");const o=n.map(N=>N.label||N.key),c=l.map(N=>{const S={};return n.forEach(A=>{const E=A.label||A.key,y=N[A.key];S[E]=y===null||typeof y>"u"?"":y}),S}),d=r.utils.json_to_sheet(c,{header:o}),u=r.utils.book_new();r.utils.book_append_sheet(u,d,s.sheetName||"Export");const m=r.write(u,{bookType:"xlsx",type:"array"}),p=new Blob([m],{type:"application/octet-stream"}),b=URL.createObjectURL(p),f=document.createElement("a");f.href=b,f.download=a,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.setTimeout(()=>URL.revokeObjectURL(b),500)}function sa(e=[]){const s=new Map;return e.forEach(n=>{const l=n.section||"Other";s.has(l)||s.set(l,[]),s.get(l).push(n)}),Array.from(s.entries()).map(([n,l])=>({section:n,fields:l}))}function Wt(e){const s={frequency:"off",lastRun:null,maxVaultEntries:Xi};if(!e||typeof e!="object")return s;const n=Ki.includes(e.frequency)?e.frequency:s.frequency,l=typeof e.lastRun=="string"&&e.lastRun?e.lastRun:null;let a=s.maxVaultEntries;if(e.maxVaultEntries==="unlimited"||e.maxVaultEntries===null)a=null;else{const r=parseInt(e.maxVaultEntries,10);Number.isFinite(r)&&r>0&&(a=Math.min(r,200))}return{frequency:n,lastRun:l,maxVaultEntries:a}}function nc(e){switch(e){case"nightly":return 24*60*60*1e3;case"weekly":return 7*24*60*60*1e3;case"monthly":return 30*24*60*60*1e3;default:return null}}function rc(e){if(!e||typeof e!="object")return null;const s=typeof e.savedAt=="string"&&e.savedAt?e.savedAt:null,n=e.payload&&typeof e.payload=="object"?e.payload:null;return!s||!n?null:{savedAt:s,payload:n}}const ac="[YR][PREFIX]-[SEQ]",pn=Object.freeze({template:"[YROB][GEN3][-][SEX]-[SEQ]",sequencePadding:1,uppercase:!1,customText:""});function sr(){return{...pn}}function Ns(e){const s=sr();if(!e||typeof e!="object")return s;const n={...s,...e};n.template=String(n.template||s.template);const l=parseInt(n.sequencePadding,10);return n.sequencePadding=Number.isFinite(l)&&l>0?Math.min(l,6):s.sequencePadding,n.uppercase=n.uppercase!==!1,n.customText=String(typeof n.customText=="string"?n.customText:n.customText??s.customText??""),n}function Jt(e){const s={name:"",businessName:"",email:"",phone:"",logoUrl:"",idGenerator:sr()};if(!e||typeof e!="object")return s;const n={...s,...e},l=e==null?void 0:e.idGenerator;let a=Ns(n.idGenerator);return(!l||typeof l=="object"&&(!Object.prototype.hasOwnProperty.call(l,"template")||String(l.template||"").trim()===ac)&&!Object.prototype.hasOwnProperty.call(l,"customText")&&!Object.prototype.hasOwnProperty.call(l,"uppercase")&&!Object.prototype.hasOwnProperty.call(l,"sequencePadding"))&&(a={...a,template:pn.template}),n.idGenerator=Ns(a),n}const lc=[{token:"[YR]",description:"Last two digits of the year (e.g., 25)."},{token:"[YEAR]",description:"Full four-digit year (e.g., 2025)."},{token:"[YROB]",description:"Last two digits of the birth year."},{token:"[YEAROB]",description:"Full four-digit birth year."},{token:"[PREFIX]",description:"Legacy prefix derived from the name (or sire × dam pattern)."},{token:"[PREFIXU]",description:"Prefix in uppercase."},{token:"[PREFIXL]",description:"Prefix in lowercase."},{token:"[NAME]",description:"Letters from the name in Title Case."},{token:"[NAMEU]",description:"Letters from the name in uppercase."},{token:"[NAMEL]",description:"Letters from the name in lowercase."},{token:"[INITIALS]",description:"Initials from each word of the name."},{token:"[SLUG]",description:"Letters and numbers condensed to lowercase."},{token:"[SLUGU]",description:"Letters and numbers condensed to uppercase."},{token:"[PAREN]",description:"Code from a leading parentheses block (e.g., (DH))."},{token:"[HETS]",description:"Compact het markers (e.g., 50%Hclo)."},{token:"[SEX]",description:"Animal sex (F or M)."},{token:"[TEXT]",description:"Free text snippet from the wizard."},{token:"[GEN3]",description:"First three letters of each gene (e.g., Enchi Fire Clown → EncFirClo)."},{token:"[SEQ]",description:"Running sequence number with optional padding."},{token:"[-]",description:"Literal dash separator."}];function Ms(e,s){if(typeof window>"u")return s;try{const n=window.localStorage.getItem(e);return n?JSON.parse(n)??s:s}catch(n){return console.warn(`Failed to read ${e} from storage`,n),s}}function Fs(e,s){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(s))}catch(n){console.warn(`Failed to persist ${e} to storage`,n)}}function ss(e={}){return{feeds:[...e.feeds||[]],weights:[...e.weights||[]],sheds:[...e.sheds||[]],cleanings:[...e.cleanings||[]],meds:[...e.meds||[]]}}const oc=60;function Ua(e){if(!e||typeof e!="object")return null;const s=typeof e.url=="string"&&e.url.trim()?e.url.trim():typeof e.dataUrl=="string"&&e.dataUrl.trim()?e.dataUrl.trim():null;if(!s)return null;const n=typeof e.id=="string"&&e.id.trim()?e.id.trim():ys("photo"),l=typeof e.name=="string"?e.name.trim():"",a=typeof e.addedAt=="string"&&e.addedAt?e.addedAt:new Date().toISOString(),r=e.source==="camera"?"camera":"upload",o=typeof e.type=="string"?e.type:"",c=Number(e.size),d=Number.isFinite(c)&&c>=0?c:null,u=typeof e.note=="string"?e.note:"";return{id:n,url:s,name:l,addedAt:a,source:r,type:o,size:d,note:u}}function mt(e){return Array.isArray(e)?e.map(Ua).filter(Boolean):[]}function Ln(e,s=oc){return Array.isArray(e)?typeof s!="number"||s<=0||e.length<=s?e:e.slice(e.length-s):[]}function ic(e){if(!e||typeof e!="object")return null;const s={...e};return s.morphs=Array.isArray(e.morphs)?e.morphs.map(n=>String(n||"").trim()).filter(Boolean):[],s.hets=Array.isArray(e.hets)?e.hets.map(n=>String(n||"").trim()).filter(Boolean):[],s.possibleHets=Array.isArray(e.possibleHets)?e.possibleHets.map(n=>String(n||"").trim()).filter(Boolean):typeof e.possibleHets=="string"?String(e.possibleHets).split(/[,\n]/).map(n=>String(n||"").trim()).filter(Boolean):[],s.tags=Array.isArray(e.tags)?e.tags.map(n=>String(n||"").trim()).filter(Boolean):[],s.groups=Array.isArray(e.groups)?e.groups.map(n=>String(n||"").trim()).filter(Boolean):$t(e.groups),s.logs=ss(e.logs),s.photos=mt(e.photos),s.metadata&&typeof s.metadata=="object"&&(s.metadata={...s.metadata}),s}function cc(e){return!e||typeof e!="object"?null:Ve({...e})}function za(e){if(!e||typeof e!="object")return null;const s=e.payload&&typeof e.payload=="object"?e.payload:null;if(!s)return null;const n=e.source==="auto"?"auto":"manual",l=typeof e.createdAt=="string"&&e.createdAt?e.createdAt:new Date().toISOString(),a=typeof e.updatedAt=="string"&&e.updatedAt?e.updatedAt:l,r=typeof e.name=="string"&&e.name.trim()?e.name.trim():`${n==="auto"?"Auto":"Manual"} backup ${We(l)}`;return{id:typeof e.id=="string"&&e.id.trim()?e.id.trim():ys("backup"),name:r,createdAt:l,updatedAt:a,source:n,payload:s}}function dc(e){if(!Array.isArray(e))return[];const s=e.map(za).filter(Boolean);return s.sort((n,l)=>{const a=new Date(n.createdAt||0).getTime();return new Date(l.createdAt||0).getTime()-a}),s}const Ga=[{id:"25Ath-1",name:"Athena - DEMO",sex:"F",morphs:["Clown","Pastel"],hets:["Hypo"],possibleHets:[],weight:850,year:2025,birthDate:"2024-06-15",tags:["proven","female"],groups:["Breeders"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}},{id:"25Bor-1",name:"Boris - DEMO",sex:"M",morphs:["Pinstripe","Albino"],hets:[],possibleHets:[],weight:1020,year:2023,birthDate:"2023-08-02",tags:["male"],groups:["Breeders"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}},{id:"25Jun-1",name:"Juniper - DEMO",sex:"F",morphs:["GHI"],hets:[],possibleHets:[],weight:460,year:2024,birthDate:"2024-04-11",tags:["holdback"],groups:["Holdbacks"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}},{id:"25Neo-1",name:"Neo - DEMO",sex:"M",morphs:["Normal"],hets:[],possibleHets:[],weight:180,year:2025,birthDate:"2025-05-01",tags:["hatchling"],groups:["Hatchlings 2025"],status:"Active",imageUrl:void 0,isDemo:!0,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}}],Re=Ga.find(e=>(e==null?void 0:e.name)==="Boris - DEMO"),Ts={name:(Re==null?void 0:Re.name)||"Boris - DEMO",year:(Re==null?void 0:Re.year)||it(Re==null?void 0:Re.birthDate)||new Date().getFullYear(),birthYear:it(Re==null?void 0:Re.birthDate)||(Re==null?void 0:Re.year)||new Date().getFullYear(),sex:Je(Re==null?void 0:Re.sex,"M"),genes:(()=>{const e=Array.isArray(Re==null?void 0:Re.morphs)?Re.morphs:[],s=Array.isArray(Re==null?void 0:Re.hets)?Re.hets:[],n=[...e,...s].map(l=>String(l||"").trim()).filter(Boolean);return n.length?n.join(", "):""})()},uc=[],mc=["Breeders","Holdbacks","Hatchlings 2024","Hatchlings 2025"],na=["Active","Holdback","Grow-out","Breeder","Quarantine","Sold","On loan","MorphMarket","On hold","Retired","Deceased"],ra="breedingPlannerScanMode";function aa(){return Ga.map(e=>{const s=Number(e==null?void 0:e.idSequence),n=Number.isFinite(s)&&s>0?s:Qe(e==null?void 0:e.id)||null;return{...e,idSequence:n,morphs:[...e.morphs||[]],hets:[...e.hets||[]],possibleHets:Array.isArray(e.possibleHets)?[...e.possibleHets]:[],tags:[...e.tags||[]],groups:$t(e.groups),logs:ss(e.logs),photos:mt(e.photos)}})}function hc(){return uc.map(e=>Ve({...e,goals:[...e.goals||[]],notes:e.notes||"",appointments:(e.appointments||[]).map(s=>({...s}))}))}function ve(e){if(!e)return"";if(typeof e=="string"){const s=e.match(/^(\d{4})-(\d{2})-(\d{2})/);if(s)return`${s[3]}/${s[2]}/${s[1]}`;const n=new Date(e);if(!isNaN(n)){const l=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),r=n.getFullYear();return`${l}/${a}/${r}`}return e}if(e instanceof Date){const s=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),l=e.getFullYear();return`${s}/${n}/${l}`}try{const s=new Date(e);if(!isNaN(s)){const n=String(s.getDate()).padStart(2,"0"),l=String(s.getMonth()+1).padStart(2,"0"),a=s.getFullYear();return`${n}/${l}/${a}`}}catch{}return String(e)}function Ve(e={}){const s=$s(),n={...s.ovulation,...e.ovulation||{}},l={...s.preLayShed,...e.preLayShed||{}},a={...s.clutch,...e.clutch||{}},r={...s.hatch,...e.hatch||{}},o=b=>{if(b===""||b===null||typeof b>"u")return null;const f=Number(b);return!Number.isFinite(f)||f<0?null:f},c=!!a.recorded;let d=o(a.fertileEggs),u=o(a.slugs),m=o(a.eggsTotal);c?(d===null&&m!==null&&(d=Math.max(0,m-(u??0))),u===null&&(u=0),d===null&&(d=0),d=Math.max(0,d),u=Math.max(0,u),m=d+u,a.fertileEggs=d,a.slugs=u,a.eggsTotal=m):(a.fertileEggs="",a.slugs="",a.eggsTotal=""),r.hatchedCount=Number(r.hatchedCount||0),(!Number.isFinite(r.hatchedCount)||r.hatchedCount<0)&&(r.hatchedCount=0);const p=typeof a.fertileEggs=="number"&&Number.isFinite(a.fertileEggs)?Math.max(0,a.fertileEggs):typeof a.eggsTotal=="number"&&Number.isFinite(a.eggsTotal)?Math.max(0,a.eggsTotal):null;return typeof p=="number"&&Number.isFinite(p)?r.hatchedCount=Math.min(Math.max(0,r.hatchedCount),p):r.hatchedCount=Math.max(0,r.hatchedCount),{...e,ovulation:n,preLayShed:l,clutch:a,hatch:r}}function tn(e){if(!e)return{name:"",sex:"F",status:"Active",morphs:[],hets:[],tags:[],groups:[],logs:ss(),idSequence:null};const s=Number(e==null?void 0:e.idSequence),n=Number.isFinite(s)&&s>0?s:Qe(e==null?void 0:e.id)||null;return{...e,status:typeof(e==null?void 0:e.status)=="string"&&e.status.trim()?e.status.trim():"Active",idSequence:n,sex:Je(e.sex,"F"),morphs:e.morphs||[],hets:e.hets||[],tags:e.tags||[],groups:$t(e.groups),logs:ss(e.logs),photos:mt(e.photos)}}function Mn(){return{id:"",autoId:!0,idSequence:null,name:"",sex:"F",status:"Active",morphHetInput:"",morphs:[],hets:[],weight:"",year:"",birthDate:"",imageUrl:"",photos:[],groups:[],logs:ss()}}function Pt(e,s){return Array.isArray(e)&&e.find(n=>n&&n.id===s)||null}function Ot(e){const s=String(e??"").trim().toLowerCase();return s?s==="m"||s==="male"?"M":s==="f"||s==="female"?"F":/^male\b/.test(s)?"M":/^female\b/.test(s)?"F":/^supermale\b/.test(s)?"M":/^superfemale\b/.test(s)?"F":/^1[\s.:/]*0$/.test(s)?"M":/^0[\s.:/]*1$/.test(s)?"F":/^m/.test(s)?"M":/^f/.test(s)?"F":"UNKNOWN":"UNKNOWN"}function Je(e,s="F"){const n=Ot(e);return n==="UNKNOWN"?s:n}function sn(e){return Ot(e==null?void 0:e.sex)==="F"}function Fn(e){return Ot(e==null?void 0:e.sex)==="M"}function dn(e){if(e==null)return null;let s=String(e).replace(/\s+/g," ").trim();if(!s)return null;let n=s;const l=[],a=n.match(/^(\d{1,3}%)(?:\s+)(.*)$/i);a&&(l.push(a[1].trim()),n=a[2].trim());const r=n.match(/^(pos(?:s?i?a?ble)?|probable|maybe|ph)\b\s*(.*)$/i);if(r){const d=r[1].toLowerCase(),u={pos:"Possible",possiable:"Possible",posible:"Possible",possible:"Possible",probable:"Probable",maybe:"Maybe",ph:"Possible"};l.push(u[d]||ds(d)),n=r[2].trim()}let o=n;/\bhet\b/i.test(o)&&(o=o.replace(/\bhet\b/gi,"").trim()),o&&(o=o.split(/\s+/).map(d=>{if(!d)return"";const u=d.toUpperCase();return d===u?d:d.charAt(0).toUpperCase()+d.slice(1)}).join(" ").trim());const c=[...l,"Het"];return o&&c.push(o),c.join(" ").replace(/\s+/g," ").trim()}function Vn(e=[]){const s=new Set,n=[];return e.forEach(l=>{const a=String(l).replace(/\s+/g," ").trim().toLowerCase();!a||s.has(a)||(s.add(a),n.push(l))}),n}function at(e=[],s=[],n=[]){const l=Array.isArray(e)?e:e?[e]:[],a=Array.isArray(s)?s:s?[s]:[],r=Array.isArray(n)?n:n?[n]:[],o=l.map(b=>String(b).trim()).filter(Boolean),c=a.map(dn).filter(Boolean),d=r.map(dn).filter(Boolean),u=Vn([...o,...c,...d]),m={Dominant:0,"Incomplete Dominant":1,Recessive:2,Other:3},p=u.map((b,f)=>{const N=rs(b)||"Other",S=typeof m[N]=="number"?m[N]:m.Other;return{token:b,index:f,weight:S}});return p.sort((b,f)=>b.weight!==f.weight?b.weight-f.weight:b.index-f.index),p.map(b=>b.token)}function Ha(e){if(!e)return!1;const s=String(e).toLowerCase();return!!(s.includes("het")||/(^|\s)(pos(?:s?i?a?ble)?|probable|maybe|ph)(\s|$)/i.test(s)||/\d{1,3}%/.test(s))}function pc(e){if(!e)return!1;const s=String(e).replace(/\s+/g," ").trim();if(!s)return!1;const n=s.toLowerCase();return/^(?:\d{1,3}%\s*)?(?:(?:pos(?:s?i?a?ble)?|probable|maybe|ph)\s+)?het\b/.test(n)?!0:Ha(e)}function fc(e){if(!e)return null;let s=String(e).replace(/\s+/g," ").trim();if(!s)return null;let n="";const l=s.match(/^(\d{1,3}%)(?:\s*)(.*)$/i);l&&(n=l[1].toUpperCase(),s=l[2].trim());let a="";const r=s.match(/^(pos(?:s?i?a?ble)?|probable|maybe|ph)(?:\s*)(.*)$/i);r&&(a=r[1].toLowerCase(),s=r[2].trim()),s=s.replace(/\bhet\b/gi," ").replace(/^het(?=[A-Za-z])/i,"").trim();const c={pos:"Possible",ph:"Possible",possible:"Possible",possiable:"Possible",posible:"Possible",probable:"Probable",maybe:"Maybe"}[a]||"",d=[];c&&d.push(c),s&&d.push(s);let u=d.join(" ").trim();return n&&(u=`${n} ${u}`.trim()),u||null}const Lt={map:null,compactMap:null,maxWords:1,maxCompactLength:0};function nr(e){return String(e||"").replace(/[()[\]]/g," ").replace(/[-_/]+/g," ").replace(/\s+/g," ").trim().toLowerCase()}function rr(){if(Lt.map||typeof zn>"u")return Lt;const e=new Map,s=(o,c)=>{const d=nr(o);d&&(e.has(d)||e.set(d,c))};Object.values(zn).forEach(o=>{(o||[]).forEach(c=>{if(!c)return;s(c,c);const d=c.replace(/\(.*?\)/g,"").trim();d&&d!==c&&s(d,c)})}),typeof Rs=="object"&&Rs&&Object.entries(Rs).forEach(([o,c])=>{o&&(c&&s(c,c),s(o,c||o))});const n=new Map;let l=1,a=0;const r=(o,c)=>{const d=o.replace(/\s+/g,"");d&&(n.has(d)||(n.set(d,{display:c,sourceKey:d}),d.length>a&&(a=Math.max(a,d.length))))};return e.forEach((o,c)=>{const d=c.split(" ").filter(Boolean);if(d.length>l&&(l=d.length),r(c,o),!String(o||"").toLowerCase().startsWith("super ")){const m=`super${c.replace(/\s+/g,"")}`,p=`Super ${o}`;r(m,p)}}),Lt.map=e,Lt.compactMap=n,Lt.maxWords=l,Lt.maxCompactLength=a,Lt}function la(e){if(!e)return null;const n=rr().map;if(!n)return null;const l=nr(e);return l&&n.get(l)||null}function xc(e){const s=[];if(!Array.isArray(e)||!e.length)return s;const l=rr().maxWords||1;let a=0;for(;a<e.length;){const r=e[a];if(!r){a+=1;continue}if(r.toLowerCase()==="super"&&a+1<e.length){let u=null,m=0;for(let p=Math.min(l,e.length-(a+1));p>=1;p--){const f=e.slice(a+1,a+1+p).join(" "),N=la(f);if(N){u={display:`Super ${N}`,source:`Super ${f}`},m=p+1;break}}if(u){s.push(u),a+=m;continue}}let c=null,d=0;for(let u=Math.min(l,e.length-a);u>=1;u--){const p=e.slice(a,a+u).join(" "),b=la(p);if(b){c={display:b,source:p},d=u;break}}if(c){s.push(c),a+=d;continue}s.push({display:r,source:r}),a+=1}return s}function oa(e){if(!e)return[];const s=rr(),n=s.compactMap;if(!n||!n.size)return[];const a=nr(e).replace(/\s+/g,"");if(!a)return[];const r=s.maxCompactLength||a.length,o=new Map,c=p=>{if(p===a.length)return[[]];if(o.has(p))return o.get(p);const b=[],f=Math.min(r,a.length-p);for(let N=f;N>=1;N--){const S=a.slice(p,p+N),A=n.get(S);if(!A)continue;c(p+N).forEach(y=>{b.push([A,...y])})}return o.set(p,b),b},d=c(0).filter(p=>p.length);if(!d.length)return[];d.sort((p,b)=>p.length-b.length);const u=d[0].length;return(d.find(p=>p.length===u)||d[0]).map(p=>({display:p.display,source:p.sourceKey}))}function gc(e){if(!e)return[];const s=String(e).replace(/[+]+/g," ");let n=s;const l=[],a=[];let r=0;const o=(U,L)=>a.some(T=>Math.max(T.start,U)<Math.min(T.end,L)),c=(U,L)=>{const T=String(U||"").replace(/\s+/g," ").trim();if(!T)return;const G=Number.isFinite(L)?L:Number.POSITIVE_INFINITY;l.push({token:T,start:G,order:r++})},d=(U,L)=>{!Number.isFinite(U)||!Number.isFinite(L)||a.push({start:U,end:L})},u=/(?:\d{1,3}%\s*)?(?:pos(?:s?i?a?ble)?|probable|maybe|ph)?\s*het\s*[A-Za-z][A-Za-z\s-]*/gi;let m;for(;(m=u.exec(n))!==null;){const U=m.index,L=U+m[0].length;o(U,L)||(c(m[0],U),d(U,L))}const p=/\d{1,3}%\s*[A-Za-z][A-Za-z\s-]*/gi;for(;(m=p.exec(n))!==null;){const U=m.index,L=U+m[0].length;o(U,L)||(c(m[0],U),d(U,L))}if(a.length){let U="",L=0;[...a].sort((G,H)=>G.start-H.start).forEach(G=>{U+=n.slice(L,G.start),U+=" ",L=G.end}),U+=n.slice(L),n=U}const b=s.toLowerCase();let f=0;const N=U=>{if(!U)return Number.POSITIVE_INFINITY;const L=String(U).toLowerCase();let T=b.indexOf(L,f);for(;T!==-1;){const G=T,H=G+L.length;if(!o(G,H))return d(G,H),f=H,G;T=b.indexOf(L,H)}for(T=b.indexOf(L);T!==-1;){const G=T,H=G+L.length;if(!o(G,H))return d(G,H),f=H,G;T=b.indexOf(L,H)}return Number.POSITIVE_INFINITY},S=n.split(/\s+/).filter(Boolean),A=xc(S);A.length&&A.forEach(U=>{if(U.display===U.source){const G=oa(U.source)||[];if((G.length>1||G.length===1&&G[0].display!==U.display)&&G.length){G.forEach(ee=>{if(!ee||!ee.display)return;const g=[ee.source,ee.display].filter(Boolean);let I=Number.POSITIVE_INFINITY;for(const D of g)if(I=N(D),Number.isFinite(I))break;c(ee.display,I)});return}}const T=N(U.source);c(U.display,T)});const E=[...a].sort((U,L)=>U.start-L.start);let y=0;const _=[];if(E.forEach(U=>{if(U.start>y){const L=s.slice(y,U.start);L&&/[A-Za-z]/.test(L)&&_.push(L)}y=Math.max(y,U.end)}),y<s.length){const U=s.slice(y);U&&/[A-Za-z]/.test(U)&&_.push(U)}return _.length&&_.forEach(U=>{(oa(U)||[]).forEach(T=>{if(!T||!T.display)return;const G=[T.source,T.display].filter(Boolean);let H=Number.POSITIVE_INFINITY;for(const ee of G)if(H=N(ee),Number.isFinite(H))break;c(T.display,H)})}),l.sort((U,L)=>U.start===L.start?U.order-L.order:U.start-L.start),l.map(U=>U.token)}function hs(e){const s=String(e||"").trim();if(!s)return{morphs:[],hets:[]};const l=s.split(/[\n\r,;|/+]+/).map(o=>o.trim()).filter(Boolean).flatMap(gc),a=[],r=[];return l.forEach(o=>{if(Ha(o)){const c=fc(o);c&&r.push(c)}else a.push(o)}),{morphs:a,hets:r}}function bc(e=[],s=[]){const n=(Array.isArray(e)?e:[]).map(a=>String(a).trim()).filter(Boolean),l=(Array.isArray(s)?s:[]).map(dn).filter(Boolean);return[...n,...l].join(", ")}function Ba(e,s=3){const n=[],l=new Date(e||new Date);for(let a=0;a<s;a++){const r=new Date(l.getFullYear(),l.getMonth()+a,l.getDate());n.push({id:ys("ap"),date:ze(r),notes:"",lockObserved:!1,lockLoggedAt:null})}return n}function qa(e){return new Promise((s,n)=>{const l=new FileReader;l.onload=()=>s(l.result),l.onerror=n,l.readAsDataURL(e)})}function yc(e,s,n=1024){if(!e||!s)return{width:0,height:0};const l=Math.max(e,s);if(!n||l<=n)return{width:e,height:s};const a=n/l;return{width:Math.round(e*a),height:Math.round(s*a)}}function Nc(e){return new Promise((s,n)=>{const l=new Image;l.onload=()=>s(l),l.onerror=n,l.src=e})}async function vc(e,{maxDimension:s=1024}={}){if(!e)return null;const n=URL.createObjectURL(e);try{const l=await Nc(n),a=l.naturalWidth||l.width,r=l.naturalHeight||l.height;if(!a||!r)throw new Error("Invalid image dimensions");const{width:o,height:c}=yc(a,r,s),d=document.createElement("canvas");d.width=o,d.height=c;const u=d.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("Canvas context not available");u.drawImage(l,0,0,o,c);const m=u.getImageData(0,0,o,c),p=Ql(m.data,m.width,m.height,{inversionAttempts:"attemptBoth"});return p&&typeof p.data=="string"?p.data:null}finally{URL.revokeObjectURL(n)}}function Va(e){if(!e)return null;if(typeof e=="string")return e;if(typeof e=="object"){if(typeof e.text=="string")return e.text;if(typeof e.decodedText=="string")return e.decodedText;if(typeof e.data=="string")return e.data;if(Array.isArray(e)&&e.length>0)return Va(e[0])}return null}function nn(e){if(e==null)return null;const s=String(e).trim();if(!s)return null;const n=s.match(/#?snake=?(.*)/),l=n?n[1]:s;try{return decodeURIComponent(l)||null}catch{return l||null}}function He(e,s,n,l){if(typeof e=="function"){const c=e,d=n,u=l||{};c(m=>{const p={...m.logs||{}},b=Array.isArray(p[s])?[...p[s]]:[];if(typeof d=="number"){const f=b[d]||{};b[d]={...f,...u}}else n&&typeof n=="object"&&b.push(n);return{...m,logs:{...p,[s]:b}}});return}const a=e;if(!a)return a;const r=n,o={...a.logs||{}};return o[s]=[...o[s]||[],r],{...a,logs:o}}function Ya(e){if(!e)return[];const s=e.split(/\n\s*\n/).map(l=>l.trim()).filter(Boolean),n=[];for(const l of s){let a=l.split(/\n/).map(c=>c.trim()).filter(Boolean);a=a.filter(c=>!/^ball python\s*\(python regius\)$/i.test(c));const r={name:"",sex:"F",morphs:[],hets:[],tags:[],groups:[],imageUrl:void 0},o=c=>(c||"").split(/[,/]/).map(d=>d.trim()).filter(Boolean);if(a.length>=4){const c=a[0].match(/^(.*?)\s*\(([^)]+)\)\s*$/),d=a[2].toLowerCase();if(c&&/female|male|f|m/i.test(d)){r.name=c[1].trim(),r.id=c[2].trim(),r.sex=/female/i.test(d)?"F":/male/i.test(d)?"M":"F";const u=a[3],m=/([^,]+(?:\([^)]*\))?)/g,p=[];let b;for(;(b=m.exec(u))!==null;){const f=b[1].trim();f&&p.push(f)}for(let f of p){const N=f.match(/^(.+?)\s*\(([^)]+)\)\s*$/);let S=f,A=null;N&&(S=N[1].trim(),A=N[2].trim().toLowerCase()),A?/regular/i.test(A)?r.morphs.push(S):/heterozygous66|heterozygous 66|66%|\b66\b/i.test(A)?r.hets.push(`66% ${S}`):/heterozygous50|heterozygous 50|50%|\b50\b/i.test(A)?r.hets.push(`50% ${S}`):/heterozygous|het/i.test(A)?r.hets.push(`${S}`):/\bpos(?:s?i?a?ble)?\b/i.test(A)?r.hets.push(`${S} (possible)`):r.hets.push(`${S} (${A})`):r.morphs.push(S)}r.name&&n.push(r);continue}}for(const c of a){const d=c.toLowerCase();if(d.startsWith("name:")&&(r.name=c.split(":").slice(1).join(":").trim()),d.startsWith("sex:")&&(/female/i.test(c)?r.sex="F":/male/i.test(c)&&(r.sex="M")),d.startsWith("morphs:")||d.startsWith("morph:")||d.includes("morph")){const u=c.split(":"),m=u.length>1?u.slice(1).join(":"):c.replace(/morphs?:/i,"").trim();r.morphs=o(m)}if(d.startsWith("hets:")||d.startsWith("het:")||d.includes("het")){const u=c.split(":"),m=u.length>1?u.slice(1).join(":"):c.replace(/hets?:/i,"").trim();r.hets=o(m)}}if(!r.name&&a.length){const c=a[0],d=c.match(/^(.+?)\s*\((male|female|m|f)\)/i);if(d)r.name=d[1].trim(),r.sex=/male/i.test(d[2])?"M":"F";else{const u=c.split(/[-–—|\t]/).map(m=>m.trim()).filter(Boolean);u.length>=2&&/^(male|female|m|f)$/i.test(u[1])?(r.name=u[0],r.sex=/male/i.test(u[1])?"M":"F",u.length>2&&(r.morphs=o(u.slice(2).join(", ")))):r.name=c}}if((!r.sex||r.sex==="")&&a.some(c=>/male|female|\bM\b|\bF\b/i.test(c)))for(const c of a){if(/female/i.test(c)){r.sex="F";break}if(/male/i.test(c)){r.sex="M";break}}if((!r.morphs||!r.morphs.length)&&a.length>1){for(const c of a.slice(1))if(/morphs?:|visuals?:/i.test(c)||/,/.test(c)||/\//.test(c)){const d=c.split(/:|–|-|—/).map(p=>p.trim()).filter(Boolean),u=d.length>1?d.slice(1).join(":"):d[0],m=o(u);if(m.length){r.morphs=m;break}}}if((!r.hets||!r.hets.length)&&a.length>1){for(const c of a.slice(1))if(/hets?:/i.test(c)||/het\b/i.test(c)){const d=c.split(/:|–|-|—/).map(p=>p.trim()).filter(Boolean),u=d.length>1?d.slice(1).join(":"):d[0],m=o(u);if(m.length){r.hets=m;break}}}r.name=(r.name||"").trim(),r.morphs=Array.isArray(r.morphs)?r.morphs.map(c=>c.trim()).filter(Boolean):r.morphs?[String(r.morphs).trim()]:[],r.hets=Array.isArray(r.hets)?r.hets.map(c=>c.trim()).filter(Boolean):r.hets?[String(r.hets).trim()]:[],r.name&&n.push(r)}return n}function wc(e){if(!e)return[];const s=e.split(/\n\s*\n/).map(l=>l.trim()).filter(Boolean),n=[];for(const l of s){let a=l.split(/\n/).map(N=>N.trim()).filter(Boolean);if(a=a.filter(N=>!/^ball python\s*\(python regius\)$/i.test(N)),a.length<3)continue;const r=a[0].match(/^(.*?)\s*\(([^)]+)\)\s*$/);if(!r)continue;const o=r[1].trim(),c=r[2].trim(),d=a[1]?a[1].toLowerCase():"",u=/female/i.test(d)?"F":/male/i.test(d)?"M":"F",p=(a[2]||"").split(",").map(N=>N.trim()).filter(Boolean),b=[],f=[];for(const N of p){const S=N.match(/^(.+?)\s*\(([^)]+)\)\s*$/);let A=N,E=null;S&&(A=S[1].trim(),E=S[2].trim().toLowerCase()),E?/regular/i.test(E)?b.push(A):/heterozygous66|heterozygous 66|66%|\b66\b/i.test(E)?f.push(`66% ${A}`):/heterozygous50|heterozygous 50|50%|\b50\b/i.test(E)?f.push(`50% ${A}`):/heterozygous|het/i.test(E)?f.push(`${A}`):/\bpos(?:s?i?a?ble)?\b/i.test(E)?f.push(`${A} (possible)`):f.push(`${A} (${E})`):b.push(A)}n.push({name:o,id:c,sex:u,morphs:b,hets:f})}return n}function jc(e,s=null){const n=Je(e.sex,"F"),l=[...Array.isArray(e.morphs)?e.morphs:e.morphs?[String(e.morphs)]:[],...Array.isArray(e.hets)?e.hets:e.hets?[String(e.hets)]:[],...Array.isArray(e.genetics)?e.genetics:e.genetics?[String(e.genetics)]:[]],a=Wn(l),r=bs(e.birthDate||e.hatchDate||e.birthdate||null),o=r?it(r):null,c=(e.id||"").toString().trim(),d=Array.isArray(e.__existingRecords)?e.__existingRecords:null,u=Array.isArray(e.__existingIds)?e.__existingIds:[],m=d&&d.length?d.map(j=>{if(!j)return null;if(typeof j=="string"){const ce=j;return{id:ce,idSequence:Qe(ce,s)}}const P=j.id!=null?String(j.id):"";if(!P)return null;const te=Number(j.idSequence),X=Number.isFinite(te)&&te>0?Math.floor(te):Qe(P,s);return{id:P,idSequence:X}}).filter(Boolean):u.map(j=>String(j)).filter(Boolean).map(j=>({id:j,idSequence:Qe(j,s)})),p=new Set(m.map(j=>j.id));let b=Number(e.year);(!Number.isFinite(b)||b<=0)&&(b=new Date().getFullYear());let f=e.name||"",N=!1;if(e.name){const j=String(e.name).trim().match(/^(20\d{2})\b[-\s:/]*(.*)$/);j&&(N=!0,b=Number(j[1])||b,f=(j[2]||"").trim()||f)}Number.isFinite(o)&&(b=o);let S="";if(c){let j=c;if(p.has(j)){let P=2;for(;p.has(`${c}-${P}`);)P+=1;j=`${c}-${P}`}S=j}const A=c||e.name||"",E=String(A).match(/-(\d+)$/),y=E?Number(E[1]):null,_=S||Mt(f||(n==="F"?"NewFemale":"NewMale"),b,m,y,{hadYear:N,originalRawName:String(e.name||""),morphs:a.morphs,hets:a.hets,idConfig:s,sex:n,birthYear:o}),U=Qe(_,s),L=Number(e.weight),T=Number.isFinite(L)?L:0,H=(Array.isArray(e.groups)?e.groups:Qn(e.groups)).map(j=>String(j).trim()).filter(Boolean),g=(Array.isArray(e.tags)?e.tags:Qn(e.tags)).map(j=>String(j).trim()).filter(Boolean),I=String(e.status||"Active").trim()||"Active",D=typeof e.notes=="string"?e.notes.trim():"",k=e.imageUrl?String(e.imageUrl):void 0,oe=mt(e.photos),$=k||(oe.length?oe[oe.length-1].url:void 0);return{id:_,name:f&&f.length?f:e.name||(n==="F"?"New Female":"New Male"),sex:n,morphs:a.morphs,hets:a.hets,weight:T,year:b,birthDate:r,tags:g,groups:H,status:I,notes:D,imageUrl:$,photos:oe,idSequence:U,logs:{feeds:[],weights:[],sheds:[],cleanings:[],meds:[]}}}const Tn="__SEQ_PLACEHOLDER__";function Yn(e){return String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Cc(e,s=1){const n=Number(e);if(!Number.isFinite(n)||n<=0){const a=Number.isFinite(n)?Math.max(1,Math.floor(n)||1):1;return String(a)}const l=String(Math.floor(n));return!s||s<=1?l:l.padStart(s,"0")}function Wa(e){const s=String(e||"").trim();return/\[SEQ\]/i.test(s)?s:s?/(?:-|_|\.|#|\/|\s)$/.test(s)?`${s}[SEQ]`:`${s}-[SEQ]`:pn.template}function Sc(e=[]){const s=Array.isArray(e)?e:[],n=[];for(const l of s){const a=String(l||"").trim();if(!a)continue;const r=a.match(/(\d+)%\s*(.*)$/i);if(r){const d=r[1],u=(r[2]||"").replace(/[^A-Za-z]/g,"").slice(0,3).toLowerCase();u&&n.push(`${d}%H${u}`);continue}const o=a.match(/^(.+?)\s*\(pos(?:s?i?a?ble)?\)$/i);let c=a;o&&(c=o[1]),c=c.replace(/[^A-Za-z]/g,"").slice(0,3).toLowerCase(),c&&n.push(`H${c}`)}return n.join("")}function kc(e){return String(e||"").replace(/\bhet\b/gi,"").replace(/\bpos(?:s?i?a?ble)?\b|\bprobable\b|\bmaybe\b|\bph\b/gi,"").replace(/\d{1,3}%/g,"").replace(/[()]/g," ").replace(/[^A-Za-z\s]/g," ").replace(/\s+/g," ").trim()}function ia(e){const s=kc(e);if(!s)return"";const n={monarch:"MONA",monsoon:"MONS"},l=s.replace(/[^A-Za-z]/g,"").toLowerCase();if(n[l])return n[l];const a=s.split(/\s+/).map(o=>o.replace(/[^A-Za-z]/g,"")).filter(Boolean);if(!a.length)return"";if(a.length>=2)return a.map(o=>o.charAt(0).toUpperCase()).join("");const r=a[0].toUpperCase();return r.length<=3?r:r.slice(0,3)}function Ac(e=[],s=[]){const n=Array.isArray(e)?e:e?[e]:[],l=Array.isArray(s)?s:s?[s]:[],a=n.map(c=>ia(c)).filter(Boolean),r=l.map(c=>{const d=String(c||"").trim();if(!d)return"";const u=d.match(/(\d{1,3}%)/),m=u?u[1]:"",p=/\bpos(?:s?i?a?ble)?\b/i.test(d)||/\bph\b/i.test(d)||/\bmaybe\b/i.test(d)||/\bprobable\b/i.test(d),b=ia(d);if(!b)return"";const f=[];return m&&f.push(m),p&&!f.includes("pos")&&f.push("pos"),`${f.join("")}h${b}`}).filter(Boolean),o=[...a,...r];return o.length?o.join(""):""}function Dc(e){return e.split(/\s+/).filter(Boolean).map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")}function Ec(e=""){const s=String(e??""),n=s.trim(),l=n.replace(/[^A-Za-z]/g,""),a=n.replace(/[^A-Za-z0-9]/g,""),r=a||l||"X",o=r.toUpperCase(),c=r.toLowerCase(),d=n?Dc(n):o,u=n?n.toUpperCase():o,m=n?n.toLowerCase():c,p=n.split(/\s+/).filter(Boolean),b=p.length?p.map(S=>S.charAt(0).toUpperCase()).join(""):o.charAt(0)||"X",f=n.match(/^\s*\(([^)]+)\)/);let N="";if(f){const S=f[1].replace(/[^A-Za-z0-9]/g,"");S&&(N=`(${S.toUpperCase().slice(0,3)})`)}return{rawName:s,lettersOnly:l,sanitizedAlnum:a,prefixCore:r,prefixUpper:o,prefixLower:c,nameTitle:d,nameUpper:u,nameLower:m,initials:b||o.charAt(0)||"X",slugLower:a?a.toLowerCase():c,slugUpper:a?a.toUpperCase():o,parenChunk:N}}function Qa({name:e,rawName:s,morphs:n,hets:l,year:a,sex:r,birthYear:o}){const c=Number(a)||new Date().getFullYear(),d=Number(o),u=Number.isFinite(d)&&d>0?d:c,m=String(u).slice(-2).padStart(2,"0"),p=Ec(e||s),b=Ac(n,l);return{...p,hetSegment:Sc(l),yearFull:c,yearShort:String(c).slice(-2).padStart(2,"0"),birthYearFull:u,birthYearShort:m,sexCode:String(r||"U").trim().charAt(0).toUpperCase()||"U",geneInitials:b}}function Ka(e,s,n=Tn){const l=Wa(e.template),a={"[YEAR]":String(s.yearFull),"[YR]":s.yearShort,"[YEAROB]":String(s.birthYearFull??s.yearFull),"[YROB]":s.birthYearShort??s.yearShort,"[PREFIX]":s.prefixCore,"[PREFIXU]":s.prefixUpper,"[PREFIXL]":s.prefixLower,"[NAME]":s.nameTitle,"[NAMEU]":s.nameUpper,"[NAMEL]":s.nameLower,"[INITIALS]":s.initials,"[SLUG]":s.slugLower,"[SLUGU]":s.slugUpper,"[PAREN]":s.parenChunk,"[HETS]":s.hetSegment,"[SEX]":s.sexCode,"[TEXT]":e.customText||"","[GEN3]":s.geneInitials||"","[-]":"-"};let r=l;for(const[c,d]of Object.entries(a))r=r.replace(new RegExp(Yn(c),"g"),d);let o;return n===Tn?o=Tn:Number.isFinite(Number(n))?o=Cc(n,e.sequencePadding):o=String(n||""),r=r.replace(/\[SEQ\]/gi,o),e.uppercase&&(r=r.toUpperCase()),r.trim()}function Xa(e){const s=Wa(e),n=/\[([A-Z0-9-]+)\]/gi;let l=0;const a=[];let r,o=!1;for(;(r=n.exec(s))!==null;){const d=s.slice(l,r.index);d&&a.push(Yn(d));const u=(r[1]||"").toUpperCase();u==="SEQ"?o?a.push("(?:\\d+)"):(a.push("(\\d+)"),o=!0):u==="-"?a.push("(?:-)"):a.push("(?:.*?)"),l=r.index+r[0].length}const c=s.slice(l);return c&&a.push(Yn(c)),new RegExp(`^${a.join("")}$`,"i")}function Qe(e,s=null){if(!e)return null;const n=Ns(s);if(!(n!=null&&n.template))return null;const l=Xa(n.template),a=String(e).match(l);if(!a||a.length<2)return null;const r=Number(a[1]);return!Number.isFinite(r)||r<=0?null:r}function Mt(e,s,n=[],l=null,a={}){const{hadYear:r=!1,originalRawName:o="",morphs:c=[],hets:d=[],idConfig:u=null,sex:m="U",birthYear:p=null,forceSequence:b=null}=a||{},f=Ns(u),N=Array.isArray(n)?n.map(D=>{if(!D)return null;if(typeof D=="string"){const oe=D;return{id:oe,idSequence:Qe(oe,f)}}if(typeof D=="object"){if(D.id||D.id===""){const $=D.id,j=typeof $=="string"?$:$!=null?String($):"";if(!j)return null;const P=Number(D.idSequence),te=Number.isFinite(P)&&P>0?Math.floor(P):Qe(j,f);return{id:j,idSequence:te}}const oe=String(D);return oe?{id:oe,idSequence:Qe(oe,f)}:null}const k=String(D);return k?{id:k,idSequence:Qe(k,f)}:null}).filter(D=>D&&D.id):[],S=N.map(D=>D.id).filter(Boolean),A=S.map(D=>D.toLowerCase()),E=new Set(A),y=E.size,_=new Set;N.forEach(D=>{const k=Number(D.idSequence);Number.isFinite(k)&&k>0&&_.add(Math.floor(k))});const U=Number(s)||new Date().getFullYear(),L=e&&String(e).trim()||o&&String(o).trim()||(m==="M"?"New Male":"New Female"),T=Qa({name:L,rawName:r?o:e,morphs:c,hets:d,year:U,sex:m,birthYear:p??U}),G=D=>Ka(f,T,D),H=Xa(f.template);for(const D of S){if(!D||typeof D!="string")continue;const k=D.match(H);if(!k)continue;const oe=Number(k[1]);Number.isFinite(oe)&&oe>0&&_.add(Math.floor(oe))}const ee=Number(b);if(Number.isFinite(ee)&&ee>0){const D=Math.floor(ee),k=G(D);if(!E.has(k.toLowerCase()))return k}let g=Math.max(1,y+1);for(;_.has(g);)g+=1;let I=G(g);for(;E.has(I.toLowerCase());){for(g+=1;_.has(g);)g+=1;I=G(g)}return I}function Wn(e){const s=Array.isArray(e)?e.slice():e?String(e).split(GENE_TOKEN_SPLIT_REGEX).map(o=>o.trim()).filter(Boolean):[],n=[],l=[];for(let o of s){if(!o)continue;const c=String(o).trim(),d=c.toLowerCase();if(/\([^)]*\bregular\b[^)]*\)/i.test(c)){const m=c.replace(/\([^)]*\bregular\b[^)]*\)/i,"").replace(/[()]/g,"").trim();n.push(ds(m));continue}const u=c.match(/(\d+)%/);if(u){const m=u[1];let p=c.replace(/(\d+)%/,"").replace(/\bheterozygous\b/ig,"").replace(/\bhet\b/ig,"").replace(/[()]/g,"").trim();p=ds(p)||p,l.push(`${m}% ${p}`);continue}if(/\bpos(?:s?i?a?ble)?\b/i.test(d)){const m=c.replace(/\bpos(?:s?i?a?ble)?\b/ig,"").replace(/[()]/g,"").trim();l.push(`${ds(m)} (possible)`);continue}if(/\bheterozygous\b|\bhet\b/i.test(d)){const m=c.replace(/\bheterozygous\b/ig,"").replace(/\bhet\b/ig,"").replace(/[()]/g,"").trim();l.push(ds(m));continue}n.push(ds(c))}const a=Vn(n.map(o=>String(o).trim()).filter(Boolean)),r=Vn(l.map(o=>dn(o)).filter(Boolean));return{morphs:a,hets:r}}function rn(e){const s=e.name||"",n=e.id||"",l=e.sex==="M"?"Male":e.sex==="F"?"Female":"Unknown",a=at(e.morphs,e.hets,e.possibleHets),r=a.length?a.join(", "):"-";return`Name - ${s}
ID - ${n}
Gender - ${l}
Genetics - ${r}`}function Ic(e){if(!e||typeof e!="string")return null;const s=e.trim(),n=s.match(/^\s*(.*?)\s*\(([^)]+)\)\s*/);if(!n)return null;const l=n[1].trim(),a=n[2].trim();let r=s.slice(n[0].length).trim();r=r.replace(/Ball Python\s*\(Python regius\)/i,"").trim();const o=r.match(/^(Female|Male|Unknown)\b/i),c=o?o[1][0].toUpperCase()+o[1].slice(1).toLowerCase():"Unknown";let d=o?r.slice(o[0].length).trim():r;if(d=d.replace(/^[-\s:]+/,"").trim(),!d)return{name:l,id:a,gender:c,genetics:[]};const m=d.split(",").map(p=>p.trim()).filter(Boolean).map(p=>{const b=p.match(/^(.+?)\s*\(([^)]+)\)\s*$/),f=b?b[1].trim():p,N=b?b[2].trim().toLowerCase():null;return!N||/^regular$/i.test(N)?f:/heterozygous66|heterozygous 66|66%|^66$/i.test(N)?`66% ${f}`:/heterozygous50|heterozygous 50|50%|^50$/i.test(N)?`50% ${f}`:/heterozygous|^het$/i.test(N)?`${f}`:/\bpos(?:s?i?a?ble)?\b/i.test(N)?`Possible het ${f}`:`het ${f}`});return{name:l,id:a,gender:c,genetics:m}}function Lc(e){const s=(e||"").trim(),n=s.match(/^(.+?)\s*\(([^)]+)\)\s*$/),l=n?n[1].trim():s,a=n?n[2].trim().toLowerCase():null;return!a||/^regular$/i.test(a)?l:/heterozygous66|66%|^66$/i.test(a)?`66% het ${l}`:/heterozygous50|50%|^50$/i.test(a)?`50% het ${l}`:/heterozygous|^het$/i.test(a)?`het ${l}`:/\bpos(?:s?i?a?ble)?\b/i.test(a)?`Possible het ${l}`:`het ${l}`}function Mc(e){if(!e)return[];const s=e.split(/\r?\n/).map(l=>l.trim()).filter(Boolean),n=[];for(const l of s){if(!/\|/.test(l))continue;const a=l.split("|").map(m=>m.trim()).filter(Boolean);if(a.length<2)continue;const r=a[0],o=a[1].match(/female/i)?"F":a[1].match(/male/i)?"M":"Unknown",c=a.slice(2).join(", "),u=(c?c.split(",").map(m=>m.trim()).filter(Boolean):[]).map(Lc);n.push({name:r,sex:o,morphs:u.filter(m=>!/^het\b|^66%|^50%|^possible/i.test(m)),hets:u.filter(m=>/^het\b|^66%|^50%|^Possible/i.test(m))})}return n}function Fc(e){const s=[];let n=0;const l=e.length;let a="",r=[],o=!1;for(;n<l;){const c=e[n];if(o){if(c==='"'){if(n+1<l&&e[n+1]==='"'){a+='"',n+=2;continue}o=!1,n++;continue}a+=c,n++;continue}if(c==='"'){o=!0,n++;continue}if(c===","){r.push(a),a="",n++;continue}if(c==="\r"){n++;continue}if(c===`
`){r.push(a),s.push(r),r=[],a="",n++;continue}a+=c,n++}return(a!==""||r.length)&&(r.push(a),s.push(r)),s}function Tc(e){return String(e||"").toLowerCase().replace(/[^a-z0-9]+/g," ").trim()}function Pc(e){const s=Tc(e);return s?/^name$|^animal name$|^snake name$/.test(s)?"name":/^id$|^animal id$|^snake id$|^identifier$/.test(s)?"id":/(^|\s)(sex|gender)(\s|$)/.test(s)?"sex":/(^|\s)(morph|visual|combo)(s)?(\s|$)/.test(s)?"morphs":/(^|\s)(het|hetero)(s)?(\s|$)/.test(s)?"hets":/(^|\s)(genetic|gene|traits?)(s)?(\s|$)/.test(s)?"genetics":/(^|\s)(group|collection|category|rack)(s)?(\s|$)/.test(s)?"groups":/(^|\s)(tag|keyword)(s)?(\s|$)/.test(s)?"tags":/(^|\s)(birth|hatch|dob)(\s|$)/.test(s)?"birthDate":/^year$|^birth year$|^hatch year$/.test(s)?"year":/(^|\s)weight(\s|$)|(^|\s)grams?(\s|$)/.test(s)?"weight":/(^|\s)status(\s|$)/.test(s)?"status":/(^|\s)notes?(\s|$)|(^|\s)comments?(\s|$)/.test(s)?"notes":null:null}function Qn(e){return e==null?[]:String(e).split(/[;|,/\n]/).map(s=>s.trim()).filter(Boolean)}function $t(e){if(!e&&e!==0)return[];const s=Array.isArray(e)?e:[e];for(const n of s){if(n===null||typeof n>"u")continue;const l=String(n).trim();if(l)return[l]}return[]}function bs(e){if(!e)return null;const s=String(e).trim();if(!s)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(s))return s;const n=new Date(s);return isNaN(n.getTime())?null:ze(n)}function $c(e=[]){const s={};return e.forEach((n,l)=>{const a=Pc(n);a&&(s[a]||(s[a]=[]),s[a].push(l))}),{index:s,hasHeader:Object.keys(s).length>0}}function ca(e=[],s={},n){const l=s[n];return!l||!l.length?[]:l.map(a=>(e[a]||"").toString()).filter(Boolean)}function Rc({newAnimal:e,setNewAnimal:s,groups:n,setGroups:l,statusOptions:a=[],customStatusTags:r=[],onCreateStatusTag:o,onDeleteStatusTag:c,onCancel:d,onAdd:u,theme:m="blue"}){const p=!!(e.name&&e.name.trim().length),b=(Array.isArray(e.groups)&&e.groups.length?e.groups[0]:"")||"",[f,N]=h.useState(""),S=h.useMemo(()=>new Set(r.map(g=>g.toLowerCase())),[r]),[A,E]=h.useState(!1),y=h.useRef(null);h.useEffect(()=>{if(!A)return;const g=I=>{y.current&&(y.current.contains(I.target)||E(!1))};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[A]),h.useEffect(()=>{E(!1)},[a]),h.useEffect(()=>{if(!A)return;const g=I=>{y.current&&(y.current.contains(I.target)||E(!1))};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[A]);const _=h.useCallback(()=>{const g=(f||"").trim();if(!g)return;const I=typeof o=="function"?o(g):g;I&&(s(D=>({...D,status:I})),N(""))},[f,o,s]),U=h.useCallback(g=>{s(I=>({...I,status:g})),E(!1)},[s]),L=h.useCallback(()=>{s(g=>({...g,status:""})),E(!1)},[s]),T=h.useCallback(g=>{typeof c=="function"&&c(g),E(!1),s(I=>I&&((I.status||"").trim().toLowerCase()===g.toLowerCase()?{...I,status:""}:I))},[c,s]),G=h.useCallback(g=>{const I=g.target.value;s(D=>({...D||{},name:I}))},[s]),H=h.useCallback(g=>{const I=g.target.value;s(D=>({...D||{},id:I,autoId:!1}))},[s]),ee=h.useCallback(g=>{const I=g.target.value;s(D=>({...D||{},sex:I}))},[s]);return t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm max-h-[68vh] overflow-auto",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e&&e.name||"",onChange:G,placeholder:"e.g., Athena"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"ID"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm font-mono",value:e&&e.id||"",onChange:H,placeholder:"Optional: custom ID (e.g., 25Ath-2)"}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"If you leave this blank an ID will be generated. If the ID you enter already exists a suffix will be appended to make it unique."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-2 py-1 bg-white text-sm",value:e&&e.sex||"F",onChange:ee,children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"})]})]}),t.jsxs("div",{ref:y,className:"relative",children:[t.jsx("label",{className:"text-xs font-medium",children:"Tag"}),t.jsxs("button",{type:"button",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm bg-white text-left flex items-center justify-between",onClick:()=>E(g=>!g),children:[t.jsx("span",{children:(e.status||"").trim()||"No tag"}),t.jsx("span",{className:"text-[10px] text-neutral-500",children:"v"})]}),A&&t.jsxs("div",{className:"absolute z-40 mt-1 w-full rounded-xl border border-neutral-200 bg-white shadow-lg",children:[t.jsx("button",{type:"button",className:"w-full px-3 py-2 text-left text-sm hover:bg-neutral-100",onClick:L,children:"No tag"}),t.jsx("div",{className:"border-t border-neutral-100"}),a.length?a.map(g=>t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-sm hover:bg-neutral-50",children:[t.jsx("button",{type:"button",className:"flex-1 text-left",onClick:()=>U(g),children:g}),t.jsx("button",{type:"button",className:"ml-3 text-sm font-semibold text-rose-500 hover:text-rose-600",onClick:()=>T(g),title:"Delete tag",children:"-"})]},g)):t.jsx("div",{className:"px-3 py-2 text-sm text-neutral-400",children:"No tags available yet."})]}),t.jsxs("div",{className:"mt-2 grid w-full grid-cols-[minmax(0,1fr)_auto] gap-2",children:[t.jsx("input",{className:"w-full border rounded-lg px-2 py-1 text-sm",value:f,onChange:g=>N(g.target.value),onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),_())},placeholder:"Create new tag"}),t.jsx("button",{type:"button",className:ne("px-2.5 py-1 rounded-lg text-sm border transition-colors whitespace-nowrap",f.trim()?Ee(m,!0):"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:_,disabled:!f.trim(),children:"Add tag"})]}),Array.isArray(a)&&a.length>0&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:a.map(g=>{const I=S.has(g.toLowerCase());return t.jsxs("span",{className:ne("inline-flex items-center gap-1 rounded-full px-2 py-1 text-[11px]",I?"border border-neutral-200 bg-neutral-50 text-neutral-600":"border border-neutral-100 bg-white text-neutral-500"),children:[t.jsx("span",{children:g}),typeof c=="function"&&t.jsx("button",{type:"button",className:"h-4 w-4 rounded-full border border-neutral-300 text-[10px] leading-[10px] text-neutral-500 hover:border-rose-400 hover:text-rose-500",title:"Delete tag",onClick:()=>c(g),children:"×"})]},g)})}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"Tags let you group animals for availability. Removing a tag clears it from any animals using it."})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Genetics (morphs & hets)"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-2 py-2 text-sm",value:e.morphHetInput||"",onChange:g=>{const I=g.target.value,{morphs:D,hets:k}=hs(I);s(oe=>({...oe,morphHetInput:I,morphs:D,hets:k}))},placeholder:`Clown
Pastel
Het Hypo`}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"List each trait on its own line (commas, slashes, or percentages are still supported when pasting)."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Weight (g)"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e.weight,onChange:g=>s(I=>({...I,weight:g.target.value})),placeholder:"0"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Year"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e.year,onChange:g=>s(I=>({...I,year:g.target.value})),placeholder:"2025"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:e.birthDate||"",onChange:g=>{const I=g.target.value;s(D=>{const k=I?bs(I)||I:"",oe=it(k||I),$={...D,birthDate:k};return oe?$.year=String(oe):k||($.birthDate=""),$})}})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Group"}),n.length?t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-2 py-2 text-sm bg-white",value:b,onChange:g=>{const I=g.target.value.trim();s(D=>({...D,groups:I?[I]:[]}))},children:[t.jsx("option",{value:"",children:"No group"}),n.map(g=>t.jsx("option",{value:g,children:g},g))]}):t.jsx("div",{className:"mt-1 text-xs text-neutral-500",children:"No groups yet. Add one below."}),t.jsx("div",{className:"mt-3 border border-dashed border-neutral-200 rounded-xl p-3 bg-white",children:t.jsx(el,{onAdd:g=>{g&&(l(I=>I.includes(g)?I:[...I,g]),s(I=>({...I,groups:[g]})))}})})]})]}),t.jsxs("div",{className:"p-4 border-t flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Data is local only in this demo."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:d,children:"Cancel"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm text-white",p?Ee(m,!0):Ee(m,!1)),disabled:!p,onClick:u,children:"Add animal"})]})]})]})}function _c(){var jr,Cr;const[e,s]=h.useState(aa),[n,l]=h.useState(hc),[a,r]=h.useState("animals"),[o,c]=h.useState("active"),[d,u]=h.useState("All"),[m,p]=h.useState("all"),[b,f]=h.useState(""),N="all",[S,A]=h.useState("all"),[E,y]=h.useState([]),[_,U]=h.useState([]),[L,T]=h.useState([]),[G,H]=h.useState([]),[ee,g]=h.useState([]),[I,D]=h.useState(()=>[...mc]),[k,oe]=h.useState("blue"),[$,j]=h.useState(()=>{const i=Ms(ut.breeder,null);return Jt(i)}),[P,te]=h.useState(()=>Wt(Ms(ut.backupSettings,null))),[X,ce]=h.useState(()=>rc(Ms(ut.backupSnapshot,null))),[q,V]=h.useState(()=>dc(Ms(ut.backupVault,[]))),[re,ae]=h.useState(()=>[...xs]),[pe,we]=h.useState(()=>[...gs]),[Ie,Y]=h.useState(null),[ue,M]=h.useState(!1),[R,W]=h.useState(Mn),[ie,he]=h.useState(""),[be,Ce]=h.useState([]),[je,Ne]=h.useState(!1),[Z,z]=h.useState(!1),[J,fe]=h.useState(!0),[ke,_e]=h.useState(null),[Fe,Pe]=h.useState(!1),[ye,Xe]=h.useState(null),[me,Ae]=h.useState(null),[tt,St]=h.useState(null),[Nt,st]=h.useState(null),[kt,vt]=h.useState(!1),[Ut,zt]=h.useState(!1),[as,ws]=h.useState(null),[wt,ct]=h.useState(null),[At,js]=h.useState(null),zs=h.useRef(null),Gs=h.useRef(null),[Cs,Hs]=h.useState(!1),[Gt,Ss]=h.useState(""),[ks,dt]=h.useState(!1),As=h.useRef(null);h.useEffect(()=>{if(!ks)return;const i=x=>{As.current&&(As.current.contains(x.target)||dt(!1))};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[ks]),h.useEffect(()=>{a!=="pairings"&&Fe&&Pe(!1)},[a,Fe]);const Ds=h.useCallback(i=>{const x=(i||"").trim();if(!x)return"";const w=na.some(v=>v.toLowerCase()===x.toLowerCase());return H(v=>{const F=v.some(B=>B.toLowerCase()===x.toLowerCase());return w?F?v.filter(B=>B.toLowerCase()!==x.toLowerCase()):v:F?v:[...v,x]}),g(v=>v.filter(F=>F.toLowerCase()!==x.toLowerCase())),x},[H,g]),Ht=h.useCallback(i=>{const x=(i||"").trim();if(!x)return;const w=x.toLowerCase();H(v=>v.filter(F=>F.toLowerCase()!==w)),g(v=>v.some(F=>F.toLowerCase()===w)?v:[...v,x]),T(v=>v.filter(F=>F.toLowerCase()!==w)),s(v=>v.map(F=>{const B=typeof(F==null?void 0:F.status)=="string"?F.status.trim():"";return!B||B.toLowerCase()!==w?F:{...F,status:""}})),W(v=>{if(!v)return v;const F=(v.status||"").trim();return!F||F.toLowerCase()!==w?v:{...v,status:""}}),Ae(v=>{if(!v)return v;const F=(v.status||"").trim();return!F||F.toLowerCase()!==w?v:{...v,status:""}})},[H,g,T,s,W,Ae]),xn=h.useCallback(i=>{const x=(i||"").trim();x&&T(w=>{const v=new Set(w);return v.has(x)?v.delete(x):v.add(x),Array.from(v)})},[]),C=h.useCallback(()=>{T([])},[]),[O,Q]=h.useState(()=>{const i={feed:"Mouse",size:"pinky",sizeDetail:"",form:"Frozen/thawed",formDetail:"",notes:"",refused:!1},x=Ms(ut.lastFeedDefaults,i)||i;return{...i,...x}});h.useEffect(()=>{Fs(ut.lastFeedDefaults,O)},[O]),h.useEffect(()=>{Fs(ut.breeder,Jt($))},[$]),h.useEffect(()=>{if(typeof document>"u")return;const i=typeof($==null?void 0:$.logoUrl)=="string"?$.logoUrl.trim():"",x=i||Qi;let v=document.querySelector("link[rel='icon']")||document.querySelector("link[rel='shortcut icon']");if(v||(v=document.createElement("link"),v.setAttribute("rel","icon"),document.head.appendChild(v)),v.getAttribute("href")!==x&&v.setAttribute("href",x),i){const F=i.match(/^data:(image\/[^;]+);/i);F&&F[1]?v.setAttribute("type",F[1]):v.removeAttribute("type"),v.removeAttribute("sizes")}else v.setAttribute("type","image/png"),v.setAttribute("sizes","512x512")},[$==null?void 0:$.logoUrl]),h.useEffect(()=>{Fs(ut.backupSettings,P)},[P]),h.useEffect(()=>{if(!X){if(typeof window<"u")try{window.localStorage.removeItem(ut.backupSnapshot)}catch(i){console.warn("Failed to clear backup snapshot",i)}return}Fs(ut.backupSnapshot,X)},[X]),h.useEffect(()=>{Fs(ut.backupVault,q)},[q]),h.useEffect(()=>{const i=Wt(P).maxVaultEntries;typeof i!="number"||i<=0||V(x=>Array.isArray(x)?x.length<=i?x:x.slice(0,i):[])},[P,V]);const ge=h.useCallback(i=>{te(x=>Wt({...x||{},...i||{}}))},[]),Le=h.useCallback(()=>({version:1,generatedAt:new Date().toISOString(),snakes:e,pairings:n,groups:I,breederInfo:Jt($),theme:k,lastFeedDefaults:O}),[e,n,I,$,k,O]),Be=h.useCallback((i,x={})=>{if(!i||typeof i!="object")return null;const w=x.source==="auto"?"auto":"manual",v=typeof x.savedAt=="string"&&x.savedAt?x.savedAt:new Date().toISOString(),F=typeof x.name=="string"&&x.name.trim()?x.name.trim():`${w==="auto"?"Auto":"Manual"} backup • ${We(v)}`,B=za({id:typeof x.id=="string"&&x.id.trim()?x.id.trim():ys(w==="auto"?"auto-backup":"manual-backup"),name:F,createdAt:v,updatedAt:v,source:w,payload:i});if(!B)return null;const{maxVaultEntries:le}=Wt(P);return V(K=>{const se=(Array.isArray(K)?K:[]).filter(De=>De.id!==B.id),xe=[B,...se];return xe.sort((De,Te)=>new Date(Te.createdAt||0).getTime()-new Date(De.createdAt||0).getTime()),typeof le=="number"&&le>0?xe.slice(0,le):xe}),B},[V,P]),Oe=h.useCallback((i,x)=>{const w=typeof x=="string"?x.trim():"";if(!w)return;const v=new Date().toISOString();V(F=>(Array.isArray(F)?F:[]).map(le=>le.id===i?{...le,name:w,updatedAt:v}:le))},[V]),Ge=h.useCallback(i=>{V(x=>Array.isArray(x)?x.filter(w=>w.id!==i):[])},[V]),Ke=h.useCallback(()=>{let i;try{i=Le()}catch(v){console.error("Failed to build backup payload",v);return}let x;try{x=JSON.parse(JSON.stringify(i))}catch(v){console.error("Failed to serialize auto backup payload",v);return}const w=new Date().toISOString();ce({savedAt:w,payload:x}),te(v=>Wt({...v||{},lastRun:w})),Be(x,{source:"auto",savedAt:w,name:`Auto backup • ${We(w)}`})},[Le,Be,te]);h.useEffect(()=>{if(typeof window>"u")return;const i=nc(P.frequency);if(!i)return;let x=!1;const w=()=>{if(x)return;const F=P.lastRun?new Date(P.lastRun).getTime():0;(!F||Number.isNaN(F)||Date.now()-F>=i)&&Ke()};w();const v=window.setInterval(w,5*60*1e3);return()=>{x=!0,window.clearInterval(v)}},[P.frequency,P.lastRun,Ke]);const Ye=h.useCallback(i=>{if(!i||typeof i!="object")throw new Error("Backup file is empty or invalid.");const w=(Array.isArray(i.snakes)?i.snakes:[]).map(ic).filter(Boolean),F=(Array.isArray(i.pairings)?i.pairings:[]).map(cc).filter(Boolean),B=Array.isArray(i.groups)?i.groups.map(xe=>String(xe||"").trim()).filter(Boolean):[],le=Jt(i.breederInfo||i.breeder),K=["blue","green","dark"],de=typeof i.theme=="string"&&K.includes(i.theme)?i.theme:null,se=i.lastFeedDefaults&&typeof i.lastFeedDefaults=="object"?{...i.lastFeedDefaults}:null;s(w),l(F),D(B),j(le),de&&oe(de),se&&Q(se),ce(null),te(xe=>Wt({...xe||{},lastRun:null}))},[s,l,D,j,oe,Q,ce,te]);h.useEffect(()=>{try{const i=window.localStorage.getItem(Xr);i&&(i==="all"||i==="males"||i==="females"||i==="groups")&&p(i)}catch(i){console.warn("Failed to restore pending animal view",i)}},[]),h.useEffect(()=>{try{window.localStorage.setItem(Xr,m)}catch(i){console.warn("Failed to persist animal view",i)}},[m]),h.useEffect(()=>{o!=="completed"&&d!=="All"&&u("All")},[o,d]),h.useEffect(()=>{ue&&W(i=>{if(!i||i.autoId===!1&&String(i.id||"").trim().length>0)return i;const w=Je(i.sex,"F"),v=hs(i.morphHetInput||""),F=Array.isArray(i.morphs)&&i.morphs.length?i.morphs:v.morphs,B=Array.isArray(i.hets)&&i.hets.length?i.hets:v.hets,le=it(i.birthDate),K=Number(i.year),de=Number.isFinite(K)&&K>0?K:new Date().getFullYear(),se=le??de,xe=Mt(i.name,se,e,null,{idConfig:$==null?void 0:$.idGenerator,sex:w,morphs:F,hets:B,birthYear:le}),De=le?String(le):i.year,Te=Qe(xe,$==null?void 0:$.idGenerator);return(i.id||"")===xe&&i.year===De&&i.autoId===!0&&i.idSequence===Te?i:{...i,id:xe,year:De,autoId:!0,idSequence:Te}})},[ue,e,$,R.name,R.sex,R.morphHetInput,R.morphs,R.hets,R.year,R.birthDate,R.autoId,R.idSequence]);const nt=h.useCallback(i=>{!i||i===m||p(i)},[m]),[gn,jt]=h.useState(!1),[$e,Ct]=h.useState({maleId:"",femaleId:"",goals:[],notes:"",startDate:ze(new Date)}),[Bt,Dt]=h.useState(null),Bs=typeof(me==null?void 0:me.status)=="string"?me.status:"",qt=h.useMemo(()=>{const i=new Set(na);G.forEach(F=>{const B=(F||"").trim();B&&i.add(B)}),e.forEach(F=>{const B=typeof(F==null?void 0:F.status)=="string"?F.status.trim():"";B&&i.add(B)});const x=typeof(R==null?void 0:R.status)=="string"?R.status.trim():"";x&&i.add(x);const w=typeof Bs=="string"?Bs.trim():"";w&&i.add(w);const v=new Set(ee.map(F=>F.toLowerCase()));return Array.from(i).filter(F=>!v.has(F.toLowerCase())).sort((F,B)=>F.localeCompare(B))},[G,ee,e,R.status,Bs]);h.useMemo(()=>new Set(G.map(i=>i.toLowerCase())),[G]);const rl=(Bs||"").trim(),lr=h.useCallback(()=>{const i=(Gt||"").trim();if(!i)return;const x=Ds(i);x&&(Ae(w=>w&&{...w,status:x}),Ss(""))},[Gt,Ds]);h.useEffect(()=>{dt(!1)},[qt]);const al=h.useCallback(i=>{Ae(x=>x&&{...x,status:i}),dt(!1)},[Ae,dt]),ll=h.useCallback(()=>{Ae(i=>i&&{...i,status:""}),dt(!1)},[Ae,dt]),ol=h.useCallback(i=>{Ht(i),dt(!1)},[Ht]);h.useEffect(()=>{ye||(Ss(""),dt(!1))},[ye]),h.useEffect(()=>{s(i=>{let x=!1;const w=i.map(v=>{const F=Ot(v==null?void 0:v.sex);return!v||F==="UNKNOWN"||v.sex===F?v:(x=!0,{...v,sex:F})});return x?w:i})},[]),h.useEffect(()=>{At&&(e.some(i=>i.id===At)||js(null))},[At,e]);const ls=h.useCallback(i=>i?(Array.isArray(i.groups)?i.groups:$t(i.groups)).some(w=>typeof w!="string"?!1:w.trim().toLowerCase()==="breeders"):!1,[]),or=h.useMemo(()=>e.filter(sn).filter(ls),[e,ls]),ir=h.useMemo(()=>e.filter(Fn).filter(ls),[e,ls]),cr=h.useMemo(()=>{const i=[],x=[];return n.forEach(w=>{xa(w)?x.push(w):i.push(w)}),{active:i,completed:x}},[n]),qs=cr.active,Vt=cr.completed,dr=qs.length,il=Vt.length,Es=h.useMemo(()=>Vt.map(i=>{const x=Ve({...i}),w=vs(x),v=fn({clutchDate:(w==null?void 0:w.clutchDate)||"",preLayDate:(w==null?void 0:w.preLayDate)||"",ovulationDate:(w==null?void 0:w.ovulationDate)||"",hatchDate:(w==null?void 0:w.hatchDate)||"",startDate:x.startDate||""}),F=v&&typeof v=="string"&&v.trim()?v:"Unknown";return{pairing:i,year:F}}),[Vt]),Is=h.useMemo(()=>{const i=new Set;Es.forEach(({year:w})=>{i.add(w||"Unknown")});const x=Array.from(i);return x.sort((w,v)=>{const F=K=>/^\d{4}$/.test(K)?Number(K):null,B=F(w),le=F(v);return B!==null&&le!==null?le-B:B!==null?-1:le!==null?1:w.localeCompare(v)}),x},[Es]);h.useEffect(()=>{o==="completed"&&d!=="All"&&(Is.includes(d)||u(Is[0]||"All"))},[o,d,Is]);const ur=h.useMemo(()=>o!=="completed"?Vt:d==="All"?Es.map(i=>i.pairing):Es.filter(i=>i.year===d).map(i=>i.pairing),[o,Vt,Es,d]),cl=o==="completed"?ur:qs,dl=ur.length;h.useEffect(()=>{if(Bt){if(qs.some(i=>i.id===Bt)){o!=="active"&&c("active");return}Vt.some(i=>i.id===Bt)&&o!=="completed"&&c("completed")}},[Bt,qs,Vt,o]),h.useEffect(()=>{const i=window.location.hash.match(/#snake=(.+)/);if(i){const x=decodeURIComponent(i[1]),w=e.find(v=>v.id===x);w&&(Xe(w),Ae(tn(w)))}},[e]),h.useEffect(()=>{const i=window.location.hash.match(/#pairing=(.+)/);if(i){const x=decodeURIComponent(i[1]),w=n.find(v=>v.id===x);w&&(r("pairings"),c(xa(w)?"completed":"active"),Dt(w.id))}},[n]),h.useEffect(()=>{if(!tt){st(null);return}const i=`${window.location.origin}${window.location.pathname}#snake=${encodeURIComponent(tt)}`;Pn.toDataURL(i,{width:300}).then(x=>st(x)).catch(()=>st(null))},[tt]);const os=h.useCallback(i=>{let x=Array.isArray(i)?i.slice():[];if(x=sd(x,b,N),Array.isArray(L)&&L.length){const F=new Set(L.map(B=>String(B||"").trim()).filter(Boolean));x=x.filter(B=>F.size===0?!0:F.has(String((B==null?void 0:B.status)||"").trim()))}const w=Array.isArray(E)&&E.length>0,v=Array.isArray(_)&&_.length>0;return w||v?x=x.filter(F=>{const B=Array.isArray(F==null?void 0:F.groups)?F.groups:[],le=w?B.some(de=>E.includes(de)):!0,K=v?B.some(de=>_.includes(de)):!1;return!(w&&!le||v&&K)}):S!=="all"&&(x=x.filter(F=>(F.groups||[]).includes(S))),J||(x=x.filter(F=>Array.isArray(F.groups)&&F.groups.length)),x},[b,N,L,E,_,S,J]),bn=h.useMemo(()=>os(e),[os,e]),mr=h.useMemo(()=>os(e.filter(sn)),[os,e]),hr=h.useMemo(()=>os(e.filter(Fn)),[os,e]),yn=h.useMemo(()=>m==="groups"?[]:m==="all"?bn:m==="females"?mr:m==="males"?hr:bn,[m,bn,mr,hr]),ul=m==="groups"?"Groups":m==="females"?"Females":m==="males"?"Males":"All animals",ml=t.jsxs("div",{className:"flex flex-col items-center gap-2 w-full",children:[t.jsx("span",{className:"text-base font-semibold",children:`${ul} (${yn.length})`}),t.jsx(Ed,{})]}),Nn=Pt(e,$e.femaleId||""),vn=Pt(e,$e.maleId||""),Vs=h.useCallback(i=>ls(i),[ls]),Ys=h.useCallback(i=>{i&&(Ct({maleId:Fn(i)?i.id:"",femaleId:sn(i)?i.id:"",goals:[],notes:"",startDate:ze(new Date)}),jt(!0))},[Ct,jt]),hl=h.useCallback(i=>{if(i){if(!Vs(i)){_e({snake:i});return}Ys(i)}},[Vs,Ys]),pr=h.useCallback(()=>{_e(null)},[]),pl=h.useCallback(()=>{if(!(ke!=null&&ke.snake))return;const i=ke.snake.id;s(w=>w.map(v=>!v||v.id!==i?v:{...v,groups:["Breeders"]})),D(w=>w.includes("Breeders")?w:[...w,"Breeders"]);const x={...ke.snake,groups:["Breeders"]};_e(null),Ys(x)},[ke,s,D,Ys]),fr=h.useCallback(async(i,x,w={})=>{if(!i)return{newEntries:[],combined:null,imageUrl:null};const F=(Array.isArray(x)?x:Array.from(x||[])).filter(xe=>xe&&(typeof xe.type!="string"||xe.type.startsWith("image/")));if(!F.length)return{newEntries:[],combined:null,imageUrl:null};const B=w.source==="camera"?"camera":"upload",K=(await Promise.all(F.map(async xe=>{try{const De=await qa(xe);return Ua({id:ys("photo"),url:De,name:xe.name||"",type:xe.type||"",size:xe.size,addedAt:new Date().toISOString(),source:B})}catch(De){return console.error("Failed to read image file",De),null}}))).filter(Boolean);if(!K.length)return{newEntries:[],combined:null,imageUrl:null};let de=null,se=null;return s(xe=>xe.map(De=>{var ot;if(!De||De.id!==i)return De;const Te=mt(De.photos),Se=Ln([...Te,...K]),pt=((ot=K[K.length-1])==null?void 0:ot.url)||(Se.length?Se[Se.length-1].url:void 0)||De.imageUrl||(Se.length?Se[Se.length-1].url:void 0);return de=Se,se=pt,{...De,photos:Se,imageUrl:pt}})),{newEntries:K,combined:de,imageUrl:se}},[s]),fl=h.useCallback((i,x)=>{!i||!x||s(w=>w.map(v=>{if(!v||v.id!==i)return v;const F=mt(v.photos).filter(le=>le.id!==x);let B=v.imageUrl;return F.some(le=>le.url===B)||(B=F.length?F[F.length-1].url:void 0),{...v,photos:F,imageUrl:B}}))},[s]),xl=h.useCallback((i,x)=>{!i||!x||s(w=>w.map(v=>{if(!v||v.id!==i)return v;const F=mt(v.photos),B=F.find(le=>le.id===x);return B?{...v,photos:F,imageUrl:B.url}:v}))},[s]),xr=h.useCallback(i=>{i&&js(i)},[]),gr=h.useCallback(()=>{js(null)},[]),lt=h.useMemo(()=>At&&e.find(i=>i.id===At)||null,[e,At]),Ws=h.useMemo(()=>lt?mt(lt.photos):[],[lt]),gl=h.useCallback(i=>!Number.isFinite(i)||i<=0?"":i>=1024*1024?`${(i/(1024*1024)).toFixed(1)} MB`:i>=1024?`${(i/1024).toFixed(1)} KB`:`${i} B`,[]),br=h.useMemo(()=>Array.isArray(me==null?void 0:me.photos)?me.photos.length:0,[me==null?void 0:me.photos]),Qs=h.useCallback(async(i,x)=>{if(!(ye!=null&&ye.id))return;const w=Array.isArray(i)?i.filter(Boolean):Array.from(i||[]).filter(Boolean);if(w.length)try{Hs(!0);const v=await fr(ye.id,w,{source:x}),F=Array.isArray(v==null?void 0:v.newEntries)?v.newEntries:[],B=Array.isArray(v==null?void 0:v.combined)?v.combined:null,le=typeof(v==null?void 0:v.imageUrl)=="string"?v.imageUrl:null;if(!F.length)return;Ae(K=>{if(!K)return K;const de=mt(K.photos),se=B||Ln([...de,...F]),xe=le||K.imageUrl||(se.length?se[se.length-1].url:K.imageUrl);return{...K,photos:se,imageUrl:xe}}),Xe(K=>{if(!K)return K;const de=mt(K.photos),se=B||Ln([...de,...F]),xe=le||K.imageUrl||(se.length?se[se.length-1].url:K.imageUrl);return{...K,photos:se,imageUrl:xe}})}catch(v){console.error("Failed to add photos",v),alert("Could not save those pictures. Please try again with smaller images.")}finally{Hs(!1)}},[ye,fr]),bl=h.useCallback(async i=>{var w;const x=(w=i==null?void 0:i.target)==null?void 0:w.files;x&&x.length&&await Qs(x,"camera"),i!=null&&i.target&&(i.target.value="")},[Qs]),yl=h.useCallback(async i=>{var w;const x=(w=i==null?void 0:i.target)==null?void 0:w.files;x&&x.length&&await Qs(x,"upload"),i!=null&&i.target&&(i.target.value="")},[Qs]),Nl=h.useCallback(()=>{const i=zs.current;i&&i.click()},[]),vl=h.useCallback(()=>{const i=Gs.current;i&&i.click()},[]),wl=h.useCallback(()=>{ye!=null&&ye.id&&xr(ye.id)},[ye,xr]);function jl(){Ct({maleId:"",femaleId:"",goals:[],notes:"",startDate:ze(new Date)}),c("active"),jt(!0)}const yr=h.useCallback(i=>{i&&(z(a==="animals"&&m==="groups"),r("animals"),p(sn(i)?"females":"males"),Xe(i),Ae(tn(i)))},[m,a]),Ks=h.useCallback(()=>{Xe(null),Ae(null),Z&&(r("animals"),p("groups"),z(!1))},[Z]),Nr=h.useCallback(i=>{i&&ws(i)},[]),vr=h.useCallback(i=>{i&&(s(x=>{const w=x.filter(v=>v.id!==i);return w.length?w:aa()}),l(x=>x.filter(w=>w.maleId!==i&&w.femaleId!==i)),ye&&ye.id===i&&Ks())},[Ks,ye]),Cl=h.useCallback(()=>{as&&(vr(as.id),ws(null))},[vr,as]),Sl=h.useCallback(()=>{ws(null)},[]);function kl(){var Ze;const i=Je(R.sex,"F"),x=hs(R.morphHetInput||""),w=Array.isArray(R.morphs)?R.morphs.map(Ue=>String(Ue).trim()).filter(Boolean):x.morphs,v=Array.isArray(R.hets)?R.hets.map(Ue=>String(Ue).trim()).filter(Boolean):x.hets,F=e.map(Ue=>Ue.id),B=bs(R.birthDate||null),le=it(B),K=Number(R.year),de=Number.isFinite(K)&&K>0?K:new Date().getFullYear(),se=le??de;let xe=(R.id||"").toString().trim();if(R.autoId===!1&&xe.length>0){if(F.includes(xe)){let Ue=2,rt=`${xe}-${Ue}`;for(;F.includes(rt);)Ue+=1,rt=`${xe}-${Ue}`;xe=rt}}else xe=Mt(R.name,se,e,null,{idConfig:$==null?void 0:$.idGenerator,sex:i,morphs:w,hets:v,birthYear:le});let Te=Number(R.idSequence);(!Number.isFinite(Te)||Te<=0)&&(Te=Qe(xe,$==null?void 0:$.idGenerator)||null);const Se=$t(R.groups),qe=mt(R.photos),pt=((Ze=R.imageUrl)==null?void 0:Ze.trim())||(qe.length?qe[qe.length-1].url:void 0),ot=(R.status||"").trim()||"Active",Me={id:xe,name:R.name.trim()||(i==="F"?"New Female":"New Male"),sex:i,morphs:w,hets:v,weight:Number(R.weight)||0,year:se,birthDate:B||null,tags:[],groups:Se,status:ot,imageUrl:pt,photos:qe,logs:ss(R.logs),idSequence:Number.isFinite(Te)&&Te>0?Te:null,isDemo:!1};s(Ue=>[...Ue.filter(Et=>!Et.isDemo),Me]),D(Ue=>Array.from(new Set([...Ue||[],...Me.groups]))),M(!1),W(Mn())}function Al(){const i=Ya(ie);Ce(i)}function Dl(){const i=new Set(e.map(K=>`${(K.name||"").trim().toLowerCase()}|${Je(K.sex,"F")}`)),x=e.map(K=>K.id),w=e.map(K=>({id:K.id,idSequence:K.idSequence})),v=new Map((I||[]).map(K=>[String(K).trim().toLowerCase(),K])),F=K=>{const de=String(K||"").trim();if(!de)return null;const se=de.toLowerCase();return v.has(se)?v.get(se):(v.set(se,de),de)},B=[];for(const K of be){const de=jc({...K,__existingIds:x,__existingRecords:w},$==null?void 0:$.idGenerator),se=Je(de.sex,"F"),De=`${(de.name||"").trim().toLowerCase()}|${se}`;if(i.has(De))continue;i.add(De),x.push(de.id),w.push({id:de.id,idSequence:de.idSequence});const Te=$t((de.groups||[]).map(F).filter(Boolean));B.push({...de,sex:se,groups:Te,isDemo:!1})}if(!B.length){he(""),Ce([]),r("animals"),p("all");return}s(K=>[...K.filter(se=>!se.isDemo),...B]);const le=Array.from(new Set(B.flatMap(K=>K.groups||[])));le.length&&D(K=>Array.from(new Set([...K||[],...le]))),he(""),Ce([]),r("animals"),p("all"),Ne(!1)}const El=(i,x,w,v)=>{const F=String(i||"Unknown Year").trim()||"Unknown Year",B=String(x).trim()||"Male",le=String(w).trim()||"Female",K=`${F} ${B} X ${le}`.replace(/\s+/g," ").trim();if(!v.has(K))return K;let de=2,se=`${K} (${de})`;for(;v.has(se);)de+=1,se=`${K} (${de})`;return se};function Il(){const i=$e.femaleId||"",x=$e.maleId||"";if(!i||!x)return;const w=Pt(e,i),v=Pt(e,x),F=(w==null?void 0:w.name)||"Female",B=(v==null?void 0:v.name)||"Male",le=`${F} × ${B}`,K=it($e.startDate)||new Date().getFullYear(),de={femaleId:i,maleId:x,label:le,startDate:$e.startDate,lockObserved:!1,goals:$e.goals||[],notes:$e.notes||"",appointments:Ba($e.startDate,5)};de.appointments&&de.appointments.length&&(de.startDate=de.appointments[0].date);let se="";l(xe=>{const De=new Set(xe.map(qe=>qe==null?void 0:qe.id).filter(Boolean)),Te=El(K,B,F,De);se=Te;const Se={...de,id:Te};return[...xe,Ve(Se)]}),jt(!1),r("pairings"),Dt(se)}const wr=h.useCallback(i=>{if(!i||!i.pairing||!i.count||i.count<=0)return;const x=Ve({...i.pairing}),w=i.hatchedDate||ze(new Date),v=Rt(w)||new Date,F=Number.isFinite(v.getFullYear())?v.getFullYear():new Date().getFullYear(),B=Pt(e,x==null?void 0:x.maleId),le=Pt(e,x==null?void 0:x.femaleId),K=`${(le==null?void 0:le.name)||"Dam"} × ${(B==null?void 0:B.name)||"Sire"}`,de=e.map(Se=>({id:Se.id,idSequence:Se.idSequence})),se=new Set(de.map(Se=>Se.id)),xe=de.map(Se=>({...Se})),De=$!=null&&$.idGenerator?{...$.idGenerator}:null,Te=Array.from({length:i.count},(Se,qe)=>{const ot=`Hatchling ${i.existingCount+qe+1} (${K})`,Me=Mt(ot,F,xe,null,{idConfig:De,sex:"F",morphs:[],hets:[],birthYear:F});se.add(Me);const Ze=Qe(Me,De);return xe.push({id:Me,idSequence:Ze}),{id:Me,autoId:!0,name:ot,sex:"F",morph:"",weight:"",birthDate:w,idSequence:Ze}});ct({pairingId:x.id,pairing:x,entries:Te,currentIndex:0,hatchedDate:w,total:i.count,existingCount:i.existingCount,previousHatch:i.previousHatch||x.hatch,context:{pairingName:K,sireName:(B==null?void 0:B.name)||"",damName:(le==null?void 0:le.name)||"",groupName:`Hatchlings ${F}`,year:F,idConfig:De,existingIdsBase:de.map(Se=>Se.id),existingRecordsBase:de}})},[e,$]),is=h.useCallback((i,x,w)=>{if(!i)return i;const v=Array.isArray(i.entries)?i.entries:[];if(!v[x])return i;const F=i.context||{},B=Array.isArray(F.existingIdsBase)?F.existingIdsBase.map(Me=>String(Me||"").trim()).filter(Boolean):[],le=new Set(B),se=(Array.isArray(F.existingRecordsBase)?F.existingRecordsBase:[]).map(Me=>{if(!Me)return null;if(typeof Me=="string"){const Et=Me;return{id:Et,idSequence:Qe(Et,F.idConfig)}}const Ze=Me.id!=null?String(Me.id):"";if(!Ze)return null;const Ue=Number(Me.idSequence),rt=Number.isFinite(Ue)&&Ue>0?Math.floor(Ue):Qe(Ze,F.idConfig);return{id:Ze,idSequence:rt}}).filter(Boolean).map(Me=>({...Me}));v.forEach((Me,Ze)=>{if(Ze===x)return;const Ue=String((Me==null?void 0:Me.id)||"").trim();if(Ue){le.add(Ue);const rt=Number(Me==null?void 0:Me.idSequence),Et=Number.isFinite(rt)&&rt>0?Math.floor(rt):Qe(Ue,F.idConfig);se.push({id:Ue,idSequence:Et})}});const xe=v[x].name||F.pairingName||`Hatchling ${x+1}`,De=Je(w??v[x].sex,"F"),Te=it(v[x].birthDate),Se=Te??F.year??new Date().getFullYear(),qe=Mt(xe,Se,se,null,{idConfig:F.idConfig,sex:De,morphs:[],hets:[],birthYear:Te??Se});if(!qe)return i;const pt=Qe(qe,F.idConfig),ot=v.map((Me,Ze)=>Ze===x?{...Me,id:qe,autoId:!0,idSequence:pt}:Me);return{...i,entries:ot}},[]),cs=h.useCallback((i,x)=>{ct(w=>{if(!w)return w;const v=Array.isArray(w.entries)?w.entries:[];if(i<0||i>=v.length)return w;const F=v.map((B,le)=>{if(le!==i)return B;const K={...B,...x};return!Object.prototype.hasOwnProperty.call(x,"autoId")&&Object.prototype.hasOwnProperty.call(x,"id")&&(K.autoId=!1),K});return{...w,entries:F}})},[]),Ll=h.useCallback((i,x)=>{cs(i,{id:x})},[cs]),Ml=h.useCallback((i,x)=>{cs(i,{morph:x})},[cs]),Fl=h.useCallback((i,x)=>{cs(i,{weight:x})},[cs]),Tl=h.useCallback((i,x)=>{ct(w=>{var K;if(!w)return w;const v=Array.isArray(w.entries)?w.entries:[];if(i<0||i>=v.length)return w;const F=x?bs(x)||x:"",B=v.map((de,se)=>se===i?{...de,birthDate:F}:de);let le={...w,entries:B};return(K=v[i])!=null&&K.autoId&&(le=is(le,i,B[i].sex)),le})},[is]),Pl=h.useCallback((i,x)=>{const w=Je(x,"F");ct(v=>{var de;if(!v)return v;const F=Array.isArray(v.entries)?v.entries:[];if(i<0||i>=F.length)return v;const B=!!((de=F[i])!=null&&de.autoId),le=F.map((se,xe)=>xe===i?{...se,sex:w}:se);let K={...v,entries:le};return B&&(K=is(K,i,w)),K})},[is]),$l=h.useCallback(i=>{ct(x=>{var w,v;return is(x,i,(v=(w=x==null?void 0:x.entries)==null?void 0:w[i])==null?void 0:v.sex)})},[is]),Rl=h.useCallback(()=>{ct(i=>{if(!i)return i;const x=Array.isArray(i.entries)?i.entries.length:0,w=Math.min(x-1,(i.currentIndex||0)+1);return w===i.currentIndex?i:{...i,currentIndex:w}})},[]),_l=h.useCallback(()=>{ct(i=>{if(!i)return i;const x=Math.max(0,(i.currentIndex||0)-1);return x===i.currentIndex?i:{...i,currentIndex:x}})},[]),wn=h.useCallback(()=>{ct(null)},[]),Ol=h.useCallback(()=>{ct(i=>{if(!i)return i;const x=Array.isArray(i.entries)?i.entries:[];if(!x.length)return null;const w=i.context||{},v=i.pairing||null,F=i.hatchedDate||ze(new Date),B=w.groupName||null,le=new Set(e.map(se=>se.id)),K=e.map(se=>({id:se.id,idSequence:se.idSequence})),de=[];return x.forEach((se,xe)=>{const De=se.name||w.pairingName||`Hatchling ${xe+1}`,Te=Je(se.sex,"F");let Se=String(se.id||"").trim();const qe=se.birthDate||F,pt=qe?bs(qe)||qe:"",ot=it(pt||qe),Me=ot??w.year??new Date().getFullYear();if(Se||(Se=Mt(De,Me,K,null,{idConfig:w.idConfig,sex:Te,morphs:[],hets:[],birthYear:ot??Me})),!Se)return;if(le.has(Se)){let Cn=2,Sn=`${Se}-${Cn}`;for(;le.has(Sn);)Cn+=1,Sn=`${Se}-${Cn}`;Se=Sn}le.add(Se);const Ze=Qe(Se,$==null?void 0:$.idGenerator);K.push({id:Se,idSequence:Ze});const Ue=pt||qe,rt=Rt(Ue),Et=rt&&Number.isFinite(rt.getFullYear())?rt.getFullYear():Me,{morphs:Bl,hets:ql}=hs(se.morph||""),jn=Number(se.weight),Vl=Number.isFinite(jn)&&jn>=0?jn:0;de.push({id:Se,name:De,sex:Te,morphs:Bl,hets:ql,weight:Vl,year:Et,birthDate:Ue,pairingId:(v==null?void 0:v.id)||i.pairingId||null,sireId:(v==null?void 0:v.maleId)||null,damId:(v==null?void 0:v.femaleId)||null,tags:["hatchling"],groups:B?$t(B):[],status:"Active",imageUrl:void 0,logs:ss(),idSequence:Ze,isDemo:!1})}),de.length&&(s(se=>[...se.filter(De=>!De.isDemo),...de]),B&&D(se=>se.includes(B)?se:[...se,B]),typeof window<"u"&&typeof window.alert=="function"&&window.alert(`${de.length} hatchlings added${B?` to ${B}`:""}.`)),null})},[e,s,D,$]),Ul=h.useCallback(()=>{Ae(i=>{var se;if(!i||String(i.id||"").trim())return i;const w=e.filter(xe=>xe&&xe.id!==(ye==null?void 0:ye.id)).map(xe=>({id:xe.id,idSequence:xe.idSequence})),v=Number(i.year)||(i.birthDate?((se=Rt(i.birthDate))==null?void 0:se.getFullYear())||new Date().getFullYear():new Date().getFullYear()),F=i.birthDate?it(i.birthDate):null,B=Number(i.idSequence),le=Number.isFinite(B)&&B>0?Math.floor(B):null,K=Mt(i.name,v,w,null,{idConfig:$==null?void 0:$.idGenerator,sex:i.sex||"U",morphs:i.morphs||[],hets:i.hets||[],birthYear:F??v,forceSequence:le});if(!K)return i;const de=Qe(K,$==null?void 0:$.idGenerator);return{...i,id:K,idSequence:de??le??i.idSequence??null,autoId:!0}})},[e,ye,$]),zl=h.useCallback(()=>{Ae(i=>{var de;if(!i)return i;const x=e.filter(se=>se&&se.id!==(ye==null?void 0:ye.id)).map(se=>({id:se.id,idSequence:se.idSequence})),w=Number(i.year)||(i.birthDate?((de=Rt(i.birthDate))==null?void 0:de.getFullYear())||new Date().getFullYear():new Date().getFullYear()),v=i.birthDate?it(i.birthDate):null,F=Number(i.idSequence),B=Number.isFinite(F)&&F>0?Math.floor(F):null,le=Mt(i.name,w,x,null,{idConfig:$==null?void 0:$.idGenerator,sex:i.sex||"U",morphs:i.morphs||[],hets:i.hets||[],birthYear:v??w,forceSequence:B});if(!le)return i;const K=Qe(le,$==null?void 0:$.idGenerator);return{...i,id:le,idSequence:K??B??i.idSequence??null,autoId:!0}})},[e,ye,$]),Gl=h.useCallback((i,x)=>{let w=null;l(v=>v.map(F=>{var De,Te,Se;if(F.id!==i)return F;const B=Ve({...F}),le=typeof x=="function"?x(B):x,K=Ve({...B,...le||{}});K.id=F.id;const de=(De=B==null?void 0:B.hatch)!=null&&De.recorded?Number(B.hatch.hatchedCount||0):0,se=(Te=K==null?void 0:K.hatch)!=null&&Te.recorded?Number(K.hatch.hatchedCount||0):0,xe=(Se=K==null?void 0:K.hatch)!=null&&Se.recorded?Math.max(0,se-de):0;return xe>0&&(w={pairing:{...B,...K},count:xe,hatchedDate:K.hatch.date,existingCount:de,previousHatch:{...B.hatch}}),K})),w&&wr(w)},[l,wr]),Hl=k==="green"?{"--primary":"#059669","--primary-border":"#059669","--primary-contrast":"#fff"}:k==="dark"?{"--primary":"#374151","--primary-border":"#374151","--primary-contrast":"#fff"}:{"--primary":"#0ea5e9","--primary-border":"#0ea5e9","--primary-contrast":"#fff"};return t.jsxs("div",{className:"app-root w-full min-h-screen bg-neutral-50 text-neutral-900",style:Hl,children:[t.jsx("div",{className:"px-5 py-4 border-b bg-white sticky top-0 z-10",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[$.logoUrl?t.jsx("img",{src:$.logoUrl,alt:"logo",className:"w-10 h-10 rounded-full object-cover border"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-neutral-50 flex items-center justify-center text-xs text-neutral-400 border",children:"Logo"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-semibold tracking-tight",children:"Breeding Planner"}),t.jsx("div",{className:"text-xs text-neutral-600",children:$.businessName?`${$.businessName} • ${$.name}`:""})]})]})}),t.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[t.jsx(et,{theme:k,active:a==="animals",onClick:()=>r("animals"),children:"Animals"}),t.jsx(et,{theme:k,active:a==="pairings",onClick:()=>r("pairings"),children:"Breeding Planner"}),t.jsx(et,{theme:k,active:a==="calendar",onClick:()=>r("calendar"),children:"Calendar"}),t.jsx(et,{theme:k,active:a==="setup",onClick:()=>r("setup"),children:"Setup"}),t.jsx("div",{className:"ml-2",children:t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-sm bg-white",value:k,onChange:i=>oe(i.target.value),children:[t.jsx("option",{value:"blue",children:"Blue"}),t.jsx("option",{value:"green",children:"Green"}),t.jsx("option",{value:"dark",children:"Dark"})]})}),t.jsx("div",{className:"ml-auto flex items-center gap-2",children:t.jsx("input",{value:b,onChange:i=>f(i.target.value),placeholder:"Search name, morph, het, tag",className:"px-3 py-2 border rounded-xl text-sm w-64 focus:outline-none focus:ring-2 focus:ring-black/10"})})]})]})}),t.jsxs("div",{className:"max-w-7xl mx-auto p-5",children:[a==="animals"&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(et,{theme:k,active:m==="all",onClick:()=>nt("all"),children:"All"}),t.jsx(et,{theme:k,active:m==="males",onClick:()=>nt("males"),children:"Males"}),t.jsx(et,{theme:k,active:m==="females",onClick:()=>nt("females"),children:"Females"}),t.jsx(et,{theme:k,active:m==="groups",onClick:()=>nt("groups"),children:"Groups"})]}),t.jsxs("div",{className:"ml-auto flex flex-wrap items-center gap-2",children:[t.jsx("button",{onClick:()=>vt(!0),className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),children:"Export QR"}),t.jsx("button",{onClick:()=>zt(!0),className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),children:"Scan QR"}),t.jsx("button",{onClick:()=>{W(Mn()),M(!0)},className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),children:"+ Add animal"}),t.jsx("button",{onClick:()=>Ne(!0),className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),children:"Import animals"})]})]}),m==="groups"?t.jsx(Nd,{groups:I,setGroups:D,snakes:e,theme:k,onOpenSnake:yr,onDeleteGroup:i=>{if(e.some(w=>(w.groups||[]).includes(i)))return alert("Group in use by some snakes. Remove from those snakes first.");D(w=>w.filter(v=>v!==i)),S===i&&A("all")}}):t.jsxs(Us,{title:ml,children:[t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500",children:"Tags"}),qt.length>0&&t.jsx("span",{className:"text-[11px] text-neutral-500",children:L.length?`${L.length} selected`:"Showing all"}),L.length>0&&t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 border rounded-lg bg-white hover:bg-neutral-50",onClick:C,children:"Clear"})]}),t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:qt.length?qt.map(i=>{const x=L.includes(i);return t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("label",{className:ne("inline-flex items-center gap-1 px-2 py-1 border rounded-lg text-[12px] bg-white transition-colors",x?"border-sky-500 text-sky-700 bg-sky-50":"border-neutral-200 text-neutral-700 hover:border-sky-400"),children:[t.jsx("input",{type:"checkbox",className:"w-3 h-3",checked:x,onChange:()=>xn(i)}),t.jsx("span",{children:i})]}),t.jsx("button",{type:"button",className:"h-5 w-5 inline-flex items-center justify-center rounded-full border border-neutral-200 text-[11px] leading-none text-neutral-500 hover:border-rose-400 hover:text-rose-500",title:"Delete tag",onClick:()=>Ht(i),children:"×"})]},i)}):t.jsx("div",{className:"text-xs text-neutral-500",children:"No tags yet. Add one from an animal card."})})]}),t.jsx(Gc,{groups:I,showGroups:E,setShowGroups:y,hiddenGroups:_,setHiddenGroups:U,showUnassigned:J,setShowUnassigned:fe}),t.jsxs("div",{className:"grid sm:grid-cols-2 xl:grid-cols-3 gap-3",children:[yn.map(i=>t.jsx(Jc,{s:i,groups:I,setSnakes:s,setQrFor:St,onEdit:x=>{Xe(x),Ae(tn(x))},onQuickPair:x=>hl(x),onDelete:Nr,pairings:n,onOpenPairing:x=>{const w=n.find(v=>v.id===x);w&&(r("pairings"),Dt(w.id))},lastFeedDefaults:O,setLastFeedDefaults:Q},i.id)),!yn.length&&t.jsx("div",{className:"col-span-full text-sm text-neutral-500",children:"No animals match your filters."})]})]})]}),a==="pairings"&&t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs(et,{theme:k,active:o==="active",onClick:()=>{c("active"),Dt(null),u("All")},children:["Active projects (",dr,")"]}),t.jsxs(et,{theme:k,active:o==="completed",onClick:()=>{c("completed"),Dt(null),u("All")},children:["Completed projects (",il,")"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>Pe(i=>!i),className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!Fe)),"aria-pressed":Fe,children:Fe?"Hide advisor":"Breeding advisor"}),t.jsx("button",{type:"button",onClick:jl,className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),children:"New pairing"})]})]}),o==="completed"&&Is.length>0&&t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(et,{theme:k,active:d==="All",onClick:()=>u("All"),children:"All years"}),Is.map(i=>t.jsx(et,{theme:k,active:d===i,onClick:()=>u(i),children:i},i))]}),Fe&&t.jsx("div",{className:"flex flex-col gap-4",children:t.jsx(Vi,{males:ir,females:or})}),t.jsx(rd,{snakes:e,pairings:cl,onDelete:i=>{l(x=>x.filter(w=>w.id!==i)),Dt(x=>x===i?null:x)},onOpenSnake:yr,onUpdatePairing:Gl,focusedPairingId:Bt,onFocusPairing:Dt,theme:k,title:o==="completed"?`Completed projects (${dl}${d!=="All"?` • ${d}`:""})`:`Breeding Planner (${dr})`,emptyMessage:o==="completed"?d==="All"?"No completed projects yet. Hatchlings will land here once the cycle is marked finished.":`No completed projects recorded for ${d}.`:"No active pairings yet. Use “New pairing”.",variant:"collapsed"})]}),a==="calendar"&&t.jsx(wd,{snakes:e,pairings:n,theme:k,onOpenPairing:i=>{const x=n.find(w=>w.id===i);x&&(r("pairings"),Dt(x.id))}}),a==="setup"&&t.jsx(nd,{breederInfo:$,setBreederInfo:j,theme:k,onSaved:()=>r("animals"),createBackupPayload:Le,onRestoreBackup:Ye,backupSettings:P,updateBackupSettings:ge,autoBackupSnapshot:X,onTriggerAutoBackup:Ke,backupVault:q,onCreateVaultEntry:Be,onRenameVaultEntry:Oe,onDeleteVaultEntry:Ge,snakes:e,pairings:n,animalExportFields:re,setAnimalExportFields:ae,pairingExportFields:pe,setPairingExportFields:we,exportFeedback:Ie,setExportFeedback:Y})]}),lt&&t.jsx("div",{className:ne("fixed inset-0 flex items-center justify-center p-4 z-[80]",Ft(k)),onClick:gr,children:t.jsxs("div",{className:"relative w-full max-w-4xl bg-white text-neutral-900 rounded-2xl shadow-xl border border-neutral-200 max-h-[90vh] overflow-hidden",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"flex items-start justify-between gap-4 px-5 pt-5",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-base font-semibold",children:lt.name||"Unnamed snake"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:lt.id}),t.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:[Ws.length," photo",Ws.length===1?"":"s"," stored"]})]}),t.jsx("button",{className:"text-sm px-3 py-1.5 border rounded-lg",onClick:gr,children:"Close"})]}),t.jsx("div",{className:"px-5 pb-5 overflow-y-auto max-h-[70vh] mt-4",children:Ws.length?t.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:Ws.map(i=>{const x=!!(lt.imageUrl&&i.url===lt.imageUrl),w=We(i.addedAt)||"",v=typeof i.size=="number"?gl(i.size):"",F=i.name||`${lt.name||lt.id||"snake"}-${i.id}`;return t.jsxs("div",{className:"border border-neutral-200 rounded-xl overflow-hidden bg-neutral-50 flex flex-col",children:[t.jsxs("div",{className:"relative bg-black/5",children:[t.jsx("img",{src:i.url,alt:i.name||`${lt.name||"Snake"} photo`,className:"w-full h-full object-cover",loading:"lazy"}),x&&t.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-0.5 rounded-full bg-emerald-500 text-white shadow",children:"Cover"})]}),t.jsxs("div",{className:"p-3 flex-1 flex flex-col gap-2 text-sm",children:[t.jsx("div",{className:"flex items-start justify-between gap-2",children:t.jsx("div",{className:"font-medium truncate",title:i.name||F,children:i.name||"Untitled photo"})}),t.jsxs("div",{className:"text-xs text-neutral-500",children:[i.source==="camera"?"Captured on device":"Uploaded file",v?` • ${v}`:""]}),w&&t.jsxs("div",{className:"text-xs text-neutral-500",children:["Added ",w]}),t.jsxs("div",{className:"mt-auto flex flex-wrap items-center gap-2 pt-2",children:[t.jsx("a",{href:i.url,download:F,target:"_blank",rel:"noopener noreferrer",className:"text-xs px-2 py-1 border rounded-lg hover:bg-neutral-100",children:"Open"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg hover:bg-neutral-100 disabled:opacity-60",onClick:()=>xl(lt.id,i.id),disabled:x,children:x?"Current cover":"Set as cover"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 hover:bg-rose-50",onClick:()=>{window.confirm("Remove this photo?")&&fl(lt.id,i.id)},children:"Remove"})]})]})]},i.id)})}):t.jsx("div",{className:"text-sm text-neutral-500",children:"No photos saved for this snake yet. Use the card buttons to add some."})})]})}),ue&&t.jsx("div",{className:ne("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Ft(k)),onClick:()=>M(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh]",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:"Add animal"}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:()=>M(!1),children:"Close"})]}),t.jsx(Rc,{newAnimal:R,setNewAnimal:W,groups:I,setGroups:D,statusOptions:qt,customStatusTags:G,onCreateStatusTag:Ds,onDeleteStatusTag:Ht,onCancel:()=>M(!1),onAdd:kl,theme:k})]})}),ke&&t.jsx("div",{className:ne("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Ft(k)),onClick:pr,children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-xl border p-6 space-y-4",onClick:i=>i.stopPropagation(),children:[t.jsx("div",{className:"text-lg font-semibold text-center",children:"Breeders only"}),t.jsx("p",{className:"text-sm text-neutral-600 text-center",children:"Only snakes in the Breeders group can be paired."}),t.jsxs("p",{className:"text-xs text-neutral-500 text-center",children:["Add"," ",t.jsx("span",{className:"font-semibold text-neutral-700",children:((jr=ke==null?void 0:ke.snake)==null?void 0:jr.name)||((Cr=ke==null?void 0:ke.snake)==null?void 0:Cr.id)||"this snake"})," ","to Breeders and continue?"]}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:pr,children:"Cancel"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm text-white",Ee(k,!0)),onClick:pl,children:"Add to Breeders & pair"})]})]})}),wt&&(()=>{var K,de;const i=Array.isArray(wt.entries)?wt.entries.length:0,x=i?Math.min(i-1,Math.max(0,wt.currentIndex||0)):0,w=i?wt.entries[x]:null,v=((K=wt.context)==null?void 0:K.pairingName)||"Hatchling",F=((de=wt.context)==null?void 0:de.groupName)||"",B=x===i-1,le=w&&String(w.id||"").trim().length>0;return t.jsx("div",{className:ne("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Ft(k)),onClick:wn,children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh] flex flex-col",onClick:se=>se.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:"Log hatchlings"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-0.5",children:i>0?`Hatchling ${x+1} of ${i}`:"No hatchlings to record"})]}),t.jsx("button",{type:"button",className:"text-sm px-2 py-1",onClick:wn,children:"Close"})]}),t.jsx("div",{className:"p-4 overflow-auto flex-1",children:w?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-sm text-neutral-600",children:["Pairing: ",t.jsx("span",{className:"font-medium text-neutral-800",children:v})]}),F&&t.jsxs("div",{className:"text-xs text-neutral-500",children:["New hatchlings will be placed in ",t.jsx("span",{className:"font-medium text-neutral-700",children:F}),"."]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Hatchling ID"}),t.jsxs("div",{className:"mt-1 flex gap-2",children:[t.jsx("input",{className:"flex-1 border rounded-xl px-3 py-2 text-sm",value:w.id||"",onChange:se=>Ll(x,se.target.value)}),t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-xl text-sm border",w.autoId?"text-neutral-600":"text-neutral-700"),onClick:()=>$l(x),children:"Regenerate"})]}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:w.autoId?"Generated automatically based on pairing.":"ID locked—edit to override or regenerate."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm bg-white",value:w.sex||"F",onChange:se=>Pl(x,se.target.value),children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"}),t.jsx("option",{value:"U",children:"Unknown"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Weight (g)"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm",value:w.weight,onChange:se=>Fl(x,se.target.value),placeholder:"e.g., 75"})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Morph / het notes"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm",value:w.morph||"",onChange:se=>Ml(x,se.target.value),placeholder:"e.g., Pastel Clown 66% Het Hypo"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2 text-sm",value:w.birthDate||"",onChange:se=>Tl(x,se.target.value)})]})]})]}):t.jsx("div",{className:"text-sm text-neutral-500",children:"No hatchlings to record."})}),t.jsxs("div",{className:"p-4 border-t flex items-center justify-between gap-3",children:[t.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl text-sm border",onClick:wn,children:"Cancel"}),t.jsxs("div",{className:"flex items-center gap-2",children:[x>0&&t.jsx("button",{type:"button",className:"px-3 py-2 rounded-xl text-sm border",onClick:_l,children:"Previous"}),!B&&t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-xl text-sm text-white",le?Ee(k,!0):Ee(k,!1)),onClick:Rl,disabled:!le,children:"Next"}),B&&t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-xl text-sm text-white",le?Ee(k,!0):Ee(k,!1)),onClick:Ol,disabled:!le,children:"Save hatchlings"})]})]})]})})})(),je&&t.jsx("div",{className:ne("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Ft(k)),onClick:()=>Ne(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-5xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh]",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:"Import animals"}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:()=>Ne(!1),children:"Close"})]}),t.jsx("div",{className:"p-4 overflow-auto max-h-[80vh]",children:t.jsx(bd,{importText:ie,setImportText:he,importPreview:be,setImportPreview:Ce,runImportPreview:Al,applyImport:Dl,theme:k,onCancel:()=>Ne(!1)})})]})}),gn&&t.jsx("div",{className:ne("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Ft(k)),onClick:()=>jt(!1),children:t.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-2xl shadow-xl border overflow-hidden max-h-[92vh]",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:"Create pairing"}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:()=>jt(!1),children:"Close"})]}),t.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-[70vh] overflow-auto",children:[(()=>{const i=ir.filter(Vs),x=or.filter(Vs),w=!i.length||!x.length;return t.jsxs(t.Fragment,{children:[w&&t.jsx("div",{className:"sm:col-span-2 text-xs text-amber-600 bg-amber-50 border border-amber-200 rounded-lg p-2",children:"Add at least one male and one female to the Breeders group to enable pairing."}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Male"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",value:$e.maleId||"",onChange:v=>Ct(F=>({...F,maleId:v.target.value})),children:[t.jsx("option",{value:"",children:"Select male"}),i.map(v=>{const B=at(v.morphs,v.hets,v.possibleHets).join(" ");return t.jsxs("option",{value:v.id,children:[v.name,B?` • ${B}`:""]},v.id)})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Female"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",value:$e.femaleId||"",onChange:v=>Ct(F=>({...F,femaleId:v.target.value})),children:[t.jsx("option",{value:"",children:"Select female"}),x.map(v=>{const B=at(v.morphs,v.hets,v.possibleHets).join(" ");return t.jsxs("option",{value:v.id,children:[v.name,B?` • ${B}`:""]},v.id)})]})]})]})})(),$e.maleId&&$e.femaleId&&t.jsxs("div",{className:"sm:col-span-2 text-xs text-neutral-500",children:["Pairing label will be saved as ",(Nn==null?void 0:Nn.name)||$e.femaleId," × ",(vn==null?void 0:vn.name)||$e.maleId,"."]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Starting date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:$e.startDate||"",onChange:i=>Ct(x=>({...x,startDate:i.target.value}))})]}),t.jsxs("div",{className:"sm:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{className:"mt-1 w-full border rounded-xl px-3 py-2",rows:3,value:$e.notes||"",onChange:i=>Ct(x=>({...x,notes:i.target.value})),placeholder:"Ultrasound size, rotation plan, etc."})]})]}),t.jsxs("div",{className:"p-5 border-t flex items-center justify-between",children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Appointments generate monthly from the start date. Calendar staggers same-male appointments by 3 days."}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:()=>jt(!1),children:"Cancel"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm text-white",$e.femaleId&&$e.maleId?Ee(k,!0):Ee(k,!1)),disabled:!$e.femaleId||!$e.maleId,onClick:()=>{if(!$e.maleId||!$e.femaleId){alert("Choose a breeder male and female first.");return}Il()},children:"Add pairing"})]})]})]})}),ye&&me&&t.jsx("div",{className:ne("fixed inset-0 backdrop-blur-sm flex items-center justify-center p-4 z-50",Ft(k)),children:t.jsxs("div",{className:"bg-white w-full max-w-3xl rounded-2xl shadow-xl border max-h-[92vh] flex flex-col",onClick:i=>i.stopPropagation(),children:[t.jsxs("div",{className:"p-5 border-b flex items-center justify-between",children:[t.jsx("div",{className:"font-semibold",children:ye.name}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border border-rose-200 text-rose-600",onClick:()=>Nr(ye),children:"Delete"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),onClick:async()=>{try{await Kc(me,$,k,n)}catch(i){console.error(i),alert("Export failed")}},children:"Export PDF"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),onClick:()=>{const i=ye.id,x=me.id||i,w=Je(me.sex,Je(ye.sex,"F")),v=(me.status||"").trim()||"Active",F=$t(me.groups);s(B=>B.map(le=>le.id===i?{...me,id:x,sex:w,status:v,groups:F}:le)),l(B=>B.map(le=>({...le,maleId:le.maleId===i?x:le.maleId,femaleId:le.femaleId===i?x:le.femaleId}))),Ks()},children:"Save changes"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm",Ee(k,!0)),onClick:Ks,children:"Cancel"})]})]}),t.jsxs("div",{className:"p-5 grid grid-cols-1 md:grid-cols-3 gap-4 overflow-auto min-h-0 flex-1",children:[t.jsxs("div",{className:"md:col-span-1 space-y-1",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Name"}),t.jsx("input",{className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm",value:me.name,onChange:i=>Ae(x=>({...x,name:i.target.value}))})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"ID"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 border rounded-lg text-neutral-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:Ul,disabled:!!(me.id||"").trim(),children:"Generate ID"}),t.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 border rounded-lg text-neutral-700",onClick:zl,children:"Update ID"})]})]}),t.jsx("input",{className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm font-mono",value:me.id,onChange:i=>Ae(x=>({...x,id:i.target.value}))}),!(me.id||"").trim()&&t.jsx("div",{className:"mt-0.5 text-[11px] text-neutral-500",children:"Will use your breeder wizard settings the first time you generate."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm bg-white",value:me.sex,onChange:i=>Ae(x=>({...x,sex:i.target.value})),children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"})]})]}),t.jsxs("div",{ref:As,className:"relative",children:[t.jsx("label",{className:"text-xs font-medium",children:"Tag"}),t.jsxs("button",{type:"button",className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm bg-white text-left flex items-center justify-between",onClick:()=>dt(i=>!i),children:[t.jsx("span",{children:rl||"No tag"}),t.jsx("span",{className:"text-[10px] text-neutral-500",children:"v"})]}),ks&&t.jsxs("div",{className:"absolute z-40 mt-1 w-full rounded-xl border border-neutral-200 bg-white shadow-lg",children:[t.jsx("button",{type:"button",className:"w-full px-3 py-2 text-left text-sm hover:bg-neutral-100",onClick:ll,children:"No tag"}),t.jsx("div",{className:"border-t border-neutral-100"}),qt.length?qt.map(i=>t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 text-sm hover:bg-neutral-50",children:[t.jsx("button",{type:"button",className:"flex-1 text-left",onClick:()=>al(i),children:i}),t.jsx("button",{type:"button",className:"ml-3 text-sm font-semibold text-rose-500 hover:text-rose-600",onClick:()=>ol(i),title:"Delete tag",children:"-"})]},i)):t.jsx("div",{className:"px-3 py-2 text-sm text-neutral-400",children:"No tags available yet."})]}),t.jsxs("div",{className:"mt-2 grid w-full grid-cols-[minmax(0,1fr)_auto] gap-2",children:[t.jsx("input",{className:"w-full border rounded-lg px-2 py-1 text-sm",value:Gt,onChange:i=>Ss(i.target.value),onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),lr())},placeholder:"Create new tag"}),t.jsx("button",{type:"button",className:ne("px-2.5 py-1 rounded-lg text-sm border transition-colors whitespace-nowrap",Gt.trim()?Ee(k,!0):"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:lr,disabled:!Gt.trim(),children:"Add tag"})]}),t.jsx("div",{className:"text-[11px] text-neutral-500 mt-1",children:"Create and assign custom tags to track sales channels or availability. Use the dropdown above to select a tag or remove it with the minus icon."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth date"}),t.jsx("input",{type:"date",className:"mt-0.5 w-full border rounded-xl px-2 py-1 text-sm",value:me.birthDate||"",onChange:i=>Ae(x=>({...x,birthDate:i.target.value}))}),t.jsx("div",{className:"text-xs text-neutral-500 mt-0.5",children:me.birthDate?ve(me.birthDate):""})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Genetics (morphs & hets)"}),t.jsx("textarea",{rows:3,className:"mt-0.5 w-full border rounded-xl px-2 py-2 text-sm",value:bc(me.morphs,me.hets),onChange:i=>{const{morphs:x,hets:w}=hs(i.target.value);Ae(v=>({...v,morphs:x,hets:w}))},placeholder:`Clown
Pastel
Het Hypo`}),t.jsx("div",{className:"text-[11px] text-neutral-500 mt-0.5",children:"One trait per line works best. Prefix recessive targets with “Het”, “Possible”, or a percentage when needed."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Weight (g)"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm",value:me.weight,onChange:i=>Ae(x=>({...x,weight:Number(i.target.value)||0}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Group"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-2 py-1 text-sm bg-white",value:Array.isArray(me.groups)&&me.groups[0]||"",onChange:i=>{const x=i.target.value.trim();Ae(w=>({...w,groups:x?[x]:[]}))},children:[t.jsx("option",{value:"",children:"No group"}),I.map(i=>t.jsx("option",{value:i,children:i},i))]}),t.jsx("div",{className:"mt-2 border border-dashed border-neutral-200 rounded-xl p-3 bg-white",children:t.jsx(el,{onAdd:i=>{i&&(D(x=>x.includes(i)?x:[...x,i]),Ae(x=>({...x,groups:[i]})))}})}),t.jsxs("div",{className:"text-[11px] text-neutral-500 mt-1",children:["Existing: ",I.join(", ")||"—"]})]})]}),t.jsxs("div",{className:"md:col-span-2 space-y-5",children:[t.jsxs("div",{className:"mt-4 p-2 border rounded-xl bg-neutral-50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("div",{className:"font-medium text-sm",children:"Logs"}),t.jsx("div",{className:"text-xs text-neutral-500",children:"Edit recent feeds, weights, sheds, cleanings, meds"})]}),t.jsx(vd,{editSnakeDraft:me,setEditSnakeDraft:Ae,lastFeedDefaults:O,setLastFeedDefaults:Q})]}),t.jsxs("div",{className:"mt-4 flex flex-col items-end gap-3",children:[t.jsxs("div",{style:{width:318,height:318},className:"rounded-lg overflow-hidden border-2 border-neutral-200 relative",children:[me.imageUrl?t.jsx("img",{src:me.imageUrl,alt:me.name,className:"w-full h-full object-cover object-center"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm text-neutral-500 bg-neutral-50",children:"No image"}),Cs&&t.jsx("div",{className:"absolute inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center text-sm text-neutral-600",children:"Saving pictures…"})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[t.jsx("input",{ref:zs,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:bl}),t.jsx("input",{ref:Gs,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:yl}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:Nl,disabled:Cs||!(ye!=null&&ye.id),children:"Take picture"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:vl,disabled:Cs||!(ye!=null&&ye.id),children:"Upload picture"}),t.jsxs("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:wl,disabled:!(ye!=null&&ye.id),children:["View pictures",br?` (${br})`:""]}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{Ae(i=>i&&{...i,imageUrl:void 0}),Xe(i=>i&&{...i,imageUrl:void 0})},disabled:!(me!=null&&me.imageUrl),children:"Clear cover"})]})]})]})]})]})}),t.jsx("div",{className:"py-10"}),tt&&(()=>{const i=e.find(x=>x.id===tt);return t.jsx(Hc,{id:tt,name:i==null?void 0:i.name,morphs:i==null?void 0:i.morphs,hets:i==null?void 0:i.hets,dataUrl:Nt,onClose:()=>St(null)})})(),t.jsx(Bc,{open:kt,onClose:()=>vt(!1),snakes:e,groups:I,onGenerate:i=>Qc(i,$),theme:k}),Ut&&t.jsx(Oc,{onClose:()=>zt(!1),onFound:i=>{zt(!1);const x=e.find(w=>w.id===i);x?(Xe(x),Ae(tn(x))):alert(`No snake found with ID: ${i}`)}}),t.jsx(Uc,{snake:as,onCancel:Sl,onConfirm:Cl,theme:k}),t.jsx(Id,{theme:k})]})}function Oc({onClose:e,onFound:s}){const n=h.useRef(null),l=h.useRef(null),a=h.useRef(null),[r,o]=h.useState(""),c=h.useMemo(()=>{if(typeof navigator>"u")return"camera";const y=navigator.userAgent||"";return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile/i.test(y)?"camera":"scanner"},[]),[d,u]=h.useState(()=>{if(typeof window<"u")try{const y=window.localStorage.getItem(ra);if(y==="camera"||y==="scanner")return y}catch{}return c}),m=d==="camera",p=h.useCallback(async()=>{const y=l.current;if(!y)return;l.current=null;const _=[];typeof y.stop=="function"&&_.push(y.stop().catch(()=>{})),typeof y.clear=="function"&&_.push(y.clear().catch(()=>{})),typeof y.close=="function"&&_.push(y.close().catch(()=>{})),_.length&&await Promise.allSettled(_)},[]),b=h.useCallback(y=>{y!=="camera"&&y!=="scanner"||(u(_=>_===y?_:y),y!=="camera"&&p().catch(()=>{}))},[p]),f=h.useCallback(async()=>{var U,L;if(n.current)return n.current;if(typeof window>"u")return null;let y=null;try{y=await ns(()=>import("./vendor-CCGeIgWZ.js").then(T=>T.i),__vite__mapDeps([1,2]))}catch(T){console.warn("Failed to import html5-qrcode via ESM",T)}const _={Html5Qrcode:(y==null?void 0:y.Html5Qrcode)||((U=y==null?void 0:y.default)==null?void 0:U.Html5Qrcode)||window.Html5Qrcode||null,Html5QrcodeScanner:(y==null?void 0:y.Html5QrcodeScanner)||((L=y==null?void 0:y.default)==null?void 0:L.Html5QrcodeScanner)||window.Html5QrcodeScanner||null};return!_.Html5Qrcode&&!_.Html5QrcodeScanner?null:(n.current=_,_)},[]);h.useEffect(()=>{let y=!0;return m?((async()=>{await p().catch(()=>{});const U=await f();if(!y)return;if(!U){alert("QR scanner library failed to load. Check your connection and reload.");return}if(!document.getElementById("qr-scan-root"))return;const{Html5QrcodeScanner:T,Html5Qrcode:G}=U;try{if(T){const H=new T("qr-scan-root",{fps:10,qrbox:250},!1);l.current=H,H.render(ee=>{const g=nn(ee);g&&(y&&s(g),p().catch(()=>{}))},()=>{})}else if(G){const H=new G("qr-scan-root");l.current=H,await H.start({facingMode:{ideal:"environment"}},{fps:10,qrbox:250},ee=>{const g=nn(ee);g&&(y&&s(g),p().catch(()=>{}))},()=>{})}else throw new Error("html5-qrcode module unavailable")}catch(H){console.error("QR importer failed",H),y&&alert("Unable to start QR scanner. Verify camera permissions and try again.")}})(),()=>{y=!1,p().catch(()=>{})}):(p().catch(()=>{}),()=>{y=!1,p().catch(()=>{})})},[f,m,s,p]),h.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(ra,d)}catch{}},[d]),h.useEffect(()=>{if(d!=="scanner")return;const y=a.current;if(y){try{y.focus({preventScroll:!0})}catch{try{y.focus()}catch{}}if(typeof y.select=="function")try{y.select()}catch{}}},[d]);const N=async y=>{const _=y.target.files&&y.target.files[0];if(_){y.target&&(y.target.value="");try{const U=await f();let L=null;if(U&&U.Html5Qrcode){const{Html5Qrcode:G}=U;try{let H=null;typeof G.scanFileV2=="function"?H=await G.scanFileV2(_,!0):typeof G.scanFile=="function"&&(H=await G.scanFile(_,!0)),L=Va(H)}catch(H){console.warn("html5-qrcode file scan failed, will fall back to jsQR",H)}}if(L||(L=await vc(_)),!L){alert("Could not read a QR code from that image. Try a clearer, well-lit photo.");return}const T=nn(L);if(!T){alert("Could not parse an ID from that QR code.");return}s(T)}catch(U){console.error("file scan failed",U),alert("Failed to scan uploaded image")}}},S=h.useCallback(()=>{const y=r.trim();if(!y){alert("Scan or paste a QR value first.");return}const _=nn(y);if(!_){alert("Scan or paste a QR value first.");return}o(""),s(_)},[r,s]),A=y=>{y.key==="Enter"&&(y.preventDefault(),S())},E=r.trim().length>0;return t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",onClick:e,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow w-full max-w-md",onClick:y=>y.stopPropagation(),children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-lg",children:"Scan QR Code"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Choose how you'd like to scan. Cameras shine on mobile; USB readers are handy on desktop."})]}),t.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:e,children:"✕"})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"text-xs font-medium text-neutral-600",children:"Scan method"}),t.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>b("camera"),className:ne("px-3 py-1.5 rounded-lg text-sm border transition-colors",m?"bg-sky-600 text-white border-sky-600 shadow-sm":"bg-white text-neutral-700 border-neutral-200 hover:border-sky-400"),children:"Device camera"}),t.jsx("button",{type:"button",onClick:()=>b("scanner"),className:ne("px-3 py-1.5 rounded-lg text-sm border transition-colors",m?"bg-white text-neutral-700 border-neutral-200 hover:border-sky-400":"bg-sky-600 text-white border-sky-600 shadow-sm"),children:"USB / handheld scanner"})]}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:[m?"Camera starts automatically. Switch if you prefer a USB reader.":"Input field below is ready for your USB reader. Switch if you need the device camera."," ","Your choice is remembered. Suggested default: ",c==="camera"?"device camera (mobile).":"USB / handheld scanner (desktop)."]})]}),t.jsx("div",{className:"mt-3",children:t.jsx("div",{id:"qr-scan-root",className:ne("w-full h-56 rounded-lg border-2 border-dashed flex items-center justify-center transition-colors",m?"border-neutral-200 bg-neutral-50":"border-neutral-300 bg-neutral-100"),children:m?t.jsx("div",{className:"text-center text-sm text-neutral-500 px-4",children:"Align the QR inside the box"}):t.jsx("div",{className:"text-center text-sm text-neutral-500 px-4",children:"Camera disabled. Trigger your USB scanner and the scanned text will appear below."})},d)}),t.jsx("div",{className:"mt-3 text-xs text-neutral-500",children:m?"Tip: Hold the camera steady and ensure the code is well-lit. If the camera is blocked, upload a photo instead.":"Tip: USB readers usually act like keyboards. If the field below loses focus, click it once before scanning."}),t.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[t.jsx("label",{className:"text-sm",children:"Upload image:"}),t.jsx("input",{type:"file",accept:"image/*",onChange:N})]}),t.jsxs("div",{className:"mt-4 border-t border-neutral-200 pt-4",children:[t.jsx("div",{className:"text-sm font-medium",children:m?"Using a USB / handheld scanner?":"Scanner input"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:m?"Most external QR readers act like keyboards. Click the field below, then trigger your scanner to fill it.":"We focused this field so your USB reader can type the QR value automatically. You can also paste a code manually."}),t.jsxs("div",{className:"mt-2 flex flex-col sm:flex-row gap-2",children:[t.jsx("input",{ref:a,type:"text",value:r,onChange:y=>o(y.target.value),onKeyDown:A,className:"flex-1 border rounded-lg px-3 py-2 text-sm font-mono",placeholder:m?"Scan or paste the QR contents here":"Scanner-ready: trigger your reader or paste the QR contents here",inputMode:"text",autoComplete:"off",autoFocus:d==="scanner"}),t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm border transition-colors",E?"bg-sky-600 text-white border-sky-600":"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:S,disabled:!E,children:"Look up"})]})]}),t.jsx("div",{className:"mt-4 flex justify-end",children:t.jsx("button",{className:"px-3 py-2 rounded-lg border",onClick:e,children:"Close"})})]})})}function Uc({snake:e,onCancel:s,onConfirm:n,theme:l="blue"}){return e?t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-[70]",onClick:s,children:t.jsxs("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-xl border p-5",onClick:a=>a.stopPropagation(),children:[t.jsxs("div",{className:"font-semibold text-lg",children:["Delete ",e.name||"this snake","?"]}),t.jsx("p",{className:"mt-2 text-sm text-neutral-600 leading-relaxed",children:"This removes the animal and detaches any pairings linked to it. Demo animals will return automatically whenever your collection is empty, so you always have something to explore."}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:s,children:"Cancel"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm text-white",l==="dark"?"bg-rose-500 hover:bg-rose-600":"bg-rose-600 hover:bg-rose-700"),onClick:n,children:"Delete"})]})]})}):null}function zc(e){return e==="green"?{active:"bg-emerald-600 text-white border-emerald-600",soft:"bg-emerald-300"}:e==="dark"?{active:"bg-neutral-800 text-white border-neutral-700",soft:"bg-neutral-600"}:{active:"bg-sky-600 text-white border-sky-600",soft:"bg-sky-300"}}function Ee(e,s=!0){return e==="green"?s?"bg-emerald-600 text-white":"bg-emerald-300 text-white":e==="dark"?s?"bg-neutral-800 text-white":"bg-neutral-600 text-white":s?"bg-sky-600 text-white":"bg-sky-300 text-white"}function Ft(e){return e==="green"?"bg-emerald-900/20":e==="dark"?"bg-neutral-900/40":"bg-sky-900/20"}function et({theme:e="blue",active:s,onClick:n,children:l}){const a=zc(e);return t.jsx("button",{className:ne("px-3 py-1.5 rounded-lg text-sm border",s?a.active:"bg-white hover:bg-neutral-50"),onClick:n,children:l})}function Us({title:e,children:s}){return t.jsxs("div",{className:"bg-white border rounded-2xl shadow-sm",children:[t.jsx("div",{className:"px-4 py-3 border-b font-semibold",children:e}),t.jsx("div",{className:"p-4",children:s})]})}function Ja({children:e}){return t.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full border bg-neutral-50",children:e})}function Gc({groups:e,showGroups:s,setShowGroups:n,hiddenGroups:l,setHiddenGroups:a,showUnassigned:r=!0,setShowUnassigned:o}){const c=N=>{typeof n!="function"||typeof a!="function"||n(S=>{const A=new Set(S||[]);return A.has(N)?A.delete(N):(A.add(N),a(E=>(E||[]).filter(y=>y!==N))),[...A]})},d=N=>{typeof a!="function"||typeof n!="function"||a(S=>{const A=new Set(S||[]);return A.has(N)?A.delete(N):(A.add(N),n(E=>(E||[]).filter(y=>y!==N))),[...A]})},u=()=>{typeof n=="function"&&n([]),typeof a=="function"&&a([])},m=()=>{typeof o=="function"&&o(N=>!N)},p=new Set(s||[]),b=new Set(l||[]),f=p.size>0||b.size>0;return t.jsxs("div",{className:"space-y-2 mb-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[t.jsx("button",{type:"button",disabled:!f,className:ne("px-2.5 py-1 rounded-lg border text-xs font-medium transition-colors",f?"bg-white hover:bg-neutral-50 border-neutral-300":"bg-neutral-100 text-neutral-400 border-neutral-200 cursor-not-allowed"),onClick:u,children:"Clear filters"}),t.jsx("button",{type:"button",className:ne("px-2.5 py-1 rounded-lg border text-xs font-medium transition-colors",r?"bg-amber-100 border-amber-300 text-amber-900":"bg-white hover:bg-neutral-50 border-neutral-300"),onClick:m,children:r?"Hide unassigned":"Show unassigned"})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.map(N=>{const S=p.has(N)?"show":b.has(N)?"hide":"neutral";return t.jsxs("div",{className:ne("inline-flex items-center gap-1 text-sm px-2.5 py-1 rounded-lg border transition-colors",S==="show"?"bg-emerald-50 border-emerald-400 text-emerald-700":S==="hide"?"bg-rose-50 border-rose-400 text-rose-700":"bg-white border-neutral-300 text-neutral-700"),children:[t.jsx("span",{className:"font-medium mr-0.5",children:N}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",onClick:()=>c(N),className:ne("px-1.5 py-0.5 rounded-md border text-[10px] uppercase tracking-wide",S==="show"?"bg-emerald-500 border-emerald-500 text-white":"bg-white border-neutral-300 text-neutral-600 hover:bg-neutral-50"),children:"Show"}),t.jsx("button",{type:"button",onClick:()=>d(N),className:ne("px-1.5 py-0.5 rounded-md border text-[10px] uppercase tracking-wide",S==="hide"?"bg-rose-500 border-rose-500 text-white":"bg-white border-neutral-300 text-neutral-600 hover:bg-neutral-50"),children:"Hide"})]})]},N)}),!e.length&&t.jsx("span",{className:"text-xs text-neutral-500",children:"No groups yet."})]})]})}function Hc({id:e,name:s,morphs:n,hets:l,dataUrl:a,onClose:r}){if(!e)return null;const o=at(n,l,possibleHets);return t.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center p-4",onClick:r,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow",onClick:c=>c.stopPropagation(),children:[t.jsxs("div",{className:"font-medium mb-2",children:["QR for ",s||e]}),t.jsxs("div",{className:"text-sm text-neutral-500 mb-2",children:["ID: ",t.jsx("span",{className:"font-mono",children:e})]}),t.jsx("div",{className:"space-y-1 mb-3",children:o.length?t.jsx(ar,{label:"Genetics",genes:o,size:"md"}):t.jsx("div",{className:"text-xs text-neutral-500 uppercase tracking-wide",children:"Genetics: -"})}),a?t.jsx("img",{src:a,className:"w-64 h-64",alt:`QR ${e}`}):t.jsx("div",{className:"w-64 h-64 flex items-center justify-center",children:"Generating…"}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[a&&t.jsx("a",{className:"px-3 py-2 rounded-lg text-sm border",download:`snake-${e}.png`,href:a,children:"Download"}),t.jsx("button",{className:"px-3 py-2 rounded-lg text-sm border",onClick:r,children:"Close"})]})]})})}function Bc({open:e,onClose:s,snakes:n,groups:l,onGenerate:a,theme:r="blue"}){const[o,c]=h.useState("all"),[d,u]=h.useState([]),[m,p]=h.useState([]);h.useEffect(()=>{e||(c("all"),u([]),p([]))},[e]);const b=async()=>{let f=[];o==="all"?f=n:o==="groups"?f=n.filter(N=>(N.groups||[]).some(S=>d.includes(S))):f=n.filter(N=>m.includes(N.id)),a(f),s()};return e?t.jsx("div",{className:ne("fixed inset-0 flex items-center justify-center p-4 z-50",Ft(r)),onClick:s,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow w-full max-w-2xl",onClick:f=>f.stopPropagation(),children:[t.jsx("div",{className:"font-medium mb-2",children:"Export QR to PDF (100mm × 50mm)"}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{children:t.jsxs("label",{className:"inline-flex items-center gap-2",children:[t.jsx("input",{type:"radio",checked:o==="all",onChange:()=>c("all")})," All snakes"]})}),t.jsxs("div",{children:[t.jsxs("label",{className:"inline-flex items-center gap-2",children:[t.jsx("input",{type:"radio",checked:o==="groups",onChange:()=>c("groups")})," By groups"]}),o==="groups"&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:l.map(f=>{const N=d.includes(f);return t.jsxs("label",{className:"inline-flex items-center gap-2 px-2 py-1 border rounded-lg",children:[t.jsx("input",{type:"checkbox",checked:N,onChange:S=>{const A=S.target.checked;u(E=>{const y=new Set(E||[]);return A?y.add(f):y.delete(f),[...y]})}}),f]},f)})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"inline-flex items-center gap-2",children:[t.jsx("input",{type:"radio",checked:o==="selected",onChange:()=>c("selected")})," Selected snakes"]}),o==="selected"&&t.jsx("div",{className:"mt-2 max-h-40 overflow-auto border rounded p-2",children:n.map(f=>{const N=m.includes(f.id);return t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:N,onChange:S=>{const A=S.target.checked;p(E=>{const y=new Set(E||[]);return A?y.add(f.id):y.delete(f.id),[...y]})}}),f.name," ",t.jsx("span",{className:"text-xs text-neutral-500",children:f.id})]},f.id)})})]})]}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-lg border",onClick:s,children:"Cancel"}),t.jsx("button",{className:ne("px-3 py-2 rounded-lg text-white",Ee(r,!0)),onClick:b,children:"Generate PDF"})]})]})}):null}const qc=.352778;function Za(e,s,n,l=18,a=8){if(!s)return a;let r=l;for(;r>=a;){if(e.setFontSize(r),e.getTextWidth(s)<=n)return r;r-=1}return e.setFontSize(a),a}function es(e,s=1.2){return e*qc*s}const Vc=typeof document<"u"&&typeof document.createElement=="function";async function Yc(e,s){try{if(Vc){const l=document.createElement("canvas");if(await new Promise((a,r)=>{Pn.toCanvas(l,e,{width:600,margin:1},o=>o?r(o):a())}),s)try{const a=l.getContext("2d");if(a){const r=await Wc(s),c=600*.2,d=c*.25,u=(600-c)/2,m=(600-c)/2;a.fillStyle="#ffffff",a.fillRect(u-d/2,m-d/2,c+d,c+d),a.drawImage(r,u,m,c,c)}}catch(a){console.warn("Unable to overlay logo on QR code",a)}return l.toDataURL("image/png")}}catch(l){console.warn("Falling back to basic QR generation",l)}return await Pn.toDataURL(e,{width:600,margin:1})}function Wc(e){return new Promise((s,n)=>{const l=new Image;l.crossOrigin="anonymous",l.onload=()=>s(l),l.onerror=n,l.src=e})}async function Qc(e,s={}){const{jsPDF:n}=await ns(async()=>{const{jsPDF:c}=await import("./jspdf-BBNVmQfp.js").then(d=>d.j);return{jsPDF:c}},__vite__mapDeps([0,1,2])),l=100,a=50,r=6,o=new n({unit:"mm",format:[l,a],orientation:"landscape"});for(let c=0;c<e.length;c++){const d=e[c],u=`${window.location.origin}${window.location.pathname}#snake=${encodeURIComponent(d.id)}`;try{const m=await Yc(u,s==null?void 0:s.logoUrl),p=Math.min(a-r*2,38),b=r,f=(a-p)/2;o.addImage(m,"PNG",b,f,p,p);const N=1.5;o.setDrawColor(50),o.setLineWidth(.3),o.rect(b-N,f-N,p+N*2,p+N*2);const S=Math.max(20,l-r-(b+p)-8),A=d.name||"Unnamed",E=d.id?`ID: ${d.id}`:"",_=at(d.morphs,d.hets,d.possibleHets).join(", "),U=Za(o,A,S,18,10),L=10;let T=9;const G=6;o.setFontSize(U);const H=o.splitTextToSize(A,S),ee=es(U,1),g=H.length*ee,I=_?[`Genetics: ${_}`]:[],D=a-r*2,k=V=>{o.setFontSize(V);const re=[];I.forEach(pe=>{const we=o.splitTextToSize(pe,S);re.push(...we)});const ae=re.length?re.length*es(V,1):0;return{lines:re,height:ae}};let{lines:oe,height:$}=k(T);const j=3;let P=oe.length?2:0;const te=E?es(L,1):0;let X=g+j+te+P+$;for(;X>D&&T>G;)T-=1,{lines:oe,height:$}=k(T),P=oe.length?2:0,X=g+j+te+P+$;let ce=(a-X)/2;ce<r&&(ce=r);const q=b+p+8;try{o.setFont(void 0,"bold")}catch{}o.setFontSize(U),o.text(H,q,ce,{baseline:"top"}),ce+=g+j;try{o.setFont(void 0,"normal")}catch{}E&&(o.setFontSize(L),o.text(E,q,ce,{baseline:"top"}),ce+=te+P),oe.length&&(o.setFontSize(T),o.text(oe,q,ce,{baseline:"top"}))}catch(m){console.error("QR gen failed",m)}o.setDrawColor(120),o.setLineWidth(.4),o.rect(1.5,1.5,l-3,a-3),c<e.length-1&&o.addPage([l,a],"landscape")}o.save("qr-labels.pdf")}async function Kc(e,s={},n="blue",l=[]){const{jsPDF:a}=await ns(async()=>{const{jsPDF:q}=await import("./jspdf-BBNVmQfp.js").then(V=>V.j);return{jsPDF:q}},__vite__mapDeps([0,1,2])),r=new a({unit:"mm",format:"a4"}),o=210,c=297,d=15;let u=20;const m=8,p={blue:"#1E40AF",green:"#059669",dark:"#374151"},b=p[n]||p.blue,N=Ot(e==null?void 0:e.sex)==="F"?sl(e==null?void 0:e.id,l):[];function S(q){const V=String(q).replace("#",""),re=parseInt(V.length===3?V.split("").map(ae=>ae+ae).join(""):V,16);return{r:re>>16&255,g:re>>8&255,b:re&255}}function A(q){return q?String(q).replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/[_-]+/g," ").split(/\s+/).map(re=>re?re.charAt(0).toUpperCase()+re.slice(1):"").join(" "):""}function E(q=!1){if(r.setDrawColor(b),r.setLineWidth(1.5),r.rect(m,m,o-m*2,297-m*2),q){u=20;try{if(s&&s.logoUrl)try{r.addImage(s.logoUrl,"PNG",d,u,20,20)}catch{}}catch{}const V=d+24;r.setFontSize(14),s.businessName?(r.text(s.businessName,V,u+6),r.setFontSize(12),r.text(s.name||"",V,u+12)):s.name&&r.text(s.name,V,u+6),r.setFontSize(10);const re=[];s.email&&re.push(s.email),s.phone&&re.push(s.phone),re.length&&r.text(re.join(" • "),V,u+18);const ae=u+26;r.setLineWidth(.6),r.setDrawColor(180),r.line(m+4,ae,o-m-4,ae),u=ae+6,r.setFontSize(16),r.text(e.name||"",o/2,u,{align:"center"}),u+=10,r.setFontSize(10),r.text(`ID: ${e.id||""}`,d,u),r.text(`Sex: ${e.sex||""}`,d+70,u),r.text(`Birth date: ${e.birthDate?ve(e.birthDate):""}`,d+110,u),u+=7,r.text(`Weight: ${e.weight||""} g`,d,u),r.text(`Groups: ${(e.groups||[]).join(", ")}`,d+70,u),u+=8;const pe=at(e.morphs,e.hets,e.possibleHets),we=pe.length?pe.join(", "):"-";r.text(`Genetics: ${we}`,d,u),u+=8;const Ie=u+2;r.setLineWidth(.6),r.setDrawColor(180),r.line(m+4,Ie,o-m-4,Ie),u=Ie+8}else u=m+18}E(!0);const y=e.logs||{},_=o-d*2,U=c-m-6;function L(q,V){return u+q>U?(r.addPage(),E(!1),typeof V=="function"&&V(),!0):!1}function T(q,V,re,ae={}){const we=ae.cellFontSize||10,Ie=Math.max(4,Math.round(we*.35278*.8)),Y=we*.35278*1.05,ue=V.length,M=V.map(Ce=>Ce.width||_/ue);function R(){r.setFontSize(12),r.text(q,d,u),u+=8;let Ce=d;const je=S(b);r.setFillColor(je.r,je.g,je.b),r.rect(d,u,_,9,"F");for(let Ne=0;Ne<ue;Ne++){r.setDrawColor(0),r.setLineWidth(.3),r.rect(Ce,u,M[Ne],9,"S"),r.setFontSize(8),r.setTextColor(255);try{r.setFont(void 0,"bold")}catch{}const Z=A(V[Ne].title||V[Ne].key||""),z=Ce+M[Ne]/2,J=u+9/2;r.text(String(Z),z,J,{align:"center",baseline:"middle"});try{r.setFont(void 0,"normal")}catch{}Ce+=M[Ne]}u+=9,r.setFontSize(we),r.setTextColor(10)}L(19,R)||R(),re.forEach((Ce,je)=>{r.setFontSize(we);let Ne=1;const Z=[];for(let ke=0;ke<ue;ke++){const _e=V[ke].key;let Fe="";typeof _e=="function"?Fe=_e(Ce)||"":Fe=Ce&&typeof Ce[_e]<"u"?Ce[_e]:"";let Pe="";Fe===null||typeof Fe>"u"?Pe="":typeof Fe=="boolean"?Pe=Fe?"Yes":"No":Array.isArray(Fe)?Pe=Fe.join(", "):typeof Fe=="object"?Pe=JSON.stringify(Fe):Pe=String(Fe);const ye=typeof _e=="string"?_e:V[ke].title;typeof Pe=="string"&&(ye==="date"||/date$/i.test(String(ye)))&&(Pe=ve(Pe)||Pe);const Xe=r.splitTextToSize(Pe,Math.max(10,M[ke]-4));Z.push(Xe),Xe.length>Ne&&(Ne=Xe.length)}const J=Math.max(Ie,Math.ceil(Ne*Y))+4;L(J+2,R);let fe=d;for(let ke=0;ke<ue;ke++){const _e=M[ke];r.setDrawColor(0),r.setLineWidth(.25),r.rect(fe,u,_e,J,"S");const Fe=Z[ke]||[""],Pe=fe+3,ye=u+J/2-(Fe.length-1)*Y/2;r.setFontSize(we),r.text(Fe,Pe,ye),fe+=_e}u+=J});const ie=Math.max(Ie,Math.ceil(Y))+4;L(ie+2,R),r.setDrawColor(0),r.setLineWidth(.3),r.rect(d,u,_,ie,"S"),r.setFontSize(Math.max(8,we));const he=u+2+Y/2;r.text(`Total entries: ${re.length}`,d+3,he),u+=ie+4;const be=typeof ae.spacingAfter=="number"?ae.spacingAfter:0;be>0&&(L(be,null)||(u+=be))}function G(){L(7,null)||(u+=2,r.setDrawColor(200),r.setLineWidth(.4),r.line(d,u,d+_,u),u+=4)}function H(q){if(!Array.isArray(q)||!q.length)return;const V=()=>{r.setFontSize(12),r.text("Breeding cycles",d,u),u+=7},re=Ie=>{r.setFontSize(10),r.text(String(Ie),d,u),u+=5.5};V();const ae=9,pe=4,we=es(ae,1.05);q.forEach(Ie=>{L(6,()=>{E(!1),V()}),re(Ie.year),(Ie.cycles||[]).forEach(Y=>{const ue=[],M=Y.label||`Pairing ${Y.id||""}`;if(ue.push(`• ${M}`),Y.locks&&Y.locks.length){const ie=Y.locks.map(he=>he.display||We(he.iso)).filter(Boolean).join(", ");ie&&ue.push(`   Locks: ${ie}`)}Y.ovulationDate&&ue.push(`   Ovulation: ${ve(Y.ovulationDate)}`),Y.preLayDate&&ue.push(`   Pre-Lay Shed: ${ve(Y.preLayDate)}`),Y.clutchDate&&ue.push(`   Eggs laid: ${ve(Y.clutchDate)}`),Y.hatchDate&&ue.push(`   Hatched: ${ve(Y.hatchDate)}`),ue.length===1&&ue.push("   No events recorded");const R=ue.flatMap(ie=>r.splitTextToSize(ie,_-pe)),W=R.length*we+2;L(W+2,()=>{E(!1),V(),re(Ie.year)}),r.setFontSize(ae),r.text(R,d+pe,u,{baseline:"top"}),u+=W}),u+=2})}N.length&&(H(N),G());const ee=(y.feeds||[]).slice().reverse(),g=[{title:"Date",key:"date",width:26},{title:"Food",key:"feed",width:46},{title:"Size",key:q=>{if(!q)return"";const V=[q.size,q.sizeDetail,q.preySize,q.portionSize,q.itemSize],re=V.find(ae=>typeof ae=="string"&&ae.trim().length)||V.find(ae=>typeof ae=="number");return typeof re=="number"?`${re}`:re||""},width:30},{title:"Weight",key:q=>q&&(q.weightGrams||q.grams)?`${q.weightGrams||q.grams} g`:"",width:24},{title:"Form",key:q=>{const V=q&&(q.method||q.form),re=q&&(q.methodDetail||q.formDetail);return V?V==="Other"?re||"Other":V:""},width:36},{title:"Notes",key:"notes",width:_-162}];T("Feed",g,ee,{cellFontSize:6,spacingAfter:0}),G();const I=(y.weights||[]).slice().reverse(),D=[{title:"Date",key:"date",width:30},{title:"Grams",key:q=>q&&typeof q.grams<"u"?`${q.grams} g`:"",width:30},{title:"Notes",key:"notes",width:_-60}];T("Weights",D,I,{cellFontSize:6,spacingAfter:0}),G();const k=(y.cleanings||[]).slice().reverse(),oe=[{title:"Date",key:"date",width:30},{title:"Type",key:q=>q&&q.deep?"Deep cleaning":"Quick cleaning",width:40},{title:"Notes",key:"notes",width:_-70}];T("Cleanings",oe,k,{cellFontSize:6,spacingAfter:0}),G();const $=(y.sheds||[]).slice().reverse(),j=[{title:"Date",key:"date",width:30},{title:"Status",key:q=>q&&q.complete?"Complete":"Incomplete",width:30},{title:"Notes",key:"notes",width:_-60}];T("Sheds",j,$,{cellFontSize:6,spacingAfter:0}),G();const P=(y.meds||[]).slice().reverse(),te=[{title:"Date",key:"date",width:30},{title:"Drug",key:"drug",width:48},{title:"Dose",key:q=>q&&(q.dose||q.dose===0)?`${q.dose} mg`:"",width:26},{title:"Notes",key:"notes",width:_-104}];T("Meds",te,P,{cellFontSize:6,spacingAfter:0});const X=r.getNumberOfPages();for(let q=1;q<=X;q++)r.setPage(q),r.setFontSize(9),r.text(`Page ${q} / ${X}`,d,12);const ce=`${e.id||"snake"}-${(e.name||"").replace(/\s+/g,"_")}.pdf`;r.save(ce)}async function Xc(e={}){const{jsPDF:s}=await ns(async()=>{const{jsPDF:g}=await import("./jspdf-BBNVmQfp.js").then(I=>I.j);return{jsPDF:g}},__vite__mapDeps([0,1,2])),n=100,l=50,a=6,r=new s({unit:"mm",format:[n,l],orientation:"landscape"}),o=e.clutchNumber?String(e.clutchNumber):"—",c=e.label?e.label:e.clutchNumber?`Clutch #${o}`:"Clutch Card",d=e.femaleName||"—",u=e.maleName||"—",m=g=>{if(g===null||typeof g>"u")return"";const I=String(g).trim();return!I||I==="—"?"":I},p=m(e.femaleGenetics),b=m(e.maleGenetics);r.setDrawColor(80),r.setLineWidth(.5),r.roundedRect(3,3,n-6,l-6,2,2);const f=Za(r,c,n-a*2,18,12);try{r.setFont(void 0,"bold")}catch{}r.setFontSize(f),r.text(c,n/2,a,{align:"center",baseline:"top"});try{r.setFont(void 0,"normal")}catch{}const N=e.clutchDate||"",S=N?ts(N,59):"",A=(()=>{const g=e.eggsTotal;if(g===null||typeof g>"u"||g==="")return"—";if(typeof g=="number"&&Number.isFinite(g))return String(g);const I=Number(g);return Number.isFinite(I)?String(I):String(g)})(),E=[{label:"Clutch #",value:o},{label:"Date",value:N?ve(N):"—"},{label:"Female",value:d,secondary:p},{label:"Male",value:u,secondary:b},{label:"Eggs",value:A},{label:"Est. hatch",value:S?ve(S):"—"}];let _=a+es(f,.9)+2;const U=n-a*2,L=10;r.setFontSize(L);const T=es(L,1.05),G=Math.max(8,L-1);E.forEach(g=>{const I=`${g.label}: ${g.value}`,D=r.splitTextToSize(I,U);if(r.text(D,a,_,{baseline:"top"}),_+=D.length*T,g.secondary){r.setFontSize(G);const k=r.splitTextToSize(`   ${g.secondary}`,U);r.text(k,a,_,{baseline:"top"}),_+=k.length*es(G,1.05),r.setFontSize(L)}});const ee=(e.label||(e.clutchNumber?`clutch-${e.clutchNumber}`:"clutch-card")).toString().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")||"clutch-card";r.save(`${ee}.pdf`)}function Jc({s:e,onEdit:s,onQuickPair:n,onDelete:l,groups:a=[],setSnakes:r,setQrFor:o,pairings:c=[],onOpenPairing:d,lastFeedDefaults:u,setLastFeedDefaults:m}){var $;const p=typeof s=="function",b=typeof n=="function",f=typeof l=="function",[N,S]=h.useState(!1),[A,E]=h.useState(null),[y,_]=h.useState({date:ze(new Date),notes:"",grams:0,feed:"Mouse",size:"pinky",sizeDetail:"",form:"",formDetail:"",drug:"",dose:"",refused:!1}),U=h.useRef(null),L=h.useMemo(()=>at(e==null?void 0:e.morphs,e==null?void 0:e.hets,e==null?void 0:e.possibleHets),[e==null?void 0:e.morphs,e==null?void 0:e.hets,e==null?void 0:e.possibleHets]),T=h.useMemo(()=>Ot(e==null?void 0:e.sex),[e==null?void 0:e.sex]),G=h.useMemo(()=>(typeof(e==null?void 0:e.status)=="string"?e.status.trim():"")||"Active",[e==null?void 0:e.status]),H=h.useMemo(()=>{var te;return(Array.isArray((te=e==null?void 0:e.logs)==null?void 0:te.weights)?e.logs.weights:[]).map((X,ce)=>{const q=typeof(X==null?void 0:X.grams)=="number"?X.grams:typeof(X==null?void 0:X.weightGrams)=="number"?X.weightGrams:typeof(X==null?void 0:X.weight)=="number"?X.weight:Number((X==null?void 0:X.grams)??(X==null?void 0:X.weightGrams)??(X==null?void 0:X.weight)??(X==null?void 0:X.value));if(!Number.isFinite(q))return null;const V=(X==null?void 0:X.date)||(X==null?void 0:X.loggedAt)||(X==null?void 0:X.createdAt)||null,ae=(typeof V=="string"?Rt(V):null)||(V?new Date(V):null);return!(ae instanceof Date)||Number.isNaN(ae.getTime())?null:{grams:q,date:ae,label:ve(ae)||ae.toLocaleDateString(),rawDate:V||ae.toISOString(),index:ce}}).filter(Boolean).sort((X,ce)=>X.date.getTime()-ce.date.getTime()).slice(-12)},[($=e==null?void 0:e.logs)==null?void 0:$.weights]),ee=h.useMemo(()=>{if(e!=null&&e.imageUrl)return e.imageUrl;if(Array.isArray(e==null?void 0:e.photos)&&e.photos.length){const j=e.photos[e.photos.length-1];return(j==null?void 0:j.url)||null}return null},[e==null?void 0:e.imageUrl,e==null?void 0:e.photos]),g=h.useMemo(()=>T!=="F"?[]:sl(e==null?void 0:e.id,c),[T,e==null?void 0:e.id,c]);function I(j){if(!j)return{key:"feeds",defaults:{}};const P=String(j).toLowerCase();return P.includes("weight")?{key:"weights",defaults:{grams:0}}:P.includes("feed")||P.includes("feeding")?{key:"feeds",defaults:{feed:"Mouse",size:"pinky",grams:0}}:P.includes("shed")?{key:"sheds",defaults:{complete:!0}}:P.includes("clean")?{key:"cleanings",defaults:{deep:!1}}:P.includes("med")?{key:"meds",defaults:{drug:"",dose:""}}:{key:"feeds",defaults:{}}}function D(j,P){P&&P.stopPropagation();const X={feeds:"Feed",weights:"Weight",cleanings:"Cleaning",sheds:"Shed",meds:"Meds"}[j]||j;try{const q=U.current;q&&q.scrollIntoView({block:"nearest",behavior:"smooth"})}catch{}const ce=I(X);ce.key==="feeds"&&u?_({date:ze(new Date),notes:u.notes||"",grams:ce.defaults.grams||0,feed:u.feed||ce.defaults.feed||"Mouse",size:u.size||ce.defaults.size||"pinky",sizeDetail:u.sizeDetail||"",form:u.form||ce.defaults.form||"",formDetail:u.formDetail||"",refused:!1,drug:ce.defaults.drug||"",dose:ce.defaults.dose||""}):_({date:ze(new Date),notes:"",grams:ce.defaults.grams||0,feed:ce.defaults.feed||"Mouse",size:ce.defaults.size||"pinky",sizeDetail:ce.defaults.sizeDetail||"",form:ce.defaults.form||"",formDetail:ce.defaults.formDetail||"",drug:ce.defaults.drug||"",dose:ce.defaults.dose||"",refused:!1}),E(X)}function k(){E(null)}function oe(j,P={}){if(!r){alert("Editing not enabled"),k();return}const te=(j||"").toLowerCase();let X="feeds";te.includes("weight")?X="weights":te.includes("feed")?X="feeds":te.includes("shed")?X="sheds":te.includes("clean")?X="cleanings":te.includes("med")&&(X="meds");const ce={date:y.date};X==="weights"&&(ce.grams=Number(y.grams)||0);const q=P.forceRefused===!0;if(X==="feeds"&&(ce.feed=y.feed,ce.size=y.size==="Other"?y.sizeDetail||"":y.size,ce.weightGrams=Number(y.grams)||0,y.form?(ce.method=y.form==="Other"?"Other":y.form,ce.methodDetail=y.form==="Other"&&y.formDetail||""):(ce.method="Other",ce.methodDetail=""),ce.refused=q?!0:!!y.refused),X==="meds"&&(ce.drug=y.drug,ce.dose=y.dose),ce.notes=y.notes||"",r(V=>V.map(re=>re.id===e.id?{...re,logs:{...re.logs,[X]:[...re.logs[X]||[],ce]}}:re)),X==="feeds"&&typeof m=="function")try{m({feed:y.feed,size:y.size,sizeDetail:y.sizeDetail||"",form:y.form,formDetail:y.formDetail||"",notes:y.notes||"",refused:!1})}catch{}k()}return t.jsxs("div",{ref:U,className:"relative bg-white border rounded-xl p-2 flex flex-col gap-1 min-h-[280px] max-h-[520px] min-w-0 text-sm",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0",children:ee?t.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border ring-1 ring-white/60 shadow-sm",children:t.jsx("img",{src:ee,alt:e!=null&&e.name?`${e.name} photo`:"Snake photo",className:"w-full h-full object-cover object-center",onError:j=>{j.currentTarget.style.display="none"}})}):t.jsx("div",{className:"w-12 h-12 rounded-full border bg-neutral-50 flex items-center justify-center text-[11px] text-neutral-400 text-center leading-tight px-1 ring-1 ring-white/60 shadow-sm",children:"No picture"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-medium text-base truncate",children:e.name}),t.jsx("div",{className:"text-xs font-mono text-neutral-500 mt-1 truncate",children:e.id}),t.jsx("div",{className:"text-xs text-neutral-500",children:e.birthDate?ve(e.birthDate):""})]}),t.jsx("div",{className:"shrink-0",children:t.jsx(Ja,{children:T==="M"?"♂":T==="F"?"♀":"•"})})]}),t.jsx("div",{className:"mt-1 space-y-1",children:L.length?t.jsx(ar,{label:"Genetics",genes:L,size:"sm"}):t.jsx("div",{className:"text-[11px] uppercase tracking-wide text-neutral-500",children:"Genetics: -"})})]})]}),t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p&&t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg",onClick:()=>s(e),children:"Edit"}),b&&t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg",onClick:()=>n(e),children:"Pair"}),t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg",onClick:()=>{typeof o=="function"&&o(e.id)},children:"QR"}),f&&t.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded-lg text-rose-600",onClick:()=>l(e),title:"Delete snake",children:"Delete"})]}),t.jsx("div",{className:"flex-1 overflow-auto",children:t.jsx("div",{className:"mt-2 grid grid-cols-2 gap-1",children:(()=>{const j=e.logs||{},P=j.feeds&&j.feeds.length?j.feeds[j.feeds.length-1]:null,te=j.weights&&j.weights.length?j.weights[j.weights.length-1]:null,X=j.cleanings&&j.cleanings.length?j.cleanings[j.cleanings.length-1]:null,ce=j.sheds&&j.sheds.length?j.sheds[j.sheds.length-1]:null,q=j.meds&&j.meds.length?j.meds[j.meds.length-1]:null,V=e.groups||[];return[{key:"feeds",entry:P},{key:"weights",entry:te},{key:"cleanings",entry:X},{key:"sheds",entry:ce},{key:"meds",entry:q},{key:"groups",groups:V}].map(ae=>{const pe=ae.key,we=ae.entry&&ae.entry.date||"",Ie=pe==="feeds"?"Feed":pe==="weights"?"Weight":pe==="cleanings"?"Cleaning":pe==="sheds"?"Shed":pe==="meds"?"Meds":"Group",Y=["feeds","weights","cleanings","sheds","meds"].includes(pe),ue=nl[pe]||{bg:"#efefef",border:"#ddd"};return t.jsxs("div",{onClick:M=>{Y&&(M.stopPropagation(),D(pe,M))},role:Y?"button":void 0,className:ne(Y?"cursor-pointer":"","w-full px-2 py-1 text-[11px] rounded-lg border flex flex-col justify-between gap-1 min-h-[48px]"),style:{backgroundColor:ue.bg,borderColor:ue.border},children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-[10px] text-neutral-600 font-semibold uppercase",children:Ie}),t.jsx("div",{className:"text-[10px] text-neutral-600",children:ve(we)||" "})]}),t.jsxs("div",{className:"min-w-0",children:[pe==="feeds"?(()=>{if(!ae.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const M=ae.entry,R=(M.feed||M.item||"").trim(),W=(M.size||"").trim(),ie=typeof M.weightGrams=="number"&&M.weightGrams>0?`${M.weightGrams} g`:typeof M.grams=="number"&&M.grams>0?`${M.grams} g`:"",he=M.method?M.methodDetail?`${M.method} (${M.methodDetail})`:M.method:"";let be="";if(!M.refused){const je=[];R&&je.push(R),W&&je.push(W),ie&&je.push(ie),he&&je.push(he),be=je.join(" • ")}const Ce=M.refused?"Refused feed":be||"Feed";return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:ne("truncate",M.refused?"font-semibold text-rose-600":"font-medium text-neutral-800"),children:Ce}),M.refused&&be?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:be}):null,M.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:M.notes}):null]})})():null,pe==="weights"?(()=>{if(!ae.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const M=ae.entry;return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"font-medium",children:typeof M.grams=="number"?`${M.grams} g`:`${M.grams||""}`}),M.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:M.notes}):null]})})():null,pe==="cleanings"?(()=>{if(!ae.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const M=ae.entry;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium",children:["Cleaning",M.deep?" • deep":""]}),M.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:M.notes}):null]})})():null,pe==="sheds"?(()=>{if(!ae.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const M=ae.entry;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium",children:["Shed",M.complete?" • complete":""]}),M.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:M.notes}):null]})})():null,pe==="meds"?(()=>{if(!ae.entry)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const M=ae.entry;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium truncate",children:[M.drug," ",M.dose?`• ${M.dose}`:""]}),M.notes?t.jsx("div",{className:"text-[11px] text-neutral-700 truncate",children:M.notes}):null]})})():null,pe==="groups"?(()=>{const M=ae.groups||[];if(!M.length)return t.jsx("div",{className:"text-sm text-neutral-700",children:"—"});const R=M.join(", ");return R.trim().toLowerCase()==="group"?t.jsx("div",{className:"text-sm text-neutral-700",children:"—"}):t.jsx("div",{className:"font-medium truncate",children:R})})():null]})]},pe)})})()})}),A&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 p-4",onClick:j=>{j.stopPropagation(),k()},children:t.jsxs("div",{className:"pointer-events-auto w-full max-w-md bg-white border rounded-xl shadow-2xl p-4 max-h-[90vh] overflow-y-auto",onClick:j=>j.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"text-base font-semibold",children:["Add ",A]}),t.jsx("button",{className:"text-sm px-2 py-1 border rounded-lg text-neutral-500 hover:text-neutral-700",onClick:j=>{j.stopPropagation(),k()},children:"Close"})]}),t.jsxs("div",{className:"space-y-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Date"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",type:"date",value:y.date,onChange:j=>_(P=>({...P,date:j.target.value}))})]}),A.toLowerCase().includes("feed")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Feed type"}),t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:y.feed||"",onChange:j=>_(P=>({...P,feed:j.target.value,size:j.target.value==="Mouse"||j.target.value==="Rat"?P.size||"pinky":""})),children:[t.jsx("option",{value:"Mouse",children:"Mouse"}),t.jsx("option",{value:"Rat",children:"Rat"}),t.jsx("option",{value:"Chick",children:"Chick"}),t.jsx("option",{value:"Other",children:"Other"})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Size"}),y.feed==="Mouse"||y.feed==="Rat"?t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:y.size||"",onChange:j=>_(P=>({...P,size:j.target.value})),children:[t.jsx("option",{value:"pinky",children:"pinky"}),t.jsx("option",{value:"fuzzy",children:"fuzzy"}),t.jsx("option",{value:"medium",children:"medium"}),t.jsx("option",{value:"adult",children:"adult"}),t.jsx("option",{value:"Other",children:"Other"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:y.size||"",onChange:j=>_(P=>({...P,size:j.target.value})),children:[t.jsx("option",{value:"",children:"Select"}),t.jsx("option",{value:"Other",children:"Other"})]}),y.size==="Other"&&t.jsx("input",{className:"mt-2 w-full px-2 py-1 border rounded",placeholder:"Custom size",value:y.sizeDetail||"",onChange:j=>_(P=>({...P,sizeDetail:j.target.value}))})]}),y.size==="Other"&&y.feed!=="Mouse"&&y.feed!=="Rat"&&t.jsx("input",{className:"mt-2 w-full px-2 py-1 border rounded",placeholder:"Custom size",value:y.sizeDetail||"",onChange:j=>_(P=>({...P,sizeDetail:j.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Weight (g)"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",type:"number",value:y.grams,onChange:j=>_(P=>({...P,grams:j.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Form"}),t.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:y.form||"",onChange:j=>_(P=>({...P,form:j.target.value})),children:[t.jsx("option",{value:"",children:"Select"}),t.jsx("option",{value:"Live",children:"Live"}),t.jsx("option",{value:"Freshly killed",children:"Freshly killed"}),t.jsx("option",{value:"Frozen/thawed",children:"Frozen/thawed"}),t.jsx("option",{value:"Other",children:"Other"})]}),y.form==="Other"&&t.jsx("input",{className:"mt-2 w-full px-2 py-1 border rounded",placeholder:"Method details",value:y.formDetail||"",onChange:j=>_(P=>({...P,formDetail:j.target.value}))})]})]}),A.toLowerCase().includes("weight")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Grams"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",type:"number",value:y.grams,onChange:j=>_(P=>({...P,grams:j.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Recent progress"}),t.jsx(Zc,{data:H})]})]}),A.toLowerCase().includes("med")&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Drug"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",value:y.drug,onChange:j=>_(P=>({...P,drug:j.target.value}))})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Dose"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",value:y.dose,onChange:j=>_(P=>({...P,dose:j.target.value}))})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-neutral-500",children:"Notes"}),t.jsx("input",{className:"w-full px-2 py-1 border rounded",value:y.notes,onChange:j=>_(P=>({...P,notes:j.target.value}))})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"px-2 py-1 border rounded",onClick:j=>{j.stopPropagation(),k()},children:"Cancel"}),t.jsx("button",{className:"px-2 py-1 border rounded text-rose-600",onClick:j=>{j.stopPropagation(),oe(A,{forceRefused:!0})},children:"Refused feed"}),t.jsx("button",{className:"px-2 py-1 bg-emerald-500 text-white rounded",onClick:j=>{j.stopPropagation(),oe(A)},children:"Add"})]})]})]})}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Assign group"}),t.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[a.map(j=>t.jsxs("label",{className:"inline-flex items-center gap-1 px-2 py-0.5 border rounded-lg bg-white text-[11px] min-w-0",children:[t.jsx("input",{type:"radio",name:`group-${e.id}`,className:"w-3 h-3",checked:(e.groups||[]).includes(j),onChange:()=>{r&&r(P=>P.map(te=>te.id===e.id?{...te,groups:[j]}:te))}}),t.jsx("span",{className:"truncate max-w-[8rem]",children:j})]},j)),t.jsxs("label",{className:"inline-flex items-center gap-1 px-2 py-0.5 border rounded-lg bg-white text-[11px]",children:[t.jsx("input",{type:"radio",name:`group-${e.id}`,className:"w-3 h-3",checked:!(e.groups||[]).length,onChange:()=>{r&&r(j=>j.map(P=>P.id===e.id?{...P,groups:[]}:P))}}),t.jsx("span",{children:"None"})]})]})]}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsx(td,{status:G}),t.jsx("div",{className:"text-xs",children:G})]}),T==="F"&&g.length>0&&t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Breeding cycles"}),t.jsx("div",{className:"flex flex-col gap-1 max-h-40 overflow-auto pr-1",children:g.map(j=>t.jsxs("div",{className:"rounded-lg border bg-neutral-50 p-2 space-y-1",children:[t.jsx("div",{className:"text-[10px] font-semibold uppercase text-neutral-500",children:j.year}),j.cycles.map(P=>{var te;return t.jsxs("div",{className:"rounded-lg border bg-white px-2 py-1 text-[11px] space-y-1",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("div",{className:"font-medium truncate",children:P.label}),d&&P.id&&t.jsx("button",{className:"text-[10px] px-1.5 py-0.5 border rounded-lg",onClick:()=>d(P.id),children:"Open"})]}),t.jsxs("div",{className:"space-y-0.5 text-neutral-700",children:[P.locks&&P.locks.length?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Locks:"})," ",t.jsx("span",{children:P.locks.map(X=>X.display||We(X.iso)).filter(Boolean).join(", ")})]}):null,P.ovulationDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Ovulation:"})," ",t.jsx("span",{children:ve(P.ovulationDate)})]}):null,P.preLayDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Pre-Lay Shed:"})," ",t.jsx("span",{children:ve(P.preLayDate)})]}):null,P.clutchDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Eggs laid:"})," ",t.jsx("span",{children:ve(P.clutchDate)})]}):null,P.hatchDate?t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-600",children:"Hatched:"})," ",t.jsx("span",{children:ve(P.hatchDate)})]}):null,!((te=P.locks)!=null&&te.length)&&!P.ovulationDate&&!P.preLayDate&&!P.clutchDate&&!P.hatchDate?t.jsx("div",{className:"text-neutral-500",children:"No cycle events recorded."}):null]})]},P.id)})]},j.year))})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"text-xs text-neutral-500 mb-1",children:"Pairings"}),(()=>{const j=c.filter(te=>te.maleId===e.id||te.femaleId===e.id),P=j.slice(0,3);return t.jsxs("div",{className:"flex flex-col gap-1 max-h-36 overflow-auto",children:[P.map(te=>t.jsxs("button",{className:"text-sm text-left px-2 py-1 rounded-lg border hover:bg-neutral-50 min-w-0",onClick:()=>d?d(te.id):null,children:[t.jsx("div",{className:"font-medium truncate",children:te.label||`${te.femaleId} × ${te.maleId}`}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Start: ",te.startDate?ve(te.startDate):"—"]})]},te.id)),j.length===0&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No pairings"}),j.length>3&&t.jsxs("button",{className:"text-xs mt-1 px-2 py-1 border rounded-lg text-neutral-700",onClick:()=>S(!0),children:["+",j.length-3," more"]})]})})()]}),N&&t.jsx(ed,{snake:e,pairings:c.filter(j=>j.maleId===e.id||j.femaleId===e.id),onClose:()=>S(!1),onOpenPairing:j=>{S(!1),d&&d(j)}})]})}function Zc({data:e=[]}){const s="#0ea5e9",a={top:18,right:28,bottom:32,left:42},r=320-a.left-a.right,o=140-a.top-a.bottom,c=h.useMemo(()=>`weight-gradient-${Math.random().toString(36).slice(2,8)}`,[]);if(!Array.isArray(e)||e.length===0)return t.jsx("div",{className:"mt-2 border rounded-lg bg-neutral-50 px-3 py-4 text-xs text-neutral-500",children:"No weight history yet. Log a weight to start tracking progress."});const d=e.map(L=>L.grams),u=Math.min(...d),p=Math.max(...d)-u||1,b=a.top+o,f=L=>new Intl.NumberFormat(void 0,{maximumFractionDigits:1}).format(L),N=e.map((L,T)=>{const G=e.length===1?.5:T/(e.length-1),H=a.left+r*G,ee=a.top+o-(L.grams-u)/p*o;return{x:H,y:ee,grams:L.grams,label:L.label||""}}),S=N.map((L,T)=>`${T===0?"M":"L"}${L.x.toFixed(2)} ${L.y.toFixed(2)}`).join(" "),A=N.length>1?`${S} L${N[N.length-1].x.toFixed(2)} ${b.toFixed(2)} L${N[0].x.toFixed(2)} ${b.toFixed(2)} Z`:null,E=N[N.length-1],y=N[0],_=E.grams-y.grams,U=`${_>=0?"+":""}${f(_)} g`;return t.jsxs("div",{className:"mt-2 border rounded-lg bg-neutral-50 p-3",children:[t.jsxs("svg",{viewBox:"0 0 320 140",role:"img","aria-label":"Weight trend chart",className:"w-full h-32",children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:c,x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"0%",stopColor:s,stopOpacity:"0.28"}),t.jsx("stop",{offset:"100%",stopColor:s,stopOpacity:"0"})]})}),t.jsx("rect",{x:a.left,y:a.top,width:r,height:o,fill:"#f8fafc",rx:12}),t.jsx("line",{x1:a.left,y1:b,x2:a.left+r,y2:b,stroke:"#e2e8f0",strokeDasharray:"4 4"}),A?t.jsx("path",{d:A,fill:`url(#${c})`}):null,t.jsx("path",{d:S,fill:"none",stroke:s,strokeWidth:2.5,strokeLinejoin:"round",strokeLinecap:"round"}),N.map((L,T)=>t.jsx("circle",{cx:L.x,cy:L.y,r:4,fill:"#fff",stroke:s,strokeWidth:2},`weight-point-${T}`))]}),t.jsxs("div",{className:"mt-2 text-[11px] text-neutral-600 grid grid-cols-2 gap-y-1",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-neutral-700",children:"Latest:"})," ",f(E.grams)," g"]}),t.jsxs("div",{className:"text-right",children:[t.jsx("span",{className:"font-semibold text-neutral-700",children:"Change:"})," ",U]}),t.jsx("div",{className:"col-span-2 text-neutral-500",children:N.length>1?`From ${y.label} to ${E.label}`:`Logged on ${E.label}`})]}),N.length>1&&t.jsxs("div",{className:"mt-1 flex justify-between text-[10px] uppercase tracking-wide text-neutral-400",children:[t.jsx("span",{children:e[0].label}),t.jsx("span",{children:e[e.length-1].label})]})]})}function ed({snake:e,pairings:s,onClose:n,onOpenPairing:l}){return t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50",onClick:n,children:t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow w-full max-w-md",onClick:a=>a.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:["Pairings for ",e.name]}),t.jsx("div",{className:"text-xs text-neutral-500",children:"Click a pairing to open it."})]}),t.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:n,children:"Close"})]}),t.jsx("div",{className:"mt-3 space-y-2 max-h-72 overflow-auto",children:s.length?s.map(a=>t.jsxs("div",{className:"p-2 border rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-medium truncate",children:a.label}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Start: ",a.startDate?ve(a.startDate):"—"]})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>l&&l(a.id),children:"Open"})})]}),t.jsxs("div",{className:"mt-2 text-xs",children:["Appointments:",t.jsx("div",{className:"mt-1 space-y-1",children:(a.appointments||[]).map(r=>t.jsxs("div",{className:"text-[11px] px-2 py-1 rounded border bg-neutral-50",children:[ve(r.date)," ",r.notes?`• ${r.notes}`:""]},r.id))})]})]},a.id)):t.jsx("div",{className:"text-sm text-neutral-500",children:"No pairings"})})]})})}function td({status:e}){const s=e==="Active"?"bg-emerald-500":e==="Hold"?"bg-amber-500":"bg-rose-500";return t.jsx("span",{className:ne("inline-block w-2 h-2 rounded-full",s)})}function sd(e,s,n){const l=String(s||"").trim().toLowerCase(),a=l?l.split(/\s+/).filter(Boolean):[],r=String(n).trim().toLowerCase();return e.filter(o=>{if(!o||r!=="all"&&!(Array.isArray(o.tags)?o.tags:[]).some(m=>String(m||"").trim().toLowerCase()===r))return!1;if(!a.length)return!0;const c=at(o.morphs,o.hets,o.possibleHets),d=[o.id,o.name,...Array.isArray(c)?c:[],o.morphHetInput,...Array.isArray(o.morphs)?o.morphs:[],...Array.isArray(o.hets)?o.hets:[],...Array.isArray(o.tags)?o.tags:[],...Array.isArray(o.groups)?o.groups:[]].map(u=>String(u||"").trim().toLowerCase()).filter(Boolean);return d.length?a.every(u=>d.some(m=>m.includes(u))):!1})}function el({onAdd:e}){const[s,n]=h.useState("");return t.jsxs("div",{className:"flex gap-2 px-2",children:[t.jsx("input",{className:"flex-1 border rounded-lg px-2 py-1 text-sm",placeholder:"Add new group",value:s,onChange:l=>n(l.target.value)}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const l=s.trim();l&&(e(l),n(""))},children:"Add"})]})}function nd({breederInfo:e,setBreederInfo:s,theme:n="blue",onSaved:l,createBackupPayload:a,onRestoreBackup:r,backupSettings:o,updateBackupSettings:c,autoBackupSnapshot:d,onTriggerAutoBackup:u,backupVault:m,onCreateVaultEntry:p,onRenameVaultEntry:b,onDeleteVaultEntry:f,snakes:N,pairings:S,animalExportFields:A,setAnimalExportFields:E,pairingExportFields:y,setPairingExportFields:_,exportFeedback:U,setExportFeedback:L}){const T=Jt(e),G=h.useMemo(()=>Ns(T.idGenerator),[T.idGenerator]),H=h.useCallback(C=>{s(O=>{const Q=Jt(O),ge=typeof C=="function"?C(Q):C;return Jt(ge)})},[s]),ee=h.useCallback(C=>{H(O=>{const Q={...O.idGenerator,...C||{}};return{...O,idGenerator:Ns(Q)}})},[H]),g=h.useCallback(()=>{H(C=>({...C,idGenerator:sr()}))},[H]),I=h.useCallback(C=>{const O=G.template||"",Q=C==="[-]"?"[-]":C,ge=St.current,Le=(Ye,nt)=>{st.current={start:Ye,end:nt}};if(C!=="[-]"&&O.includes(Q)){const Ye=O.indexOf(Q);if(Ye===-1)return;const nt=`${O.slice(0,Ye)}${O.slice(Ye+Q.length)}`;Nt.current={start:Ye,end:Ye,focus:!0},Le(Ye,Ye),ee({template:nt});return}let Be=O.length,Oe=O.length;if(ge&&typeof ge.selectionStart=="number"&&typeof ge.selectionEnd=="number")Be=ge.selectionStart,Oe=ge.selectionEnd;else if(st.current){const{start:Ye,end:nt}=st.current;typeof Ye=="number"&&typeof nt=="number"&&(Be=Ye,Oe=nt)}const Ge=`${O.slice(0,Be)}${Q}${O.slice(Oe)}`,Ke=Be+Q.length;Nt.current={start:Ke,end:Ke,focus:!0},Le(Ke,Ke),ee({template:Ge})},[G.template,ee]),D=h.useCallback(()=>{const C=St.current;if(!C)return;const O=typeof C.selectionStart=="number"?C.selectionStart:C.value.length,Q=typeof C.selectionEnd=="number"?C.selectionEnd:O;st.current={start:O,end:Q}},[]),[k,oe]=h.useState("info"),[$,j]=h.useState(null),[P,te]=h.useState(null),X=h.useRef(null),ce=h.useRef(null),q=h.useMemo(()=>Wt(o),[o]),V=h.useMemo(()=>Array.isArray(m)?m:[],[m]),re=h.useMemo(()=>ms(A,xs,Qt),[A]),ae=h.useMemo(()=>ms(y,gs,Kt),[y]),pe=h.useMemo(()=>sa(Qt),[]),we=h.useMemo(()=>sa(Kt),[]),Ie=h.useMemo(()=>new Set(re),[re]),Y=h.useMemo(()=>new Set(ae),[ae]),ue=typeof q.maxVaultEntries=="number"&&q.maxVaultEntries>0?String(q.maxVaultEntries):"unlimited",M=q.maxVaultEntries?`Keeping the latest ${q.maxVaultEntries} backups. Oldest entries are pruned automatically.`:"Keeping all backups (no limit).",R=h.useMemo(()=>{if(!d||typeof d!="object")return null;const C=d.payload||{};return{snakes:Array.isArray(C.snakes)?C.snakes.length:0,pairings:Array.isArray(C.pairings)?C.pairings.length:0,groups:Array.isArray(C.groups)?C.groups.length:0}},[d]),W=q.lastRun?We(q.lastRun):"Never",ie=($==null?void 0:$.context)==="manual"?$:null,he=$&&typeof $.context=="string"&&$.context.startsWith("auto")?$:null,be=$&&typeof $.context=="string"&&$.context.startsWith("vault")?$:null,Ce=U&&U.context==="animals"?U:null,je=U&&U.context==="pairings"?U:null,Ne=Array.isArray(N)&&N.length>0,Z=Array.isArray(S)&&S.length>0,[z,J]=h.useState(()=>T.name||T.businessName||Ts.name),[fe,ke]=h.useState(()=>Ts.year),[_e,Fe]=h.useState(()=>Ts.birthYear),[Pe,ye]=h.useState(Ts.sex),[Xe,me]=h.useState(1),[Ae,tt]=h.useState(()=>Ts.genes||""),St=h.useRef(null),Nt=h.useRef(null),st=h.useRef({start:null,end:null}),kt=h.useCallback(()=>{if(typeof a!="function"){j({type:"error",message:"Backup export is unavailable.",context:"manual",timestamp:new Date().toISOString()});return}try{const C=a(),O=JSON.stringify(C,null,2),Q=new Date().toISOString(),ge=Q.replace(/[:.]/g,"-");if(typeof window>"u"||typeof document>"u")throw new Error("Downloads are not supported in this environment.");const Le=In("breeding-planner-backup",ge),Be=new Blob([O],{type:Ls}),Oe=URL.createObjectURL(Be),Ge=document.createElement("a");Ge.href=Oe,Ge.download=Le,document.body.appendChild(Ge),Ge.click(),document.body.removeChild(Ge),window.setTimeout(()=>URL.revokeObjectURL(Oe),1e3),j({type:"success",message:`Backup downloaded (${Array.isArray(C.snakes)?C.snakes.length:0} snakes, ${Array.isArray(C.pairings)?C.pairings.length:0} pairings).`,context:"manual",timestamp:Q})}catch(C){console.error(C),j({type:"error",message:(C==null?void 0:C.message)||"Unable to download backup.",context:"manual",timestamp:new Date().toISOString()})}},[a]),vt=h.useCallback(()=>{if(typeof a!="function"||typeof p!="function"){j({type:"error",message:"Backup vault is unavailable.",context:"vault",timestamp:new Date().toISOString()});return}try{const C=a(),O=new Date().toISOString();let Q=`Manual backup • ${We(O)}`;if(typeof window<"u"&&typeof window.prompt=="function"){const Le=window.prompt("Name this backup file",Q);Le&&Le.trim()&&(Q=Le.trim())}const ge=p(C,{source:"manual",name:Q,savedAt:O});j({type:ge?"success":"error",message:ge?`Saved “${ge.name}” to the backup vault.`:"Failed to save backup to the vault.",context:"vault",timestamp:O})}catch(C){console.error(C),j({type:"error",message:(C==null?void 0:C.message)||"Unable to save the backup to the vault.",context:"vault",timestamp:new Date().toISOString()})}},[a,p]),Ut=h.useCallback(()=>{if(!d||!d.payload){j({type:"error",message:"No automatic backup is available yet.",context:"auto-download",timestamp:new Date().toISOString()});return}try{if(typeof window>"u"||typeof document>"u")throw new Error("Downloads are not supported in this environment.");const C=d.payload,O=JSON.stringify(C,null,2),ge=(d.savedAt||new Date().toISOString()).replace(/[:.]/g,"-"),Le=In("breeding-planner-auto-backup",ge),Be=new Blob([O],{type:Ls}),Oe=URL.createObjectURL(Be),Ge=document.createElement("a");Ge.href=Oe,Ge.download=Le,document.body.appendChild(Ge),Ge.click(),document.body.removeChild(Ge),window.setTimeout(()=>URL.revokeObjectURL(Oe),1e3),j({type:"success",message:"Latest automatic backup downloaded.",context:"auto-download",timestamp:new Date().toISOString()})}catch(C){console.error(C),j({type:"error",message:(C==null?void 0:C.message)||"Unable to download the automatic backup.",context:"auto-download",timestamp:new Date().toISOString()})}},[d]),zt=h.useCallback(C=>{E(O=>{const Q=ms(O,xs,Qt);return C?Q.includes(C)?Q.length<=1?Q:Q.filter(Le=>Le!==C):[...Q,C]:Q})},[E]),as=h.useCallback(()=>{E(Qt.map(C=>C.key))},[E]),ws=h.useCallback(()=>{E([...xs])},[E]),wt=h.useCallback(C=>{_(O=>{const Q=ms(O,gs,Kt);return C?Q.includes(C)?Q.length<=1?Q:Q.filter(Le=>Le!==C):[...Q,C]:Q})},[_]),ct=h.useCallback(()=>{_(Kt.map(C=>C.key))},[_]),At=h.useCallback(()=>{_([...gs])},[_]),js=h.useCallback(async()=>{const C=new Date().toISOString();try{const O=Jr(N,S,re);if(!O.columns.length)throw new Error("Select at least one field before exporting.");if(!O.rows.length)throw new Error("No animals available to export.");const Q=C.replace(/[:.]/g,"-");await ea(O,{title:"Animals export",subtitle:`${O.rows.length} animals • ${O.columns.length} fields`,fileName:`animals-export-${Q}.pdf`}),L({type:"success",message:`Exported ${O.rows.length} animals to PDF.`,context:"animals",timestamp:new Date().toISOString()})}catch(O){console.error("Animals PDF export failed",O),L({type:"error",message:(O==null?void 0:O.message)||"Failed to export animals to PDF.",context:"animals",timestamp:new Date().toISOString()})}},[N,S,re,L]),zs=h.useCallback(async()=>{const C=new Date().toISOString();try{const O=Jr(N,S,re);if(!O.columns.length)throw new Error("Select at least one field before exporting.");if(!O.rows.length)throw new Error("No animals available to export.");const Q=C.replace(/[:.]/g,"-");await ta(O,{fileName:`animals-export-${Q}.xlsx`,sheetName:"Animals"}),L({type:"success",message:`Exported ${O.rows.length} animals to spreadsheet.`,context:"animals",timestamp:new Date().toISOString()})}catch(O){console.error("Animals sheet export failed",O),L({type:"error",message:(O==null?void 0:O.message)||"Failed to export animals to spreadsheet.",context:"animals",timestamp:new Date().toISOString()})}},[N,S,re,L]),Gs=h.useCallback(async()=>{const C=new Date().toISOString();try{const O=Zr(S,N,ae);if(!O.columns.length)throw new Error("Select at least one field before exporting.");if(!O.rows.length)throw new Error("No breeding projects available to export.");const Q=C.replace(/[:.]/g,"-");await ea(O,{title:"Breeding projects export",subtitle:`${O.rows.length} projects • ${O.columns.length} fields`,fileName:`pairings-export-${Q}.pdf`}),L({type:"success",message:`Exported ${O.rows.length} projects to PDF.`,context:"pairings",timestamp:new Date().toISOString()})}catch(O){console.error("Pairings PDF export failed",O),L({type:"error",message:(O==null?void 0:O.message)||"Failed to export breeding projects to PDF.",context:"pairings",timestamp:new Date().toISOString()})}},[S,N,ae,L]),Cs=h.useCallback(async()=>{const C=new Date().toISOString();try{const O=Zr(S,N,ae);if(!O.columns.length)throw new Error("Select at least one field before exporting.");if(!O.rows.length)throw new Error("No breeding projects available to export.");const Q=C.replace(/[:.]/g,"-");await ta(O,{fileName:`pairings-export-${Q}.xlsx`,sheetName:"Pairings"}),L({type:"success",message:`Exported ${O.rows.length} projects to spreadsheet.`,context:"pairings",timestamp:new Date().toISOString()})}catch(O){console.error("Pairings sheet export failed",O),L({type:"error",message:(O==null?void 0:O.message)||"Failed to export breeding projects to spreadsheet.",context:"pairings",timestamp:new Date().toISOString()})}},[S,N,ae,L]),Hs=h.useCallback(C=>{var Q;const O=((Q=C==null?void 0:C.target)==null?void 0:Q.value)||"off";typeof c=="function"&&c({frequency:O})},[c]),Gt=h.useCallback(C=>{var ge;if(typeof c!="function")return;const O=(ge=C==null?void 0:C.target)==null?void 0:ge.value;if(O==="unlimited"){c({maxVaultEntries:"unlimited"});return}const Q=parseInt(O,10);Number.isFinite(Q)&&Q>0&&c({maxVaultEntries:Q})},[c]),Ss=h.useCallback(()=>{if(typeof u!="function"){j({type:"error",message:"Automatic backup is unavailable.",context:"auto",timestamp:new Date().toISOString()});return}try{u(),j({type:"success",message:"Automatic backup created.",context:"auto",timestamp:new Date().toISOString()})}catch(C){console.error(C),j({type:"error",message:(C==null?void 0:C.message)||"Automatic backup failed.",context:"auto",timestamp:new Date().toISOString()})}},[u]),ks=h.useCallback(C=>{const O=V.find(Q=>Q.id===C);if(!O){j({type:"error",message:"Backup file not found.",context:"vault-download",timestamp:new Date().toISOString()});return}try{if(typeof window>"u"||typeof document>"u")throw new Error("Downloads are not supported in this environment.");const Q=JSON.stringify(O.payload,null,2),Le=O.name.replace(/[\\/:*?"<>|]+/g,"-")||"breeding-planner-backup",Be=In(Le,O.id),Oe=new Blob([Q],{type:Ls}),Ge=URL.createObjectURL(Oe),Ke=document.createElement("a");Ke.href=Ge,Ke.download=Be,document.body.appendChild(Ke),Ke.click(),document.body.removeChild(Ke),window.setTimeout(()=>URL.revokeObjectURL(Ge),1e3),j({type:"success",message:`Downloaded “${O.name}”.`,context:"vault-download",timestamp:new Date().toISOString()})}catch(Q){console.error(Q),j({type:"error",message:(Q==null?void 0:Q.message)||"Unable to download the backup.",context:"vault-download",timestamp:new Date().toISOString()})}},[V]),dt=h.useCallback(C=>{const O=V.find(Q=>Q.id===C);if(!O){te({type:"error",message:"Backup file not found.",timestamp:new Date().toISOString()});return}try{if(typeof r!="function")throw new Error("Restore handler is unavailable.");r(O.payload),te({type:"success",message:`Restored data from “${O.name}”.`,timestamp:new Date().toISOString()})}catch(Q){console.error(Q),te({type:"error",message:(Q==null?void 0:Q.message)||"Failed to restore backup.",timestamp:new Date().toISOString()})}},[V,r]),As=h.useCallback(C=>{if(typeof b!="function")return;const O=V.find(Q=>Q.id===C);if(O&&typeof window<"u"&&typeof window.prompt=="function"){const Q=window.prompt("Rename backup",O.name);Q&&Q.trim()&&(b(C,Q.trim()),j({type:"success",message:`Renamed backup to “${Q.trim()}”.`,context:"vault-rename",timestamp:new Date().toISOString()}))}},[b,V]),Ds=h.useCallback(C=>{if(typeof f!="function")return;const O=V.find(ge=>ge.id===C);if(!O)return;let Q=!0;typeof window<"u"&&typeof window.confirm=="function"&&(Q=window.confirm(`Delete “${O.name}”? This cannot be undone.`)),Q&&(f(C),j({type:"success",message:`Deleted “${O.name}”.`,context:"vault-delete",timestamp:new Date().toISOString()}))},[f,V]),Ht=h.useCallback(async C=>{var Q,ge,Le,Be;const O=(ge=(Q=C==null?void 0:C.target)==null?void 0:Q.files)==null?void 0:ge[0];if(O)try{const Oe=((Be=(Le=C==null?void 0:C.target)==null?void 0:Le.dataset)==null?void 0:Be.allowLegacyJson)==="true",Ge=typeof O.name=="string"?O.name:"",Ke=Ge.toLowerCase(),Ye=!!Ge&&Ke.endsWith(us),nt=!!Ge&&Ke.endsWith(".json");if(!Ye&&(!Oe||!nt))throw new Error(`Select a ${us} backup${Oe?" or legacy .json file":""}.`);if(O.type){const $e=O.type.toLowerCase(),Ct=[Ls,"application/octet-stream"],Bt=["application/json","text/json","application/octet-stream"];if(Ye&&!Ct.includes($e))throw new Error("Unsupported backup file type.");if(!Ye&&Oe&&nt&&!Bt.includes($e))throw new Error("Unsupported legacy backup file type.")}const gn=await O.text(),jt=JSON.parse(gn);if(typeof r!="function")throw new Error("Restore handler is unavailable.");await Promise.resolve(r(jt)),te({type:"success",message:`Restored data from ${O.name}`,timestamp:new Date().toISOString()})}catch(Oe){console.error(Oe),te({type:"error",message:(Oe==null?void 0:Oe.message)||"Failed to restore backup.",timestamp:new Date().toISOString()})}finally{C!=null&&C.target&&(C.target.value="")}},[r]);h.useEffect(()=>{const C=T.name||T.businessName;C&&!z&&J(C)},[T.name,T.businessName,z]),h.useEffect(()=>{var Q;const C=Nt.current;if(!C)return;const O=St.current;if(O)try{C.focus&&O.focus();const ge=((Q=O.value)==null?void 0:Q.length)??0,Le=Math.max(0,Math.min(C.start??ge,ge)),Be=Math.max(0,Math.min(C.end??ge,ge));O.setSelectionRange(Le,Be),st.current={start:Le,end:Be}}catch{}Nt.current=null},[G.template]);const xn=h.useMemo(()=>{try{const C=Number(fe),O=Number.isFinite(C)&&C>0?C:new Date().getFullYear(),Q=Number(_e),ge=Number.isFinite(Q)&&Q>0?Q:O,Le=Number(Xe),Be=Number.isFinite(Le)&&Le>0?Le:1,Oe=hs(Ae),Ge=Oe.morphs||[],Ke=Oe.hets||[],Ye=Qa({name:z,rawName:z,morphs:Ge,hets:Ke,year:O,sex:Pe,birthYear:ge});return Ka(G,Ye,Be)}catch{return"Template error"}},[G,z,fe,_e,Pe,Xe,Ae]);return t.jsxs(Us,{title:"Setup",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4",children:[t.jsx(et,{theme:n,active:k==="info",onClick:()=>oe("info"),children:"Breeder info"}),t.jsx(et,{theme:n,active:k==="id",onClick:()=>oe("id"),children:"ID wizard"}),t.jsx(et,{theme:n,active:k==="export",onClick:()=>oe("export"),children:"Data exports"}),t.jsx(et,{theme:n,active:k==="backup",onClick:()=>oe("backup"),children:"Backups"})]}),k==="info"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:T.name,onChange:C=>H(O=>({...O,name:C.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Business name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:T.businessName,onChange:C=>H(O=>({...O,businessName:C.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Email"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:T.email,onChange:C=>H(O=>({...O,email:C.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Phone"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:T.phone,onChange:C=>H(O=>({...O,phone:C.target.value}))})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Logo"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("input",{id:"breeder-logo-upload",type:"file",accept:"image/*",className:"hidden",onChange:async C=>{const O=C.target.files&&C.target.files[0];if(O)try{const Q=await qa(O);H(ge=>({...ge,logoUrl:Q}))}catch(Q){console.error(Q)}}}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:()=>{const C=document.getElementById("breeder-logo-upload");C&&C.click()},children:"Upload logo"}),T.logoUrl&&t.jsx("img",{src:T.logoUrl,alt:"logo",className:"w-20 h-20 object-cover rounded-md border"})]})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{className:ne("px-3 py-2 rounded-lg text-white",Ee(n,!0)),onClick:()=>{alert("Breeder info saved locally for this demo"),typeof l=="function"&&l()},children:"Save"})})]}),k==="id"&&t.jsxs("div",{className:"border-t pt-4 space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"ID generator wizard"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Define how automatic IDs are created when you add animals, generate hatchlings, or import data."})]}),t.jsx("button",{type:"button",className:"text-xs px-2 py-1 border rounded-lg",onClick:g,children:"Reset to default"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Template"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2 font-mono text-sm",ref:St,value:G.template,onChange:C=>{ee({template:C.target.value}),D()},onSelect:D,onKeyUp:D,onClick:D,onFocus:D,onBlur:D,placeholder:pn.template}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Use tokens such as ",t.jsx("code",{children:"[YROB]"}),", ",t.jsx("code",{children:"[GEN3]"}),", ",t.jsx("code",{children:"[SEX]"}),", and ",t.jsx("code",{children:"[SEQ]"}),". The sequence token is required—well append it automatically if you omit it."]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sequence padding"}),t.jsx("input",{type:"number",min:1,max:6,className:"mt-1 w-full border rounded-xl px-3 py-2",value:G.sequencePadding,onChange:C=>ee({sequencePadding:parseInt(C.target.value,10)||1})}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"Pads the [SEQ] number (e.g., 001)."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Letter casing"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:G.uppercase,onChange:C=>ee({uppercase:C.target.checked})}),t.jsx("span",{className:"text-sm",children:"Force uppercase output"})]}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Uncheck to keep mixed case like ",t.jsx("em",{children:"Ath"}),"."]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Free text token value"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:G.customText,onChange:C=>ee({customText:C.target.value}),placeholder:"BREED"}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Rendered wherever ",t.jsx("code",{children:"[TEXT]"})," appears in your template."]})]})]}),t.jsxs("div",{className:"border rounded-xl bg-neutral-50 p-4 space-y-3",children:[t.jsx("div",{className:"font-medium text-sm",children:"Live preview"}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sample name"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:z,onChange:C=>J(C.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Year"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-3 py-2",value:fe,onChange:C=>ke(C.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Birth year"}),t.jsx("input",{type:"number",className:"mt-1 w-full border rounded-xl px-3 py-2",value:_e,onChange:C=>Fe(C.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sex"}),t.jsxs("select",{className:"mt-1 w-full border rounded-xl px-3 py-2 bg-white",value:Pe,onChange:C=>ye(C.target.value),children:[t.jsx("option",{value:"F",children:"Female"}),t.jsx("option",{value:"M",children:"Male"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Sequence"}),t.jsx("input",{type:"number",min:1,className:"mt-1 w-full border rounded-xl px-3 py-2",value:Xe,onChange:C=>me(C.target.value)})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Sample genes"}),t.jsx("input",{className:"mt-1 w-full border rounded-xl px-3 py-2",value:Ae,onChange:C=>tt(C.target.value),placeholder:"Enchi, Fire, Clown"}),t.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:"Comma, slash, or newline separated list. Each gene contributes a three-letter chunk."})]})]}),t.jsxs("div",{className:"text-sm",children:["Example ID: ",t.jsx("code",{className:"font-mono text-base font-semibold",children:xn})]})]}),t.jsxs("div",{className:"space-y-1 text-[11px] text-neutral-600",children:[t.jsx("div",{className:"font-semibold text-neutral-700",children:"Available tokens"}),t.jsx("div",{className:"space-y-1.5",children:lc.map(({token:C,description:O})=>{const Q=C,ge=(G.template||"").includes(Q);return t.jsxs("button",{type:"button","aria-pressed":ge,onClick:()=>I(C),className:ne("w-full flex items-center gap-3 rounded-lg border px-2 py-1.5 text-left transition",ge?"border-blue-500/60 bg-blue-50 text-blue-700 shadow-sm":"border-neutral-200 bg-white hover:border-blue-400 hover:bg-blue-50/40"),children:[t.jsx("span",{className:ne("font-mono text-[10px] px-1.5 py-0.5 rounded border",ge?"border-blue-400 bg-white text-blue-700":"border-neutral-200 bg-neutral-50 text-neutral-700"),children:C}),t.jsx("span",{className:"flex-1 text-[11px] sm:text-xs text-neutral-600",children:O}),t.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:ge?"Remove":"Add"})]},C)})})]})]}),k==="export"&&t.jsx("div",{className:"border-t pt-4 space-y-6",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Data exports"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Choose the columns to include and download PDF or spreadsheet summaries for animals and breeding projects."})]}),t.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[t.jsxs("div",{className:"border rounded-xl bg-white p-3 shadow-sm space-y-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Animals"}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Selected ",re.length," of ",Qt.length," fields."]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm text-white",Ee(n,!0),Ne?"":"opacity-60 cursor-not-allowed"),onClick:js,disabled:!Ne,children:"Export PDF"}),t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm border",Ne?"":"opacity-60 cursor-not-allowed"),onClick:zs,disabled:!Ne,children:"Export sheet (.xlsx)"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-neutral-500",children:[t.jsx("button",{type:"button",className:"underline",onClick:as,children:"Select all"}),t.jsx("button",{type:"button",className:"underline",onClick:ws,children:"Reset defaults"})]}),t.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:pe.map(C=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500",children:C.section}),t.jsx("div",{className:"space-y-1.5",children:C.fields.map(O=>{const Q=Ie.has(O.key);return t.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-700",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-neutral-300",checked:Q,onChange:()=>zt(O.key)}),t.jsx("span",{children:O.label})]},O.key)})})]},C.section))}),!Ne&&t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Add animals to enable exports."}),Ce&&t.jsxs("div",{className:ne("text-xs",Ce.type==="success"?"text-emerald-600":"text-red-600"),children:[Ce.message,Ce.timestamp?` • ${We(Ce.timestamp)}`:""]})]}),t.jsxs("div",{className:"border rounded-xl bg-white p-3 shadow-sm space-y-3",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Breeding projects"}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Selected ",ae.length," of ",Kt.length," fields."]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm text-white",Ee(n,!0),Z?"":"opacity-60 cursor-not-allowed"),onClick:Gs,disabled:!Z,children:"Export PDF"}),t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm border",Z?"":"opacity-60 cursor-not-allowed"),onClick:Cs,disabled:!Z,children:"Export sheet (.xlsx)"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-neutral-500",children:[t.jsx("button",{type:"button",className:"underline",onClick:ct,children:"Select all"}),t.jsx("button",{type:"button",className:"underline",onClick:At,children:"Reset defaults"})]}),t.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:we.map(C=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-wide text-neutral-500",children:C.section}),t.jsx("div",{className:"space-y-1.5",children:C.fields.map(O=>{const Q=Y.has(O.key);return t.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-700",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-neutral-300",checked:Q,onChange:()=>wt(O.key)}),t.jsx("span",{children:O.label})]},O.key)})})]},C.section))}),!Z&&t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Build at least one pairing to enable exports."}),je&&t.jsxs("div",{className:ne("text-xs",je.type==="success"?"text-emerald-600":"text-red-600"),children:[je.message,je.timestamp?` • ${We(je.timestamp)}`:""]})]})]})]})}),k==="backup"&&t.jsxs("div",{className:"border-t pt-4 space-y-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Manual backup"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Download a Breeding Planner backup containing all animals, pairings, groups, breeder info, and settings."})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsxs("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm text-white",Ee(n,!0)),onClick:kt,children:["Download backup (",us,")"]}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:vt,children:"Save to vault"})]}),ie&&t.jsxs("span",{className:ne("text-xs",ie.type==="success"?"text-emerald-600":"text-red-600"),children:[ie.message,ie.timestamp?` • ${We(ie.timestamp)}`:""]})]}),t.jsxs("div",{className:"space-y-3 border-t pt-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Automatic backups"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Keep an automatic snapshot while the planner is open in your browser."})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 text-sm",children:[t.jsx("label",{className:"text-xs font-medium uppercase tracking-wide text-neutral-500",children:"Schedule"}),t.jsxs("select",{className:"border rounded-lg px-3 py-2 bg-white text-sm",value:q.frequency,onChange:Hs,children:[t.jsx("option",{value:"off",children:"Off"}),t.jsx("option",{value:"nightly",children:"Every night"}),t.jsx("option",{value:"weekly",children:"Every week"}),t.jsx("option",{value:"monthly",children:"Every month"})]})]}),t.jsxs("div",{className:"text-xs text-neutral-500",children:["Last automatic backup: ",W,".",R&&(R.snakes||R.pairings||R.groups)?t.jsxs("span",{children:[" ","Includes ",R.snakes," snakes, ",R.pairings," pairings, ",R.groups," groups."]}):null]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm text-white",Ee(n,!0)),onClick:Ss,children:"Run now"}),t.jsx("button",{type:"button",className:ne("px-3 py-2 rounded-lg text-sm border",d?"":"opacity-60 cursor-not-allowed"),onClick:Ut,disabled:!d,children:"Download latest snapshot"})]}),he&&t.jsxs("div",{className:ne("text-xs",he.type==="success"?"text-emerald-600":"text-red-600"),children:[he.message,he.timestamp?` • ${We(he.timestamp)}`:""]})]}),t.jsxs("div",{className:"space-y-3 border-t pt-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Backup vault"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Stored backups with unique identifiers. Rename, download, restore, or remove them here."})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 text-sm",children:[t.jsx("label",{className:"text-xs font-medium uppercase tracking-wide text-neutral-500",children:"Retention limit"}),t.jsx("select",{className:"border rounded-lg px-3 py-2 bg-white text-sm w-full sm:w-auto",value:ue,onChange:Gt,children:Ji.map(C=>{const O=C==="unlimited"?"unlimited":String(C),Q=C==="unlimited"?"Unlimited (no pruning)":`Keep last ${C}`;return t.jsx("option",{value:O,children:Q},O)})})]}),t.jsx("div",{className:"text-[11px] text-neutral-500",children:M}),t.jsx("div",{className:"text-xs text-neutral-500",children:V.length?`${V.length} backup${V.length===1?"":"s"} saved.`:"No backups saved yet."}),be&&t.jsxs("div",{className:ne("text-xs",be.type==="success"?"text-emerald-600":"text-red-600"),children:[be.message,be.timestamp?` • ${We(be.timestamp)}`:""]}),t.jsx("div",{className:"space-y-2",children:V.length?V.map(C=>{const O=We(C.createdAt),Q=C.updatedAt&&C.updatedAt!==C.createdAt?We(C.updatedAt):null;let ge=null;try{const Le=JSON.stringify(C.payload);ge=Math.max(1,Math.ceil(Le.length/1024))}catch{ge=null}return t.jsxs("div",{className:"border rounded-xl bg-white p-3 shadow-sm space-y-2",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm text-neutral-800",children:C.name}),t.jsxs("div",{className:"text-[11px] text-neutral-500 space-x-2",children:[t.jsx("span",{children:C.source==="auto"?"Auto backup":"Manual backup"}),t.jsxs("span",{children:["Created ",O]}),Q&&t.jsxs("span",{children:["Updated ",Q]}),ge&&t.jsxs("span",{children:["~",ge," KB"]})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg border text-xs",onClick:()=>ks(C.id),children:"Download"}),t.jsx("button",{type:"button",className:ne("px-3 py-1.5 rounded-lg text-xs text-white",Ee(n,!0)),onClick:()=>dt(C.id),children:"Restore"}),t.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg border text-xs",onClick:()=>As(C.id),children:"Rename"}),t.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-lg border text-xs text-red-600",onClick:()=>Ds(C.id),children:"Delete"})]})]}),t.jsxs("div",{className:"text-[10px] text-neutral-400 break-words",children:["ID: ",C.id]})]},C.id)}):t.jsx("div",{className:"text-xs text-neutral-500",children:"Create a manual or automatic backup to populate the vault."})})]}),t.jsxs("div",{className:"space-y-3 border-t pt-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold text-sm",children:"Restore from backup"}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Upload a Breeding Planner backup file or import a legacy JSON export to replace the current data."})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[t.jsx("input",{ref:X,type:"file",accept:`${Ls},${us}`,className:"hidden",onChange:Ht}),t.jsx("input",{ref:ce,type:"file",accept:"application/json,.json","data-allow-legacy-json":"true",className:"hidden",onChange:Ht}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:()=>{X.current&&X.current.click()},children:"Choose backup file"}),t.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border text-sm",onClick:()=>{ce.current&&ce.current.click()},children:"Import legacy JSON"}),t.jsxs("span",{className:"text-xs text-neutral-500",children:[us," or .json files"]})]}),P&&t.jsxs("div",{className:ne("text-xs",P.type==="success"?"text-emerald-600":"text-red-600"),children:[P.message,P.timestamp?` • ${We(P.timestamp)}`:""]}),t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Restoring replaces everything in the app. Download a backup first to stay safe."})]})]})]})}function rd({snakes:e,pairings:s,onDelete:n,onOpenSnake:l,onUpdatePairing:a,theme:r="blue",focusedPairingId:o=null,onFocusPairing:c,title:d,emptyMessage:u="No pairings yet. Use “New pairing”.",variant:m="default"}){const p=typeof n=="function"?n:null,b=typeof l=="function"?l:null,f=Array.isArray(s)?s:[],N=d||`Breeding Planner (${f.length})`,S=m==="collapsed",A=S?"flex flex-col gap-3":"space-y-4";return t.jsx(Us,{title:N,children:t.jsxs("div",{className:A,children:[f.map((E,y)=>t.jsx(ad,{pairing:E,pairingNumber:y+1,snakes:e,onDelete:p,onOpenSnake:b,onUpdatePairing:a,theme:r,isFocused:o===E.id,onFocus:c?()=>c(E.id):void 0,variant:m},E.id)),!f.length&&t.jsx("div",{className:ne("text-sm text-neutral-500",S&&"w-full"),children:u})]})})}function ad({pairing:e,pairingNumber:s,snakes:n,onDelete:l,onOpenSnake:a,onUpdatePairing:r,theme:o="blue",isFocused:c=!1,onFocus:d,variant:u="default"}){var we,Ie;const m=h.useRef(null),[p,b]=h.useState(!1),[f,N]=h.useState(u!=="collapsed");h.useEffect(()=>{if(c&&m.current)try{m.current.scrollIntoView({behavior:"smooth",block:"center"})}catch{}},[c]),h.useEffect(()=>{c&&typeof d=="function"&&d()},[c,d]);const S=u==="collapsed";h.useEffect(()=>{N(!S)},[S]),h.useEffect(()=>{S&&c&&N(!0)},[S,c]);const A=h.useMemo(()=>Ve(e||{}),[e]),E=h.useMemo(()=>Pt(n,A.femaleId),[n,A.femaleId]),y=h.useMemo(()=>Pt(n,A.maleId),[n,A.maleId]),_=(E==null?void 0:E.name)||A.femaleId||"Female",U=(y==null?void 0:y.name)||A.maleId||"Male",L=`${_} × ${U}`,T=h.useMemo(()=>E?at(E.morphs,E.hets,E.possibleHets):[],[E]),G=h.useMemo(()=>y?at(y.morphs,y.hets,y.possibleHets):[],[y]),H=E?T.length?T.join(", "):"Normal":"—",ee=y?G.length?G.join(", "):"Normal":"—",g=h.useCallback(Y=>{typeof r=="function"&&r(e.id,Y)},[r,e.id]);h.useEffect(()=>{g(Y=>{if(!Y)return Y;const ue=(Y.label||"").trim(),M=L;return!ue&&Y.label!==M?{...Y,label:M}:Y})},[L,g]);const I=A.label||L,D=h.useMemo(()=>tl(y,E),[y,E]),k=h.useMemo(()=>{if(!D)return!1;const Y=Array.isArray(D.perGene)?D.perGene:[],ue=Array.isArray(D.combined)?D.combined:[];return Y.length>0||ue.length>0},[D]);h.useEffect(()=>{!k&&p&&b(!1)},[k,p]);const oe=h.useMemo(()=>n.filter(Y=>{var be;if(!Y)return!1;const ue=Array.isArray(Y.tags)?Y.tags:[],M=Array.isArray(Y.groups)?Y.groups:[];if(!(ue.includes("hatchling")||M.some(Ce=>/^hatchlings\b/i.test(Ce))))return!1;const W=Y.pairingId===e.id||((be=Y==null?void 0:Y.metadata)==null?void 0:be.pairingId)===e.id,ie=Y.damId&&Y.damId===e.femaleId&&Y.sireId&&Y.sireId===e.maleId,he=typeof Y.name=="string"&&I&&Y.name.includes(I);return W||ie||he}),[n,e,I]),$=h.useMemo(()=>vs(A),[A]),j=h.useMemo(()=>fn({clutchDate:$.clutchDate,preLayDate:$.preLayDate,ovulationDate:$.ovulationDate,hatchDate:$.hatchDate,startDate:A.startDate||""}),[$.clutchDate,$.preLayDate,$.ovulationDate,$.hatchDate,A.startDate]),P=A.startDate?ve(A.startDate):"—",te=$.hatchDate||((we=A==null?void 0:A.hatch)!=null&&we.recorded?(Ie=A==null?void 0:A.hatch)==null?void 0:Ie.date:"")||$.clutchDate||"",X=te?ve(te):"—",ce=h.useCallback(()=>{g(Y=>{const ue=Ba(Y.startDate||ze(new Date),5),M={...Y,appointments:ue};return M.startDate=M.appointments&&M.appointments[0]?M.appointments[0].date:M.startDate,M})},[g]),q=h.useCallback(()=>{g(Y=>{var M;const ue=[...Y.appointments||[],{id:ys(),date:ze(new Date),lockObserved:!1,lockLoggedAt:null,notes:""}];return{...Y,appointments:ue,startDate:((M=ue[0])==null?void 0:M.date)||Y.startDate||null}})},[g]),V=h.useCallback(()=>{typeof a!="function"||!y||a(y)},[a,y]),re=h.useCallback(()=>{typeof a!="function"||!E||a(E)},[a,E]),ae=h.useCallback(async()=>{var M,R;const Y=(M=A==null?void 0:A.clutch)==null?void 0:M.date;if(!Y){alert("Please add a clutch date before generating the clutch card.");return}let ue=(R=A==null?void 0:A.clutch)==null?void 0:R.eggsTotal;if(ue===""||typeof ue>"u")ue=null;else if(typeof ue=="string"){const W=Number(ue);ue=Number.isFinite(W)?W:ue}try{const W=y?G.length?G.join(", "):"Normal":"—",ie=E?T.length?T.join(", "):"Normal":"—";await Xc({clutchNumber:s,clutchDate:Y,femaleName:_,femaleGenetics:ie,maleName:U,maleGenetics:W,eggsTotal:ue,label:I})}catch(W){console.error("Failed to generate clutch card",W),alert("Unable to generate clutch card PDF.")}},[A,s,_,U,T,G,I,E,y]),pe=ne("border rounded-xl shadow-sm bg-white focus:outline-none w-full p-3",c?"ring-2 ring-sky-400 ring-offset-1":"ring-0");return f?t.jsxs("div",{ref:m,className:pe,tabIndex:-1,children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"font-semibold leading-tight text-sm sm:text-base",children:t.jsxs("div",{className:"truncate",children:["Clutch #",s," • ",j]})}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-600 space-y-1",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"truncate text-[12px] text-neutral-800 flex items-center gap-1",children:[t.jsx("span",{className:"text-[11px] text-neutral-500",children:"♂"}),typeof a=="function"&&y?t.jsx("button",{type:"button",className:"truncate font-medium text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:V,children:U}):t.jsx("span",{className:"truncate font-medium",children:U})]}),t.jsx("div",{className:"truncate",children:ee})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"truncate text-[12px] text-neutral-800 flex items-center gap-1",children:[t.jsx("span",{className:"text-[11px] text-neutral-500",children:"♀"}),typeof a=="function"&&E?t.jsx("button",{type:"button",className:"truncate font-medium text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:re,children:_}):t.jsx("span",{className:"truncate font-medium",children:_})]}),t.jsx("div",{className:"truncate",children:H})]})]}),t.jsx("div",{className:"flex gap-1 flex-wrap mt-1",children:(e.goals||[]).slice(0,4).map(Y=>t.jsx(Ja,{children:Y},Y))})]}),t.jsxs("div",{className:"flex gap-2 shrink-0",children:[typeof l=="function"&&t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>l(e.id),children:"Delete"}),f&&t.jsx("button",{type:"button",className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>N(!1),children:"Collapse"})]})]}),t.jsxs("div",{className:"mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Label"}),t.jsx("input",{className:"w-full border rounded-xl px-3 py-2 text-sm",value:I,onChange:Y=>g(ue=>({...ue,label:Y.target.value}))})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Starting date"}),t.jsx("input",{type:"date",className:"w-full border rounded-xl px-3 py-2 text-sm",value:A.startDate||"",onChange:Y=>g(ue=>({...ue,startDate:Y.target.value}))})]})]}),t.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] gap-3 min-w-0",children:[t.jsxs("div",{className:"flex flex-col gap-3 min-w-0",children:[t.jsxs("div",{className:"border rounded-2xl bg-white shadow-sm p-3 flex flex-col gap-3 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Appointments"}),t.jsx("div",{className:"text-[13px] text-neutral-500",children:"Manage pairing touchpoints"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:ce,children:"Generate 5 months"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:q,children:"+ Add appointment"})]})]}),t.jsxs("div",{className:"flex-1 flex flex-col gap-2 min-w-0",children:[(A.appointments||[]).map((Y,ue)=>t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[minmax(0,150px)_minmax(0,1fr)_auto] gap-2 items-center min-w-0",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-sm min-w-0",value:Y.date,onChange:M=>{const R=M.target.value;g(W=>{const ie=[...W.appointments||[]];return ie[ue]={...ie[ue],date:R},{...W,appointments:ie}})}}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3 gap-1",children:[t.jsxs("label",{className:"inline-flex items-center gap-2 text-xs",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!Y.lockObserved,onChange:M=>{const R=M.target.checked;g(W=>{const ie=[...W.appointments||[]],he=ie[ue]||{};let be=he.notes||"",Ce=he.lockLoggedAt||null;if(R){const je=Yi();Ce=je,be=Wi(be,Ra(je))}else Ce=null;return ie[ue]={...he,lockObserved:R,lockLoggedAt:Ce,notes:be},{...W,appointments:ie}})}}),"Lock"]}),t.jsx("input",{placeholder:"Notes",className:"border rounded-lg px-2 py-1 text-xs flex-1 min-w-0",value:Y.notes||"",onChange:M=>{const R=M.target.value;g(W=>{const ie=[...W.appointments||[]];return ie[ue]={...ie[ue],notes:R},{...W,appointments:ie}})}})]}),t.jsx("button",{className:"text-[11px] px-2 py-1 border rounded-lg",onClick:()=>{g(M=>{var W;const R=[...M.appointments||[]];return R.splice(ue,1),{...M,appointments:R,startDate:((W=R[0])==null?void 0:W.date)||M.startDate||null}})},children:"Remove"})]},Y.id)),!(A.appointments||[]).length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No appointments yet."})]})]}),t.jsx(fd,{lifecycle:$,theme:o})]}),t.jsx(pd,{edit:A,setEdit:g,theme:o,onCreateClutchCard:ae,lifecycle:$})]}),t.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:2,className:"w-full border rounded-xl px-3 py-2 text-sm",value:A.notes||"",onChange:Y=>g(ue=>({...ue,notes:Y.target.value}))})]}),oe.length>0&&t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"Hatchlings"}),t.jsx("div",{className:"flex flex-wrap gap-1",children:oe.map(Y=>t.jsx("button",{type:"button",className:ne("px-2 py-0.5 text-xs rounded-full border bg-amber-50 text-amber-900",a?"hover:bg-amber-100 transition-colors":"cursor-default opacity-80"),onClick:a?()=>a(Y):void 0,title:Y.name||Y.id,children:Y.name||Y.id},Y.id))})]}),k&&t.jsx("div",{className:"mt-4",children:t.jsxs("div",{className:"border rounded-xl bg-neutral-50",children:[t.jsxs("button",{type:"button",className:"w-full flex items-center justify-between px-3 py-2 text-xs font-semibold text-neutral-700",onClick:()=>b(Y=>!Y),"aria-expanded":p,children:[t.jsx("span",{children:"Genetics calculator"}),t.jsx("span",{className:"text-[11px] text-neutral-500",children:p?"Hide":"Show"})]}),p&&t.jsx("div",{className:"border-t px-3 pb-3",children:t.jsx(ld,{male:y,female:E,odds:D})})]})})]}):t.jsx("button",{ref:m,type:"button",className:ne(pe,"text-left cursor-pointer"),onClick:()=>{N(!0),typeof d=="function"&&d()},"aria-expanded":!1,children:t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500 shrink-0",children:["Clutch #",s," • ",j]}),t.jsxs("div",{className:"text-[11px] text-neutral-500 flex items-center gap-1",children:[t.jsx("span",{className:"font-semibold",children:"View details"}),t.jsx("span",{"aria-hidden":"true",children:"›"})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-neutral-800",children:[t.jsxs("div",{className:"flex items-center gap-2 min-w-[12rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"♂ Male"}),typeof a=="function"&&y?t.jsx("button",{type:"button",className:"truncate font-medium text-sm text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:V,children:U}):t.jsx("span",{className:"font-medium truncate",children:U})]}),t.jsxs("div",{className:"flex items-center gap-2 min-w-[12rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"♀ Female"}),typeof a=="function"&&E?t.jsx("button",{type:"button",className:"truncate font-medium text-sm text-left text-sky-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400 rounded",onClick:re,children:_}):t.jsx("span",{className:"font-medium truncate",children:_})]}),t.jsxs("div",{className:"flex items-center gap-2 min-w-[10rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"Start"}),t.jsx("span",{className:"font-medium",children:P})]}),t.jsxs("div",{className:"flex items-center gap-2 min-w-[10rem]",children:[t.jsx("span",{className:"text-[11px] uppercase text-neutral-500 font-semibold",children:"End"}),t.jsx("span",{className:"font-medium",children:X})]})]})]})})}function ld({male:e,female:s,odds:n}){const l=h.useMemo(()=>n||tl(e,s),[n,e,s]),a=(l==null?void 0:l.perGene)||[],r=(l==null?void 0:l.combined)||[];return!a.length&&!r.length?null:t.jsxs("div",{className:"mt-3",children:[a.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"Genetics odds"}),t.jsx("div",{className:"flex flex-col gap-2",children:a.map(o=>t.jsxs("div",{className:"rounded-lg border bg-neutral-50 px-2 py-2",children:[t.jsx("div",{className:"text-xs font-semibold text-neutral-700",children:o.gene}),t.jsx("div",{className:"mt-1 flex flex-wrap gap-1.5",children:o.outcomes.map(c=>t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border bg-white px-2 py-0.5 text-[11px]",children:[t.jsx("span",{className:"font-semibold",children:un(c.probability)}),t.jsx("span",{children:c.label})]},`${o.gene}-${c.label}`))}),o.notes?t.jsx("div",{className:"mt-1 text-[10px] text-neutral-500",children:o.notes}):null]},o.gene))})]}),r.length>0&&t.jsxs("div",{className:"mt-3",children:[t.jsx("div",{className:"text-xs font-medium mb-1",children:"Combined genetics odds"}),t.jsx("div",{className:"flex flex-col gap-1.5",children:r.map(o=>{const c=(o.breakdown||[]).filter(d=>d.label&&d.label!=="Normal");return t.jsxs("div",{className:"rounded-lg border bg-white px-2 py-1.5 text-[11px] text-neutral-700",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[t.jsx("span",{className:"font-semibold text-neutral-900",children:un(o.probability)}),t.jsx("span",{children:o.label})]}),c.length?t.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-neutral-500",children:c.map(d=>t.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border px-1.5 py-0.5 bg-neutral-50",children:[t.jsx("span",{className:"font-semibold text-neutral-700",children:d.gene}),t.jsx("span",{children:d.label})]},`${o.key}-${d.gene}`))}):null]},o.key)})})]})]})}function tl(e,s){if(!e||!s)return{perGene:[],combined:[]};const n=da(e),l=da(s),a=new Set([...n.keys(),...l.keys()]),r=[];for(const c of a){const d=n.get(c)||null,u=l.get(c)||null,m=(d==null?void 0:d.displayName)||(u==null?void 0:u.displayName)||"";if(!m||/^normal$/i.test(m))continue;const p=dd(m,d,u);if(!p)continue;let b=null;if(p==="Recessive")b=ud(m,d,u);else if(p==="Incomplete Dominant"||p==="Dominant")b=md(m,d,u,p);else continue;if(!b||!b.outcomes||!b.outcomes.length||!b.outcomes.some(S=>S.label!=="Normal"&&S.probability>1e-4))continue;const N=[`Inheritance: ${p}`];b.sireDescriptor&&N.push(`Sire: ${b.sireDescriptor}`),b.damDescriptor&&N.push(`Dam: ${b.damDescriptor}`),r.push({gene:m,inheritance:p,outcomes:b.outcomes,notes:N.join(" • ")})}r.sort((c,d)=>c.gene.localeCompare(d.gene));const o=od(r);return{perGene:r,combined:o}}function od(e,s=12,n=.01){if(!Array.isArray(e)||!e.length)return[];let l=[{probability:1,breakdown:[],labelParts:[],geneOutcomes:[]}];e.forEach(r=>{const o=Array.isArray(r.outcomes)&&r.outcomes.length?r.outcomes:[{label:"Normal",probability:1}],c=new Map;l.forEach(d=>{o.forEach(u=>{const m=d.probability*(u.probability||0);if(m<=0)return;const p=[...d.breakdown,{gene:r.gene,label:u.label}],b=u.label&&u.label!=="Normal"?[...d.labelParts,u.label]:[...d.labelParts],f=[...d.geneOutcomes,`${r.gene}:${u.label}`],N=f.join("|"),S=c.get(N);S?S.probability+=m:c.set(N,{probability:m,breakdown:p,labelParts:b,geneOutcomes:f})})}),l=Array.from(c.values()),l.sort((d,u)=>u.probability-d.probability),l.length>1024&&(l=l.slice(0,1024))}),l.sort((r,o)=>o.probability-r.probability);const a=[];return l.forEach(r=>{(r.probability>=n||a.length<s)&&a.push(r)}),a.slice(0,s).map(r=>({key:r.geneOutcomes.join("|"),label:r.labelParts.length?r.labelParts.join(" + "):"Normal (all genes)",probability:r.probability,breakdown:r.breakdown}))}function da(e){const s=new Map;if(!e)return s;const n=(l,a)=>{s.has(l)||s.set(l,{key:l,displayName:a||"",group:null,visualCount:0,superVisual:!1,hetCount:0,possibleHetProbabilities:[],morphTokens:[],hetTokens:[]});const r=s.get(l);if(a&&((!r.displayName||r.displayName.length<a.length)&&(r.displayName=a),!r.group||r.group==="Other")){const o=rs(a);o&&(r.group=o)}return r};return(Array.isArray(e.morphs)?e.morphs:[]).forEach(l=>{const a=id(l);if(!a)return;const r=_s(a.gene);if(!r)return;const o=n(r,a.displayName);o.visualCount+=1,o.superVisual=o.superVisual||!!a.isSuper,o.morphTokens.push(a.original)}),(Array.isArray(e.hets)?e.hets:[]).forEach(l=>{const a=cd(l);if(!a)return;const r=_s(a.gene);if(!r)return;const o=n(r,a.displayName);o.hetTokens.push(a.original),a.isCertain?o.hetCount+=1:o.possibleHetProbabilities.push(Math.max(0,Math.min(1,a.probability))),(!o.group||o.group==="Other")&&(o.group="Recessive")}),s}function id(e){if(!e)return null;const s=String(e).trim();if(!s)return null;let n=s,l=!1;const a=n.match(/^super[\s-]+(.+)$/i);if(a&&a[1])l=!0,n=a[1].trim();else{const o=n.match(/^Super([A-Z].*)$/);o&&o[1]&&(l=!0,n=o[1].trim())}const r=n.replace(/\s+/g," ").trim();return r?{gene:r,displayName:r,isSuper:l,original:s}:null}function cd(e){if(!e)return null;const s=String(e).trim();if(!s)return null;let n=s,l=1,a=!1;const r=n.match(/^(\d{1,3})%\s*(.+)$/i);if(r&&r[2]&&(a=!0,l=Math.min(1,parseInt(r[1],10)/100),n=r[2].trim()),/^possible\s+/i.test(n)?(a||(l=Math.min(l,.5)),n=n.replace(/^possible\s+/i,"").trim()):/^probable\s+/i.test(n)?(a||(l=Math.min(l,.66)),n=n.replace(/^probable\s+/i,"").trim()):/^maybe\s+/i.test(n)&&(a||(l=Math.min(l,.33)),n=n.replace(/^maybe\s+/i,"").trim()),n=n.replace(/^het\s+/i,"").trim(),!n)return null;const o=n,c=l>=.999;return{gene:n,displayName:o,probability:l,isCertain:c,original:s}}function dd(e,s,n){const l=[s==null?void 0:s.group,n==null?void 0:n.group,rs(e)].filter(Boolean),a=l.find(o=>o&&o!=="Other");if(a)return a;const r=ua(s)||ua(n);return r||l[0]||null}function ua(e){return e?(e.hetCount||0)>0||(e.possibleHetProbabilities||[]).some(s=>s>0)?"Recessive":e.superVisual||(e.visualCount||0)>0?"Incomplete Dominant":null:null}function ma(e){if(!e)return{descriptor:"Normal",states:[{genotype:"NN",probability:1}]};if((e.visualCount||0)>0)return{descriptor:"Visual",states:[{genotype:"rr",probability:1}]};if((e.hetCount||0)>0)return{descriptor:"Het",states:[{genotype:"Nr",probability:1}]};const s=(e.possibleHetProbabilities||[]).filter(n=>n>0);if(s.length){const n=Math.max(...s),l=Math.max(0,Math.min(1,n));return l>=.999?{descriptor:"Het (proven)",states:[{genotype:"Nr",probability:1}]}:{descriptor:`${un(l)} possible het`,states:[{genotype:"Nr",probability:l},{genotype:"NN",probability:1-l}]}}return{descriptor:"Normal",states:[{genotype:"NN",probability:1}]}}function ha(e){return e==="rr"?[{allele:"r",probability:1}]:e==="Nr"||e==="rN"?[{allele:"r",probability:.5},{allele:"N",probability:.5}]:[{allele:"N",probability:1}]}function ud(e,s,n){const l=ma(s),a=ma(n),r=new Map;return l.states.forEach(c=>{a.states.forEach(d=>{const u=c.probability*d.probability;if(u<=0)return;const m=ha(c.genotype),p=ha(d.genotype);m.forEach(b=>{p.forEach(f=>{const N=u*b.probability*f.probability;if(N<=0)return;const S=(b.allele==="r"?1:0)+(f.allele==="r"?1:0),A=S===2?`Visual ${e}`:S===1?`Het ${e}`:"Normal";r.set(A,(r.get(A)||0)+N)})})})}),{outcomes:Array.from(r.entries()).map(([c,d])=>({label:c,probability:d})).filter(c=>c.probability>1e-4).sort((c,d)=>d.probability-c.probability),sireDescriptor:l.descriptor,damDescriptor:a.descriptor}}function pa(e,s){if(!e)return{descriptor:"Normal",states:[{copies:0,probability:1}]};if(e.superVisual)return{descriptor:s==="Incomplete Dominant"?"Super visual":"Homozygous visual",states:[{copies:2,probability:1}]};if((e.visualCount||0)>0)return{descriptor:"Visual",states:[{copies:1,probability:1}]};if((e.hetCount||0)>0)return{descriptor:"Carrier",states:[{copies:1,probability:1}]};const n=(e.possibleHetProbabilities||[]).filter(l=>l>0);if(n.length){const l=Math.max(...n),a=Math.max(0,Math.min(1,l));return a>=.999?{descriptor:"Visual (likely homozygous)",states:[{copies:1,probability:1}]}:{descriptor:`${un(a)} possible carrier`,states:[{copies:1,probability:a},{copies:0,probability:1-a}]}}return{descriptor:"Normal",states:[{copies:0,probability:1}]}}function fa(e){return e>=2?[{allele:"A",probability:1}]:e>=1?[{allele:"A",probability:.5},{allele:"a",probability:.5}]:[{allele:"a",probability:1}]}function md(e,s,n,l){const a=pa(s,l),r=pa(n,l),o=new Map;return a.states.forEach(d=>{r.states.forEach(u=>{const m=d.probability*u.probability;if(m<=0)return;const p=fa(d.copies),b=fa(u.copies);p.forEach(f=>{b.forEach(N=>{const S=m*f.probability*N.probability;if(S<=0)return;const A=(f.allele==="A"?1:0)+(N.allele==="A"?1:0);let E;A===0?E="Normal":A===2&&l==="Incomplete Dominant"?E=`Super ${e}`:E=e,o.set(E,(o.get(E)||0)+S)})})})}),{outcomes:Array.from(o.entries()).map(([d,u])=>({label:d,probability:u})).filter(d=>d.probability>1e-4).sort((d,u)=>u.probability-d.probability),sireDescriptor:a.descriptor,damDescriptor:r.descriptor}}function un(e){if(!Number.isFinite(e)||e<=0)return"0%";if(e>=.9995)return"100%";const s=e*100,n=Math.round(s*10)/10;return Number.isInteger(n)?`${n}%`:`${n.toFixed(1)}%`}function vs(e={}){const s=(e==null?void 0:e.ovulation)||{},n=(e==null?void 0:e.preLayShed)||{},l=(e==null?void 0:e.clutch)||{},a=(e==null?void 0:e.hatch)||{},r=!!s.observed,o=!!n.observed,c=!!l.recorded,d=!!a.recorded,u=s.date||"",m=n.date||"",p=l.date||"",b=a.scheduledDate||"",f=a.date||"",N=u?ts(u,21):null,S=m?ts(m,30):null,A=p?ts(p,60):null,E=b||A,y=l.eggsTotal,_=l.fertileEggs,U=l.slugs,L=typeof y=="number"&&Number.isFinite(y)?Math.max(0,y):null,T=typeof _=="number"&&Number.isFinite(_)?Math.max(0,_):null,G=_===""||typeof _>"u"?"":String(_),H=U===""||typeof U>"u"?"":String(U),ee=y===""||typeof y>"u"?"":String(y),g=r&&!o,I=o&&!c,D=c&&!d,P=[g&&N?{key:"preLay",label:"Pre-Lay ETA",targetDate:N,totalDays:21}:null,I&&S?{key:"eggLay",label:"Egg Lay ETA",targetDate:S,totalDays:30}:null,D&&A?{key:"hatch",label:"Hatch ETA",targetDate:A,totalDays:60}:null,!D&&E&&!d&&L!==0?{key:"scheduled",label:"Scheduled Hatch",targetDate:E,totalDays:null}:null].filter(Boolean),te=P.length?P[0]:null;return{ovulationObserved:r,preLayObserved:o,clutchRecorded:c,hatchedRecorded:d,ovulationDate:u,preLayDate:m,clutchDate:p,hatchScheduledDate:b,preLayWindowTarget:N,eggLayingTarget:S,hatchTarget:A,hatchCountdownTarget:E,hatchDate:f,eggsTotalNumber:L,fertileEggsNumber:T,clutchFertileValue:G,clutchTotalValue:ee,clutchSlugsValue:H,timerQueue:P,activeTimer:te,hasActiveTimers:P.length>0}}function xa(e){if(!e)return!1;const s=Ve({...e});return!!vs(s).hatchedRecorded}function fn({clutchDate:e,preLayDate:s,ovulationDate:n,hatchDate:l,startDate:a}){const r=[e,s,n,l,a];for(const o of r){if(!o)continue;const c=Date.parse(o);if(!Number.isNaN(c))return String(new Date(c).getFullYear());const d=String(o).match(/^(\d{4})/);if(d)return d[1]}return"Unknown"}function hd(e){if(!e)return null;const s=Ve({...e}),n=vs(s),l=(s.appointments||[]).filter(f=>f&&f.lockObserved&&(f.lockLoggedAt||f.date)).map(f=>{const N=f.lockLoggedAt||f.date||"",S=Date.parse(N),A=We(N)||ve(f.date)||"";return{iso:N,display:A,notes:f.notes?String(f.notes).trim():"",timestamp:Number.isNaN(S)?null:S}}).filter(f=>f.iso).sort((f,N)=>{const S=typeof f.timestamp=="number"?f.timestamp:1/0,A=typeof N.timestamp=="number"?N.timestamp:1/0;return S-A}).map(({timestamp:f,...N})=>N),a=n.ovulationDate||"",r=n.preLayDate||"",o=n.clutchDate||"",c=n.hatchDate||"";if(!(l.length||a||r||o||c))return null;const u=fn({clutchDate:o,preLayDate:r,ovulationDate:a,hatchDate:c,startDate:s.startDate||""}),m=o||r||a||c||s.startDate||"",p=m&&!Number.isNaN(Date.parse(m))?Date.parse(m):null,b=s.label||`${s.femaleId||"Female"} × ${s.maleId||"Male"}`;return{id:s.id||`${s.femaleId||"female"}-${s.maleId||"male"}-${u}`,label:b,year:u,startDate:s.startDate||"",locks:l,ovulationDate:a,preLayDate:r,clutchDate:o,hatchDate:c,sortValue:p}}function sl(e,s=[]){if(!e||!Array.isArray(s)||!s.length)return[];const n=s.filter(r=>r&&r.femaleId===e).map(hd).filter(Boolean);if(!n.length)return[];const l=new Map;n.forEach(r=>{const o=r.year||"Unknown";l.has(o)||l.set(o,[]),l.get(o).push(r)});const a=r=>{const o=Number(r);return Number.isFinite(o)?o:-1/0};return Array.from(l.entries()).sort((r,o)=>{const c=a(o[0])-a(r[0]);return c!==0?c:String(o[0]).localeCompare(String(r[0]))}).map(([r,o])=>{const c=o.slice().sort((d,u)=>{const m=typeof d.sortValue=="number"?d.sortValue:-1/0;return(typeof u.sortValue=="number"?u.sortValue:-1/0)-m}).map(({sortValue:d,...u})=>u);return{year:r,cycles:c}})}function pd({edit:e,setEdit:s,theme:n="blue",onCreateClutchCard:l,lifecycle:a}){var ue,M,R,W,ie,he,be,Ce,je,Ne;const[r,o]=h.useState(null),[c,d]=h.useState({date:"",notes:""}),[u,m]=h.useState({date:"",notes:""}),[p,b]=h.useState({fertileEggs:"",slugs:""}),[f,N]=h.useState({date:"",hatchedCount:"",notes:""}),S=a||vs(e),{ovulationObserved:A,preLayObserved:E,clutchRecorded:y,hatchedRecorded:_,ovulationDate:U,preLayDate:L,clutchDate:T,preLayWindowTarget:G,eggLayingTarget:H,hatchTarget:ee,eggsTotalNumber:g,fertileEggsNumber:I,clutchFertileValue:D,clutchSlugsValue:k}=S,oe=h.useMemo(()=>{if(typeof g=="number")return g;const Z=typeof I=="number"?I:(()=>{if(D===""||typeof D>"u")return null;const J=Number(D);return Number.isFinite(J)&&J>=0?J:null})(),z=(()=>{if(k===""||typeof k>"u")return null;const J=Number(k);return Number.isFinite(J)&&J>=0?J:null})();return Z===null&&z===null?null:Math.max(0,Z??0)+Math.max(0,z??0)},[g,I,D,k]),$=typeof I=="number"?I:typeof g=="number"?g:null,j=typeof I=="number"?"fertile eggs":"eggs laid",P=typeof l=="function"&&y&&!!T;h.useEffect(()=>{var Z,z;r==="ovulation"&&d({date:((Z=e==null?void 0:e.ovulation)==null?void 0:Z.date)||ze(new Date),notes:((z=e==null?void 0:e.ovulation)==null?void 0:z.notes)||""})},[r,(ue=e==null?void 0:e.ovulation)==null?void 0:ue.date,(M=e==null?void 0:e.ovulation)==null?void 0:M.notes]),h.useEffect(()=>{var Z,z;r==="preLay"&&m({date:((Z=e==null?void 0:e.preLayShed)==null?void 0:Z.date)||ze(new Date),notes:((z=e==null?void 0:e.preLayShed)==null?void 0:z.notes)||""})},[r,(R=e==null?void 0:e.preLayShed)==null?void 0:R.date,(W=e==null?void 0:e.preLayShed)==null?void 0:W.notes]),h.useEffect(()=>{r==="clutch"&&b({fertileEggs:D===""?"":D,slugs:k===""?"0":k})},[r,D,k]),h.useEffect(()=>{var Z,z,J;r==="hatched"&&N({date:((Z=e==null?void 0:e.hatch)==null?void 0:Z.date)||ze(new Date),hatchedCount:(z=e==null?void 0:e.hatch)!=null&&z.hatchedCount?String(e.hatch.hatchedCount):"",notes:((J=e==null?void 0:e.hatch)==null?void 0:J.notes)||""})},[r,e==null?void 0:e.hatch]);const te=h.useCallback(Z=>{s(z=>{const J=Ve({...z});if(Z)J.clutch.recorded=!0,J.clutch.date=J.clutch.date||ze(new Date),!J.hatch.scheduledDate&&J.clutch.date&&(J.hatch.scheduledDate=ts(J.clutch.date,60));else{const fe=$s();J.clutch={...fe.clutch},J.hatch={...fe.hatch}}return J})},[s]),X=h.useCallback((Z,z)=>{s(J=>{const fe=Ve({...J});if(fe.clutch.recorded=!0,Z==="date"){const ke=z||"";fe.clutch.date=ke,!fe.hatch.scheduledDate&&ke&&(fe.hatch.scheduledDate=ts(ke,60))}else if(Z==="fertileEggs"||Z==="slugs"){const ke=z??"";if(ke==="")fe.clutch[Z]="";else{const Pe=Number(ke);fe.clutch[Z]=Number.isFinite(Pe)?Math.max(0,Pe):fe.clutch[Z]}const _e=typeof fe.clutch.fertileEggs=="number"&&Number.isFinite(fe.clutch.fertileEggs)?Math.max(0,fe.clutch.fertileEggs):null,Fe=typeof fe.clutch.slugs=="number"&&Number.isFinite(fe.clutch.slugs)?Math.max(0,fe.clutch.slugs):null;if(_e===null&&Fe===null)fe.clutch.eggsTotal="";else{const Pe=Math.max(0,_e??0)+Math.max(0,Fe??0);fe.clutch.eggsTotal=Pe}}else Z==="notes"&&(fe.clutch.notes=z||"");return fe})},[s]),ce=h.useCallback(()=>{s(Z=>{const z=Ve({...Z});return z.hatch={...$s().hatch},z})},[s]),q=h.useCallback(()=>{o("hatched")},[o]),V=h.useCallback(()=>{s(Z=>{const z=Ve({...Z});let J=Number(p.fertileEggs);(!Number.isFinite(J)||J<0)&&(J=0);let fe=p.slugs===""?0:Number(p.slugs);return(!Number.isFinite(fe)||fe<0)&&(fe=0),z.clutch.recorded=!0,z.clutch.date=z.clutch.date||ze(new Date),z.clutch.fertileEggs=J,z.clutch.slugs=fe,z.clutch.eggsTotal=J+fe,!z.hatch.scheduledDate&&z.clutch.date&&(z.hatch.scheduledDate=ts(z.clutch.date,60)),z}),o(null)},[p,s,o]),re=h.useCallback(()=>{s(Z=>{const z=Ve({...Z});if(z.ovulation.observed=!0,z.ovulation.date=c.date||"",z.ovulation.notes=c.notes||"",z.ovulation.date&&(z.appointments=gd(z.appointments||[],z.ovulation.date)),z.preLayShed.observed&&z.preLayShed.date){const J=ba(z.ovulation.date,z.preLayShed.date);z.preLayShed.intervalFromOvulation=Number.isFinite(J)?J:null}return z}),o(null)},[c,s,o]),ae=h.useCallback(()=>{s(Z=>{const z=Ve({...Z});z.preLayShed.observed=!0,z.preLayShed.date=u.date||"",z.preLayShed.notes=u.notes||"";const J=z.ovulation.observed&&z.ovulation.date&&u.date?ba(z.ovulation.date,u.date):null;return z.preLayShed.intervalFromOvulation=Number.isFinite(J)?J:null,z}),o(null)},[u,s,o]),pe=h.useMemo(()=>{const Z=p.fertileEggs;if(Z==="")return!0;const z=Number(Z);if(!Number.isFinite(z)||z<0)return!0;if(p.slugs==="")return!1;const J=Number(p.slugs);return!Number.isFinite(J)||J<0},[p]),we=h.useMemo(()=>{const Z=p.fertileEggs,z=p.slugs,J=Z!==""&&Number.isFinite(Number(Z)),fe=z!==""&&Number.isFinite(Number(z));if(!J&&!fe)return null;const ke=J?Math.max(0,Number(Z)):0,_e=fe?Math.max(0,Number(z)):0;return ke+_e},[p]),Ie=h.useCallback(()=>{s(Z=>{const z=Ve({...Z});let J=f.hatchedCount===""?0:Number(f.hatchedCount);(!Number.isFinite(J)||J<0)&&(J=0);const fe=typeof z.clutch.fertileEggs=="number"&&Number.isFinite(z.clutch.fertileEggs)?Math.max(0,z.clutch.fertileEggs):typeof z.clutch.eggsTotal=="number"&&Number.isFinite(z.clutch.eggsTotal)?Math.max(0,z.clutch.eggsTotal):null;return typeof fe=="number"&&(J=Math.min(J,fe)),z.hatch={...z.hatch,recorded:!0,date:f.date,hatchedCount:J,notes:f.notes||""},z}),o(null)},[f,s]),Y="rounded-xl border border-neutral-200 bg-white p-2 flex flex-col gap-2 text-[11px] min-w-0 overflow-hidden";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"border rounded-2xl bg-white shadow-sm p-3 flex flex-col gap-3 h-full max-h-[60vh] min-h-0 overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Breeding cycle"}),t.jsx("div",{className:"text-[12px] text-neutral-500",children:"Track sheds, clutches, and hatch"})]}),t.jsxs("div",{className:"flex flex-col gap-2.5 min-w-0 overflow-auto pr-1",children:[t.jsxs("div",{className:"flex flex-col gap-2.5 lg:grid lg:grid-cols-2 lg:gap-2.5 lg:items-stretch",children:[t.jsxs("div",{className:ne(Y,"flex-1 lg:h-full"),children:[t.jsxs("div",{className:"flex-1 text-center space-y-1",children:[t.jsx("div",{className:"text-[12px] font-semibold uppercase tracking-wide text-neutral-500",children:"Ovulation"}),t.jsx("div",{className:"text-neutral-700 text-[13px]",children:U?ve(U):"—"}),A&&((ie=e==null?void 0:e.ovulation)!=null&&ie.notes)?t.jsx("div",{className:"text-[11px] text-neutral-500 leading-snug max-h-12 overflow-hidden mx-auto",children:e.ovulation.notes}):null,A&&G&&t.jsxs("div",{className:"text-[11px] text-neutral-500",children:["Pre-lay window ",ve(G)]})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mt-2",children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>o("ovulation"),children:A?"Edit details":"Log ovulation"}),A&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>{s(Z=>{const z=Ve({...Z});return z.ovulation={observed:!1,date:"",notes:""},z.preLayShed={...$s().preLayShed},z})},children:"Clear"})]})]}),t.jsxs("div",{className:ne(Y,"flex-1 lg:h-full"),children:[t.jsxs("div",{className:"flex-1 text-center space-y-1",children:[t.jsx("div",{className:"text-[12px] font-semibold uppercase tracking-wide text-neutral-500",children:"Pre-Lay Shed"}),t.jsx("div",{className:"text-neutral-700 text-[13px]",children:L?ve(L):"—"}),E&&Number.isFinite((he=e==null?void 0:e.preLayShed)==null?void 0:he.intervalFromOvulation)&&t.jsxs("div",{className:"text-[11px] text-neutral-500",children:[e.preLayShed.intervalFromOvulation," days after ovulation"]}),E&&((be=e==null?void 0:e.preLayShed)!=null&&be.notes)?t.jsx("div",{className:"text-[11px] text-neutral-500 leading-snug max-h-12 overflow-hidden mx-auto",children:e.preLayShed.notes}):null,E&&H&&t.jsxs("div",{className:"text-[11px] text-neutral-500",children:["Egg window ",ve(H)]})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-2 mt-2",children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>o("preLay"),disabled:!A,children:E?"Edit details":"Log pre-lay shed"}),E&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>{s(Z=>{const z=Ve({...Z});return z.preLayShed={...$s().preLayShed},z})},children:"Clear"})]})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:ne(Y,"w-full lg:max-w-xl"),children:[t.jsxs("div",{className:"space-y-0.5",children:[t.jsx("div",{className:"font-semibold uppercase tracking-wide text-neutral-500",children:"Clutch & Hatch"}),t.jsx("div",{className:"text-neutral-700 text-[13px]",children:y&&T?`Laid ${ve(T)}`:"No egg laid recorded"})]}),t.jsxs("div",{className:"mt-3 w-full text-left space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:"Egg laying date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2 text-xs",value:T,onChange:Z=>X("date",Z.target.value),disabled:!y})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:"Number of fertile eggs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2 text-xs",value:D,onChange:Z=>X("fertileEggs",Z.target.value),disabled:!y})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-[10px] font-semibold uppercase tracking-wide text-neutral-500",children:"Number of slugs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2 text-xs",value:k,onChange:Z=>X("slugs",Z.target.value),disabled:!y})]})]})]}),t.jsxs("div",{className:"mt-3 flex flex-col gap-2 items-center text-xs text-neutral-600",children:[t.jsx("div",{className:"text-[11px] text-neutral-500",children:y?"Egg laid recorded":"No egg laid yet"}),t.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-neutral-500",children:[t.jsx("span",{children:"Expected on"}),t.jsx("span",{className:"text-neutral-700 font-medium",children:ee?ve(ee):"—"})]}),t.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[!y&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>o("clutch"),children:"Eggs laid"}),y&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:()=>l==null?void 0:l(),disabled:!P,children:"Create clutch card"}),!_&&t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:q,children:"Eggs hatched"}),t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg text-rose-600 border-rose-300",onClick:()=>te(!1),children:"Clear egg record"})]})]})]}),t.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-neutral-50 px-3 py-2 mt-2 flex items-start justify-between gap-3 w-full",children:[t.jsxs("div",{className:"space-y-1 text-left",children:[t.jsx("div",{className:"text-[11px] font-medium uppercase tracking-wide text-neutral-500",children:"Hatched"}),t.jsx("div",{className:"text-[13px] text-neutral-700",children:_&&((Ce=e==null?void 0:e.hatch)!=null&&Ce.date)?`Hatched ${ve(e.hatch.date)}`:"Not yet"}),_&&t.jsxs("div",{className:"text-[11px] text-neutral-500 space-y-1",children:[t.jsxs("div",{children:["Hatched count: ",((je=e==null?void 0:e.hatch)==null?void 0:je.hatchedCount)||0]}),(Ne=e==null?void 0:e.hatch)!=null&&Ne.notes?t.jsxs("div",{children:["Notes: ",e.hatch.notes]}):null]})]}),t.jsx("div",{className:"flex flex-col items-end gap-2",children:_&&t.jsxs("div",{className:"flex flex-col items-end gap-2",children:[t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg",onClick:q,children:"View / edit hatch"}),t.jsx("button",{className:"text-[11px] px-2.5 py-1 border rounded-lg text-rose-600 border-rose-300",onClick:ce,children:"Clear hatch record"})]})})]}),t.jsxs("div",{className:"mt-2 text-[11px] text-neutral-500",children:["Total eggs laid: ",typeof oe=="number"?oe:"—"," (fertile + slugs)"]})]})})]})]}),r==="ovulation"&&t.jsx(an,{title:"Ovulation details",theme:n,onClose:()=>o(null),onConfirm:re,disableConfirm:!c.date,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Ovulation date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:c.date,onChange:Z=>d(z=>({...z,date:Z.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-3 py-2",value:c.notes,onChange:Z=>d(z=>({...z,notes:Z.target.value}))})]})]})}),r==="preLay"&&t.jsx(an,{title:"Pre-Lay shed details",theme:n,onClose:()=>o(null),onConfirm:ae,disableConfirm:!u.date,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Pre-Lay shed date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:u.date,onChange:Z=>m(z=>({...z,date:Z.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-3 py-2",value:u.notes,onChange:Z=>m(z=>({...z,notes:Z.target.value}))})]})]})}),r==="clutch"&&t.jsx(an,{title:"Log eggs laid",theme:n,onClose:()=>o(null),onConfirm:V,disableConfirm:pe,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Number of fertile eggs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2",value:p.fertileEggs,onChange:Z=>{const z=Z.target.value;if(z===""){b(fe=>({...fe,fertileEggs:""}));return}let J=Number(z);Number.isFinite(J)&&(J<0&&(J=0),b(fe=>({...fe,fertileEggs:String(J)})))}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Number of slugs"}),t.jsx("input",{type:"number",min:"0",className:"mt-1 w-full border rounded-xl px-3 py-2",value:p.slugs,onChange:Z=>{const z=Z.target.value;if(z===""){b(fe=>({...fe,slugs:""}));return}let J=Number(z);Number.isFinite(J)&&(J<0&&(J=0),b(fe=>({...fe,slugs:String(J)})))}}),t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Total eggs laid will be saved as fertile eggs + slugs",typeof we=="number"?` = ${we}`:"","."]})]})]})}),r==="hatched"&&t.jsx(an,{title:"Hatch details",theme:n,onClose:()=>o(null),onConfirm:Ie,disableConfirm:!f.date,children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Hatch date"}),t.jsx("input",{type:"date",className:"mt-1 w-full border rounded-xl px-3 py-2",value:f.date,onChange:Z=>N(z=>({...z,date:Z.target.value}))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Number hatched"}),t.jsx("input",{type:"number",min:"0",max:$??void 0,className:"mt-1 w-full border rounded-xl px-3 py-2",value:f.hatchedCount,onChange:Z=>{const z=Z.target.value;if(z===""){N(fe=>({...fe,hatchedCount:""}));return}let J=Number(z);(!Number.isFinite(J)||J<0)&&(J=0),$!==null&&J>$&&(J=$),N(fe=>({...fe,hatchedCount:String(J)}))}}),$!==null&&t.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:["Maximum allowed: ",$," (",j,")"]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Notes"}),t.jsx("textarea",{rows:3,className:"mt-1 w-full border rounded-xl px-3 py-2",value:f.notes,onChange:Z=>N(z=>({...z,notes:Z.target.value}))})]})]})})]})}function fd({lifecycle:e,theme:s="blue",className:n}){const l=(e==null?void 0:e.timerQueue)||[],a=l.length>0,[r,o]=h.useState(new Date),c=!!(e!=null&&e.hatchedRecorded),d=(e==null?void 0:e.hatchDate)||"",u=!!(e&&(e.ovulationObserved||e.preLayObserved||e.clutchRecorded||e.hatchedRecorded||e.ovulationDate||e.preLayDate||e.clutchDate));return h.useEffect(()=>{if(a||c)return;const m=setInterval(()=>o(new Date),6e4);return()=>clearInterval(m)},[a,c]),!a&&!u?null:c?t.jsxs("div",{className:ne("border rounded-2xl bg-white shadow-sm p-4 sm:p-5 flex flex-col gap-4",n),children:[t.jsx("div",{className:"flex flex-wrap items-end justify-between gap-2",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Cycle timers"}),t.jsx("div",{className:"text-sm text-neutral-600",children:"Breeding cycle status"})]})}),t.jsxs("div",{className:"flex flex-col gap-2 text-sm text-neutral-600",children:[t.jsx("div",{className:"font-medium text-neutral-700",children:"This breeding cycle is over."}),d?t.jsxs("div",{className:"text-xs text-neutral-500",children:["Hatched on ",ve(d)]}):null]})]}):t.jsxs("div",{className:ne("border rounded-2xl bg-white shadow-sm p-4 sm:p-5 flex flex-col gap-4",n),children:[t.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide text-neutral-500",children:"Cycle timers"}),t.jsx("div",{className:"text-sm text-neutral-600",children:"Upcoming breeding milestones"})]}),a&&t.jsxs("div",{className:"text-xs text-neutral-500",children:[l.length," active"]})]}),a?t.jsx("div",{className:"flex flex-col gap-3",children:l.map(m=>t.jsx(xd,{label:m.label,targetDate:m.targetDate,totalDays:typeof m.totalDays=="number"?m.totalDays:null,theme:s,size:"lg"},m.key))}):t.jsxs("div",{className:"flex flex-col gap-2 text-sm text-neutral-600",children:[t.jsx("div",{children:"No active timers yet. Log ovulation, pre-lay, or clutch events to start tracking milestones."}),t.jsxs("div",{className:"text-xs font-medium text-neutral-500",children:["Current time: ",We(r)]})]})]})}function an({title:e,onClose:s,onConfirm:n,children:l,theme:a="blue",confirmLabel:r="Save",disableConfirm:o=!1}){return t.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[70]",onClick:s,children:t.jsxs("div",{className:"bg-white w-full max-w-md rounded-2xl shadow-xl border p-5",onClick:c=>c.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("div",{className:"font-semibold",children:e}),t.jsx("button",{className:"text-sm px-2 py-1",onClick:s,children:"Close"})]}),t.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-auto pr-1",children:l}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:s,children:"Cancel"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm",Ee(a,!0)),onClick:n,disabled:o,children:r})]})]})})}function xd({label:e,targetDate:s,totalDays:n=null,theme:l="blue",size:a="sm"}){const[r,o]=h.useState(Date.now());if(h.useEffect(()=>{if(!s)return;const N=setInterval(()=>o(Date.now()),6e4);return()=>clearInterval(N)},[s]),!s)return null;const c=Rt(s);if(!c)return null;const d=c.getTime()-r,u=d<0,m=u?`Overdue by ${ga(-d)}`:`Due in ${ga(d)}`;let p=null;if(n&&n>0){const N=n*864e5,S=N-d;p=u?100:Math.min(100,Math.max(0,S/N*100))}const b=l==="green"?"bg-emerald-100 border border-emerald-300 text-emerald-700":l==="dark"?"bg-slate-200 border border-slate-400 text-slate-800":"bg-sky-100 border border-sky-300 text-sky-700",f=a==="lg"?"px-4 py-3 rounded-2xl gap-3 text-sm sm:text-base":"px-3 py-1.5 rounded-full gap-2 text-xs";return t.jsxs("div",{className:ne("countdown-badge flex flex-wrap items-center font-semibold w-full",f,b,u&&"overdue"),children:[p!==null&&t.jsx("span",{className:"countdown-progress",style:{width:`${p}%`}}),t.jsx("span",{className:"break-words leading-tight",children:e}),t.jsx("span",{className:"break-words leading-tight",children:m}),t.jsx("span",{className:"break-words leading-tight",children:ve(s)})]})}function ga(e){const s=Math.max(0,Math.floor(e)),n=Math.round(s/6e4),l=Math.floor(n/(60*24)),a=Math.floor((n-l*60*24)/60),r=n-l*60*24-a*60;return l>0?`${l}d ${a}h`:a>0?`${a}h ${r}m`:`${Math.max(r,0)}m`}function gd(e=[],s){return!s||!Array.isArray(e)||!e.length||e.filter(l=>(l.date||"")<=s).length<3?e:e.filter(l=>(l.date||"")<=s)}function ba(e,s){const n=Rt(e),l=Rt(s);if(!n||!l)return null;const a=l.getTime()-n.getTime();return Math.round(a/864e5)}function Rt(e){if(!e)return null;const[s,n,l]=String(e).split("-").map(Number);if(!s||!n||!l)return null;const a=new Date(s,n-1,l,12);return isNaN(a.getTime())?null:a}function bd({importText:e,setImportText:s,importPreview:n,setImportPreview:l,runImportPreview:a,applyImport:r,theme:o="blue",onCancel:c}){const[d,u]=h.useState(null),[m,p]=h.useState(!1),b=h.useRef();return t.jsxs(Us,{title:"Import snakes from text",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",children:"Paste text exported from the PDF"}),t.jsx("textarea",{className:"mt-1 w-full h-64 border rounded-xl px-3 py-2",value:e,onChange:f=>s(f.target.value.replace(/Ball Python\s*\(Python regius\)/ig,"")),placeholder:"Paste content here..."}),t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"text-xs font-medium",children:"Upload PDF"}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("input",{id:"import-pdf-input",type:"file",accept:"application/pdf",className:"hidden",onChange:async f=>{const N=f.target.files&&f.target.files[0];if(u(N||null),!!N){p(!0);try{const S=await yd(N);s(S);let A=wc(S);if(A&&A.length){const L=A.map(T=>{const G=Je(T.sex,"F");return{name:T.name,sex:G,morphs:T.morphs||[],hets:T.hets||[],previewText:rn({...T,sex:G})}});l(L);return}const y=S.split(/\r?\n/).map(L=>L.trim()).filter(Boolean).map(L=>Ic(L)).filter(Boolean);if(y&&y.length){const L=y.map(T=>{const G=[],H=[];(T.genetics||[]).forEach(g=>{const I=String(g).toLowerCase();/^het\b|\bhet\b|^66%|^50%|possible/i.test(I)?H.push(g):G.push(g)});const ee=Je(T.gender&&T.gender[0],"F");return{name:T.name,sex:ee,morphs:G,hets:H,previewText:rn({name:T.name,id:T.id||"",sex:ee,morphs:G,hets:H})}});l(L);return}const _=Mc(S);if(_&&_.length){const L=_.map(T=>{const G=Je(T.sex,"F");return{name:T.name,sex:G,morphs:T.morphs||[],hets:T.hets||[],previewText:rn({name:T.name,id:"",sex:G,morphs:T.morphs,hets:T.hets})}});l(L);return}const U=Ya(S);l(U)}catch(S){console.error("pdf parse failed",S),alert("Failed to parse PDF")}finally{p(!1)}}}}),t.jsx("input",{id:"import-sheet-input",ref:b,type:"file",accept:".csv,.xlsx,.xls,text/csv",className:"hidden",onChange:async f=>{const N=f.target.files&&f.target.files[0];if(N){p(!0);try{const S=(N.name||"").toLowerCase();let A="";if(S.endsWith(".csv")||S.endsWith(".txt"))A=await N.text();else if(S.endsWith(".xlsx")||S.endsWith(".xls")){let H;try{H=await ns(()=>import("./xlsx-D_0l8YDs.js"),[])}catch(k){console.error("xlsx import failed",k),alert('To import Excel files please install the "xlsx" package: npm install xlsx');return}const ee=await N.arrayBuffer(),g=H.read(ee,{type:"array"}),I=g.SheetNames[0],D=g.Sheets[I];A=H.utils.sheet_to_csv(D)}else{alert("Unsupported file type. Please upload CSV or XLSX.");return}const E=Fc(A||"");if(!E||!E.length){l([]);return}const{index:y,hasHeader:_}=$c(E[0]||[]),U=H=>{if(!H||!H.length)return null;const ee=H.map(R=>(R||"").toString());if(ee.every(R=>!R.trim()))return null;const g=R=>{const W=ca(ee,y,R);return W.length?W[0].trim():""},I=R=>ca(ee,y,R).flatMap(Qn),D=g("name"),k=g("id"),oe=g("sex"),$=g("status"),j=g("year"),P=g("weight"),te=g("birthDate"),X=g("notes"),ce=[...I("genetics"),...I("morphs")],q=I("hets").map(R=>{const W=R.trim();if(!W)return"";const ie=W.toLowerCase();return ie.includes("het")||/\d+%/.test(ie)||ie.includes("possible")?W:`het ${W}`}).filter(Boolean),{morphs:V,hets:re}=Wn([...ce,...q]),ae=Array.from(new Set(I("groups"))),pe=Array.from(new Set(I("tags"))),we=Je(oe,"F"),Ie=Number(j),Y=P&&P.trim()?P:"",ue=bs(te)||te||null,M=$?$.trim():"";return!D&&!k&&!V.length&&!re.length&&!ae.length&&!pe.length?null:{name:D,id:k,sex:we,morphs:V,hets:re,groups:ae,tags:pe,weight:Y,year:Number.isFinite(Ie)?Ie:void 0,birthDate:ue,status:M,notes:X||void 0}},L=_?E.slice(1):E;let T=_?L.map(U).filter(Boolean):[];if(!T.length){let H=E;E[0].map(I=>(I||"").toString().toLowerCase()).some(I=>I.includes("name")||I.includes("gender")||I.includes("gen"))&&(H=E.slice(1)),T=H.map(I=>{const D=I.map(ae=>(ae||"").trim());if(!D.length||D.every(ae=>!ae))return null;const k=D[0]||"",oe=(D[1]||"").trim(),$=(D[2]||"").trim(),j=(D[3]||"").trim(),P=(D[4]||"").trim(),te=oe.toLowerCase();let X="F";/^f$/.test(te)||/\bfemale\b/.test(te)?X="F":(/^m$/.test(te)||/\bmale\b/.test(te))&&(X="M");const ce=$?$.split(GENE_TOKEN_SPLIT_REGEX).map(ae=>ae.trim()).filter(Boolean):[],q=Wn(ce),V=j?j.split(/[;,|]/).map(ae=>ae.trim()).filter(Boolean):[],re=P?P.split(/[;,|]/).map(ae=>ae.trim()).filter(Boolean):[];return k||q.morphs.length||q.hets.length||V.length||re.length?{name:k,id:"",sex:X,morphs:q.morphs,hets:q.hets,groups:V,tags:re}:null}).filter(Boolean)}if(!T.length){l([]);return}const G=T.map(H=>{const ee=Je(H.sex,"F"),g={name:H.name,id:H.id||"",sex:ee,morphs:H.morphs||[],hets:H.hets||[]};return{...H,sex:ee,previewText:rn(g)}});l(G),s(A)}catch(S){console.error("sheet import error",S),l([])}finally{p(!1);try{f.target.value=null}catch{}}}}}),t.jsx("button",{className:ne("text-xs px-2 py-1 rounded-lg",Ee(o,!0)),onClick:()=>{const f=document.getElementById("import-pdf-input");f&&f.click()},disabled:m,children:m?"Parsing…":"Upload PDF"}),t.jsx("button",{className:ne("text-xs px-2 py-1 rounded-lg","ml-2",Ee(o,!0)),onClick:()=>{const f=document.getElementById("import-sheet-input");f&&f.click()},disabled:m,children:m?"Parsing…":"Upload Sheet"}),t.jsx("div",{className:"text-xs text-neutral-500",children:d?d.name:"No file selected"})]})]}),t.jsxs("div",{className:"mt-3 flex gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:a,children:"Preview"}),t.jsx("button",{className:ne("px-3 py-2 rounded-xl text-sm border","bg-white"),onClick:()=>{s(""),u(null),l([]),c&&c()},children:"Cancel"}),t.jsxs("button",{className:ne("px-3 py-2 rounded-xl text-sm text-white",n.length?Ee(o,!0):Ee(o,!1)),disabled:!n.length,onClick:r,children:["Import ",n.length?`(${n.length})`:""]})]})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-medium",children:"Preview"}),t.jsxs("div",{className:"mt-1 border rounded-xl p-2 h-64 overflow-auto bg-neutral-50",children:[!n.length&&t.jsx("div",{className:"text-sm text-neutral-500",children:"Click Preview to see parsed snakes."}),n.map((f,N)=>t.jsx("div",{className:"text-sm py-1 border-b last:border-b-0",children:f.previewText?t.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:f.previewText}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"font-medium",children:[f.name," ",t.jsxs("span",{className:"text-xs text-neutral-500",children:["(",f.sex,")"]})]}),(()=>{const S=at(f.morphs,f.hets,f.possibleHets);return t.jsx("div",{className:"space-y-1 mt-1 text-[10px]",children:S.length?t.jsx(ar,{label:"Genetics",genes:S,size:"xs"}):t.jsx("div",{className:"text-neutral-500 uppercase tracking-wide",children:"Genetics: -"})})})()]})},N))]})]})]}),t.jsx("div",{className:"text-xs text-neutral-500 mt-3",children:"Row 1 column titles (Name, ID, Gender, Morphs, etc.) are mapped automatically—double-check the preview before importing."})]})}async function yd(e){const s=await e.arrayBuffer(),n=new Uint8Array(s);let l;try{l=await $n.getDocument({data:n}).promise}catch(r){throw console.error("pdfjs failed to load document",r),r}let a="";for(let r=1;r<=l.numPages;r++){const d=(await(await l.getPage(r)).getTextContent()).items||[];let u=[],m=null,p="";for(const f of d){const N=f.str||"",S=f.transform&&typeof f.transform[5]<"u"?Math.round(f.transform[5]):0;if(m===null){m=S,p=N;continue}Math.abs(S-m)>5?(u.push(p.trim()),p=N,m=S):p=(p?p+" ":"")+N}p&&u.push(p.trim());const b=u.join(`
`);a+=b+`

`}return a}function Nd({groups:e,setGroups:s,snakes:n,onDeleteGroup:l,onOpenSnake:a,theme:r="blue"}){const[o,c]=h.useState("");return t.jsxs(Us,{title:"Groups",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{className:"flex-1 border rounded-xl px-3 py-2",placeholder:"New group name",value:o,onChange:d=>c(d.target.value)}),t.jsx("button",{className:"px-3 py-2 rounded-xl text-sm border",onClick:()=>{const d=o.trim();d&&(s(u=>u.includes(d)?u:[...u,d]),c(""))},children:"Add"})]}),t.jsxs("div",{className:"mt-4 space-y-4",children:[e.map(d=>{const u=n.filter(m=>(m.groups||[]).includes(d));return t.jsxs("div",{className:"p-3 border rounded-lg",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium",children:[d," ",t.jsxs("span",{className:"text-xs text-neutral-500",children:["(",u.length,")"]})]}),t.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"Members"})]}),t.jsx("div",{className:"flex gap-2",children:t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>l(d),children:"Delete"})})]}),t.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:u.length?u.map(m=>t.jsxs("button",{type:"button",onClick:()=>a&&a(m),className:"text-sm px-2 py-1 rounded-full border bg-neutral-50 flex items-center gap-2 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-sky-200",children:[t.jsx("span",{className:"font-medium",children:m.name}),(()=>{const p=Ot(m.sex),b=p==="M"?"♂":p==="F"?"♀":"•";return t.jsx("span",{className:"text-xs text-neutral-500",children:b})})()]},m.id)):t.jsx("div",{className:"text-xs text-neutral-500",children:"No snakes in this group."})})]},d)}),!e.length&&t.jsx("div",{className:"py-2 text-xs text-neutral-500",children:"No groups yet."})]}),t.jsx("div",{className:"mt-4 text-xs text-neutral-500",children:"Tip: Edit a snake to assign or change its group."})]})}function vd({editSnakeDraft:e,setEditSnakeDraft:s,lastFeedDefaults:n,setLastFeedDefaults:l}){const a=h.useRef(null),r=h.useRef(null),o=h.useRef(null),c=h.useRef(null),d=h.useRef(null),u=(m,p)=>{s(b=>{const f=[...b.logs[m]||[]];return f.splice(p,1),{...b,logs:{...b.logs,[m]:f}}})};return h.useEffect(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[e.logs.feeds.length]),h.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e.logs.weights.length]),h.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[e.logs.sheds.length]),h.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[e.logs.cleanings.length]),h.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[e.logs.meds.length]),t.jsxs(t.Fragment,{children:[t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Feeds"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=ze(new Date),p=n||{feed:"Mouse",size:"",form:"Frozen/thawed",formDetail:"",notes:""},b=p.form||"Frozen/thawed",f=p.formDetail||"";s(N=>({...N,logs:{...N.logs,feeds:[...N.logs.feeds,{date:m,feed:p.feed||"Mouse",size:p.size||"",weightGrams:0,method:b,methodDetail:f,notes:p.notes||"",refused:!1}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:a,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.feeds.map((m,p)=>m.refused?t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-7 gap-2 items-center text-xs",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-xs text-neutral-900 sm:col-span-2 min-w-[8rem] w-full",value:m.date,onChange:f=>He(s,"feeds",p,{date:f.target.value})}),t.jsx("div",{className:"sm:col-span-3 font-semibold text-rose-600",children:"Refused feed"}),t.jsxs("div",{className:"sm:col-span-2 flex justify-end gap-2 flex-wrap",children:[t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>He(s,"feeds",p,{refused:!1}),children:"Undo refused"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600",onClick:()=>u("feeds",p),children:"Delete"})]})]},p):t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-7 gap-2 items-center text-xs",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-xs text-neutral-900 sm:col-span-2 min-w-[8rem] w-full",value:m.date,onChange:f=>He(s,"feeds",p,{date:f.target.value})}),t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-xs sm:col-span-1 w-full",value:m.feed||"",onChange:f=>He(s,"feeds",p,{feed:f.target.value,size:f.target.value==="Mouse"||f.target.value==="Rat"?m.size||"pinky":""}),children:[t.jsx("option",{value:"Mouse",children:"Mouse"}),t.jsx("option",{value:"Rat",children:"Rat"}),t.jsx("option",{value:"Chick",children:"Chick"}),t.jsx("option",{value:"Other",children:"Other"})]}),m.feed==="Mouse"||m.feed==="Rat"?t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-xs sm:col-span-1 w-full",value:m.size||"",onChange:f=>He(s,"feeds",p,{size:f.target.value}),children:[t.jsx("option",{value:"pinky",children:"pinky"}),t.jsx("option",{value:"fuzzy",children:"fuzzy"}),t.jsx("option",{value:"medium",children:"medium"}),t.jsx("option",{value:"adult",children:"adult"})]}):t.jsx("input",{className:"border rounded-lg px-2 py-1 text-xs sm:col-span-1 w-full",placeholder:"Size",value:m.size||"",onChange:f=>He(s,"feeds",p,{size:f.target.value})}),t.jsx("input",{type:"number",className:"border rounded-lg px-2 py-1 text-xs w-full sm:col-span-1",placeholder:"g",value:typeof m.weightGrams=="number"?m.weightGrams:m.weightGrams||0,onChange:f=>He(s,"feeds",p,{weightGrams:Number(f.target.value)||0})}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-2 sm:col-span-2",children:[t.jsxs("select",{className:"border rounded-lg px-2 py-1 text-xs w-full sm:w-auto",value:m.method||"",onChange:f=>He(s,"feeds",p,{method:f.target.value}),children:[t.jsx("option",{value:"Live",children:"Live"}),t.jsx("option",{value:"Freshly killed",children:"Freshly killed"}),t.jsx("option",{value:"Frozen/thawed",children:"Frozen/thawed"}),t.jsx("option",{value:"Other",children:"Other"})]}),m.method==="Other"&&t.jsx("input",{className:"border rounded-lg px-2 py-1 text-xs w-full sm:w-auto",placeholder:"Method details",value:m.methodDetail||"",onChange:f=>He(s,"feeds",p,{methodDetail:f.target.value})})]}),t.jsx("div",{className:"sm:col-span-7",children:t.jsx("input",{className:"border rounded-lg px-2 py-1 text-xs w-full",placeholder:"Notes",value:m.notes||"",onChange:f=>He(s,"feeds",p,{notes:f.target.value})})}),t.jsxs("div",{className:"sm:col-span-7 flex justify-end items-center gap-2 flex-wrap",children:[t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>He(s,"feeds",p,{refused:!0}),children:"Mark refused"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600",onClick:()=>u("feeds",p),children:"Delete"})]})]},p)),!e.logs.feeds.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Weights"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=ze(new Date);s(p=>({...p,logs:{...p.logs,weights:[...p.logs.weights,{date:m,grams:0,notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:r,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.weights.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:b=>He(s,"weights",p,{date:b.target.value})}),t.jsx("input",{type:"number",className:"border rounded-lg px-2 py-1",placeholder:"grams",value:m.grams,onChange:b=>He(s,"weights",p,{grams:Number(b.target.value)||0})}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:b=>He(s,"weights",p,{notes:b.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-5",onClick:()=>u("weights",p),children:"Delete"})]},p)),!e.logs.weights.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Sheds"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=ze(new Date);s(p=>({...p,logs:{...p.logs,sheds:[...p.logs.sheds,{date:m,complete:!0,notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:o,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.sheds.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:b=>He(s,"sheds",p,{date:b.target.value})}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!m.complete,onChange:b=>He(s,"sheds",p,{complete:b.target.checked})}),"Complete"]}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:b=>He(s,"sheds",p,{notes:b.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-5",onClick:()=>u("sheds",p),children:"Delete"})]},p)),!e.logs.sheds.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Cleanings"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=ze(new Date);s(p=>({...p,logs:{...p.logs,cleanings:[...p.logs.cleanings,{date:m,deep:!1,notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:c,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.cleanings.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:b=>He(s,"cleanings",p,{date:b.target.value})}),t.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!m.deep,onChange:b=>He(s,"cleanings",p,{deep:b.target.checked})}),"Deep clean"]}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:b=>He(s,"cleanings",p,{notes:b.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-5",onClick:()=>u("cleanings",p),children:"Delete"})]},p)),!e.logs.cleanings.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]}),t.jsxs("section",{children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"font-medium text-sm",children:"Meds"}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg",onClick:()=>{const m=ze(new Date);s(p=>({...p,logs:{...p.logs,meds:[...p.logs.meds,{date:m,drug:"",dose:"",notes:""}]}}))},children:"+ Add"})]}),t.jsxs("div",{ref:d,className:"mt-2 space-y-2 max-h-40 overflow-auto",children:[e.logs.meds.map((m,p)=>t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 items-center",children:[t.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1",value:m.date,onChange:b=>He(s,"meds",p,{date:b.target.value})}),t.jsx("input",{className:"border rounded-lg px-2 py-1",placeholder:"Drug",value:m.drug||"",onChange:b=>He(s,"meds",p,{drug:b.target.value})}),t.jsx("input",{className:"border rounded-lg px-2 py-1",placeholder:"Dose",value:m.dose||"",onChange:b=>He(s,"meds",p,{dose:b.target.value})}),t.jsx("input",{className:"border rounded-lg px-2 py-1 md:col-span-2",placeholder:"Notes",value:m.notes||"",onChange:b=>He(s,"meds",p,{notes:b.target.value})}),t.jsx("button",{className:"text-xs px-2 py-1 border rounded-lg text-rose-600 md:col-start-6",onClick:()=>u("meds",p),children:"Delete"})]},p)),!e.logs.meds.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No records."})]})]})]})}function wd({snakes:e,pairings:s,theme:n="blue",onOpenPairing:l}){const a=new Date,[r,o]=h.useState(a.getFullYear()),[c,d]=h.useState(a.getMonth()),[u,m]=h.useState([]),[p,b]=h.useState({feeds:!0,weights:!0,cleanings:!0,sheds:!0,meds:!0,breeding:!0,clutch:!0}),[f,N]=h.useState(null),S=h.useMemo(()=>Object.fromEntries(e.filter(g=>g.sex==="M").map(g=>[g.id,g])),[e]),A=h.useMemo(()=>Object.fromEntries(e.filter(g=>g.sex==="F").map(g=>[g.id,g])),[e]),E=Cd(r,c),y=h.useCallback(g=>{b(I=>({...I,[g]:!I[g]}))},[]),_=h.useCallback(g=>{N(I=>I===g?null:g)},[]),U=h.useMemo(()=>[{key:"feeds",label:"Feeds"},{key:"weights",label:"Weights"},{key:"cleanings",label:"Cleaning"},{key:"sheds",label:"Sheds"},{key:"meds",label:"Meds"},{key:"breeding",label:"Breeding appointments"},{key:"clutch",label:"Clutch actions"}],[]),L=h.useCallback(g=>{let I=c+g,D=r;for(;I<0;)I+=12,D-=1;for(;I>11;)I-=12,D+=1;o(D),d(I)},[c,r]),T=h.useCallback(g=>{o(I=>I+g)},[]),G=h.useCallback(()=>{const g=Kn(r,c),I=[],D={};s.forEach(k=>{(k.appointments||[]).forEach(oe=>{var P;const $=new Date(oe.date);if($.getFullYear()!==r||$.getMonth()!==c)return;D[k.maleId]||(D[k.maleId]={});const j=$.getDate();D[k.maleId][j]||(D[k.maleId][j]=[]),D[k.maleId][j].push({pairing:k,appt:oe,femaleName:((P=A[k.femaleId])==null?void 0:P.name)||k.femaleId})})}),Object.keys(D).forEach(k=>{const oe=D[k];Object.keys(oe).map($=>Number($)).sort(($,j)=>$-j).forEach($=>{const j=oe[$].sort((q,V)=>(q.femaleName||"").localeCompare(V.femaleName||"")),P=new Set,te=q=>{for(const V of P)if(Math.abs(V-q)<3)return!1;return!0},ce=()=>{for(let V=0;V<50;V++){let re;V===0?re=0:V%2===1?re=(V+1)/2*3:re=-(V/2)*3;const ae=$+re;if(!(ae<1||ae>g)&&!P.has(ae)&&te(ae))return ae}return null};for(let q=0;q<j.length;q++){const V=j[q];let re=ce();if(re===null){let pe=null;for(let we=0;we<=g;we++){const Ie=[$-we,$+we].filter(Y=>Y>=1&&Y<=g);for(const Y of Ie)if(!P.has(Y)&&te(Y)){pe=Y;break}if(pe!==null)break}re=pe}if(re===null){for(let pe=1;pe<=g;pe++)if(!P.has(pe)){re=pe;break}}re===null&&(re=Math.min(Math.max($,1),g)),P.add(re),re+1<=g&&P.add(re+1),re+2<=g&&P.add(re+2);const ae=new Date(r,c,re);for(let pe=0;pe<3;pe++){const we=new Date(ae);we.setDate(we.getDate()+pe),we.getFullYear()===r&&we.getMonth()===c&&I.push({date:ze(we),maleId:k,femaleId:V.pairing.femaleId,pairingId:V.pairing.id,apptId:V.appt.id,type:"pairing",spanOffset:pe,notes:V.appt.notes||"",lockObserved:!!V.appt.lockObserved,lockLoggedAt:V.appt.lockLoggedAt||null})}}})}),s.forEach(k=>{var $,j,P,te,X,ce,q,V;const oe=(re,ae)=>{if(!re)return;const pe=new Date(re);Number.isNaN(pe.getTime())||pe.getFullYear()!==r||pe.getMonth()!==c||I.push({date:ze(pe),type:"clutch",stage:ae,pairingId:k.id,maleId:k.maleId,femaleId:k.femaleId})};($=k==null?void 0:k.ovulation)!=null&&$.observed&&((j=k==null?void 0:k.ovulation)!=null&&j.date)&&oe(k.ovulation.date,"ovulation"),(P=k==null?void 0:k.preLayShed)!=null&&P.observed&&((te=k==null?void 0:k.preLayShed)!=null&&te.date)&&oe(k.preLayShed.date,"preLay"),(X=k==null?void 0:k.clutch)!=null&&X.recorded&&((ce=k==null?void 0:k.clutch)!=null&&ce.date)&&oe(k.clutch.date,"clutch"),(q=k==null?void 0:k.hatch)!=null&&q.recorded&&((V=k==null?void 0:k.hatch)!=null&&V.date)&&oe(k.hatch.date,"hatch")}),e.forEach(k=>{const oe=k.logs||{},$=j=>{(oe[j]||[]).forEach(P=>{try{const te=new Date(P.date);te.getFullYear()===r&&te.getMonth()===c&&I.push({date:ze(te),type:"activity",activityKey:j,snakeId:k.id,entry:P})}catch{}})};["feeds","weights","sheds","cleanings","meds"].forEach($)}),m(I)},[r,c,s,A,e]);h.useEffect(()=>{G()},[G]);const H=h.useMemo(()=>u.filter(g=>{if(g.type==="activity"){const I=g.activityKey;return I?p[I]!==!1:!0}return g.type==="pairing"?!(p.breeding===!1||f&&g.maleId&&g.maleId!==f):g.type==="clutch"?!(p.clutch===!1||f&&g.maleId&&g.maleId!==f):!(f&&g.maleId&&g.maleId!==f)}),[u,p,f]),ee=h.useMemo(()=>Array.from(new Set(u.filter(I=>I.type==="pairing").map(I=>I.maleId).filter(Boolean))).map(I=>{var D;return{id:I,name:((D=S[I])==null?void 0:D.name)||I,colors:I?ya(I,n):null,isActive:f===I}}),[u,S,n,f]);return t.jsxs("div",{className:"bg-white border rounded-2xl shadow-sm",children:[t.jsxs("div",{className:"px-4 py-3 border-b flex flex-wrap items-center gap-3",children:[t.jsx("div",{className:"font-semibold mr-2",children:"Monthly calendar"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>L(-1),"aria-label":"Previous month",children:"←"}),t.jsx("select",{className:"border rounded-lg px-2 py-1 text-sm",value:c,onChange:g=>d(Number(g.target.value)),children:Array.from({length:12},(g,I)=>I).map(g=>t.jsx("option",{value:g,children:new Date(2e3,g,1).toLocaleString("en",{month:"long"})},g))}),t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>L(1),"aria-label":"Next month",children:"→"})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>T(-1),"aria-label":"Previous year",children:"←"}),t.jsx("input",{className:"border rounded-lg px-2 py-1 w-24",type:"number",value:r,onChange:g=>o(Number(g.target.value)||r)}),t.jsx("button",{type:"button",className:"px-2 py-1 border rounded-lg text-xs",onClick:()=>T(1),"aria-label":"Next year",children:"→"})]}),t.jsx("button",{className:ne("ml-auto px-3 py-2 rounded-xl text-sm",Ee(n,!0)),onClick:G,children:"Refresh"})]}),t.jsx("div",{className:"px-4 py-3 border-b bg-neutral-50",children:t.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs text-neutral-700",children:U.map(g=>t.jsxs("label",{className:ne("flex items-center gap-2 rounded-lg border px-2 py-1 bg-white",p[g.key]?"border-sky-200 shadow-sm":"border-neutral-200 opacity-80"),children:[t.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:!!p[g.key],onChange:()=>y(g.key)}),t.jsx("span",{children:g.label})]},g.key))})}),t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"grid grid-cols-7 text-xs font-medium text-neutral-500",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(g=>t.jsx("div",{className:"p-2",children:g},g))}),t.jsx("div",{className:"grid grid-cols-7 gap-px bg-neutral-200 rounded-lg overflow-hidden",children:E.map((g,I)=>t.jsxs("div",{className:ne("min-h[110px] bg-white p-2",g.current?"":"bg-neutral-50"),children:[t.jsx("div",{className:"text-xs text-neutral-500",children:g.day}),H.filter(D=>D.date===jd(g.year,g.month,g.day)).map((D,k)=>{var ce,q,V,re,ae,pe,we,Ie,Y,ue,M,R;if(D.type==="activity"){const W=nl[D.activityKey]||{bg:"#efefef",border:"#ddd"},ie=e.find(he=>he.id===D.snakeId);if(D.activityKey==="feeds"&&D.entry){const he=D.entry,be=(he.feed||he.item||"").trim(),Ce=(he.size||"").trim(),je=typeof he.weightGrams=="number"&&he.weightGrams>0?`${he.weightGrams} g`:typeof he.grams=="number"&&he.grams>0?`${he.grams} g`:"",Ne=he.method?he.methodDetail?`${he.method} (${he.methodDetail})`:he.method:"";let Z="";if(!he.refused){const J=[];be&&J.push(be),Ce&&J.push(Ce),je&&J.push(je),Ne&&J.push(Ne),Z=J.join(" • ")}const z=he.refused?"Refused feed":Z||"Feed";return t.jsx("div",{className:ne("text-[11px] px-2 py-1 rounded-full border flex items-start gap-2"),style:{backgroundColor:W.bg,borderColor:W.border},children:t.jsxs("div",{className:"truncate",children:[t.jsxs("div",{className:"font-medium truncate",children:[(ie==null?void 0:ie.name)||D.snakeId," • ",z]}),he.refused&&Z?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:Z}):null,he.notes?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:he.notes}):null]})},k)}return t.jsxs("div",{className:ne("text-[11px] px-2 py-0.5 rounded-full border flex items-center gap-2"),style:{backgroundColor:W.bg,borderColor:W.border},children:[t.jsx("span",{className:"font-medium",children:(ie==null?void 0:ie.name)||D.snakeId}),t.jsx("span",{className:"text-xs text-neutral-700",children:D.activityKey.replace(/s$/,"")})]},k)}if(D.type==="clutch"){const W=s.find(Ne=>Ne.id===D.pairingId),ie=((ce=S[D.maleId])==null?void 0:ce.name)||D.maleId,he=((q=A[D.femaleId])==null?void 0:q.name)||D.femaleId,be={ovulation:"Ovulation observed",preLay:"Pre-lay shed",clutch:"Clutch laid",hatch:"Hatch recorded"},Ce={ovulation:"border-sky-200 bg-sky-50",preLay:"border-amber-200 bg-amber-50",clutch:"border-rose-200 bg-rose-50",hatch:"border-emerald-200 bg-emerald-50"};let je="";if(D.stage==="clutch"){const Ne=(V=W==null?void 0:W.clutch)==null?void 0:V.eggsTotal,Z=(re=W==null?void 0:W.clutch)==null?void 0:re.slugs,z=[];typeof Ne=="number"&&Number.isFinite(Ne)&&z.push(`Eggs: ${Ne}`),typeof Z=="number"&&Number.isFinite(Z)&&z.push(`Slugs: ${Z}`),z.length?je=z.join(" • "):(ae=W==null?void 0:W.clutch)!=null&&ae.notes&&(je=W.clutch.notes)}else if(D.stage==="hatch"){const Ne=(pe=W==null?void 0:W.hatch)==null?void 0:pe.hatchedCount;typeof Ne=="number"&&Number.isFinite(Ne)?je=`Hatched: ${Ne}`:(we=W==null?void 0:W.hatch)!=null&&we.notes&&(je=W.hatch.notes)}else D.stage==="preLay"?(Ie=W==null?void 0:W.preLayShed)!=null&&Ie.intervalFromOvulation&&Number.isFinite(W.preLayShed.intervalFromOvulation)?je=`${W.preLayShed.intervalFromOvulation} days after ovulation`:(Y=W==null?void 0:W.preLayShed)!=null&&Y.notes&&(je=W.preLayShed.notes):D.stage==="ovulation"&&(je=((ue=W==null?void 0:W.ovulation)==null?void 0:ue.notes)||"");return t.jsxs("button",{onClick:()=>{l&&l(D.pairingId)},className:ne("text-xs px-2 py-1 rounded-lg border flex flex-col text-left w-full",Ce[D.stage]||"border-neutral-200 bg-neutral-50"),children:[t.jsx("div",{className:"font-medium truncate",children:be[D.stage]||"Clutch action"}),t.jsxs("div",{className:"text-[11px] text-neutral-500 truncate",children:[ie," × ",he]}),je?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:je}):null]},k)}const oe=s.find(W=>W.id===D.pairingId),$=((M=S[D.maleId])==null?void 0:M.name)||D.maleId,j=((R=A[D.femaleId])==null?void 0:R.name)||D.femaleId,P=ya(D.maleId,n),te=D.spanOffset===0&&D.lockObserved&&D.lockLoggedAt?Ra(D.lockLoggedAt):null;let X=null;return D.spanOffset===0&&D.notes&&(X=D.notes.split(`
`).map(ie=>ie.trim()).filter(Boolean).find(ie=>!te||ie!==te)||null),t.jsxs("button",{onClick:()=>{l&&l(D.pairingId)},className:"text-xs px-2 py-1 rounded-lg border flex items-center gap-2 text-left w-full",style:{borderColor:P.border,background:P.fill},children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-1 align-middle",style:{backgroundColor:P.dot}}),t.jsxs("div",{className:"truncate",children:[t.jsxs("div",{className:"font-medium truncate",children:[$," × ",j]}),oe!=null&&oe.label?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:oe.label}):null,te?t.jsx("div",{className:"text-[11px] text-emerald-600 truncate",children:te}):null,X?t.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:X}):null]})]},k)})]},I))}),t.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[ee.map(g=>{const I=g.colors?{borderColor:g.colors.border,background:g.isActive?g.colors.fill:void 0,opacity:f&&!g.isActive?.5:1}:void 0;return t.jsxs("button",{type:"button",onClick:()=>_(g.id),className:"text-xs px-2 py-1 border rounded-lg flex items-center gap-1 transition-opacity",style:I,"aria-pressed":g.isActive,children:[t.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-1 align-middle",style:g.colors?{backgroundColor:g.colors.dot}:void 0}),g.name]},g.id)}),!ee.length&&t.jsx("div",{className:"text-xs text-neutral-500",children:"No appointments in this view."})]})]})]})}function Kn(e,s){return new Date(e,s+1,0).getDate()}function jd(e,s,n){return`${e}-${String(s+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`}function Cd(e,s){const n=new Date(e,s,1).getDay(),l=Kn(e,s),a=s-1,r=a<0?e-1:e,o=Kn(r,(a+12)%12),c=[];for(let m=0;m<n;m++)c.push({year:r,month:(a+12)%12,day:o-n+1+m,current:!1});for(let m=1;m<=l;m++)c.push({year:e,month:s,day:m,current:!0});const d=(s+1)%12,u=d===0?e+1:e;for(;c.length%7;)c.push({year:u,month:d,day:c.length%7,current:!1});return c}function Sd(e){const s=typeof e=="string"||typeof e=="number"?String(e):"";let n=0;for(let l=0;l<s.length;l++)n=n*31+s.charCodeAt(l)>>>0;return n}function ya(e,s="blue"){const l=Sd(e)%360,a=s==="dark"?55:62,r=s==="dark"?55:45,o=s==="dark"?38:50,c=s==="dark"?22:92,d=s==="dark"?.35:.25;return{border:`hsl(${l}, ${a}%, ${o}%)`,dot:`hsl(${l}, ${a}%, ${r}%)`,fill:`hsla(${l}, ${a}%, ${c}%, ${d})`}}const nl={feeds:{bg:"#9EB7B8",border:"#9EB7B8"},weights:{bg:"#BBC7B4",border:"#BBC7B4"},cleanings:{bg:"#E6B6A0",border:"#E6B6A0"},sheds:{bg:"#ECD1A5",border:"#ECD1A5"},meds:{bg:"#DCAD9A",border:"#DCAD9A"},groups:{bg:"#FAF5EE",border:"#FAF5EE"},pairing:{bg:"#ECB5CE",border:"#ECB5CE"}},kd="bg-violet-200 border border-violet-300 text-violet-800",ln={Het:kd,Recessive:"bg-violet-300 border border-violet-400","Incomplete Dominant":"bg-rose-300 border border-rose-400",Dominant:"bg-sky-300 border border-sky-400",Other:"bg-emerald-300 border border-emerald-400"};function Ad(e,s){if(pc(e))return ln.Het;const n=s||rs(e);return ln[n]||ln.Other}const Dd=[{key:"Recessive",label:"Recessive"},{key:"Het",label:"Het / Possible Het"},{key:"Incomplete Dominant",label:"Incomplete Dominant"},{key:"Dominant",label:"Dominant"},{key:"Other",label:"Other / Polygenic"}],Na={sm:{container:"text-[11px]",label:"text-[10px]",chip:"text-[11px] px-2 py-0.5"},md:{container:"text-sm",label:"text-[11px]",chip:"text-xs px-2 py-0.5"},xs:{container:"text-[10px]",label:"text-[9px]",chip:"text-[10px] px-1.5 py-0.5"}};function ar({label:e,genes:s=[],size:n="sm",className:l}){const a=Array.isArray(s)?s.filter(Boolean):[];if(!a.length)return null;const r=Na[n]||Na.sm;return t.jsxs("div",{className:ne("flex flex-wrap items-center gap-1 leading-snug",r.container,l),children:[t.jsxs("span",{className:ne("uppercase tracking-wide text-neutral-500 mr-1",r.label),children:[e,":"]}),a.map((o,c)=>{const d=rs(o),u=Ad(o,d);return t.jsx("span",{className:ne("inline-flex items-center rounded-md border font-medium break-words",r.chip,u),children:o},`${e}-${o}-${c}`)})]})}function Ed({className:e}){return t.jsx("div",{className:ne("flex flex-wrap items-center justify-center gap-3 text-[11px] font-normal",e),children:Dd.map(s=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:ne("inline-block h-3 w-3 rounded-sm",ln[s.key])}),t.jsx("span",{className:"text-neutral-600 whitespace-nowrap",children:s.label})]},s.key))})}function Id({theme:e="blue",className:s}){const[n,l]=h.useState(!1);return h.useEffect(()=>{function a(){l(window.scrollY>200)}return window.addEventListener("scroll",a,{passive:!0}),a(),()=>window.removeEventListener("scroll",a)},[]),t.jsx("button",{type:"button",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:ne("fixed bottom-6 right-6 z-50 rounded-full shadow-lg border backdrop-blur-sm transition-opacity duration-200 flex items-center justify-center h-12 w-12 text-white",n?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none",Ee(e,!0),s),"aria-label":"Scroll to top",children:t.jsx("span",{className:"text-xl leading-none",children:"↑"})})}function ts(e,s){const n=new Date(e);return n.setDate(n.getDate()+s),`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`}const Ld=Yl.createRoot(document.getElementById("root"));Ld.render(t.jsx(Wl.StrictMode,{children:t.jsx(_c,{})}));
